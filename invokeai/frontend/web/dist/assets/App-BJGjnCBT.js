var qq=Object.defineProperty;var Q_=e=>{throw TypeError(e)};var Kq=(e,t,n)=>t in e?qq(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var k=(e,t,n)=>Kq(e,typeof t!="symbol"?t+"":t,n),qv=(e,t,n)=>t.has(e)||Q_("Cannot "+n);var X=(e,t,n)=>(qv(e,t,"read from private field"),n?n.call(e):t.get(e)),Tt=(e,t,n)=>t.has(e)?Q_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Je=(e,t,n,s)=>(qv(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),He=(e,t,n)=>(qv(e,t,"access private method"),n);var Dg=(e,t,n,s)=>({set _(i){Je(e,t,i,n)},get _(){return X(e,t,s)}});import{g as Nu,w as Zq,a as A3,b as Yq,r as u,i as Af,c as Kv,d as Vh,I as Xq,e as Qq,t as J_,f as T3,S as Jq,h as eK,j as tK,k as nK,l as e4,m as E3,n as M3,o as sK,p as rK,q as iK,s as oK,v as aK,u as lK,x as Tf,y as cK,z as uK,A as kt,B as Fs,C as ce,D as Oe,E as rs,F as pe,G as Fu,H as z,J as M,K as dK,L as dS,M as ve,N as I,O as hK,P as fK,Q as ws,R as lp,T as On,$ as cp,U as l0,V as t4,W as pt,X as pK,Y as gK,Z as P3,_ as up,a0 as Ar,a1 as Ge,a2 as dp,a3 as r,a4 as ti,a5 as mK,a6 as L3,a7 as D3,a8 as R3,a9 as yK,aa as vK,ab as Wn,ac as hS,ad as qe,ae as O3,af as fS,ag as pS,ah as Jr,ai as Te,aj as N3,ak as gS,al as F3,am as B3,an as $3,ao as V3,ap as G3,aq as z3,ar as jn,as as bK,at as et,au as Bu,av as H3,aw as lt,ax as W3,ay as hp,az as Tn,aA as U3,aB as xs,aC as ut,aD as q3,aE as xK,aF as K3,aG as CK,aH as Z3,aI as Pc,aJ as Y3,aK as X3,aL as Q3,aM as J3,aN as mS,aO as H1,aP as n4,aQ as Kt,aR as Zl,aS as tn,aT as SK,aU as wK,aV as s4,aW as yS,aX as Tr,aY as A,aZ as q,a_ as Z,a$ as Fe,b0 as eE,b1 as vS,b2 as Yl,b3 as Va,b4 as tE,b5 as bt,b6 as jK,b7 as Ei,b8 as W1,b9 as Ra,ba as $u,bb as Xl,bc as fp,bd as U1,be as _e,bf as kK,bg as Kx,bh as Zx,bi as Ga,bj as bS,bk as _K,bl as r4,bm as IK,bn as AK,bo as c0,bp as Yx,bq as pp,br as TK,bs as nE,bt as Ls,bu as ss,bv as Mi,bw as Rl,bx as xS,by as CS,bz as u0,bA as Xx,bB as gp,bC as SS,bD as wS,bE as q1,bF as EK,bG as MK,bH as yc,bI as Gh,bJ as sE,bK as me,bL as Et,bM as Er,bN as rE,bO as ni,bP as nr,bQ as si,bR as Mr,bS as yo,bT as sr,bU as ye,bV as vo,bW as Ql,bX as mp,bY as jS,bZ as te,b_ as kn,b$ as Lt,c0 as PK,c1 as Cr,c2 as LK,c3 as ds,c4 as Pi,c5 as Vt,c6 as iE,c7 as i4,c8 as DK,c9 as RK,ca as Pt,cb as at,cc as K1,cd as oE,ce as OK,cf as aE,cg as kS,ch as _S,ci as yp,cj as lE,ck as Se,cl as $e,cm as Rt,cn as cE,co as Ol,cp as Fn,cq as Un,cr as za,cs as uE,ct as Bn,cu as dE,cv as qn,cw as dn,cx as rt,cy as NK,cz as FK,cA as BK,cB as $K,cC as Ze,cD as Ae,cE as dt,cF as rr,cG as IS,cH as VK,cI as hE,cJ as Z1,cK as GK,cL as zK,cM as HK,cN as WK,cO as UK,cP as qK,cQ as KK,cR as ZK,cS as fE,cT as pE,cU as AS,cV as TS,cW as ES,cX as MS,cY as gE,cZ as he,c_ as vs,c$ as De,d0 as Js,d1 as vp,d2 as YK,d3 as XK,d4 as QK,d5 as Yt,d6 as Xt,d7 as It,d8 as Jl,d9 as Qo,da as ji,db as vc,dc as JK,dd as kr,de as bi,df as eZ,dg as bp,dh as PS,di as xp,dj as mE,dk as yE,dl as tZ,dm as is,dn as oe,dp as LS,dq as Jo,dr as jt,ds as lo,dt as nZ,du as Hi,dv as To,dw as DS,dx as sZ,dy as rZ,dz as Zs,dA as Cp,dB as iZ,dC as vE,dD as bE,dE as oZ,dF as xE,dG as aZ,dH as lZ,dI as cZ,dJ as uZ,dK as dZ,dL as ec,dM as tc,dN as Sn,dO as Vu,dP as Ln,dQ as hZ,dR as fZ,dS as pZ,dT as gZ,dU as mZ,dV as yZ,dW as vZ,dX as bZ,dY as xZ,dZ as CZ,d_ as SZ,d$ as CE,e0 as wZ,e1 as jZ,e2 as kZ,e3 as _Z,e4 as d0,e5 as Y1,e6 as RS,e7 as IZ,e8 as AZ,e9 as Al,ea as Qn,eb as TZ,ec as EZ,ed as SE,ee as Gu,ef as wE,eg as jE,eh as zu,ei as Hu,ej as X1,ek as MZ,el as _n,em as Pr,en as PZ,eo as Q1,ep as J1,eq as ru,er as ey,es as Ds,et as Wu,eu as LZ,ev as xr,ew as DZ,ex as RZ,ey as OZ,ez as NZ,eA as OS,eB as kE,eC as FZ,eD as Qx,eE as BZ,eF as Ys,eG as wa,eH as Jx,eI as Rm,eJ as _E,eK as IE,eL as AE,eM as $Z,eN as TE,eO as EE,eP as ME,eQ as PE,eR as VZ,eS as LE,eT as NS,eU as e2,eV as Xr,eW as Dt,eX as Sp,eY as GZ,eZ as DE,e_ as ts,e$ as ty,f0 as Cs,f1 as Hc,f2 as RE,f3 as zZ,f4 as o4,f5 as ny,f6 as OE,f7 as NE,f8 as HZ,f9 as FE,fa as BE,fb as $E,fc as FS,fd as VE,fe as WZ,ff as GE,fg as zE,fh as t2,fi as UZ,fj as qZ,fk as KZ,fl as bc,fm as Gr,fn as co,fo as Ji,fp as ZZ,fq as HE,fr as a4,fs as Zv,ft as l4,fu as c4,fv as u4,fw as d4,fx as n2,fy as YZ,fz as Do,fA as s2,fB as WE,fC as UE,fD as Rg,fE as XZ,fF as No,fG as qE,fH as KE,fI as ZE,fJ as YE,fK as XE,fL as QZ,fM as JZ,fN as Ha,fO as r2,fP as eY,fQ as h4,fR as f4,fS as h0,fT as tY,fU as nY,fV as QE,fW as sY,fX as rY,fY as iY,fZ as oY,f_ as aY,f$ as JE,g0 as eM,g1 as i2,g2 as Wc,g3 as wp,g4 as lY,g5 as cY,g6 as uY,g7 as dY,g8 as hY,g9 as BS,ga as fY,gb as pY,gc as gY,gd as mY,ge as o2,gf as tM,gg as yY,gh as vY,gi as bY,gj as p4,gk as xY,gl as sy,gm as jp,gn as $S,go as nM,gp as CY,gq as SY,gr as wY,gs as zh,gt as jY,gu as kY,gv as _Y,gw as IY,gx as AY,gy as TY,gz as EY,gA as MY,gB as PY,gC as LY,gD as DY,gE as RY,gF as OY,gG as NY,gH as FY,gI as Li,gJ as Wa,gK as kp,gL as ry,gM as iy,gN as BY,gO as $Y,gP as sM,gQ as rM,gR as iM,gS as _p,gT as oM,gU as aM,gV as VY,gW as iu,gX as a2,gY as VS,gZ as lM,g_ as cM,g$ as GS,h0 as Yv,h1 as GY,h2 as zY,h3 as HY,h4 as Hh,h5 as uM,h6 as dM,h7 as hM,h8 as nc,h9 as WY,ha as UY,hb as xc,hc as dl,hd as Ip,he as qY,hf as Uu,hg as sc,hh as KY,hi as ZY,hj as YY,hk as XY,hl as fM,hm as pM,hn as oy,ho as QY,hp as gM,hq as JY,hr as Ua,hs as eX,ht as zS,hu as tX,hv as mM,hw as yM,hx as nX,hy as vM,hz as bM,hA as xM,hB as ir,hC as sX,hD as rX,hE as ay,hF as iX,hG as oX,hH as aX,hI as rc,hJ as lX,hK as Ap,hL as g4,hM as cX,hN as uX,hO as dX,hP as hX,hQ as fX,hR as pX,hS as gX,hT as mX,hU as yX,hV as vX,hW as bX,hX as xX,hY as CX,hZ as SX,h_ as wX,h$ as jX,i0 as kX,i1 as CM,i2 as SM,i3 as _X,i4 as IX,i5 as AX,i6 as TX,i7 as EX,i8 as MX,i9 as Tp,ia as PX,ib as LX,ic as DX,id as RX,ie as OX,ig as m4,ih as NX,ii as FX,ij as BX,ik as $X,il as VX,im as HS,io as GX,ip as zX,iq as HX,ir as Ef,is as f0,it as qu,iu as wM,iv as Ep,iw as jM,ix as WX,iy as WS,iz as ly,iA as UX,iB as qX,iC as KX,iD as ZX,iE as YX,iF as XX,iG as QX,iH as JX,iI as y4,iJ as eQ,iK as tQ,iL as kM,iM as nQ,iN as sQ,iO as rQ,iP as iQ,iQ as oQ,iR as US,iS as _M,iT as qS,iU as aQ,iV as lQ,iW as l2,iX as cQ,iY as uQ,iZ as cy,i_ as dQ,i$ as Mp,j0 as IM,j1 as KS,j2 as hQ,j3 as ZS,j4 as Ur,j5 as c2,j6 as v4,j7 as u2,j8 as ea,j9 as fQ,ja as pQ,jb as gQ,jc as YS,jd as mQ,je as AM,jf as TM,jg as uy,jh as uo,ji as yQ,jj as EM,jk as vQ,jl as MM,jm as bQ,jn as PM,jo as xQ,jp as sf,jq as p0,jr as CQ,js as LM,jt as Ku,ju as bo,jv as DM,jw as RM,jx as SQ,jy as wQ,jz as OM,jA as NM,jB as dy,jC as jQ,jD as Zu,jE as Ue,jF as kQ,jG as _Q,jH as ht,jI as ki,jJ as b4,jK as IQ,jL as Xv,jM as AQ,jN as x4,jO as C4,jP as S4,jQ as w4,jR as TQ,jS as EQ,jT as j4,jU as MQ,jV as k4,jW as PQ,jX as Qv,jY as LQ,jZ as _4,j_ as I4,j$ as A4,k0 as DQ,k1 as Jv,k2 as T4,k3 as RQ,k4 as OQ,k5 as E4,k6 as M4,k7 as P4,k8 as NQ,k9 as FQ,ka as BQ,kb as $Q,kc as ic,kd as VQ,ke as GQ,kf as FM,kg as zQ,kh as BM,ki as HQ,kj as WQ,kk as UQ,kl as qQ,km as hy,kn as KQ,ko as ZQ,kp as YQ,kq as XQ,kr as Pp,ks as QQ,kt as ho,ku as JQ,kv as eJ,kw as XS,kx as tJ,ky as nJ,kz as sJ,kA as rJ,kB as iJ,kC as oJ,kD as aJ,kE as lJ,kF as cJ,kG as uJ,kH as dJ,kI as hJ,kJ as fJ,kK as pJ,kL as gJ,kM as mJ,kN as yJ,kO as vJ,kP as bJ,kQ as xJ,kR as CJ,kS as SJ,kT as wJ,kU as jJ,kV as kJ,kW as _J,kX as IJ,kY as AJ,kZ as TJ,k_ as EJ,k$ as MJ,l0 as PJ,l1 as LJ,l2 as DJ,l3 as RJ,l4 as OJ,l5 as NJ,l6 as FJ,l7 as BJ,l8 as $J,l9 as VJ,la as GJ,lb as zJ,lc as HJ,ld as WJ,le as UJ,lf as qJ,lg as KJ,lh as ZJ,li as YJ,lj as XJ,lk as QJ,ll as JJ,lm as eee,ln as tee,lo as nee,lp as see,lq as ree,lr as iee,ls as oee,lt as aee,lu as $M,lv as bl,lw as QS,lx as VM,ly as GM,lz as lee,lA as zM,lB as HM,lC as WM,lD as UM,lE as qM,lF as cee,lG as uee,lH as dee,lI as KM,lJ as fy,lK as hee,lL as fee,lM as pee,lN as gee,lO as ZM,lP as mee,lQ as yee,lR as vee,lS as bee,lT as xee,lU as Cee,lV as fs,lW as See,lX as wee,lY as Yu,lZ as YM,l_ as Su,l$ as py,m0 as jee,m1 as kee,m2 as g0,m3 as _ee,m4 as Iee,m5 as XM,m6 as QM,m7 as JM,m8 as Aee,m9 as L4,ma as Tee,mb as Eee,mc as Mee,md as eP,me as JS,mf as Pee,mg as Lee,mh as Dee,mi as Ree,mj as tP,mk as nP,ml as sP,mm as rP,mn as Oee,mo as Nee,mp as d2,mq as ew,mr as Fee,ms as Bee,mt as Fo,mu as tw,mv as $ee,mw as Vee,mx as Gee,my as gy,mz as Om,mA as zee,mB as nw,mC as Lp,mD as iP,mE as Hee,mF as Wee,mG as Uee,mH as oP,mI as qee,mJ as Kee,mK as Zee,mL as Yee,mM as Xee,mN as aP,mO as lP,mP as Qee,mQ as Jee,mR as ete,mS as tte,mT as nte,mU as ste,mV as rte,mW as ite,mX as ote,mY as ate,mZ as Og,m_ as lte,m$ as cte,n0 as ute,n1 as dte,n2 as hte,n3 as fte,n4 as pte,n5 as sw,n6 as cP,n7 as uP,n8 as gte,n9 as mte,na as yte,nb as dP,nc as vte,nd as hP,ne as fP,nf as bte,ng as xte,nh as Cte,ni as Xu,nj as Ste,nk as wte,nl as jte,nm as kte,nn as _te,no as Ite,np as Ate,nq as Tte,nr as Ete,ns as Mte,nt as Pte,nu as Dp,nv as pP,nw as Lte,nx as Dte,ny as Rte,nz as Ote,nA as Nte,nB as Fte,nC as Bte,nD as $te,nE as Vte,nF as Gte,nG as zte,nH as Hte,nI as Wte,nJ as Ute,nK as qte,nL as rw,nM as Kte,nN as gP,nO as my,nP as Zte,nQ as mP,nR as yP,nS as Yte,nT as vP,nU as Xte,nV as bP,nW as iw,nX as Qte,nY as xP,nZ as Jte,n_ as ene,n$ as ow,o0 as aw,o1 as tne,o2 as nne,o3 as sne,o4 as rne,o5 as ine,o6 as one,o7 as ane,o8 as lw,o9 as lne,oa as cne,ob as Rp,oc as une,od as dne,oe as hne,of as fne,og as pne,oh as gne,oi as mne,oj as D4,ok as CP,ol as yne,om as vne,on as bne,oo as xne,op as Cne,oq as Sne,or as wne,os as SP,ot as jne,ou as kne,ov as _ne,ow as Ine,ox as R4,oy as Ane,oz as Tne,oA as Ene,oB as Mne,oC as Pne,oD as Lne,oE as Dne,oF as Rne,oG as One,oH as Nne,oI as Fne,oJ as Bne,oK as $ne,oL as Mf,oM as cw,oN as O4,oO as Vne,oP as Gne,oQ as zne,oR as Hne,oS as h2,oT as wP,oU as jP,oV as N4,oW as F4,oX as Op,oY as Wne,oZ as Une,o_ as Cc,o$ as yy,p0 as f2,p1 as vy,p2 as qne,p3 as Kne,p4 as Np,p5 as Zne,p6 as Yne,p7 as Xne,p8 as Qne,p9 as Jne,pa as ese,pb as tse,pc as kP,pd as nse,pe as sse,pf as rse,pg as ise,ph as ose,pi as ase,pj as lse,pk as cse,pl as use,pm as m0,pn as _P,po as p2,pp as dse,pq as hse,pr as Lc,ps as Ng,pt as ya,pu as ou,pv as mr,pw as uw,px as rf,py as Ki,pz as Tl,pA as IP,pB as fse,pC as pse,pD as gse,pE as AP,pF as TP,pG as EP,pH as by,pI as MP,pJ as PP,pK as mse,pL as yse,pM as vse,pN as bse,pO as xse,pP as Cse,pQ as Sse,pR as wse,pS as dw,pT as xy,pU as Wh,pV as LP,pW as DP,pX as RP,pY as jse,pZ as hw,p_ as OP,p$ as NP,q0 as Xs,q1 as FP,q2 as Fp,q3 as kse,q4 as BP,q5 as Qu,q6 as ja,q7 as ka,q8 as $P,q9 as _se,qa as Ise,qb as Ase,qc as Tse,qd as Ese,qe as Mse,qf as B4,qg as $4,qh as Pse,qi as Lse,qj as V4,qk as G4,ql as Dse,qm as Rse,qn as Ose,qo as Nse,qp as eb,qq as Fse,qr as Bse,qs as $se,qt as Vse,qu as Gse,qv as zse,qw as VP,qx as Hse,qy as Wse,qz as Use,qA as Cy,qB as qse,qC as Kse,qD as Zse,qE as Yse,qF as Xse,qG as Qse,qH as Jse,qI as ere,qJ as tre,qK as nre,qL as sre,qM as rre,qN as ire,qO as ore,qP as are,qQ as lre,qR as cre,qS as ure,qT as dre,qU as hre,qV as fre,qW as pre,qX as gre,qY as GP,qZ as mre,q_ as yre,q$ as vre,r0 as bre,r1 as xre,r2 as zP,r3 as Cre,r4 as Sre,r5 as wre,r6 as jre,r7 as kre,r8 as HP,r9 as _re,ra as Ire,rb as Are,rc as z4,rd as H4,re as Tre,rf as W4,rg as Ere,rh as Mre,ri as U4,rj as Dc,rk as Nm,rl as Pre,rm as Lre,rn as Dre,ro as Rre,rp as Ore,rq as Nre,rr as Fre,rs as WP,rt as q4,ru as Bre,rv as $re,rw as K4,rx as Z4,ry as Vre,rz as Gre,rA as zre,rB as Hre,rC as Wre,rD as Ure}from"./index-BPqcjo38.js";var tb,Y4;function qre(){return Y4||(Y4=1,tb={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),tb}var Kre=qre();const Zre=Nu(Kre);var Yre=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function X4(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(Zre[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var i=new RegExp(Yre),o=null;(o=i.exec(e))!==null;)if(o[0].trim())if(o[1]){var a=o[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),t.attrs[l[0]]=l[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var Xre=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,Qre=/^\s*$/,Jre=Object.create(null);function UP(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var i in n)s.push(i+'="'+n[i]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(UP,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var eie={parse:function(e,t){t||(t={}),t.components||(t.components=Jre);var n,s=[],i=[],o=-1,a=!1;if(e.indexOf("<")!==0){var l=e.indexOf("<");s.push({type:"text",content:l===-1?e:e.substring(0,l)})}return e.replace(Xre,function(c,d){if(a){if(c!=="</"+n.name+">")return;a=!1}var h,f=c.charAt(1)!=="/",p=c.startsWith("<!--"),g=d+c.length,m=e.charAt(g);if(p){var y=X4(c);return o<0?(s.push(y),s):((h=i[o]).children.push(y),s)}if(f&&(o++,(n=X4(c)).type==="tag"&&t.components[n.name]&&(n.type="component",a=!0),n.voidElement||a||!m||m==="<"||n.children.push({type:"text",content:e.slice(g,e.indexOf("<",g))}),o===0&&s.push(n),(h=i[o-1])&&h.children.push(n),i[o]=n),(!f||n.voidElement)&&(o>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(o--,n=o===-1?s:i[o]),!a&&m!=="<"&&m)){h=o===-1?s:i[o].children;var b=e.indexOf("<",g),C=e.slice(g,b===-1?void 0:b);Qre.test(C)&&(C=" "),(b>-1&&o+h.length>=0||C!==" ")&&h.push({type:"text",content:C})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+UP("",n)},"")}};const nb=(e,t)=>{var s;if(!e)return!1;const n=((s=e.props)==null?void 0:s.children)??e.children;return t?n.length>0:!!n},sb=e=>{var n,s;if(!e)return[];const t=((n=e.props)==null?void 0:n.children)??e.children;return(s=e.props)!=null&&s.i18nIsDynamicList?Uc(t):t},tie=e=>Array.isArray(e)&&e.every(u.isValidElement),Uc=e=>Array.isArray(e)?e:[e],nie=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},qP=(e,t)=>{if(!e)return"";let n="";const s=Uc(e),i=t!=null&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((o,a)=>{if(Af(o))n+=`${o}`;else if(u.isValidElement(o)){const{props:l,type:c}=o,d=Object.keys(l).length,h=i.indexOf(c)>-1,f=l.children;if(!f&&h&&!d)n+=`<${c}/>`;else if(!f&&(!h||d)||l.i18nIsDynamicList)n+=`<${a}></${a}>`;else if(h&&d===1&&Af(f))n+=`<${c}>${f}</${c}>`;else{const p=qP(f,t);n+=`<${a}>${p}</${a}>`}}else if(o===null)Kv("Trans: the passed in value is invalid - seems you passed in a null child.");else if(Vh(o)){const{format:l,...c}=o,d=Object.keys(c);if(d.length===1){const h=l?`${d[0]}, ${l}`:d[0];n+=`{{${h}}}`}else Kv("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",o)}else Kv("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",o)}),n},sie=(e,t,n,s,i,o)=>{if(t==="")return[];const a=s.transKeepBasicHtmlNodesFor||[],l=t&&new RegExp(a.map(b=>`<${b}`).join("|")).test(t);if(!e&&!l&&!o)return[t];const c={},d=b=>{Uc(b).forEach(v=>{Af(v)||(nb(v)?d(sb(v)):Vh(v)&&!u.isValidElement(v)&&Object.assign(c,v))})};d(e);const h=eie.parse(`<0>${t}</0>`),f={...c,...i},p=(b,C,v)=>{var w;const x=sb(b),S=m(x,C.children,v);return tie(x)&&S.length===0||(w=b.props)!=null&&w.i18nIsDynamicList?x:S},g=(b,C,v,x,S)=>{b.dummy?(b.children=C,v.push(u.cloneElement(b,{key:x},S?void 0:C))):v.push(...u.Children.map([b],w=>{const j={...w.props};return delete j.i18nIsDynamicList,u.createElement(w.type,{...j,key:x,ref:w.ref},S?null:C)}))},m=(b,C,v)=>{const x=Uc(b);return Uc(C).reduce((w,j,P)=>{var L,E;const T=((E=(L=j.children)==null?void 0:L[0])==null?void 0:E.content)&&n.services.interpolator.interpolate(j.children[0].content,f,n.language);if(j.type==="tag"){let O=x[parseInt(j.name,10)];v.length===1&&!O&&(O=v[0][j.name]),O||(O={});const F=Object.keys(j.attrs).length!==0?nie({props:j.attrs},O):O,_=u.isValidElement(F),R=_&&nb(j,!0)&&!j.voidElement,D=l&&Vh(F)&&F.dummy&&!_,$=Vh(e)&&Object.hasOwnProperty.call(e,j.name);if(Af(F)){const G=n.services.interpolator.interpolate(F,f,n.language);w.push(G)}else if(nb(F)||R){const G=p(F,j,v);g(F,G,w,P)}else if(D){const G=m(x,j.children,v);g(F,G,w,P)}else if(Number.isNaN(parseFloat(j.name)))if($){const G=p(F,j,v);g(F,G,w,P,j.voidElement)}else if(s.transSupportBasicHtmlNodes&&a.indexOf(j.name)>-1)if(j.voidElement)w.push(u.createElement(j.name,{key:`${j.name}-${P}`}));else{const G=m(x,j.children,v);w.push(u.createElement(j.name,{key:`${j.name}-${P}`},G))}else if(j.voidElement)w.push(`<${j.name} />`);else{const G=m(x,j.children,v);w.push(`<${j.name}>${G}</${j.name}>`)}else if(Vh(F)&&!_){const G=j.children[0]?T:null;G&&w.push(G)}else g(F,T,w,P,j.children.length!==1||!T)}else if(j.type==="text"){const O=s.transWrapTextNodes,F=o?s.unescape(n.services.interpolator.interpolate(j.content,f,n.language)):n.services.interpolator.interpolate(j.content,f,n.language);O?w.push(u.createElement(O,{key:`${j.name}-${P}`},F)):w.push(F)}return w},[])},y=m([{dummy:!0,children:e||[]}],h,Uc(e||[]));return sb(y[0])};function rie({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var O,F,_,R,D,$;const m=h||A3();if(!m)return Zq("You will need to pass in an i18next instance by using i18nextReactModule"),e;const y=f||m.t.bind(m)||(G=>G),b={...Yq(),...(O=m.options)==null?void 0:O.react};let C=d||y.ns||((F=m.options)==null?void 0:F.defaultNS);C=Af(C)?[C]:C||["translation"];const v=qP(e,b),x=l||v||b.transEmptyNodeValue||s,{hashTransKey:S}=b,w=s||(S?S(v||x):v||x);(R=(_=m.options)==null?void 0:_.interpolation)!=null&&R.defaultVariables&&(a=a&&Object.keys(a).length>0?{...a,...m.options.interpolation.defaultVariables}:{...m.options.interpolation.defaultVariables});const j=a||t!==void 0&&!(($=(D=m.options)==null?void 0:D.interpolation)!=null&&$.alwaysFormat)||!e?o.interpolation:{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}},P={...o,context:i||o.context,count:t,...a,...j,defaultValue:x,ns:C},T=w?y(w,P):x;c&&Object.keys(c).forEach(G=>{const ee=c[G];if(typeof ee.type=="function"||!ee.props||!ee.props.children||T.indexOf(`${G}/>`)<0&&T.indexOf(`${G} />`)<0)return;function Q(){return u.createElement(u.Fragment,null,ee)}c[G]=u.createElement(Q)});const L=sie(c||e,T,m,b,P,p),E=n??b.defaultTransParent;return E?u.createElement(E,g,L):L}function Jt({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var v;const{i18n:m,defaultNS:y}=u.useContext(Xq)||{},b=h||m||A3(),C=f||(b==null?void 0:b.t.bind(b));return rie({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o,values:a,defaults:l,components:c,ns:d||(C==null?void 0:C.ns)||y||((v=b==null?void 0:b.options)==null?void 0:v.defaultNS),i18n:b,t:f,shouldUnescape:p,...g})}function fw(e){return Object.keys(e)}function iie(e){return Object.entries(e)}var rb=function(){return Qq.Date.now()},oie="Expected a function",aie=Math.max,lie=Math.min;function ri(e,t,n){var s,i,o,a,l,c,d=0,h=!1,f=!1,p=!0;if(typeof e!="function")throw new TypeError(oie);t=J_(t)||0,T3(n)&&(h=!!n.leading,f="maxWait"in n,o=f?aie(J_(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p);function g(j){var P=s,T=i;return s=i=void 0,d=j,a=e.apply(T,P),a}function m(j){return d=j,l=setTimeout(C,t),h?g(j):a}function y(j){var P=j-c,T=j-d,L=t-P;return f?lie(L,o-T):L}function b(j){var P=j-c,T=j-d;return c===void 0||P>=t||P<0||f&&T>=o}function C(){var j=rb();if(b(j))return v(j);l=setTimeout(C,y(j))}function v(j){return l=void 0,p&&s?g(j):(s=i=void 0,a)}function x(){l!==void 0&&clearTimeout(l),d=0,s=c=i=l=void 0}function S(){return l===void 0?a:v(rb())}function w(){var j=rb(),P=b(j);if(s=arguments,i=this,c=j,P){if(l===void 0)return m(c);if(f)return clearTimeout(l),l=setTimeout(C,t),g(c)}return l===void 0&&(l=setTimeout(C,t)),a}return w.cancel=x,w.flush=S,w}var cie=200;function uie(e,t,n,s){var i=-1,o=eK,a=!0,l=e.length,c=[],d=t.length;if(!l)return c;t.length>=cie&&(o=tK,a=!1,t=new Jq(t));e:for(;++i<l;){var h=e[i],f=h;if(h=h!==0?h:0,a&&f===f){for(var p=d;p--;)if(t[p]===f)continue e;c.push(h)}else o(t,f,s)||c.push(h)}return c}var die=nK(function(e,t){return e4(e)?uie(e,E3(t,1,e4,!0)):[]});function hie(e,t){var n=-1,s=M3(e)?Array(e.length):[];return sK(e,function(i,o,a){s[++n]=t(i,o,a)}),s}function _i(e,t){var n=oK(e)?rK:hie;return n(e,iK(t))}function fie(e,t){return E3(_i(e,t))}var pie=Math.max;function gie(e,t,n,s){e=M3(e)?e:aK(e),n=n?lK(n):0;var i=e.length;return n<0&&(n=pie(i+n,0)),Tf(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&cK(e,t,n)>-1}var mie="Expected a function";function KP(e){if(typeof e!="function")throw new TypeError(mie);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var yie="Expected a function";function g2(e,t,n){var s=!0,i=!0;if(typeof e!="function")throw new TypeError(yie);return T3(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),ri(e,t,{leading:s,maxWait:t,trailing:i})}function ZP(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?uK(e,void 0,t):[]}const YP=Fs("system"),au={gallery:new Set,layers:new Set,canvas:new Set,workflows:new Set,viewer:new Set},Sy=Oe(null),vie=fw(au).reduce((e,t)=>(e[`$${t}`]=rs(Sy,n=>n===t),e),{}),m2=e=>{Sy.set(e),YP.trace(`Focus changed: ${e}`)},ta=(e,t,n)=>{u.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},i=t.current;return au[e].add(i),s&&m2(e),()=>{au[e].delete(i),au[e].size===0&&Sy.get()===e&&m2(null)}},[n,t,e])},Os=e=>ce(vie[`$${e}`]),Q4=e=>{var i;const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const o of fw(au))for(const a of au[o])a.contains(t)&&n.push({region:o,element:a});if(n.length===0)return;n.sort((o,a)=>a.element.contains(o.element)?-1:o.element.contains(a.element)?1:0);const s=(i=n[0])==null?void 0:i.region;if(!s){YP.warn("No focused region found");return}m2(s)},bie=()=>{kt("useFocusRegionWatcher"),u.useEffect(()=>(window.addEventListener("focus",Q4,{capture:!0}),()=>{window.removeEventListener("focus",Q4,{capture:!0})}),[])},xie={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},Oa=Oe(xie),En=pe(Fu,e=>e.activeTab),XP=pe(Fu,e=>e.shouldShowImageDetails),pw=pe(Fu,e=>e.shouldShowProgressInViewer),Pf=pe(Fu,e=>e.activeTabCanvasRightPanel),QP=e=>{const t=z(),{t:n}=M(),[s,i]=dK();return[u.useCallback(async a=>{try{const{data:l}=await s(a);l?(t(dS({data:l,asCopy:!0})),e!=null&&e.onSuccess&&(e==null||e.onSuccess())):ve({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}catch{ve({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}},[s,t,e,n]),i]};function JP(e,t,n){var s=this,i=u.useRef(null),o=u.useRef(0),a=u.useRef(null),l=u.useRef([]),c=u.useRef(),d=u.useRef(),h=u.useRef(e),f=u.useRef(!0);h.current=e;var p=typeof window<"u",g=!t&&t!==0&&p;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var m=!!(n=n||{}).leading,y=!("trailing"in n)||!!n.trailing,b="maxWait"in n,C="debounceOnServer"in n&&!!n.debounceOnServer,v=b?Math.max(+n.maxWait||0,t):null;u.useEffect(function(){return f.current=!0,function(){f.current=!1}},[]);var x=u.useMemo(function(){var S=function(E){var O=l.current,F=c.current;return l.current=c.current=null,o.current=E,d.current=h.current.apply(F,O)},w=function(E,O){g&&cancelAnimationFrame(a.current),a.current=g?requestAnimationFrame(E):setTimeout(E,O)},j=function(E){if(!f.current)return!1;var O=E-i.current;return!i.current||O>=t||O<0||b&&E-o.current>=v},P=function(E){return a.current=null,y&&l.current?S(E):(l.current=c.current=null,d.current)},T=function E(){var O=Date.now();if(j(O))return P(O);if(f.current){var F=t-(O-i.current),_=b?Math.min(F,v-(O-o.current)):F;w(E,_)}},L=function(){if(p||C){var E=Date.now(),O=j(E);if(l.current=[].slice.call(arguments),c.current=s,i.current=E,O){if(!a.current&&f.current)return o.current=i.current,w(T,t),m?S(i.current):d.current;if(b)return w(T,t),S(i.current)}return a.current||w(T,t),d.current}};return L.cancel=function(){a.current&&(g?cancelAnimationFrame(a.current):clearTimeout(a.current)),o.current=0,l.current=i.current=c.current=a.current=null},L.isPending=function(){return!!a.current},L.flush=function(){return a.current?P(Date.now()):d.current},L},[m,b,t,v,y,g,p,C]);return x}function Cie(e,t){return e===t}function Sie(e,t){return t}function Ju(e,t,n){var s=Cie,i=u.useReducer(Sie,e),o=i[0],a=i[1],l=JP(u.useCallback(function(d){return a(d)},[a]),t,n),c=u.useRef(e);return s(c.current,e)||(l(e),c.current=e),s(o,e)&&l.cancel(),[o,l]}const eL=e=>{const t=I(hK),[n]=Ju(e,t),{data:s,isLoading:i}=fK(n??ws);return{metadata:s,isLoading:i}},gw=e=>{const t=z(),{t:n}=M(),s=I(lp),i=I(On),o=I(En),{metadata:a}=eL(e.image_name),[l,c]=u.useState(!1),[d,h]=u.useState(!1),[f,p]=u.useState(!1),g=ce(cp);u.useEffect(()=>{(async()=>{if(a){c(!0);try{await pt.seed.parse(a),h(!0)}catch{h(!1)}(await Promise.allSettled([pt.positivePrompt.parse(a).catch(()=>{}),pt.negativePrompt.parse(a).catch(()=>{}),pt.sdxlPositiveStylePrompt.parse(a).catch(()=>{}),pt.sdxlNegativeStylePrompt.parse(a).catch(()=>{})])).some(O=>O.status==="fulfilled")?p(!0):p(!1)}else c(!1),h(!1),p(!1)})()},[a]);const m=u.useCallback(()=>{s&&(t(l0(null)),ve({status:"info",title:n("stylePresets.promptTemplateCleared")}))},[t,s,n]),y=u.useCallback(()=>{a&&(t4(a,o==="canvas",i?["width","height"]:[]),m())},[a,o,i,m]),b=u.useCallback(()=>{a&&(t4(a,o==="canvas",["seed"]),m())},[o,a,m]),C=u.useCallback(()=>{a&&pt.seed.parse(a).then(L=>{var E,O;(O=(E=pt.seed).recall)==null||O.call(E,L,!0)}).catch(()=>{})},[a]),v=u.useCallback(()=>{a&&(pK(a),m())},[a,m]),x=u.useCallback(async()=>{if(!a)return;let L,E;try{L=await pt.positivePrompt.parse(a)}catch{L=""}try{E=await pt.negativePrompt.parse(a)}catch{E=""}Oa.set({prefilledFormData:{name:"",positivePrompt:L,negativePrompt:E,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[a,e]),[S]=QP(),w=u.useCallback(()=>{!e.has_workflow||!g||S(e.image_name)},[S,g,e.has_workflow,e.image_name]),j=u.useCallback(()=>{i||gK(e)},[e,i]),P=u.useCallback(()=>{t(P3({imageDTO:e}))},[t,e]),T=u.useCallback(()=>{t(up([e]))},[t,e]);return{hasMetadata:l,hasSeed:d,hasPrompts:f,recallAll:y,remix:b,recallSeed:C,recallPrompts:v,createAsPreset:x,loadWorkflow:w,hasWorkflow:e.has_workflow,recallSize:j,upscale:P,delete:T}},en=e=>{const t=u.useMemo(()=>pe(Ar,s=>!(s.disabledFeatures.includes(e)||s.disabledSDFeatures.includes(e)||s.disabledTabs.includes(e))),[e]);return I(t)};function y2(){return y2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},y2.apply(this,arguments)}var tL=["shift","alt","meta","mod","ctrl"],wie={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function _a(e){return(wie[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function jie(e){return tL.includes(e)}function ib(e,t){return t===void 0&&(t=","),e.split(t)}function ob(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(a){return _a(a)}),i={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},o=s.filter(function(a){return!tL.includes(a)});return y2({},i,{keys:o,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&nL([_a(e.key),_a(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&sL([_a(e.key),_a(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){Ia.clear()})})();var Ia=new Set;function mw(e){return Array.isArray(e)}function kie(e,t){t===void 0&&(t=",");var n=mw(e)?e:e.split(t);return n.every(function(s){return Ia.has(s.trim().toLowerCase())})}function nL(e){var t=Array.isArray(e)?e:[e];Ia.has("meta")&&Ia.forEach(function(n){return!jie(n)&&Ia.delete(n.toLowerCase())}),t.forEach(function(n){return Ia.add(n.toLowerCase())})}function sL(e){var t=Array.isArray(e)?e:[e];e==="meta"?Ia.clear():t.forEach(function(n){return Ia.delete(n.toLowerCase())})}function _ie(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function Iie(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function Aie(e){return rL(e,["input","textarea","select"])}function rL(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return mw(t)?!!(s&&t&&t.some(function(i){return i.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function Tie(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var Eie=function(t,n,s){s===void 0&&(s=!1);var i=n.alt,o=n.meta,a=n.mod,l=n.shift,c=n.ctrl,d=n.keys,h=t.key,f=t.code,p=t.ctrlKey,g=t.metaKey,m=t.shiftKey,y=t.altKey,b=_a(f),C=h.toLowerCase();if(!(d!=null&&d.includes(b))&&!(d!=null&&d.includes(C))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(b))return!1;if(!s){if(i===!y&&C!=="alt"||l===!m&&C!=="shift")return!1;if(a){if(!g&&!p)return!1}else if(o===!g&&C!=="meta"&&C!=="os"||c===!p&&C!=="ctrl"&&C!=="control")return!1}return d&&d.length===1&&(d.includes(C)||d.includes(b))?!0:d?kie(d):!d},Mie=u.createContext(void 0),Pie=function(){return u.useContext(Mie)};function iL(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&iL(e[s],t[s])},!0):e===t}var Lie=u.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),Die=function(){return u.useContext(Lie)};function Rie(e){var t=u.useRef(void 0);return iL(t.current,e)||(t.current=e),t.current}var J4=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},Oie=typeof window<"u"?u.useLayoutEffect:u.useEffect;function Ii(e,t,n,s){var i=u.useRef(null),o=u.useRef(!1),a=n instanceof Array?s instanceof Array?void 0:s:n,l=mw(e)?e.join(a==null?void 0:a.splitKey):e,c=n instanceof Array?n:s instanceof Array?s:void 0,d=u.useCallback(t,c??[]),h=u.useRef(d);c?h.current=d:h.current=t;var f=Rie(a),p=Die(),g=p.enabledScopes,m=Pie();return Oie(function(){if(!((f==null?void 0:f.enabled)===!1||!Tie(g,f==null?void 0:f.scopes))){var y=function(S,w){var j;if(w===void 0&&(w=!1),!(Aie(S)&&!rL(S,f==null?void 0:f.enableOnFormTags))){if(i.current!==null){var P=i.current.getRootNode();if((P instanceof Document||P instanceof ShadowRoot)&&P.activeElement!==i.current&&!i.current.contains(P.activeElement)){J4(S);return}}(j=S.target)!=null&&j.isContentEditable&&!(f!=null&&f.enableOnContentEditable)||ib(l,f==null?void 0:f.splitKey).forEach(function(T){var L,E=ob(T,f==null?void 0:f.combinationKey);if(Eie(S,E,f==null?void 0:f.ignoreModifiers)||(L=E.keys)!=null&&L.includes("*")){if(f!=null&&f.ignoreEventWhen!=null&&f.ignoreEventWhen(S)||w&&o.current)return;if(_ie(S,E,f==null?void 0:f.preventDefault),!Iie(S,E,f==null?void 0:f.enabled)){J4(S);return}h.current(S,E),w||(o.current=!0)}})}},b=function(S){S.key!==void 0&&(nL(_a(S.code)),((f==null?void 0:f.keydown)===void 0&&(f==null?void 0:f.keyup)!==!0||f!=null&&f.keydown)&&y(S))},C=function(S){S.key!==void 0&&(sL(_a(S.code)),o.current=!1,f!=null&&f.keyup&&y(S,!0))},v=i.current||(a==null?void 0:a.document)||document;return v.addEventListener("keyup",C),v.addEventListener("keydown",b),m&&ib(l,f==null?void 0:f.splitKey).forEach(function(x){return m.addHotkey(ob(x,f==null?void 0:f.combinationKey,f==null?void 0:f.description))}),function(){v.removeEventListener("keyup",C),v.removeEventListener("keydown",b),m&&ib(l,f==null?void 0:f.splitKey).forEach(function(x){return m.removeHotkey(ob(x,f==null?void 0:f.combinationKey,f==null?void 0:f.description))})}}},[l,f,g]),i}const Nie=(e,t)=>e.map(n=>t?n.split("+").map(s=>s.replaceAll("mod","cmd").replaceAll("alt","option")):n.split("+").map(s=>s.replaceAll("mod","ctrl"))),oL=()=>{const{t:e}=M(),t=en("modelManager"),n=u.useMemo(()=>navigator.userAgent.toLowerCase().includes("mac"),[]);return u.useMemo(()=>{const i={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},o=(a,l,c)=>{i[a].hotkeys[l]={id:l,category:a,title:e(`hotkeys.${a}.${l}.title`),desc:e(`hotkeys.${a}.${l}.desc`),hotkeys:c,platformKeys:Nie(c,n)}};return o("app","invoke",["mod+enter"]),o("app","invokeFront",["mod+shift+enter"]),o("app","cancelQueueItem",["shift+x"]),o("app","clearQueue",["mod+shift+x"]),o("app","selectCanvasTab",["1"]),o("app","selectUpscalingTab",["2"]),o("app","selectWorkflowsTab",["3"]),t&&o("app","selectModelsTab",["4"]),o("app","selectQueueTab",t?["5"]:["4"]),o("app","focusPrompt",["alt+a"]),o("app","toggleLeftPanel",["t","o"]),o("app","toggleRightPanel",["g"]),o("app","resetPanelLayout",["shift+r"]),o("app","togglePanels",["f"]),o("canvas","selectBrushTool",["b"]),o("canvas","selectBboxTool",["c"]),o("canvas","decrementToolWidth",["["]),o("canvas","incrementToolWidth",["]"]),o("canvas","selectEraserTool",["e"]),o("canvas","selectMoveTool",["v"]),o("canvas","selectRectTool",["u"]),o("canvas","selectViewTool",["h"]),o("canvas","selectColorPickerTool",["i"]),o("canvas","setFillToWhite",["d"]),o("canvas","fitLayersToCanvas",["mod+0"]),o("canvas","fitBboxToCanvas",["mod+shift+0"]),o("canvas","setZoomTo100Percent",["mod+1"]),o("canvas","setZoomTo200Percent",["mod+2"]),o("canvas","setZoomTo400Percent",["mod+3"]),o("canvas","setZoomTo800Percent",["mod+4"]),o("canvas","quickSwitch",["q"]),o("canvas","deleteSelected",["delete","backspace"]),o("canvas","resetSelected",["shift+c"]),o("canvas","transformSelected",["shift+t"]),o("canvas","filterSelected",["shift+f"]),o("canvas","undo",["mod+z"]),o("canvas","redo",["mod+shift+z","mod+y"]),o("canvas","nextEntity",["alt+]"]),o("canvas","prevEntity",["alt+["]),o("canvas","applyFilter",["enter"]),o("canvas","cancelFilter",["esc"]),o("canvas","applyTransform",["enter"]),o("canvas","cancelTransform",["esc"]),o("canvas","applySegmentAnything",["enter"]),o("canvas","cancelSegmentAnything",["esc"]),o("workflows","addNode",["shift+a","space"]),o("workflows","copySelection",["mod+c"]),o("workflows","pasteSelection",["mod+v"]),o("workflows","pasteSelectionWithEdges",["mod+shift+v"]),o("workflows","selectAll",["mod+a"]),o("workflows","deleteSelection",["delete","backspace"]),o("workflows","undo",["mod+z"]),o("workflows","redo",["mod+shift+z","mod+y"]),o("viewer","toggleViewer",["z"]),o("viewer","swapImages",["c"]),o("viewer","nextComparisonMode",["m"]),o("viewer","loadWorkflow",["w"]),o("viewer","recallAll",["a"]),o("viewer","recallSeed",["s"]),o("viewer","recallPrompts",["p"]),o("viewer","remix",["r"]),o("viewer","useSize",["d"]),o("viewer","runPostprocessing",["shift+u"]),o("viewer","toggleMetadata",["i"]),o("gallery","selectAllOnPage",["mod+a"]),o("gallery","clearSelection",["esc"]),o("gallery","galleryNavUp",["up"]),o("gallery","galleryNavRight",["right"]),o("gallery","galleryNavDown",["down"]),o("gallery","galleryNavLeft",["left"]),o("gallery","galleryNavUpAlt",["alt+up"]),o("gallery","galleryNavRightAlt",["alt+right"]),o("gallery","galleryNavDownAlt",["alt+down"]),o("gallery","galleryNavLeftAlt",["alt+left"]),o("gallery","deleteSelection",["delete","backspace"]),i},[n,t,e])},Le=({id:e,category:t,callback:n,options:s,dependencies:i})=>{const o=oL(),a=u.useMemo(()=>{var c;const l=(c=o[t].hotkeys[e])==null?void 0:c.hotkeys;return Ge(l!==void 0,`Hotkey ${t}.${e} not found`),l},[t,o,e]);return Ii(a,n,s,i)},aL=u.memo(()=>{kt("GlobalImageHotkeys");const e=I(dp);return e?r.jsx(lL,{imageDTO:e}):null});aL.displayName="GlobalImageHotkeys";const lL=u.memo(({imageDTO:e})=>{const t=Os("gallery"),n=Os("viewer"),s=gw(e),i=I(On),o=en("upscaling");return Le({id:"loadWorkflow",category:"viewer",callback:s.loadWorkflow,options:{enabled:t||n},dependencies:[s.loadWorkflow,t,n]}),Le({id:"recallAll",category:"viewer",callback:s.recallAll,options:{enabled:!i&&(t||n)},dependencies:[s.recallAll,i,t,n]}),Le({id:"recallSeed",category:"viewer",callback:s.recallSeed,options:{enabled:t||n},dependencies:[s.recallSeed,t,n]}),Le({id:"recallPrompts",category:"viewer",callback:s.recallPrompts,options:{enabled:t||n},dependencies:[s.recallPrompts,t,n]}),Le({id:"remix",category:"viewer",callback:s.remix,options:{enabled:t||n},dependencies:[s.remix,t,n]}),Le({id:"useSize",category:"viewer",callback:s.recallSize,options:{enabled:!i&&(t||n)},dependencies:[s.recallSize,i,t,n]}),Le({id:"runPostprocessing",category:"viewer",callback:s.upscale,options:{enabled:o&&n},dependencies:[o,e,n]}),null});lL.displayName="GlobalImageHotkeysInternal";const e5=document.title,Fie="assets/images/invoke-favicon.svg",Bie="assets/images/invoke-alert-favicon.svg",$ie=()=>{const{queueSize:e}=ti(void 0,{selectFromResult:t=>({queueSize:t.data?t.data.queue.pending+t.data.queue.in_progress:0})});u.useEffect(()=>{document.title=e>0?`(${e}) ${e5}`:e5;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?Bie:Fie)},[e])},cL=e=>u.useMemo(()=>Fs(e),[e]),Vie=()=>{kt("useSyncLoggingConfig");const e=ce(mK),t=I(L3),n=I(D3),s=I(R3);u.useLayoutEffect(()=>{yK((e==null?void 0:e.logIsEnabled)??s,(e==null?void 0:e.logLevel)??t,(e==null?void 0:e.logNamespaces)??n)},[s,t,n,e==null?void 0:e.logIsEnabled,e==null?void 0:e.logLevel,e==null?void 0:e.logNamespaces])},uL=()=>u.useCallback(()=>{vK(),localStorage.clear()},[]),wy=()=>{const e=ce(Wn),{data:t}=ti(),[n,{isLoading:s}]=hS(),{t:i}=M(),o=u.useMemo(()=>t==null?void 0:t.queue.item_id,[t==null?void 0:t.queue.item_id]),a=u.useCallback(async()=>{if(o)try{await n(o).unwrap(),ve({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{ve({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[o,i,n]),l=u.useMemo(()=>!e||qe(o),[e,o]);return{cancelQueueItem:a,isLoading:s,currentQueueItemId:o,isDisabled:l}},dL=()=>{const{t:e}=M(),t=z(),{data:n}=ti(),s=ce(Wn),[i,{isLoading:o}]=O3({fixedCacheKey:"clearQueue"}),a=u.useCallback(async()=>{if(n!=null&&n.queue.total)try{await i().unwrap(),ve({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"}),t(fS(void 0)),t(pS(void 0))}catch{ve({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[n==null?void 0:n.queue.total,i,t,e]),l=u.useMemo(()=>!s||!(n!=null&&n.queue.total),[s,n==null?void 0:n.queue.total]);return{clearQueue:a,isLoading:o,queueStatus:n,isDisabled:l}},Pd=Oe(!0),Gie=(e,t)=>{const n=[],{minItems:s,maxItems:i}=t,o=e.length;return s!==void 0&&s>0&&o===0?n.push(Te("parameters.invoke.collectionEmpty")):(s!==void 0&&o<s&&n.push(Te("parameters.invoke.collectionTooFewItems",{count:o,minItems:s})),i!==void 0&&o>i&&n.push(Te("parameters.invoke.collectionTooManyItems",{count:o,maxItems:i}))),n},zie=(e,t)=>{const n=[],{minItems:s,maxItems:i,minLength:o,maxLength:a}=t,l=e.length;s!==void 0&&s>0&&l===0?n.push(Te("parameters.invoke.collectionEmpty")):(s!==void 0&&l<s&&n.push(Te("parameters.invoke.collectionTooFewItems",{count:l,minItems:s})),i!==void 0&&l>i&&n.push(Te("parameters.invoke.collectionTooManyItems",{count:l,maxItems:i})));for(const c of e)a!==void 0&&c.length>a&&n.push(Te("parameters.invoke.collectionStringTooLong",{value:e,maxLength:a})),o!==void 0&&c.length<o&&n.push(Te("parameters.invoke.collectionStringTooShort",{value:e,minLength:o}));return n},t5=(e,t)=>{const n=[],{minItems:s,maxItems:i,minimum:o,maximum:a,exclusiveMinimum:l,exclusiveMaximum:c,multipleOf:d}=t,h=e.length;s!==void 0&&s>0&&h===0?n.push(Te("parameters.invoke.collectionEmpty")):(s!==void 0&&h<s&&n.push(Te("parameters.invoke.collectionTooFewItems",{count:h,minItems:s})),i!==void 0&&h>i&&n.push(Te("parameters.invoke.collectionTooManyItems",{count:h,maxItems:i})));for(const f of e)a!==void 0&&f>a&&n.push(Te("parameters.invoke.collectionNumberGTMax",{value:e,maximum:a})),o!==void 0&&f<o&&n.push(Te("parameters.invoke.collectionNumberLTMin",{value:e,minimum:o})),c!==void 0&&f>=c&&n.push(Te("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:c})),l!==void 0&&f<=l&&n.push(Te("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:l})),d!==void 0&&f%d!==0&&n.push(Te("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:d}));return n},Hie=(e,t,n,s)=>`${e.data.label||t.title} -> ${n.label||s.title}`,hL=(e,t,n,s,i)=>{const o=[],a=Hie(e,t,n,s),l=e.data.id,c=n.name,d=i.edges.find(h=>h.target===l&&h.targetHandle===c)!==void 0;if(s.required&&!d&&n.value===void 0)o.push({type:"field-error",nodeId:l,fieldName:c,prefix:a,issue:Te("parameters.invoke.missingInputForField")});else if(!d){if(n.value&&N3(s)&&gS(n)){const h=Gie(n.value,s);o.push(...h.map(f=>({type:"field-error",nodeId:l,fieldName:c,prefix:a,issue:f})))}else if(n.value&&F3(s)&&B3(n)){const h=zie(n.value,s);o.push(...h.map(f=>({type:"field-error",nodeId:l,fieldName:c,prefix:a,issue:f})))}else if(n.value&&$3(s)&&V3(n)){const h=t5(n.value,s);o.push(...h.map(f=>({type:"field-error",nodeId:l,fieldName:c,prefix:a,issue:f})))}else if(n.value&&G3(s)&&z3(n)){const h=t5(n.value,s);o.push(...h.map(f=>({type:"field-error",nodeId:l,fieldName:c,prefix:a,issue:f})))}}return o},fL=(e,t,n)=>{const s=[],i=n.nodes.find(a=>a.id===e);Ge(Jr(i),`Node ${e} is not an invocation node`);const o=t[i.data.type];if(!o)return s.push({type:"node-error",nodeId:e,issue:Te("parameters.invoke.missingNodeTemplate")}),s;for(const[a,l]of Object.entries(i.data.inputs)){const c=o.inputs[a];if(!c){s.push({type:"node-error",nodeId:e,issue:Te("parameters.invoke.missingFieldTemplate")});continue}s.push(...hL(i,o,l,c,n))}return s},Ld={reference_image:"controlLayers.referenceImage",inpaint_mask:"controlLayers.inpaintMask",regional_guidance:"controlLayers.regionalGuidance",raster_layer:"controlLayers.rasterLayer",control_layer:"controlLayers.controlLayer"},Aa=Oe([]),jy=rs(Aa,e=>e.length===0),Wie=ri(async(e,t,n,s,i,o,a,l,c,d,h,f,p,g,m,y)=>{if(e==="canvas"){const b=await Zie({isConnected:t,canvas:n,params:s,dynamicPrompts:i,canvasIsFiltering:o,canvasIsTransforming:a,canvasIsRasterizing:l,canvasIsCompositing:c,canvasIsSelectingObject:d});Aa.set(b)}else if(e==="workflows"){const b=await qie({dispatch:y.dispatch,nodesState:h,workflowSettingsState:f,isConnected:t,templates:p});Aa.set(b)}else if(e==="upscaling"){const b=Kie({isConnected:t,upscale:g,config:m,params:s});Aa.set(b)}else Aa.set(xs)},300),Uie=()=>{kt("useReadinessWatcher");const e=jn(),t=bK(),n=I(En),s=I(et),i=I(Bu),o=I(H3),a=I(lt),l=I(W3),c=I(hp),d=I(Ar),h=ce(Tn),f=ce(Wn),p=ce((t==null?void 0:t.stateApi.$isFiltering)??Pd),g=ce((t==null?void 0:t.stateApi.$isTransforming)??Pd),m=ce((t==null?void 0:t.stateApi.$isRasterizing)??Pd),y=ce((t==null?void 0:t.stateApi.$isSegmenting)??Pd),b=ce((t==null?void 0:t.compositor.$isBusy)??Pd);u.useEffect(()=>{Wie(n,f,s,i,o,p,g,m,b,y,a,l,h,c,d,e)},[e,s,b,p,m,y,g,d,o,f,a,i,n,h,c,l])},yw=e=>({content:e("parameters.invoke.systemDisconnected")}),qie=async e=>{const{dispatch:t,nodesState:n,workflowSettingsState:s,isConnected:i,templates:o}=e,a=[];if(i||a.push(yw(ut.t)),s.shouldValidateGraph){const{nodes:l,edges:c}=n,d=l.filter(Jr),h=d.filter(q3);d.filter(xK).length||a.push({content:ut.t("parameters.invoke.noNodesInGraph")});for(const p of h)c.find(g=>g.source===p.id)===void 0&&a.push({content:ut.t("parameters.invoke.batchNodeNotConnected",{label:p.data.label})});if(h.length>0){const p=[],g=K3(h,m=>{var y;return(y=m.data.inputs.batch_group_id)==null?void 0:y.value});for(const[m,y]of Object.entries(g)){const b=[];for(const C of y){const v=(await CK({dispatch:t,nodesState:n,node:C})).length;m==="None"?p.push(v):b.push(v)}b.some(C=>C!==b[0])&&a.push({content:ut.t("parameters.invoke.batchNodeCollectionSizeMismatch",{batchGroupId:m})}),b[0]!==void 0&&p.push(b[0])}p.some(m=>m===0)&&a.push({content:ut.t("parameters.invoke.batchNodeEmptyCollection")})}d.forEach(p=>{if(!Jr(p))return;const g=fL(p.data.id,o,n);for(const m of g)m.type==="node-error"?a.push({content:m.issue}):a.push({prefix:m.prefix,content:m.issue})})}return a},Kie=e=>{const{isConnected:t,upscale:n,config:s,params:i}=e,o=[];if(t||o.push(yw(ut.t)),!n.upscaleInitialImage)o.push({content:ut.t("upscaling.missingUpscaleInitialImage")});else if(s.maxUpscaleDimension){const{width:l,height:c}=n.upscaleInitialImage,{scale:d}=n,h=s.maxUpscaleDimension**2;l*d*c*d>h&&o.push({content:ut.t("upscaling.exceedsMaxSize")})}const a=i.model;return a&&!["sd-1","sdxl"].includes(a.base)?o.push({content:ut.t("upscaling.incompatibleBaseModel")}):(a||o.push({content:ut.t("parameters.invoke.noModelSelected")}),n.upscaleModel||o.push({content:ut.t("upscaling.missingUpscaleModel")}),n.tileControlnetModel||o.push({content:ut.t("upscaling.missingTileControlNetModel")})),o},Zie=e=>{const{isConnected:t,canvas:n,params:s,dynamicPrompts:i,canvasIsFiltering:o,canvasIsTransforming:a,canvasIsRasterizing:l,canvasIsCompositing:c,canvasIsSelectingObject:d}=e,{model:h,positivePrompt:f}=s,p=[];if(t||p.push(yw(ut.t)),o&&p.push({content:ut.t("parameters.invoke.canvasIsFiltering")}),a&&p.push({content:ut.t("parameters.invoke.canvasIsTransforming")}),l&&p.push({content:ut.t("parameters.invoke.canvasIsRasterizing")}),c&&p.push({content:ut.t("parameters.invoke.canvasIsCompositing")}),d&&p.push({content:ut.t("parameters.invoke.canvasIsSelectingObject")}),i.prompts.length===0&&U3(f)&&p.push({content:ut.t("parameters.invoke.noPrompts")}),h||p.push({content:ut.t("parameters.invoke.noModelSelected")}),(h==null?void 0:h.base)==="flux"){const{bbox:y}=n;s.t5EncoderModel||p.push({content:ut.t("parameters.invoke.noT5EncoderModelSelected")}),s.clipEmbedModel||p.push({content:ut.t("parameters.invoke.noCLIPEmbedModelSelected")}),s.fluxVAE||p.push({content:ut.t("parameters.invoke.noFLUXVAEModelSelected")}),y.scaleMethod==="none"?(y.rect.width%16!==0&&p.push({content:ut.t("parameters.invoke.fluxModelIncompatibleBboxWidth",{width:y.rect.width})}),y.rect.height%16!==0&&p.push({content:ut.t("parameters.invoke.fluxModelIncompatibleBboxHeight",{height:y.rect.height})})):(y.scaledSize.width%16!==0&&p.push({content:ut.t("parameters.invoke.fluxModelIncompatibleScaledBboxWidth",{width:y.scaledSize.width})}),y.scaledSize.height%16!==0&&p.push({content:ut.t("parameters.invoke.fluxModelIncompatibleScaledBboxHeight",{height:y.scaledSize.height})}))}const g=n.controlLayers.entities.filter(y=>y.isEnabled),m=g.filter(y=>{var b,C;return((C=(b=y.controlAdapter)==null?void 0:b.model)==null?void 0:C.type)==="control_lora"}).length;return(h==null?void 0:h.base)==="flux"&&m>1&&p.push({content:ut.t("parameters.invoke.fluxModelMultipleControlLoRAs")}),g.forEach((y,b)=>{const C=ut.t("controlLayers.layer_one"),v=b+1,x=ut.t(Ld.control_layer),S=`${C} #${v} (${x})`,w=Z3(y,h);if(w.length){const j=Pc(w.map(P=>ut.t(P)).join(", "));p.push({prefix:S,content:j})}}),n.referenceImages.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ut.t("controlLayers.layer_one"),v=b+1,x=ut.t(Ld[y.type]),S=`${C} #${v} (${x})`,w=Y3(y,h);if(w.length){const j=Pc(w.map(P=>ut.t(P)).join(", "));p.push({prefix:S,content:j})}}),n.regionalGuidance.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ut.t("controlLayers.layer_one"),v=b+1,x=ut.t(Ld[y.type]),S=`${C} #${v} (${x})`,w=X3(y,h);if(w.length){const j=Pc(w.map(P=>ut.t(P)).join(", "));p.push({prefix:S,content:j})}}),n.rasterLayers.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ut.t("controlLayers.layer_one"),v=b+1,x=ut.t(Ld[y.type]),S=`${C} #${v} (${x})`,w=Q3();if(w.length){const j=Pc(w.map(P=>ut.t(P)).join(", "));p.push({prefix:S,content:j})}}),n.inpaintMasks.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ut.t("controlLayers.layer_one"),v=b+1,x=ut.t(Ld[y.type]),S=`${C} #${v} (${x})`,w=J3();if(w.length){const j=Pc(w.map(P=>ut.t(P)).join(", "));p.push({prefix:S,content:j})}}),p},Yie=pe(Bu,H3,(e,t)=>U3(e.positivePrompt)?t.prompts.length:1),vw=()=>{const e=z(),t=I(En),n=ce(jy),[s,{isLoading:i}]=mS(H1),o=u.useCallback(()=>{n&&e(n4({tabName:t,prepend:!1}))},[e,n,t]),a=u.useCallback(()=>{n&&e(n4({tabName:t,prepend:!0}))},[e,n,t]);return{queueBack:o,queueFront:a,isLoading:i,isDisabled:!n}},Xie=()=>{const e=z(),t=en("modelManager"),n=vw();Le({id:"invoke",category:"app",callback:n.queueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),Le({id:"invokeFront",category:"app",callback:n.queueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const{cancelQueueItem:s,isDisabled:i,isLoading:o}=wy();Le({id:"cancelQueueItem",category:"app",callback:s,options:{enabled:!i&&!o,preventDefault:!0},dependencies:[s,i,o]});const{clearQueue:a,isDisabled:l,isLoading:c}=dL();Le({id:"clearQueue",category:"app",callback:a,options:{enabled:!l&&!c,preventDefault:!0},dependencies:[a,l,c]}),Le({id:"selectCanvasTab",category:"app",callback:()=>{e(Kt("canvas"))},dependencies:[e]}),Le({id:"selectUpscalingTab",category:"app",callback:()=>{e(Kt("upscaling"))},dependencies:[e]}),Le({id:"selectWorkflowsTab",category:"app",callback:()=>{e(Kt("workflows"))},dependencies:[e]}),Le({id:"selectModelsTab",category:"app",callback:()=>{e(Kt("models"))},options:{enabled:t},dependencies:[e,t]}),Le({id:"selectQueueTab",category:"app",callback:()=>{e(Kt("queue"))},dependencies:[e,t]})},Qie=tn(eE,e=>e.imagesToChange),Jie=pe(eE,e=>e.isModalOpen),eoe=()=>{kt("ChangeBoardModal");const e=z(),[t,n]=u.useState(),{data:s,isFetching:i}=Zl({include_archived:!0}),o=I(Jie),a=I(Qie),[l]=SK(),[c]=wK(),{t:d}=M(),h=u.useMemo(()=>[{label:d("boards.uncategorized"),value:"none"}].concat((s??[]).map(y=>({label:y.board_name,value:y.board_id}))),[s,d]),f=u.useMemo(()=>h.find(y=>y.value===t),[h,t]),p=u.useCallback(()=>{e(s4()),e(yS(!1))},[e]),g=u.useCallback(()=>{!a.length||!t||(t==="none"?c({imageDTOs:a}):l({imageDTOs:a,board_id:t}),n(null),e(s4()))},[l,e,a,c,t]),m=u.useCallback(y=>{y&&n(y.value)},[]);return r.jsx(Tr,{isOpen:o,onClose:p,title:d("boards.changeBoard"),acceptCallback:g,acceptButtonText:d("boards.move"),cancelButtonText:d("boards.cancel"),useInert:!1,children:r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(q,{children:[d("boards.movingImagesToBoard",{count:a.length}),":"]}),r.jsx(Z,{isDisabled:i,children:r.jsx(Fe,{placeholder:d(i?"boards.loading":"boards.selectBoard"),onChange:m,value:f,options:h})})]})})},toe=u.memo(eoe);pe(vS,Yl,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Va.selectAll(n).filter(bS).sort(l=>l.type==="controlnet"?-1:1);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=(s==null?void 0:s.type)==="t2i_adapter"?bt(_K):bt(Xl);return s&&(i.model=Ei.parse(s)),i});const Ko=pe(vS,Yl,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Va.selectAll(n).filter(tE);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=bt(jK);return s&&(i.model=Ei.parse(s),s.base==="flux"&&(i.clipVisionModel="ViT-L")),i}),bw=()=>{const e=z();return u.useCallback(()=>{const n={controlAdapter:bt(Xl)};e(fp({isSelected:!0,overrides:n}))},[e])},xw=()=>{const e=z();return u.useCallback(()=>{e($u({isSelected:!0}))},[e])},Cw=()=>{const e=z();return u.useCallback(()=>{e(W1({isSelected:!0}))},[e])},Sw=()=>{const e=z();return u.useCallback(()=>{e(Ra({isSelected:!0}))},[e])},pL=()=>{const e=z(),t=I(Ko);return u.useCallback(()=>{const s={referenceImages:[{id:_e("regional_guidance_reference_image"),ipAdapter:bt(t)}]};e(Ra({isSelected:!0,overrides:s}))},[t,e])},ww=()=>{const e=z(),t=I(Ko);return u.useCallback(()=>{const s={ipAdapter:bt(t)};e(U1({isSelected:!0,overrides:s}))},[t,e])},gL=e=>{const t=z(),n=I(Ko);return u.useCallback(()=>{t(kK({entityIdentifier:e,overrides:{ipAdapter:bt(n)}}))},[n,t,e])},mL=e=>{const t=z();return u.useCallback(()=>{t(Kx({entityIdentifier:e,prompt:""}))},[t,e])},yL=e=>{const t=z();return u.useCallback(()=>{t(Zx({entityIdentifier:e,prompt:""}))},[t,e])},vL=e=>tn(et,t=>{const n=Ga(t,e);return{canAddPositivePrompt:(n==null?void 0:n.positivePrompt)===null,canAddNegativePrompt:(n==null?void 0:n.negativePrompt)===null}});class Bt{constructor(){k(this,"initialize");k(this,"getLoggingContext",()=>({...this.parent.getLoggingContext(),path:this.path.join(" > ")}));k(this,"destroy",()=>{this.log("Destroying module")});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path}))}}var Fm={exports:{}},Dd={},ab={},lb={},n5;function Ct(){return n5||(n5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof r4<"u"?r4:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.15",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return e.Konva.angleDeg?i*t:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var i;return(i=e.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(i){e.glob.Konva=i}};const s=i=>{e.Konva[i.prototype.getClassName()]=i};e._registerNode=s,e.Konva._injectGlobal(e.Konva)}(lb)),lb}var cb={},s5;function In(){return s5||(s5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=Ct();class n{constructor(S=[1,0,0,1,0,0]){this.dirty=!1,this.m=S&&S.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(S){S.m[0]=this.m[0],S.m[1]=this.m[1],S.m[2]=this.m[2],S.m[3]=this.m[3],S.m[4]=this.m[4],S.m[5]=this.m[5]}point(S){var w=this.m;return{x:w[0]*S.x+w[2]*S.y+w[4],y:w[1]*S.x+w[3]*S.y+w[5]}}translate(S,w){return this.m[4]+=this.m[0]*S+this.m[2]*w,this.m[5]+=this.m[1]*S+this.m[3]*w,this}scale(S,w){return this.m[0]*=S,this.m[1]*=S,this.m[2]*=w,this.m[3]*=w,this}rotate(S){var w=Math.cos(S),j=Math.sin(S),P=this.m[0]*w+this.m[2]*j,T=this.m[1]*w+this.m[3]*j,L=this.m[0]*-j+this.m[2]*w,E=this.m[1]*-j+this.m[3]*w;return this.m[0]=P,this.m[1]=T,this.m[2]=L,this.m[3]=E,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(S,w){var j=this.m[0]+this.m[2]*w,P=this.m[1]+this.m[3]*w,T=this.m[2]+this.m[0]*S,L=this.m[3]+this.m[1]*S;return this.m[0]=j,this.m[1]=P,this.m[2]=T,this.m[3]=L,this}multiply(S){var w=this.m[0]*S.m[0]+this.m[2]*S.m[1],j=this.m[1]*S.m[0]+this.m[3]*S.m[1],P=this.m[0]*S.m[2]+this.m[2]*S.m[3],T=this.m[1]*S.m[2]+this.m[3]*S.m[3],L=this.m[0]*S.m[4]+this.m[2]*S.m[5]+this.m[4],E=this.m[1]*S.m[4]+this.m[3]*S.m[5]+this.m[5];return this.m[0]=w,this.m[1]=j,this.m[2]=P,this.m[3]=T,this.m[4]=L,this.m[5]=E,this}invert(){var S=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),w=this.m[3]*S,j=-this.m[1]*S,P=-this.m[2]*S,T=this.m[0]*S,L=S*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),E=S*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=w,this.m[1]=j,this.m[2]=P,this.m[3]=T,this.m[4]=L,this.m[5]=E,this}getMatrix(){return this.m}decompose(){var S=this.m[0],w=this.m[1],j=this.m[2],P=this.m[3],T=this.m[4],L=this.m[5],E=S*P-w*j;let O={x:T,y:L,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(S!=0||w!=0){var F=Math.sqrt(S*S+w*w);O.rotation=w>0?Math.acos(S/F):-Math.acos(S/F),O.scaleX=F,O.scaleY=E/F,O.skewX=(S*j+w*P)/E,O.skewY=0}else if(j!=0||P!=0){var _=Math.sqrt(j*j+P*P);O.rotation=Math.PI/2-(P>0?Math.acos(-j/_):-Math.acos(j/_)),O.scaleX=E/_,O.scaleY=_,O.skewX=0,O.skewY=(S*j+w*P)/E}return O.rotation=e.Util._getRotation(O.rotation),O}}e.Transform=n;var s="[object Array]",i="[object Number]",o="[object String]",a="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",h="",f="0",p="Konva warning: ",g="Konva error: ",m="rgb(",y={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const v=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(x){setTimeout(x,60)};e.Util={_isElement(x){return!!(x&&x.nodeType==1)},_isFunction(x){return!!(x&&x.constructor&&x.call&&x.apply)},_isPlainObject(x){return!!x&&x.constructor===Object},_isArray(x){return Object.prototype.toString.call(x)===s},_isNumber(x){return Object.prototype.toString.call(x)===i&&!isNaN(x)&&isFinite(x)},_isString(x){return Object.prototype.toString.call(x)===o},_isBoolean(x){return Object.prototype.toString.call(x)===a},isObject(x){return x instanceof Object},isValidSelector(x){if(typeof x!="string")return!1;var S=x[0];return S==="#"||S==="."||S===S.toUpperCase()},_sign(x){return x===0||x>0?1:-1},requestAnimFrame(x){C.push(x),C.length===1&&v(function(){const S=C;C=[],S.forEach(function(w){w()})})},createCanvasElement(){var x=document.createElement("canvas");try{x.style=x.style||{}}catch{}return x},createImageElement(){return document.createElement("img")},_isInDocument(x){for(;x=x.parentNode;)if(x==document)return!0;return!1},_urlToImage(x,S){var w=e.Util.createImageElement();w.onload=function(){S(w)},w.src=x},_rgbToHex(x,S,w){return((1<<24)+(x<<16)+(S<<8)+w).toString(16).slice(1)},_hexToRgb(x){x=x.replace(d,h);var S=parseInt(x,16);return{r:S>>16&255,g:S>>8&255,b:S&255}},getRandomColor(){for(var x=(Math.random()*16777215<<0).toString(16);x.length<6;)x=f+x;return d+x},getRGB(x){var S;return x in y?(S=y[x],{r:S[0],g:S[1],b:S[2]}):x[0]===d?this._hexToRgb(x.substring(1)):x.substr(0,4)===m?(S=b.exec(x.replace(/ /g,"")),{r:parseInt(S[1],10),g:parseInt(S[2],10),b:parseInt(S[3],10)}):{r:0,g:0,b:0}},colorToRGBA(x){return x=x||"black",e.Util._namedColorToRBA(x)||e.Util._hex3ColorToRGBA(x)||e.Util._hex4ColorToRGBA(x)||e.Util._hex6ColorToRGBA(x)||e.Util._hex8ColorToRGBA(x)||e.Util._rgbColorToRGBA(x)||e.Util._rgbaColorToRGBA(x)||e.Util._hslColorToRGBA(x)},_namedColorToRBA(x){var S=y[x.toLowerCase()];return S?{r:S[0],g:S[1],b:S[2],a:1}:null},_rgbColorToRGBA(x){if(x.indexOf("rgb(")===0){x=x.match(/rgb\(([^)]+)\)/)[1];var S=x.split(/ *, */).map(Number);return{r:S[0],g:S[1],b:S[2],a:1}}},_rgbaColorToRGBA(x){if(x.indexOf("rgba(")===0){x=x.match(/rgba\(([^)]+)\)/)[1];var S=x.split(/ *, */).map((w,j)=>w.slice(-1)==="%"?j===3?parseInt(w)/100:parseInt(w)/100*255:Number(w));return{r:S[0],g:S[1],b:S[2],a:S[3]}}},_hex8ColorToRGBA(x){if(x[0]==="#"&&x.length===9)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:parseInt(x.slice(7,9),16)/255}},_hex6ColorToRGBA(x){if(x[0]==="#"&&x.length===7)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:1}},_hex4ColorToRGBA(x){if(x[0]==="#"&&x.length===5)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:parseInt(x[4]+x[4],16)/255}},_hex3ColorToRGBA(x){if(x[0]==="#"&&x.length===4)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:1}},_hslColorToRGBA(x){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(x)){const[S,...w]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(x),j=Number(w[0])/360,P=Number(w[1])/100,T=Number(w[2])/100;let L,E,O;if(P===0)return O=T*255,{r:Math.round(O),g:Math.round(O),b:Math.round(O),a:1};T<.5?L=T*(1+P):L=T+P-T*P;const F=2*T-L,_=[0,0,0];for(let R=0;R<3;R++)E=j+1/3*-(R-1),E<0&&E++,E>1&&E--,6*E<1?O=F+(L-F)*6*E:2*E<1?O=L:3*E<2?O=F+(L-F)*(2/3-E)*6:O=F,_[R]=O*255;return{r:Math.round(_[0]),g:Math.round(_[1]),b:Math.round(_[2]),a:1}}},haveIntersection(x,S){return!(S.x>x.x+x.width||S.x+S.width<x.x||S.y>x.y+x.height||S.y+S.height<x.y)},cloneObject(x){var S={};for(var w in x)this._isPlainObject(x[w])?S[w]=this.cloneObject(x[w]):this._isArray(x[w])?S[w]=this.cloneArray(x[w]):S[w]=x[w];return S},cloneArray(x){return x.slice(0)},degToRad(x){return x*l},radToDeg(x){return x*c},_degToRad(x){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(x)},_radToDeg(x){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(x)},_getRotation(x){return t.Konva.angleDeg?e.Util.radToDeg(x):x},_capitalize(x){return x.charAt(0).toUpperCase()+x.slice(1)},throw(x){throw new Error(g+x)},error(x){console.error(g+x)},warn(x){t.Konva.showWarnings&&console.warn(p+x)},each(x,S){for(var w in x)S(w,x[w])},_inRange(x,S,w){return S<=x&&x<w},_getProjectionToSegment(x,S,w,j,P,T){var L,E,O,F=(x-w)*(x-w)+(S-j)*(S-j);if(F==0)L=x,E=S,O=(P-w)*(P-w)+(T-j)*(T-j);else{var _=((P-x)*(w-x)+(T-S)*(j-S))/F;_<0?(L=x,E=S,O=(x-P)*(x-P)+(S-T)*(S-T)):_>1?(L=w,E=j,O=(w-P)*(w-P)+(j-T)*(j-T)):(L=x+_*(w-x),E=S+_*(j-S),O=(L-P)*(L-P)+(E-T)*(E-T))}return[L,E,O]},_getProjectionToLine(x,S,w){var j=e.Util.cloneObject(x),P=Number.MAX_VALUE;return S.forEach(function(T,L){if(!(!w&&L===S.length-1)){var E=S[(L+1)%S.length],O=e.Util._getProjectionToSegment(T.x,T.y,E.x,E.y,x.x,x.y),F=O[0],_=O[1],R=O[2];R<P&&(j.x=F,j.y=_,P=R)}}),j},_prepareArrayForTween(x,S,w){var j,P=[],T=[];if(x.length>S.length){var L=S;S=x,x=L}for(j=0;j<x.length;j+=2)P.push({x:x[j],y:x[j+1]});for(j=0;j<S.length;j+=2)T.push({x:S[j],y:S[j+1]});var E=[];return T.forEach(function(O){var F=e.Util._getProjectionToLine(O,P,w);E.push(F.x),E.push(F.y)}),E},_prepareToStringify(x){var S;x.visitedByCircularReferenceRemoval=!0;for(var w in x)if(x.hasOwnProperty(w)&&x[w]&&typeof x[w]=="object"){if(S=Object.getOwnPropertyDescriptor(x,w),x[w].visitedByCircularReferenceRemoval||e.Util._isElement(x[w]))if(S.configurable)delete x[w];else return null;else if(e.Util._prepareToStringify(x[w])===null)if(S.configurable)delete x[w];else return null}return delete x.visitedByCircularReferenceRemoval,x},_assign(x,S){for(var w in S)x[w]=S[w];return x},_getFirstPointerId(x){return x.touches?x.changedTouches[0].identifier:x.pointerId||999},releaseCanvas(...x){t.Konva.releaseCanvasOnDestroy&&x.forEach(S=>{S.width=0,S.height=0})},drawRoundedRectPath(x,S,w,j){let P=0,T=0,L=0,E=0;typeof j=="number"?P=T=L=E=Math.min(j,S/2,w/2):(P=Math.min(j[0]||0,S/2,w/2),T=Math.min(j[1]||0,S/2,w/2),E=Math.min(j[2]||0,S/2,w/2),L=Math.min(j[3]||0,S/2,w/2)),x.moveTo(P,0),x.lineTo(S-T,0),x.arc(S-T,T,T,Math.PI*3/2,0,!1),x.lineTo(S,w-E),x.arc(S-E,w-E,E,0,Math.PI/2,!1),x.lineTo(L,w),x.arc(L,w-L,L,Math.PI/2,Math.PI,!1),x.lineTo(0,P),x.arc(P,P,P,Math.PI,Math.PI*3/2,!1)}}}(cb)),cb}var Rd={},ub={},nn={},r5;function wt(){if(r5)return nn;r5=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.getComponentValidator=nn.getBooleanValidator=nn.getNumberArrayValidator=nn.getFunctionValidator=nn.getStringOrGradientValidator=nn.getStringValidator=nn.getNumberOrAutoValidator=nn.getNumberOrArrayOfNumbersValidator=nn.getNumberValidator=nn.alphaComponent=nn.RGBComponent=void 0;const e=Ct(),t=In();function n(m){return t.Util._isString(m)?'"'+m+'"':Object.prototype.toString.call(m)==="[object Number]"||t.Util._isBoolean(m)?m:Object.prototype.toString.call(m)}function s(m){return m>255?255:m<0?0:Math.round(m)}nn.RGBComponent=s;function i(m){return m>1?1:m<1e-4?1e-4:m}nn.alphaComponent=i;function o(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isNumber(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number.'),m}}nn.getNumberValidator=o;function a(m){if(e.Konva.isUnminified)return function(y,b){let C=t.Util._isNumber(y),v=t.Util._isArray(y)&&y.length==m;return!C&&!v&&t.Util.warn(n(y)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+m+")"),y}}nn.getNumberOrArrayOfNumbersValidator=a;function l(){if(e.Konva.isUnminified)return function(m,y){var b=t.Util._isNumber(m),C=m==="auto";return b||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number or "auto".'),m}}nn.getNumberOrAutoValidator=l;function c(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isString(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string.'),m}}nn.getStringValidator=c;function d(){if(e.Konva.isUnminified)return function(m,y){const b=t.Util._isString(m),C=Object.prototype.toString.call(m)==="[object CanvasGradient]"||m&&m.addColorStop;return b||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string or a native gradient.'),m}}nn.getStringOrGradientValidator=d;function h(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isFunction(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a function.'),m}}nn.getFunctionValidator=h;function f(){if(e.Konva.isUnminified)return function(m,y){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&m instanceof b||(t.Util._isArray(m)?m.forEach(function(C){t.Util._isNumber(C)||t.Util.warn('"'+y+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a array of numbers.')),m}}nn.getNumberArrayValidator=f;function p(){if(e.Konva.isUnminified)return function(m,y){var b=m===!0||m===!1;return b||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a boolean.'),m}}nn.getBooleanValidator=p;function g(m){if(e.Konva.isUnminified)return function(y,b){return y==null||t.Util.isObject(y)||t.Util.warn(n(y)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+m),y}}return nn.getComponentValidator=g,nn}var i5;function St(){return i5||(i5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=In(),n=wt();var s="get",i="set";e.Factory={addGetterSetter(o,a,l,c,d){e.Factory.addGetter(o,a,l),e.Factory.addSetter(o,a,c,d),e.Factory.addOverloadedGetterSetter(o,a)},addGetter(o,a,l){var c=s+t.Util._capitalize(a);o.prototype[c]=o.prototype[c]||function(){var d=this.attrs[a];return d===void 0?l:d}},addSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]||e.Factory.overWriteSetter(o,a,l,c)},overWriteSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]=function(h){return l&&h!==void 0&&h!==null&&(h=l.call(this,h,a)),this._setAttr(a,h),c&&c.call(this),this}},addComponentsGetterSetter(o,a,l,c,d){var h=l.length,f=t.Util._capitalize,p=s+f(a),g=i+f(a),m,y;o.prototype[p]=function(){var C={};for(m=0;m<h;m++)y=l[m],C[y]=this.getAttr(a+f(y));return C};var b=(0,n.getComponentValidator)(l);o.prototype[g]=function(C){var v=this.attrs[a],x;c&&(C=c.call(this,C)),b&&b.call(this,C,a);for(x in C)C.hasOwnProperty(x)&&this._setAttr(a+f(x),C[x]);return C||l.forEach(S=>{this._setAttr(a+f(S),void 0)}),this._fireChangeEvent(a,v,C),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(o,a)},addOverloadedGetterSetter(o,a){var l=t.Util._capitalize(a),c=i+l,d=s+l;o.prototype[a]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(o,a,l,c){t.Util.error("Adding deprecated "+a);var d=s+t.Util._capitalize(a),h=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[d]=function(){t.Util.error(h);var f=this.attrs[a];return f===void 0?l:f},e.Factory.addSetter(o,a,c,function(){t.Util.error(h)}),e.Factory.addOverloadedGetterSetter(o,a)},backCompat(o,a){t.Util.each(a,function(l,c){var d=o.prototype[c],h=s+t.Util._capitalize(l),f=i+t.Util._capitalize(l);function p(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}o.prototype[l]=p,o.prototype[h]=p,o.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}}(ub)),ub}var jo={},ko={},o5;function bL(){if(o5)return ko;o5=1,Object.defineProperty(ko,"__esModule",{value:!0}),ko.HitContext=ko.SceneContext=ko.Context=void 0;const e=In(),t=Ct();function n(C){var v=[],x=C.length,S=e.Util,w,j;for(w=0;w<x;w++)j=C[w],S._isNumber(j)?j=Math.round(j*1e3)/1e3:S._isString(j)||(j=j+""),v.push(j);return v}var s=",",i="(",o=")",a="([",l="])",c=";",d="()",h="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const g=100;let m=class{constructor(v){this.canvas=v,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(v){v.fillEnabled()&&this._fill(v)}_fill(v){}strokeShape(v){v.hasStroke()&&this._stroke(v)}_stroke(v){}fillStrokeShape(v){v.attrs.fillAfterStrokeEnabled?(this.strokeShape(v),this.fillShape(v)):(this.fillShape(v),this.strokeShape(v))}getTrace(v,x){var S=this.traceArr,w=S.length,j="",P,T,L,E;for(P=0;P<w;P++)T=S[P],L=T.method,L?(E=T.args,j+=L,v?j+=d:e.Util._isArray(E[0])?j+=a+E.join(s)+l:(x&&(E=E.map(O=>typeof O=="number"?Math.floor(O):O)),j+=i+E.join(s)+o)):(j+=T.property,v||(j+=h+T.val)),j+=c;return j}clearTrace(){this.traceArr=[]}_trace(v){var x=this.traceArr,S;x.push(v),S=x.length,S>=g&&x.shift()}reset(){var v=this.getCanvas().getPixelRatio();this.setTransform(1*v,0,0,1*v,0,0)}getCanvas(){return this.canvas}clear(v){var x=this.getCanvas();v?this.clearRect(v.x||0,v.y||0,v.width||0,v.height||0):this.clearRect(0,0,x.getWidth()/x.pixelRatio,x.getHeight()/x.pixelRatio)}_applyLineCap(v){const x=v.attrs.lineCap;x&&this.setAttr("lineCap",x)}_applyOpacity(v){var x=v.getAbsoluteOpacity();x!==1&&this.setAttr("globalAlpha",x)}_applyLineJoin(v){const x=v.attrs.lineJoin;x&&this.setAttr("lineJoin",x)}setAttr(v,x){this._context[v]=x}arc(v,x,S,w,j,P){this._context.arc(v,x,S,w,j,P)}arcTo(v,x,S,w,j){this._context.arcTo(v,x,S,w,j)}beginPath(){this._context.beginPath()}bezierCurveTo(v,x,S,w,j,P){this._context.bezierCurveTo(v,x,S,w,j,P)}clearRect(v,x,S,w){this._context.clearRect(v,x,S,w)}clip(...v){this._context.clip.apply(this._context,v)}closePath(){this._context.closePath()}createImageData(v,x){var S=arguments;if(S.length===2)return this._context.createImageData(v,x);if(S.length===1)return this._context.createImageData(v)}createLinearGradient(v,x,S,w){return this._context.createLinearGradient(v,x,S,w)}createPattern(v,x){return this._context.createPattern(v,x)}createRadialGradient(v,x,S,w,j,P){return this._context.createRadialGradient(v,x,S,w,j,P)}drawImage(v,x,S,w,j,P,T,L,E){var O=arguments,F=this._context;O.length===3?F.drawImage(v,x,S):O.length===5?F.drawImage(v,x,S,w,j):O.length===9&&F.drawImage(v,x,S,w,j,P,T,L,E)}ellipse(v,x,S,w,j,P,T,L){this._context.ellipse(v,x,S,w,j,P,T,L)}isPointInPath(v,x,S,w){return S?this._context.isPointInPath(S,v,x,w):this._context.isPointInPath(v,x,w)}fill(...v){this._context.fill.apply(this._context,v)}fillRect(v,x,S,w){this._context.fillRect(v,x,S,w)}strokeRect(v,x,S,w){this._context.strokeRect(v,x,S,w)}fillText(v,x,S,w){w?this._context.fillText(v,x,S,w):this._context.fillText(v,x,S)}measureText(v){return this._context.measureText(v)}getImageData(v,x,S,w){return this._context.getImageData(v,x,S,w)}lineTo(v,x){this._context.lineTo(v,x)}moveTo(v,x){this._context.moveTo(v,x)}rect(v,x,S,w){this._context.rect(v,x,S,w)}roundRect(v,x,S,w,j){this._context.roundRect(v,x,S,w,j)}putImageData(v,x,S){this._context.putImageData(v,x,S)}quadraticCurveTo(v,x,S,w){this._context.quadraticCurveTo(v,x,S,w)}restore(){this._context.restore()}rotate(v){this._context.rotate(v)}save(){this._context.save()}scale(v,x){this._context.scale(v,x)}setLineDash(v){this._context.setLineDash?this._context.setLineDash(v):"mozDash"in this._context?this._context.mozDash=v:"webkitLineDash"in this._context&&(this._context.webkitLineDash=v)}getLineDash(){return this._context.getLineDash()}setTransform(v,x,S,w,j,P){this._context.setTransform(v,x,S,w,j,P)}stroke(v){v?this._context.stroke(v):this._context.stroke()}strokeText(v,x,S,w){this._context.strokeText(v,x,S,w)}transform(v,x,S,w,j,P){this._context.transform(v,x,S,w,j,P)}translate(v,x){this._context.translate(v,x)}_enableTrace(){var v=this,x=f.length,S=this.setAttr,w,j,P=function(T){var L=v[T],E;v[T]=function(){return j=n(Array.prototype.slice.call(arguments,0)),E=L.apply(v,arguments),v._trace({method:T,args:j}),E}};for(w=0;w<x;w++)P(f[w]);v.setAttr=function(){S.apply(v,arguments);var T=arguments[0],L=arguments[1];(T==="shadowOffsetX"||T==="shadowOffsetY"||T==="shadowBlur")&&(L=L/this.canvas.getPixelRatio()),v._trace({property:T,val:L})}}_applyGlobalCompositeOperation(v){const x=v.attrs.globalCompositeOperation;var S=!x||x==="source-over";S||this.setAttr("globalCompositeOperation",x)}};ko.Context=m,p.forEach(function(C){Object.defineProperty(m.prototype,C,{get(){return this._context[C]},set(v){this._context[C]=v}})});class y extends m{constructor(v,{willReadFrequently:x=!1}={}){super(v),this._context=v._canvas.getContext("2d",{willReadFrequently:x})}_fillColor(v){var x=v.fill();this.setAttr("fillStyle",x),v._fillFunc(this)}_fillPattern(v){this.setAttr("fillStyle",v._getFillPattern()),v._fillFunc(this)}_fillLinearGradient(v){var x=v._getLinearGradient();x&&(this.setAttr("fillStyle",x),v._fillFunc(this))}_fillRadialGradient(v){const x=v._getRadialGradient();x&&(this.setAttr("fillStyle",x),v._fillFunc(this))}_fill(v){const x=v.fill(),S=v.getFillPriority();if(x&&S==="color"){this._fillColor(v);return}const w=v.getFillPatternImage();if(w&&S==="pattern"){this._fillPattern(v);return}const j=v.getFillLinearGradientColorStops();if(j&&S==="linear-gradient"){this._fillLinearGradient(v);return}const P=v.getFillRadialGradientColorStops();if(P&&S==="radial-gradient"){this._fillRadialGradient(v);return}x?this._fillColor(v):w?this._fillPattern(v):j?this._fillLinearGradient(v):P&&this._fillRadialGradient(v)}_strokeLinearGradient(v){const x=v.getStrokeLinearGradientStartPoint(),S=v.getStrokeLinearGradientEndPoint(),w=v.getStrokeLinearGradientColorStops(),j=this.createLinearGradient(x.x,x.y,S.x,S.y);if(w){for(var P=0;P<w.length;P+=2)j.addColorStop(w[P],w[P+1]);this.setAttr("strokeStyle",j)}}_stroke(v){var x=v.dash(),S=v.getStrokeScaleEnabled();if(v.hasStroke()){if(!S){this.save();var w=this.getCanvas().getPixelRatio();this.setTransform(w,0,0,w,0,0)}this._applyLineCap(v),x&&v.dashEnabled()&&(this.setLineDash(x),this.setAttr("lineDashOffset",v.dashOffset())),this.setAttr("lineWidth",v.strokeWidth()),v.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var j=v.getStrokeLinearGradientColorStops();j?this._strokeLinearGradient(v):this.setAttr("strokeStyle",v.stroke()),v._strokeFunc(this),S||this.restore()}}_applyShadow(v){var x,S,w,j=(x=v.getShadowRGBA())!==null&&x!==void 0?x:"black",P=(S=v.getShadowBlur())!==null&&S!==void 0?S:5,T=(w=v.getShadowOffset())!==null&&w!==void 0?w:{x:0,y:0},L=v.getAbsoluteScale(),E=this.canvas.getPixelRatio(),O=L.x*E,F=L.y*E;this.setAttr("shadowColor",j),this.setAttr("shadowBlur",P*Math.min(Math.abs(O),Math.abs(F))),this.setAttr("shadowOffsetX",T.x*O),this.setAttr("shadowOffsetY",T.y*F)}}ko.SceneContext=y;class b extends m{constructor(v){super(v),this._context=v._canvas.getContext("2d",{willReadFrequently:!0})}_fill(v){this.save(),this.setAttr("fillStyle",v.colorKey),v._fillFuncHit(this),this.restore()}strokeShape(v){v.hasHitStroke()&&this._stroke(v)}_stroke(v){if(v.hasHitStroke()){const j=v.getStrokeScaleEnabled();if(!j){this.save();var x=this.getCanvas().getPixelRatio();this.setTransform(x,0,0,x,0,0)}this._applyLineCap(v);var S=v.hitStrokeWidth(),w=S==="auto"?v.strokeWidth():S;this.setAttr("lineWidth",w),this.setAttr("strokeStyle",v.colorKey),v._strokeFuncHit(this),j||this.restore()}}}return ko.HitContext=b,ko}var a5;function ky(){if(a5)return jo;a5=1,Object.defineProperty(jo,"__esModule",{value:!0}),jo.HitCanvas=jo.SceneCanvas=jo.Canvas=void 0;const e=In(),t=bL(),n=Ct(),s=St(),i=wt();var o;function a(){if(o)return o;var h=e.Util.createCanvasElement(),f=h.getContext("2d");return o=function(){var p=n.Konva._global.devicePixelRatio||1,g=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/g}(),e.Util.releaseCanvas(h),o}let l=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var p=f||{},g=p.pixelRatio||n.Konva.pixelRatio||a();this.pixelRatio=g,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){var p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(m){return e.Util.error("Unable to get data URL. "+m.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};jo.Canvas=l,s.Factory.addGetterSetter(l,"pixelRatio",void 0,(0,i.getNumberValidator)());class c extends l{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new t.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}jo.SceneCanvas=c;class d extends l{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(f.width,f.height)}}return jo.HitCanvas=d,jo}var db={},l5;function jw(){return l5||(l5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=Ct(),n=In();e.DD={get isDragging(){var s=!1;return e.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(s=!0)}),s},justDragged:!1,get node(){var s;return e.DD._dragElements.forEach(i=>{s=i.node}),s},_dragElements:new Map,_drag(s){const i=[];e.DD._dragElements.forEach((o,a)=>{const{node:l}=o,c=l.getStage();c.setPointersPositions(s),o.pointerId===void 0&&(o.pointerId=n.Util._getFirstPointerId(s));const d=c._changedPointerPositions.find(p=>p.id===o.pointerId);if(d){if(o.dragStatus!=="dragging"){var h=l.dragDistance(),f=Math.max(Math.abs(d.x-o.startPointerPos.x),Math.abs(d.y-o.startPointerPos.y));if(f<h||(l.startDrag({evt:s}),!l.isDragging()))return}l._setDragPosition(s,o),i.push(l)}}),i.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:s},!0)})},_endDragBefore(s){const i=[];e.DD._dragElements.forEach(o=>{const{node:a}=o,l=a.getStage();if(s&&l.setPointersPositions(s),!l._changedPointerPositions.find(h=>h.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const d=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;d&&i.indexOf(d)===-1&&i.push(d)}),i.forEach(o=>{o.draw()})},_endDragAfter(s){e.DD._dragElements.forEach((i,o)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:s},!0),i.dragStatus!=="dragging"&&e.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1))}(db)),db}var c5;function Mn(){if(c5)return Rd;c5=1,Object.defineProperty(Rd,"__esModule",{value:!0}),Rd.Node=void 0;const e=In(),t=St(),n=ky(),s=Ct(),i=jw(),o=wt();var a="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",h="canvas",f="Change",p="children",g="konva",m="listening",y="mouseenter",b="mouseleave",C="set",v="Shape",x=" ",S="stage",w="transform",j="Stage",P="visible",T=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(x);let L=1;class E{constructor(_){this._id=L++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(_),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(_){(_===w||_===c)&&this._cache.get(_)?this._cache.get(_).dirty=!0:_?this._cache.delete(_):this._cache.clear()}_getCache(_,R){var D=this._cache.get(_),$=_===w||_===c,G=D===void 0||$&&D.dirty===!0;return G&&(D=R.call(this),this._cache.set(_,D)),D}_calculate(_,R,D){if(!this._attachedDepsListeners.get(_)){const $=R.map(G=>G+"Change.konva").join(x);this.on($,()=>{this._clearCache(_)}),this._attachedDepsListeners.set(_,!0)}return this._getCache(_,D)}_getCanvasCache(){return this._cache.get(h)}_clearSelfAndDescendantCache(_){this._clearCache(_),_===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(h)){const{scene:_,filter:R,hit:D}=this._cache.get(h);e.Util.releaseCanvas(_,R,D),this._cache.delete(h)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(_){var R=_||{},D={};(R.x===void 0||R.y===void 0||R.width===void 0||R.height===void 0)&&(D=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var $=Math.ceil(R.width||D.width),G=Math.ceil(R.height||D.height),ee=R.pixelRatio,Q=R.x===void 0?Math.floor(D.x):R.x,se=R.y===void 0?Math.floor(D.y):R.y,ne=R.offset||0,H=R.drawBorder||!1,V=R.hitCanvasPixelRatio||1;if(!$||!G){e.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const Y=Math.abs(Math.round(D.x)-Q)>.5?1:0,W=Math.abs(Math.round(D.y)-se)>.5?1:0;$+=ne*2+Y,G+=ne*2+W,Q-=ne,se-=ne;var J=new n.SceneCanvas({pixelRatio:ee,width:$,height:G}),N=new n.SceneCanvas({pixelRatio:ee,width:0,height:0,willReadFrequently:!0}),B=new n.HitCanvas({pixelRatio:V,width:$,height:G}),U=J.getContext(),ie=B.getContext();return B.isCache=!0,J.isCache=!0,this._cache.delete(h),this._filterUpToDate=!1,R.imageSmoothingEnabled===!1&&(J.getContext()._context.imageSmoothingEnabled=!1,N.getContext()._context.imageSmoothingEnabled=!1),U.save(),ie.save(),U.translate(-Q,-se),ie.translate(-Q,-se),this._isUnderCache=!0,this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this.drawScene(J,this),this.drawHit(B,this),this._isUnderCache=!1,U.restore(),ie.restore(),H&&(U.save(),U.beginPath(),U.rect(0,0,$,G),U.closePath(),U.setAttr("strokeStyle","red"),U.setAttr("lineWidth",5),U.stroke(),U.restore()),this._cache.set(h,{scene:J,filter:N,hit:B,x:Q,y:se}),this._requestDraw(),this}isCached(){return this._cache.has(h)}getClientRect(_){throw new Error('abstract "getClientRect" method call')}_transformedRect(_,R){var D=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],$=1/0,G=1/0,ee=-1/0,Q=-1/0,se=this.getAbsoluteTransform(R);return D.forEach(function(ne){var H=se.point(ne);$===void 0&&($=ee=H.x,G=Q=H.y),$=Math.min($,H.x),G=Math.min(G,H.y),ee=Math.max(ee,H.x),Q=Math.max(Q,H.y)}),{x:$,y:G,width:ee-$,height:Q-G}}_drawCachedSceneCanvas(_){_.save(),_._applyOpacity(this),_._applyGlobalCompositeOperation(this);const R=this._getCanvasCache();_.translate(R.x,R.y);var D=this._getCachedSceneCanvas(),$=D.pixelRatio;_.drawImage(D._canvas,0,0,D.width/$,D.height/$),_.restore()}_drawCachedHitCanvas(_){var R=this._getCanvasCache(),D=R.hit;_.save(),_.translate(R.x,R.y),_.drawImage(D._canvas,0,0,D.width/D.pixelRatio,D.height/D.pixelRatio),_.restore()}_getCachedSceneCanvas(){var _=this.filters(),R=this._getCanvasCache(),D=R.scene,$=R.filter,G=$.getContext(),ee,Q,se,ne;if(_){if(!this._filterUpToDate){var H=D.pixelRatio;$.setSize(D.width/D.pixelRatio,D.height/D.pixelRatio);try{for(ee=_.length,G.clear(),G.drawImage(D._canvas,0,0,D.getWidth()/H,D.getHeight()/H),Q=G.getImageData(0,0,$.getWidth(),$.getHeight()),se=0;se<ee;se++){if(ne=_[se],typeof ne!="function"){e.Util.error("Filter should be type of function, but got "+typeof ne+" instead. Please check correct filters");continue}ne.call(this,Q),G.putImageData(Q,0,0)}}catch(V){e.Util.error("Unable to apply filter. "+V.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return $}return D}on(_,R){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);var D=_.split(x),$=D.length,G,ee,Q,se,ne;for(G=0;G<$;G++)ee=D[G],Q=ee.split("."),se=Q[0],ne=Q[1]||"",this.eventListeners[se]||(this.eventListeners[se]=[]),this.eventListeners[se].push({name:ne,handler:R});return this}off(_,R){var D=(_||"").split(x),$=D.length,G,ee,Q,se,ne,H;if(this._cache&&this._cache.delete(l),!_)for(ee in this.eventListeners)this._off(ee);for(G=0;G<$;G++)if(Q=D[G],se=Q.split("."),ne=se[0],H=se[1],ne)this.eventListeners[ne]&&this._off(ne,H,R);else for(ee in this.eventListeners)this._off(ee,H,R);return this}dispatchEvent(_){var R={target:this,type:_.type,evt:_};return this.fire(_.type,R),this}addEventListener(_,R){return this.on(_,function(D){R.call(this,D.evt)}),this}removeEventListener(_){return this.off(_),this}_delegate(_,R,D){var $=this;this.on(_,function(G){for(var ee=G.target.findAncestors(R,!0,$),Q=0;Q<ee.length;Q++)G=e.Util.cloneObject(G),G.currentTarget=ee[Q],D.call(ee[Q],G)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(S),this._clearSelfAndDescendantCache(P),this._clearSelfAndDescendantCache(m)}_remove(){this._clearCaches();var _=this.getParent();_&&_.children&&(_.children.splice(this.index,1),_._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(_){var R="get"+e.Util._capitalize(_);return e.Util._isFunction(this[R])?this[R]():this.attrs[_]}getAncestors(){for(var _=this.getParent(),R=[];_;)R.push(_),_=_.getParent();return R}getAttrs(){return this.attrs||{}}setAttrs(_){return this._batchTransformChanges(()=>{var R,D;if(!_)return this;for(R in _)R!==p&&(D=C+e.Util._capitalize(R),e.Util._isFunction(this[D])?this[D](_[R]):this._setAttr(R,_[R]))}),this}isListening(){return this._getCache(m,this._isListening)}_isListening(_){if(!this.listening())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isListening(_):!0}isVisible(){return this._getCache(P,this._isVisible)}_isVisible(_){if(!this.visible())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isVisible(_):!0}shouldDrawHit(_,R=!1){if(_)return this._isVisible(_)&&this._isListening(_);var D=this.getLayer(),$=!1;i.DD._dragElements.forEach(ee=>{ee.dragStatus==="dragging"&&(ee.node.nodeType==="Stage"||ee.node.getLayer()===D)&&($=!0)});var G=!R&&!s.Konva.hitOnDragEnabled&&($||s.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!G}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var _=this.getDepth(),R=this,D=0,$,G,ee,Q;function se(H){for($=[],G=H.length,ee=0;ee<G;ee++)Q=H[ee],D++,Q.nodeType!==v&&($=$.concat(Q.getChildren().slice())),Q._id===R._id&&(ee=G);$.length>0&&$[0].getDepth()<=_&&se($)}const ne=this.getStage();return R.nodeType!==j&&ne&&se(ne.getChildren()),D}getDepth(){for(var _=0,R=this.parent;R;)_++,R=R.parent;return _}_batchTransformChanges(_){this._batchingTransformChange=!0,_(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(w),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(_){return this._batchTransformChanges(()=>{this.x(_.x),this.y(_.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const _=this.getStage();if(!_)return null;var R=_.getPointerPosition();if(!R)return null;var D=this.getAbsoluteTransform().copy();return D.invert(),D.point(R)}getAbsolutePosition(_){let R=!1,D=this.parent;for(;D;){if(D.isCached()){R=!0;break}D=D.parent}R&&!_&&(_=!0);var $=this.getAbsoluteTransform(_).getMatrix(),G=new e.Transform,ee=this.offset();return G.m=$.slice(),G.translate(ee.x,ee.y),G.getTranslation()}setAbsolutePosition(_){const{x:R,y:D,...$}=this._clearTransform();this.attrs.x=R,this.attrs.y=D,this._clearCache(w);var G=this._getAbsoluteTransform().copy();return G.invert(),G.translate(_.x,_.y),_={x:this.attrs.x+G.getTranslation().x,y:this.attrs.y+G.getTranslation().y},this._setTransform($),this.setPosition({x:_.x,y:_.y}),this._clearCache(w),this._clearSelfAndDescendantCache(c),this}_setTransform(_){var R;for(R in _)this.attrs[R]=_[R]}_clearTransform(){var _={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,_}move(_){var R=_.x,D=_.y,$=this.x(),G=this.y();return R!==void 0&&($+=R),D!==void 0&&(G+=D),this.setPosition({x:$,y:G}),this}_eachAncestorReverse(_,R){var D=[],$=this.getParent(),G,ee;if(!(R&&R._id===this._id)){for(D.unshift(this);$&&(!R||$._id!==R._id);)D.unshift($),$=$.parent;for(G=D.length,ee=0;ee<G;ee++)_(D[ee])}}rotate(_){return this.rotation(this.rotation()+_),this}moveToTop(){if(!this.parent)return e.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return e.Util.warn("Node has no parent. moveUp function is ignored."),!1;var _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.splice(_+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return e.Util.warn("Node has no parent. moveDown function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.splice(_-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return e.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(_){if(!this.parent)return e.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(_<0||_>=this.parent.children.length)&&e.Util.warn("Unexpected value "+_+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var R=this.index;return this.parent.children.splice(R,1),this.parent.children.splice(_,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(a,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var _=this.opacity(),R=this.getParent();return R&&!R._isUnderCache&&(_*=R.getAbsoluteOpacity()),_}moveTo(_){return this.getParent()!==_&&(this._remove(),_.add(this)),this}toObject(){var _=this.getAttrs(),R,D,$,G,ee;const Q={attrs:{},className:this.getClassName()};for(R in _)D=_[R],ee=e.Util.isObject(D)&&!e.Util._isPlainObject(D)&&!e.Util._isArray(D),!ee&&($=typeof this[R]=="function"&&this[R],delete _[R],G=$?$.call(this):null,_[R]=D,G!==D&&(Q.attrs[R]=D));return e.Util._prepareToStringify(Q)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(_,R,D){var $=[];R&&this._isMatch(_)&&$.push(this);for(var G=this.parent;G;){if(G===D)return $;G._isMatch(_)&&$.push(G),G=G.parent}return $}isAncestorOf(_){return!1}findAncestor(_,R,D){return this.findAncestors(_,R,D)[0]}_isMatch(_){if(!_)return!1;if(typeof _=="function")return _(this);var R=_.replace(/ /g,"").split(","),D=R.length,$,G;for($=0;$<D;$++)if(G=R[$],e.Util.isValidSelector(G)||(e.Util.warn('Selector "'+G+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),e.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),e.Util.warn("Konva is awesome, right?")),G.charAt(0)==="#"){if(this.id()===G.slice(1))return!0}else if(G.charAt(0)==="."){if(this.hasName(G.slice(1)))return!0}else if(this.className===G||this.nodeType===G)return!0;return!1}getLayer(){var _=this.getParent();return _?_.getLayer():null}getStage(){return this._getCache(S,this._getStage)}_getStage(){var _=this.getParent();return _?_.getStage():null}fire(_,R={},D){return R.target=R.target||this,D?this._fireAndBubble(_,R):this._fire(_,R),this}getAbsoluteTransform(_){return _?this._getAbsoluteTransform(_):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(_){var R;if(_)return R=new e.Transform,this._eachAncestorReverse(function($){var G=$.transformsEnabled();G==="all"?R.multiply($.getTransform()):G==="position"&&R.translate($.x()-$.offsetX(),$.y()-$.offsetY())},_),R;R=this._cache.get(c)||new e.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(R):R.reset();var D=this.transformsEnabled();if(D==="all")R.multiply(this.getTransform());else if(D==="position"){const $=this.attrs.x||0,G=this.attrs.y||0,ee=this.attrs.offsetX||0,Q=this.attrs.offsetY||0;R.translate($-ee,G-Q)}return R.dirty=!1,R}getAbsoluteScale(_){for(var R=this;R;)R._isUnderCache&&(_=R),R=R.getParent();const $=this.getAbsoluteTransform(_).decompose();return{x:$.scaleX,y:$.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(w,this._getTransform)}_getTransform(){var _,R,D=this._cache.get(w)||new e.Transform;D.reset();var $=this.x(),G=this.y(),ee=s.Konva.getAngle(this.rotation()),Q=(_=this.attrs.scaleX)!==null&&_!==void 0?_:1,se=(R=this.attrs.scaleY)!==null&&R!==void 0?R:1,ne=this.attrs.skewX||0,H=this.attrs.skewY||0,V=this.attrs.offsetX||0,Y=this.attrs.offsetY||0;return($!==0||G!==0)&&D.translate($,G),ee!==0&&D.rotate(ee),(ne!==0||H!==0)&&D.skew(ne,H),(Q!==1||se!==1)&&D.scale(Q,se),(V!==0||Y!==0)&&D.translate(-1*V,-1*Y),D.dirty=!1,D}clone(_){var R=e.Util.cloneObject(this.attrs),D,$,G,ee,Q;for(D in _)R[D]=_[D];var se=new this.constructor(R);for(D in this.eventListeners)for($=this.eventListeners[D],G=$.length,ee=0;ee<G;ee++)Q=$[ee],Q.name.indexOf(g)<0&&(se.eventListeners[D]||(se.eventListeners[D]=[]),se.eventListeners[D].push(Q));return se}_toKonvaCanvas(_){_=_||{};var R=this.getClientRect(),D=this.getStage(),$=_.x!==void 0?_.x:Math.floor(R.x),G=_.y!==void 0?_.y:Math.floor(R.y),ee=_.pixelRatio||1,Q=new n.SceneCanvas({width:_.width||Math.ceil(R.width)||(D?D.width():0),height:_.height||Math.ceil(R.height)||(D?D.height():0),pixelRatio:ee}),se=Q.getContext();const ne=new n.SceneCanvas({width:Q.width/Q.pixelRatio+Math.abs($),height:Q.height/Q.pixelRatio+Math.abs(G),pixelRatio:Q.pixelRatio});return _.imageSmoothingEnabled===!1&&(se._context.imageSmoothingEnabled=!1),se.save(),($||G)&&se.translate(-1*$,-1*G),this.drawScene(Q,void 0,ne),se.restore(),Q}toCanvas(_){return this._toKonvaCanvas(_)._canvas}toDataURL(_){_=_||{};var R=_.mimeType||null,D=_.quality||null,$=this._toKonvaCanvas(_).toDataURL(R,D);return _.callback&&_.callback($),$}toImage(_){return new Promise((R,D)=>{try{const $=_==null?void 0:_.callback;$&&delete _.callback,e.Util._urlToImage(this.toDataURL(_),function(G){R(G),$==null||$(G)})}catch($){D($)}})}toBlob(_){return new Promise((R,D)=>{try{const $=_==null?void 0:_.callback;$&&delete _.callback,this.toCanvas(_).toBlob(G=>{R(G),$==null||$(G)},_==null?void 0:_.mimeType,_==null?void 0:_.quality)}catch($){D($)}})}setSize(_){return this.width(_.width),this.height(_.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance}_off(_,R,D){var $=this.eventListeners[_],G,ee,Q;for(G=0;G<$.length;G++)if(ee=$[G].name,Q=$[G].handler,(ee!=="konva"||R==="konva")&&(!R||ee===R)&&(!D||D===Q)){if($.splice(G,1),$.length===0){delete this.eventListeners[_];break}G--}}_fireChangeEvent(_,R,D){this._fire(_+f,{oldVal:R,newVal:D})}addName(_){if(!this.hasName(_)){var R=this.name(),D=R?R+" "+_:_;this.name(D)}return this}hasName(_){if(!_)return!1;const R=this.name();if(!R)return!1;var D=(R||"").split(/\s/g);return D.indexOf(_)!==-1}removeName(_){var R=(this.name()||"").split(/\s/g),D=R.indexOf(_);return D!==-1&&(R.splice(D,1),this.name(R.join(" "))),this}setAttr(_,R){var D=this[C+e.Util._capitalize(_)];return e.Util._isFunction(D)?D.call(this,R):this._setAttr(_,R),this}_requestDraw(){if(s.Konva.autoDrawEnabled){const _=this.getLayer()||this.getStage();_==null||_.batchDraw()}}_setAttr(_,R){var D=this.attrs[_];D===R&&!e.Util.isObject(R)||(R==null?delete this.attrs[_]:this.attrs[_]=R,this._shouldFireChangeEvents&&this._fireChangeEvent(_,D,R),this._requestDraw())}_setComponentAttr(_,R,D){var $;D!==void 0&&($=this.attrs[_],$||(this.attrs[_]=this.getAttr(_)),this.attrs[_][R]=D,this._fireChangeEvent(_,$,D))}_fireAndBubble(_,R,D){R&&this.nodeType===v&&(R.target=this);var $=(_===y||_===b)&&(D&&(this===D||this.isAncestorOf&&this.isAncestorOf(D))||this.nodeType==="Stage"&&!D);if(!$){this._fire(_,R);var G=(_===y||_===b)&&D&&D.isAncestorOf&&D.isAncestorOf(this)&&!D.isAncestorOf(this.parent);(R&&!R.cancelBubble||!R)&&this.parent&&this.parent.isListening()&&!G&&(D&&D.parent?this._fireAndBubble.call(this.parent,_,R,D):this._fireAndBubble.call(this.parent,_,R))}}_getProtoListeners(_){var R,D,$;const G=(R=this._cache.get(l))!==null&&R!==void 0?R:{};let ee=G==null?void 0:G[_];if(ee===void 0){ee=[];let Q=Object.getPrototypeOf(this);for(;Q;){const se=($=(D=Q.eventListeners)===null||D===void 0?void 0:D[_])!==null&&$!==void 0?$:[];ee.push(...se),Q=Object.getPrototypeOf(Q)}G[_]=ee,this._cache.set(l,G)}return ee}_fire(_,R){R=R||{},R.currentTarget=this,R.type=_;const D=this._getProtoListeners(_);if(D)for(var $=0;$<D.length;$++)D[$].handler.call(this,R);const G=this.eventListeners[_];if(G)for(var $=0;$<G.length;$++)G[$].handler.call(this,R)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(_){var R=_?_.pointerId:void 0,D=this.getStage(),$=this.getAbsolutePosition();if(D){var G=D._getPointerById(R)||D._changedPointerPositions[0]||$;i.DD._dragElements.set(this._id,{node:this,startPointerPos:G,offset:{x:G.x-$.x,y:G.y-$.y},dragStatus:"ready",pointerId:R})}}startDrag(_,R=!0){i.DD._dragElements.has(this._id)||this._createDragElement(_);const D=i.DD._dragElements.get(this._id);D.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:_&&_.evt},R)}_setDragPosition(_,R){const D=this.getStage()._getPointerById(R.pointerId);if(D){var $={x:D.x-R.offset.x,y:D.y-R.offset.y},G=this.dragBoundFunc();if(G!==void 0){const ee=G.call(this,$,_);ee?$=ee:e.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==$.x||this._lastPos.y!==$.y)&&(this.setAbsolutePosition($),this._requestDraw()),this._lastPos=$}}stopDrag(_){const R=i.DD._dragElements.get(this._id);R&&(R.dragStatus="stopped"),i.DD._endDragBefore(_),i.DD._endDragAfter(_)}setDraggable(_){this._setAttr("draggable",_),this._dragChange()}isDragging(){const _=i.DD._dragElements.get(this._id);return _?_.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(_){var R=_.evt.button!==void 0,D=!R||s.Konva.dragButtons.indexOf(_.evt.button)>=0;if(D&&!this.isDragging()){var $=!1;i.DD._dragElements.forEach(G=>{this.isAncestorOf(G.node)&&($=!0)}),$||this._createDragElement(_)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var _=this.getStage();if(!_)return;const R=i.DD._dragElements.get(this._id),D=R&&R.dragStatus==="dragging",$=R&&R.dragStatus==="ready";D?this.stopDrag():$&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(_={x:0,y:0}){const R=this.getStage();if(!R)return!1;const D={x:-_.x,y:-_.y,width:R.width()+2*_.x,height:R.height()+2*_.y};return e.Util.haveIntersection(D,this.getClientRect())}static create(_,R){return e.Util._isString(_)&&(_=JSON.parse(_)),this._createNode(_,R)}static _createNode(_,R){var D=E.prototype.getClassName.call(_),$=_.children,G,ee,Q;R&&(_.attrs.container=R),s.Konva[D]||(e.Util.warn('Can not find a node with class name "'+D+'". Fallback to "Shape".'),D="Shape");const se=s.Konva[D];if(G=new se(_.attrs),$)for(ee=$.length,Q=0;Q<ee;Q++)G.add(E._createNode($[Q]));return G}}Rd.Node=E,E.prototype.nodeType="Node",E.prototype._attrsAffectingSize=[],E.prototype.eventListeners={},E.prototype.on.call(E.prototype,T,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(w),this._clearSelfAndDescendantCache(c)}),E.prototype.on.call(E.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(P)}),E.prototype.on.call(E.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(m)}),E.prototype.on.call(E.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(a)});const O=t.Factory.addGetterSetter;return O(E,"zIndex"),O(E,"absolutePosition"),O(E,"position"),O(E,"x",0,(0,o.getNumberValidator)()),O(E,"y",0,(0,o.getNumberValidator)()),O(E,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),O(E,"opacity",1,(0,o.getNumberValidator)()),O(E,"name","",(0,o.getStringValidator)()),O(E,"id","",(0,o.getStringValidator)()),O(E,"rotation",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(E,"scale",["x","y"]),O(E,"scaleX",1,(0,o.getNumberValidator)()),O(E,"scaleY",1,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(E,"skew",["x","y"]),O(E,"skewX",0,(0,o.getNumberValidator)()),O(E,"skewY",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(E,"offset",["x","y"]),O(E,"offsetX",0,(0,o.getNumberValidator)()),O(E,"offsetY",0,(0,o.getNumberValidator)()),O(E,"dragDistance",null,(0,o.getNumberValidator)()),O(E,"width",0,(0,o.getNumberValidator)()),O(E,"height",0,(0,o.getNumberValidator)()),O(E,"listening",!0,(0,o.getBooleanValidator)()),O(E,"preventDefault",!0,(0,o.getBooleanValidator)()),O(E,"filters",null,function(F){return this._filterUpToDate=!1,F}),O(E,"visible",!0,(0,o.getBooleanValidator)()),O(E,"transformsEnabled","all",(0,o.getStringValidator)()),O(E,"size"),O(E,"dragBoundFunc"),O(E,"draggable",!1,(0,o.getBooleanValidator)()),t.Factory.backCompat(E,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Rd}var Od={},u5;function _y(){if(u5)return Od;u5=1,Object.defineProperty(Od,"__esModule",{value:!0}),Od.Container=void 0;const e=St(),t=Mn(),n=wt();let s=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(o){if(!o)return this.children||[];const a=this.children||[];var l=[];return a.forEach(function(c){o(c)&&l.push(c)}),l}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.destroy()}),this.children=[],this._requestDraw(),this}add(...o){if(o.length===0)return this;if(o.length>1){for(var a=0;a<o.length;a++)this.add(o[a]);return this}const l=o[0];return l.getParent()?(l.moveTo(this),this):(this._validateAdd(l),l.index=this.getChildren().length,l.parent=this,l._clearCaches(),this.getChildren().push(l),this._fire("add",{child:l}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(o){return this._generalFind(o,!1)}findOne(o){var a=this._generalFind(o,!0);return a.length>0?a[0]:void 0}_generalFind(o,a){var l=[];return this._descendants(c=>{const d=c._isMatch(o);return d&&l.push(c),!!(d&&a)}),l}_descendants(o){let a=!1;const l=this.getChildren();for(const c of l){if(a=o(c),a)return!0;if(c.hasChildren()&&(a=c._descendants(o),a))return!0}return!1}toObject(){var o=t.Node.prototype.toObject.call(this);return o.children=[],this.getChildren().forEach(a=>{o.children.push(a.toObject())}),o}isAncestorOf(o){for(var a=o.getParent();a;){if(a._id===this._id)return!0;a=a.getParent()}return!1}clone(o){var a=t.Node.prototype.clone.call(this,o);return this.getChildren().forEach(function(l){a.add(l.clone())}),a}getAllIntersections(o){var a=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(o)&&a.push(l)}),a}_clearSelfAndDescendantCache(o){var a;super._clearSelfAndDescendantCache(o),!this.isCached()&&((a=this.children)===null||a===void 0||a.forEach(function(l){l._clearSelfAndDescendantCache(o)}))}_setChildrenIndices(){var o;(o=this.children)===null||o===void 0||o.forEach(function(a,l){a.index=l}),this._requestDraw()}drawScene(o,a,l){var c=this.getLayer(),d=o||c&&c.getCanvas(),h=d&&d.getContext(),f=this._getCanvasCache(),p=f&&f.scene,g=d&&d.isCache;if(!this.isVisible()&&!g)return this;if(p){h.save();var m=this.getAbsoluteTransform(a).getMatrix();h.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedSceneCanvas(h),h.restore()}else this._drawChildren("drawScene",d,a,l);return this}drawHit(o,a){if(!this.shouldDrawHit(a))return this;var l=this.getLayer(),c=o||l&&l.hitCanvas,d=c&&c.getContext(),h=this._getCanvasCache(),f=h&&h.hit;if(f){d.save();var p=this.getAbsoluteTransform(a).getMatrix();d.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,a);return this}_drawChildren(o,a,l,c){var d,h=a&&a.getContext(),f=this.clipWidth(),p=this.clipHeight(),g=this.clipFunc(),m=typeof f=="number"&&typeof p=="number"||g;const y=l===this;if(m){h.save();var b=this.getAbsoluteTransform(l),C=b.getMatrix();h.transform(C[0],C[1],C[2],C[3],C[4],C[5]),h.beginPath();let w;if(g)w=g.call(this,h,this);else{var v=this.clipX(),x=this.clipY();h.rect(v||0,x||0,f,p)}h.clip.apply(h,w),C=b.copy().invert().getMatrix(),h.transform(C[0],C[1],C[2],C[3],C[4],C[5])}var S=!y&&this.globalCompositeOperation()!=="source-over"&&o==="drawScene";S&&(h.save(),h._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(w){w[o](a,l,c)}),S&&h.restore(),m&&h.restore()}getClientRect(o={}){var a,l=o.skipTransform,c=o.relativeTo,d,h,f,p,g={x:1/0,y:1/0,width:0,height:0},m=this;(a=this.children)===null||a===void 0||a.forEach(function(x){if(x.visible()){var S=x.getClientRect({relativeTo:m,skipShadow:o.skipShadow,skipStroke:o.skipStroke});S.width===0&&S.height===0||(d===void 0?(d=S.x,h=S.y,f=S.x+S.width,p=S.y+S.height):(d=Math.min(d,S.x),h=Math.min(h,S.y),f=Math.max(f,S.x+S.width),p=Math.max(p,S.y+S.height)))}});for(var y=this.find("Shape"),b=!1,C=0;C<y.length;C++){var v=y[C];if(v._isVisible(this)){b=!0;break}}return b&&d!==void 0?g={x:d,y:h,width:f-d,height:p-h}:g={x:0,y:0,width:0,height:0},l?g:this._transformedRect(g,c)}};return Od.Container=s,e.Factory.addComponentsGetterSetter(s,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(s,"clipX",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipY",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipWidth",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipHeight",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipFunc"),Od}var hb={},or={},d5;function xL(){if(d5)return or;d5=1,Object.defineProperty(or,"__esModule",{value:!0}),or.releaseCapture=or.setPointerCapture=or.hasPointerCapture=or.createEvent=or.getCapturedShape=void 0;const e=Ct(),t=new Map,n=e.Konva._global.PointerEvent!==void 0;function s(c){return t.get(c)}or.getCapturedShape=s;function i(c){return{evt:c,pointerId:c.pointerId}}or.createEvent=i;function o(c,d){return t.get(c)===d}or.hasPointerCapture=o;function a(c,d){l(c),d.getStage()&&(t.set(c,d),n&&d._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}or.setPointerCapture=a;function l(c,d){const h=t.get(c);if(!h)return;const f=h.getStage();f&&f.content,t.delete(c),n&&h._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return or.releaseCapture=l,or}var h5;function noe(){return h5||(h5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=In(),n=St(),s=_y(),i=Ct(),o=ky(),a=jw(),l=Ct(),c=xL();var d="Stage",h="string",f="px",p="mouseout",g="mouseleave",m="mouseover",y="mouseenter",b="mousemove",C="mousedown",v="mouseup",x="pointermove",S="pointerdown",w="pointerup",j="pointercancel",P="lostpointercapture",T="pointerout",L="pointerleave",E="pointerover",O="pointerenter",F="contextmenu",_="touchstart",R="touchend",D="touchmove",$="touchcancel",G="wheel",ee=5,Q=[[y,"_pointerenter"],[C,"_pointerdown"],[b,"_pointermove"],[v,"_pointerup"],[g,"_pointerleave"],[_,"_pointerdown"],[D,"_pointermove"],[R,"_pointerup"],[$,"_pointercancel"],[m,"_pointerover"],[G,"_wheel"],[F,"_contextmenu"],[S,"_pointerdown"],[x,"_pointermove"],[w,"_pointerup"],[j,"_pointercancel"],[P,"_lostpointercapture"]];const se={mouse:{[T]:p,[L]:g,[E]:m,[O]:y,[x]:b,[S]:C,[w]:v,[j]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[T]:"touchout",[L]:"touchleave",[E]:"touchover",[O]:"touchenter",[x]:D,[S]:_,[w]:R,[j]:$,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[T]:T,[L]:L,[E]:E,[O]:O,[x]:x,[S]:S,[w]:w,[j]:j,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},ne=J=>J.indexOf("pointer")>=0?"pointer":J.indexOf("touch")>=0?"touch":"mouse",H=J=>{const N=ne(J);if(N==="pointer")return i.Konva.pointerEventsEnabled&&se.pointer;if(N==="touch")return se.touch;if(N==="mouse")return se.mouse};function V(J={}){return(J.clipFunc||J.clipWidth||J.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),J}const Y="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class W extends s.Container{constructor(N){super(V(N)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{V(this.attrs)}),this._checkVisibility()}_validateAdd(N){const B=N.getType()==="Layer",U=N.getType()==="FastLayer";B||U||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const N=this.visible()?"":"none";this.content.style.display=N}setContainer(N){if(typeof N===h){if(N.charAt(0)==="."){var B=N.slice(1);N=document.getElementsByClassName(B)[0]}else{var U;N.charAt(0)!=="#"?U=N:U=N.slice(1),N=document.getElementById(U)}if(!N)throw"Can not find container in document with id "+U}return this._setAttr("container",N),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),N.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var N=this.children,B=N.length,U;for(U=0;U<B;U++)N[U].clear();return this}clone(N){return N||(N={}),N.container=typeof document<"u"&&document.createElement("div"),s.Container.prototype.clone.call(this,N)}destroy(){super.destroy();var N=this.content;N&&t.Util._isInDocument(N)&&this.container().removeChild(N);var B=e.stages.indexOf(this);return B>-1&&e.stages.splice(B,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const N=this._pointerPositions[0]||this._changedPointerPositions[0];return N?{x:N.x,y:N.y}:(t.Util.warn(Y),null)}_getPointerById(N){return this._pointerPositions.find(B=>B.id===N)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(N){N=N||{},N.x=N.x||0,N.y=N.y||0,N.width=N.width||this.width(),N.height=N.height||this.height();var B=new o.SceneCanvas({width:N.width,height:N.height,pixelRatio:N.pixelRatio||1}),U=B.getContext()._context,ie=this.children;return(N.x||N.y)&&U.translate(-1*N.x,-1*N.y),ie.forEach(function(de){if(de.isVisible()){var be=de._toKonvaCanvas(N);U.drawImage(be._canvas,N.x,N.y,be.getWidth()/be.getPixelRatio(),be.getHeight()/be.getPixelRatio())}}),B}getIntersection(N){if(!N)return null;var B=this.children,U=B.length,ie=U-1,de;for(de=ie;de>=0;de--){const be=B[de].getIntersection(N);if(be)return be}return null}_resizeDOM(){var N=this.width(),B=this.height();this.content&&(this.content.style.width=N+f,this.content.style.height=B+f),this.bufferCanvas.setSize(N,B),this.bufferHitCanvas.setSize(N,B),this.children.forEach(U=>{U.setSize({width:N,height:B}),U.draw()})}add(N,...B){if(arguments.length>1){for(var U=0;U<arguments.length;U++)this.add(arguments[U]);return this}super.add(N);var ie=this.children.length;return ie>ee&&t.Util.warn("The stage has "+ie+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),N.setSize({width:this.width(),height:this.height()}),N.draw(),i.Konva.isBrowser&&this.content.appendChild(N.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(N){return c.hasPointerCapture(N,this)}setPointerCapture(N){c.setPointerCapture(N,this)}releaseCapture(N){c.releaseCapture(N,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&Q.forEach(([N,B])=>{this.content.addEventListener(N,U=>{this[B](U)},{passive:!1})})}_pointerenter(N){this.setPointersPositions(N);const B=H(N.type);B&&this._fire(B.pointerenter,{evt:N,target:this,currentTarget:this})}_pointerover(N){this.setPointersPositions(N);const B=H(N.type);B&&this._fire(B.pointerover,{evt:N,target:this,currentTarget:this})}_getTargetShape(N){let B=this[N+"targetShape"];return B&&!B.getStage()&&(B=null),B}_pointerleave(N){const B=H(N.type),U=ne(N.type);if(B){this.setPointersPositions(N);var ie=this._getTargetShape(U),de=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ie&&de?(ie._fireAndBubble(B.pointerout,{evt:N}),ie._fireAndBubble(B.pointerleave,{evt:N}),this._fire(B.pointerleave,{evt:N,target:this,currentTarget:this}),this[U+"targetShape"]=null):de&&(this._fire(B.pointerleave,{evt:N,target:this,currentTarget:this}),this._fire(B.pointerout,{evt:N,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(N){const B=H(N.type),U=ne(N.type);if(B){this.setPointersPositions(N);var ie=!1;this._changedPointerPositions.forEach(de=>{var be=this.getIntersection(de);if(a.DD.justDragged=!1,i.Konva["_"+U+"ListenClick"]=!0,!be||!be.isListening()){this[U+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&be.setPointerCapture(de.id),this[U+"ClickStartShape"]=be,be._fireAndBubble(B.pointerdown,{evt:N,pointerId:de.id}),ie=!0;const Ee=N.type.indexOf("touch")>=0;be.preventDefault()&&N.cancelable&&Ee&&N.preventDefault()}),ie||this._fire(B.pointerdown,{evt:N,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(N){const B=H(N.type),U=ne(N.type);if(!B)return;i.Konva.isDragging()&&a.DD.node.preventDefault()&&N.cancelable&&N.preventDefault(),this.setPointersPositions(N);var ie=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;if(!ie)return;var de={};let be=!1;var Ee=this._getTargetShape(U);this._changedPointerPositions.forEach(je=>{const Be=c.getCapturedShape(je.id)||this.getIntersection(je),Xe=je.id,Re={evt:N,pointerId:Xe};var K=Ee!==Be;if(K&&Ee&&(Ee._fireAndBubble(B.pointerout,{...Re},Be),Ee._fireAndBubble(B.pointerleave,{...Re},Be)),Be){if(de[Be._id])return;de[Be._id]=!0}Be&&Be.isListening()?(be=!0,K&&(Be._fireAndBubble(B.pointerover,{...Re},Ee),Be._fireAndBubble(B.pointerenter,{...Re},Ee),this[U+"targetShape"]=Be),Be._fireAndBubble(B.pointermove,{...Re})):Ee&&(this._fire(B.pointerover,{evt:N,target:this,currentTarget:this,pointerId:Xe}),this[U+"targetShape"]=null)}),be||this._fire(B.pointermove,{evt:N,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(N){const B=H(N.type),U=ne(N.type);if(!B)return;this.setPointersPositions(N);const ie=this[U+"ClickStartShape"],de=this[U+"ClickEndShape"];var be={};let Ee=!1;this._changedPointerPositions.forEach(je=>{const Be=c.getCapturedShape(je.id)||this.getIntersection(je);if(Be){if(Be.releaseCapture(je.id),be[Be._id])return;be[Be._id]=!0}const Xe=je.id,Re={evt:N,pointerId:Xe};let K=!1;i.Konva["_"+U+"InDblClickWindow"]?(K=!0,clearTimeout(this[U+"DblTimeout"])):a.DD.justDragged||(i.Konva["_"+U+"InDblClickWindow"]=!0,clearTimeout(this[U+"DblTimeout"])),this[U+"DblTimeout"]=setTimeout(function(){i.Konva["_"+U+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Be&&Be.isListening()?(Ee=!0,this[U+"ClickEndShape"]=Be,Be._fireAndBubble(B.pointerup,{...Re}),i.Konva["_"+U+"ListenClick"]&&ie&&ie===Be&&(Be._fireAndBubble(B.pointerclick,{...Re}),K&&de&&de===Be&&Be._fireAndBubble(B.pointerdblclick,{...Re}))):(this[U+"ClickEndShape"]=null,i.Konva["_"+U+"ListenClick"]&&this._fire(B.pointerclick,{evt:N,target:this,currentTarget:this,pointerId:Xe}),K&&this._fire(B.pointerdblclick,{evt:N,target:this,currentTarget:this,pointerId:Xe}))}),Ee||this._fire(B.pointerup,{evt:N,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+U+"ListenClick"]=!1,N.cancelable&&U!=="touch"&&N.preventDefault()}_contextmenu(N){this.setPointersPositions(N);var B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(F,{evt:N}):this._fire(F,{evt:N,target:this,currentTarget:this})}_wheel(N){this.setPointersPositions(N);var B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(G,{evt:N}):this._fire(G,{evt:N,target:this,currentTarget:this})}_pointercancel(N){this.setPointersPositions(N);const B=c.getCapturedShape(N.pointerId)||this.getIntersection(this.getPointerPosition());B&&B._fireAndBubble(w,c.createEvent(N)),c.releaseCapture(N.pointerId)}_lostpointercapture(N){c.releaseCapture(N.pointerId)}setPointersPositions(N){var B=this._getContentPosition(),U=null,ie=null;N=N||window.event,N.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(N.touches,de=>{this._pointerPositions.push({id:de.identifier,x:(de.clientX-B.left)/B.scaleX,y:(de.clientY-B.top)/B.scaleY})}),Array.prototype.forEach.call(N.changedTouches||N.touches,de=>{this._changedPointerPositions.push({id:de.identifier,x:(de.clientX-B.left)/B.scaleX,y:(de.clientY-B.top)/B.scaleY})})):(U=(N.clientX-B.left)/B.scaleX,ie=(N.clientY-B.top)/B.scaleY,this.pointerPos={x:U,y:ie},this._pointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId(N)}],this._changedPointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId(N)}])}_setPointerPosition(N){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(N)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var N=this.content.getBoundingClientRect();return{top:N.top,left:N.left,scaleX:N.width/this.content.clientWidth||1,scaleY:N.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!i.Konva.isBrowser){var N=this.container();if(!N)throw"Stage has no container. A container is required.";N.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),N.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(N){N.batchDraw()}),this}}e.Stage=W,W.prototype.nodeType=d,(0,l._registerNode)(W),n.Factory.addGetterSetter(W,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(J=>{J.batchDraw()})})}(hb)),hb}var Nd={},fb={},f5;function Jn(){return f5||(f5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=Ct(),n=In(),s=St(),i=Mn(),o=wt(),a=Ct(),l=xL();var c="hasShadow",d="shadowRGBA",h="patternImage",f="linearGradient",p="radialGradient";let g;function m(){return g||(g=n.Util.createCanvasElement().getContext("2d"),g)}e.shapes={};function y(L){const E=this.attrs.fillRule;E?L.fill(E):L.fill()}function b(L){L.stroke()}function C(L){const E=this.attrs.fillRule;E?L.fill(E):L.fill()}function v(L){L.stroke()}function x(){this._clearCache(c)}function S(){this._clearCache(d)}function w(){this._clearCache(h)}function j(){this._clearCache(f)}function P(){this._clearCache(p)}class T extends i.Node{constructor(E){super(E);let O;for(;O=n.Util.getRandomColor(),!(O&&!(O in e.shapes)););this.colorKey=O,e.shapes[O]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var E=m();const O=E.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(O&&O.setTransform){const F=new n.Transform;F.translate(this.fillPatternX(),this.fillPatternY()),F.rotate(t.Konva.getAngle(this.fillPatternRotation())),F.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),F.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const _=F.getMatrix(),R=typeof DOMMatrix>"u"?{a:_[0],b:_[1],c:_[2],d:_[3],e:_[4],f:_[5]}:new DOMMatrix(_);O.setTransform(R)}return O}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){var E=this.fillLinearGradientColorStops();if(E){for(var O=m(),F=this.fillLinearGradientStartPoint(),_=this.fillLinearGradientEndPoint(),R=O.createLinearGradient(F.x,F.y,_.x,_.y),D=0;D<E.length;D+=2)R.addColorStop(E[D],E[D+1]);return R}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){var E=this.fillRadialGradientColorStops();if(E){for(var O=m(),F=this.fillRadialGradientStartPoint(),_=this.fillRadialGradientEndPoint(),R=O.createRadialGradient(F.x,F.y,this.fillRadialGradientStartRadius(),_.x,_.y,this.fillRadialGradientEndRadius()),D=0;D<E.length;D+=2)R.addColorStop(E[D],E[D+1]);return R}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var E=n.Util.colorToRGBA(this.shadowColor());if(E)return"rgba("+E.r+","+E.g+","+E.b+","+E.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const E=this.hitStrokeWidth();return E==="auto"?this.hasStroke():this.strokeEnabled()&&!!E}intersects(E){var O=this.getStage();if(!O)return!1;const F=O.bufferHitCanvas;return F.getContext().clear(),this.drawHit(F,void 0,!0),F.context.getImageData(Math.round(E.x),Math.round(E.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(E){var O;if(!((O=this.attrs.perfectDrawEnabled)!==null&&O!==void 0?O:!0))return!1;const _=E||this.hasFill(),R=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(_&&R&&D)return!0;const $=this.hasShadow(),G=this.shadowForStrokeEnabled();return!!(_&&R&&$&&G)}setStrokeHitEnabled(E){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),E?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var E=this.size();return{x:this._centroid?-E.width/2:0,y:this._centroid?-E.height/2:0,width:E.width,height:E.height}}getClientRect(E={}){let O=!1,F=this.getParent();for(;F;){if(F.isCached()){O=!0;break}F=F.getParent()}const _=E.skipTransform,R=E.relativeTo||O&&this.getStage()||void 0,D=this.getSelfRect(),G=!E.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,ee=D.width+G,Q=D.height+G,se=!E.skipShadow&&this.hasShadow(),ne=se?this.shadowOffsetX():0,H=se?this.shadowOffsetY():0,V=ee+Math.abs(ne),Y=Q+Math.abs(H),W=se&&this.shadowBlur()||0,J=V+W*2,N=Y+W*2,B={width:J,height:N,x:-(G/2+W)+Math.min(ne,0)+D.x,y:-(G/2+W)+Math.min(H,0)+D.y};return _?B:this._transformedRect(B,R)}drawScene(E,O,F){var _=this.getLayer(),R=E||_.getCanvas(),D=R.getContext(),$=this._getCanvasCache(),G=this.getSceneFunc(),ee=this.hasShadow(),Q,se,ne=R.isCache,H=O===this;if(!this.isVisible()&&!H)return this;if($){D.save();var V=this.getAbsoluteTransform(O).getMatrix();return D.transform(V[0],V[1],V[2],V[3],V[4],V[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!G)return this;if(D.save(),this._useBufferCanvas()&&!ne){Q=this.getStage();const J=F||Q.bufferCanvas;se=J.getContext(),se.clear(),se.save(),se._applyLineJoin(this);var Y=this.getAbsoluteTransform(O).getMatrix();se.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),G.call(this,se,this),se.restore();var W=J.pixelRatio;ee&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(J._canvas,0,0,J.width/W,J.height/W)}else{if(D._applyLineJoin(this),!H){var Y=this.getAbsoluteTransform(O).getMatrix();D.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}ee&&D._applyShadow(this),G.call(this,D,this)}return D.restore(),this}drawHit(E,O,F=!1){if(!this.shouldDrawHit(O,F))return this;var _=this.getLayer(),R=E||_.hitCanvas,D=R&&R.getContext(),$=this.hitFunc()||this.sceneFunc(),G=this._getCanvasCache(),ee=G&&G.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),ee){D.save();var Q=this.getAbsoluteTransform(O).getMatrix();return D.transform(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!$)return this;if(D.save(),D._applyLineJoin(this),!(this===O)){var ne=this.getAbsoluteTransform(O).getMatrix();D.transform(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5])}return $.call(this,D,this),D.restore(),this}drawHitFromCache(E=0){var O=this._getCanvasCache(),F=this._getCachedSceneCanvas(),_=O.hit,R=_.getContext(),D=_.getWidth(),$=_.getHeight(),G,ee,Q,se,ne,H;R.clear(),R.drawImage(F._canvas,0,0,D,$);try{for(G=R.getImageData(0,0,D,$),ee=G.data,Q=ee.length,se=n.Util._hexToRgb(this.colorKey),ne=0;ne<Q;ne+=4)H=ee[ne+3],H>E?(ee[ne]=se.r,ee[ne+1]=se.g,ee[ne+2]=se.b,ee[ne+3]=255):ee[ne+3]=0;R.putImageData(G,0,0)}catch(V){n.Util.error("Unable to draw hit graph from cached scene canvas. "+V.message)}return this}hasPointerCapture(E){return l.hasPointerCapture(E,this)}setPointerCapture(E){l.setPointerCapture(E,this)}releaseCapture(E){l.releaseCapture(E,this)}}e.Shape=T,T.prototype._fillFunc=y,T.prototype._strokeFunc=b,T.prototype._fillFuncHit=C,T.prototype._strokeFuncHit=v,T.prototype._centroid=!1,T.prototype.nodeType="Shape",(0,a._registerNode)(T),T.prototype.eventListeners={},T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",x),T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",S),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",w),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",j),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",P),s.Factory.addGetterSetter(T,"stroke",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(T,"strokeWidth",2,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillAfterStrokeEnabled",!1),s.Factory.addGetterSetter(T,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(T,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(T,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(T,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(T,"lineJoin"),s.Factory.addGetterSetter(T,"lineCap"),s.Factory.addGetterSetter(T,"sceneFunc"),s.Factory.addGetterSetter(T,"hitFunc"),s.Factory.addGetterSetter(T,"dash"),s.Factory.addGetterSetter(T,"dashOffset",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"shadowColor",void 0,(0,o.getStringValidator)()),s.Factory.addGetterSetter(T,"shadowBlur",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"shadowOpacity",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(T,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(T,"shadowOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"shadowOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillPatternImage"),s.Factory.addGetterSetter(T,"fill",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(T,"fillPatternX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillPatternY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(T,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(T,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(T,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(T,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(T,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(T,"fillEnabled",!0),s.Factory.addGetterSetter(T,"strokeEnabled",!0),s.Factory.addGetterSetter(T,"shadowEnabled",!0),s.Factory.addGetterSetter(T,"dashEnabled",!0),s.Factory.addGetterSetter(T,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(T,"fillPriority","color"),s.Factory.addComponentsGetterSetter(T,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(T,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(T,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(T,"fillPatternScaleX",1,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(T,"fillPatternScaleY",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(T,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(T,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(T,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(T,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(T,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(T,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(T,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(T,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(T,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(T,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(T,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(T,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(T,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(T,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(T,"fillPatternRotation",0),s.Factory.addGetterSetter(T,"fillRule",void 0,(0,o.getStringValidator)()),s.Factory.backCompat(T,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(fb)),fb}var p5;function CL(){if(p5)return Nd;p5=1,Object.defineProperty(Nd,"__esModule",{value:!0}),Nd.Layer=void 0;const e=In(),t=_y(),n=Mn(),s=St(),i=ky(),o=wt(),a=Jn(),l=Ct();var c="#",d="beforeDraw",h="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;let g=class extends t.Container{constructor(y){super(y),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(y){return this.getContext().clear(y),this.getHitCanvas().getContext().clear(y),this}setZIndex(y){super.setZIndex(y);var b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),y<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[y+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);var y=this.getStage();return y&&y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var y=n.Node.prototype.moveUp.call(this);if(!y)return!1;var b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){var y=this.getStage();if(y){var b=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){var y=this.getStage();if(y){var b=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var y=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),y&&y.parentNode&&e.Util._isInDocument(y)&&y.parentNode.removeChild(y),this}getStage(){return this.parent}setSize({width:y,height:b}){return this.canvas.setSize(y,b),this.hitCanvas.setSize(y,b),this._setSmoothEnabled(),this}_validateAdd(y){var b=y.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(y){return y=y||{},y.width=y.width||this.getWidth(),y.height=y.height||this.getHeight(),y.x=y.x!==void 0?y.x:this.x(),y.y=y.y!==void 0?y.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,y)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(y){if(!this.isListening()||!this.isVisible())return null;for(var b=1,C=!1;;){for(let v=0;v<p;v++){const x=f[v],S=this._getIntersection({x:y.x+x.x*b,y:y.y+x.y*b}),w=S.shape;if(w)return w;if(C=!!S.antialiased,!S.antialiased)break}if(C)b+=1;else return null}}_getIntersection(y){const b=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(y.x*b),Math.round(y.y*b),1,1).data,v=C[3];if(v===255){const x=e.Util._rgbToHex(C[0],C[1],C[2]),S=a.shapes[c+x];return S?{shape:S}:{antialiased:!0}}else if(v>0)return{antialiased:!0};return{}}drawScene(y,b){var C=this.getLayer(),v=y||C&&C.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&v.getContext().clear(),t.Container.prototype.drawScene.call(this,v,b),this._fire(h,{node:this}),this}drawHit(y,b){var C=this.getLayer(),v=y||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,v,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(y){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(y)}getHitGraphEnabled(y){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var y=this.parent,b=!!this.hitCanvas._canvas.parentNode;b?y.content.removeChild(this.hitCanvas._canvas):y.content.appendChild(this.hitCanvas._canvas)}}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return Nd.Layer=g,g.prototype.nodeType="Layer",(0,l._registerNode)(g),s.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),s.Factory.addGetterSetter(g,"clearBeforeDraw",!0),s.Factory.addGetterSetter(g,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),Nd}var Fd={},g5;function soe(){if(g5)return Fd;g5=1,Object.defineProperty(Fd,"__esModule",{value:!0}),Fd.FastLayer=void 0;const e=In(),t=CL(),n=Ct();let s=class extends t.Layer{constructor(o){super(o),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return Fd.FastLayer=s,s.prototype.nodeType="FastLayer",(0,n._registerNode)(s),Fd}var Bd={},m5;function kw(){if(m5)return Bd;m5=1,Object.defineProperty(Bd,"__esModule",{value:!0}),Bd.Group=void 0;const e=In(),t=_y(),n=Ct();let s=class extends t.Container{_validateAdd(o){var a=o.getType();a!=="Group"&&a!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}};return Bd.Group=s,s.prototype.nodeType="Group",(0,n._registerNode)(s),Bd}var $d={},y5;function _w(){if(y5)return $d;y5=1,Object.defineProperty($d,"__esModule",{value:!0}),$d.Animation=void 0;const e=Ct(),t=In(),n=function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}}();let s=class Rc{constructor(o,a){this.id=Rc.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=o,this.setLayers(a)}setLayers(o){let a=[];return o&&(a=Array.isArray(o)?o:[o]),this.layers=a,this}getLayers(){return this.layers}addLayer(o){const a=this.layers,l=a.length;for(let c=0;c<l;c++)if(a[c]._id===o._id)return!1;return this.layers.push(o),!0}isRunning(){const a=Rc.animations,l=a.length;for(let c=0;c<l;c++)if(a[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),Rc._addAnimation(this),this}stop(){return Rc._removeAnimation(this),this}_updateFrameObject(o){this.frame.timeDiff=o-this.frame.lastTime,this.frame.lastTime=o,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(o){this.animations.push(o),this._handleAnimation()}static _removeAnimation(o){const a=o.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===a){this.animations.splice(d,1);break}}static _runFrames(){const o={},a=this.animations;for(let l=0;l<a.length;l++){const c=a[l],d=c.layers,h=c.func;c._updateFrameObject(n());const f=d.length;let p;if(h?p=h.call(c,c.frame)!==!1:p=!0,!!p)for(let g=0;g<f;g++){const m=d[g];m._id!==void 0&&(o[m._id]=m)}}for(let l in o)o.hasOwnProperty(l)&&o[l].batchDraw()}static _animationLoop(){const o=Rc;o.animations.length?(o._runFrames(),t.Util.requestAnimFrame(o._animationLoop)):o.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return $d.Animation=s,s.animations=[],s.animIdCounter=0,s.animRunning=!1,$d}var pb={},v5;function roe(){return v5||(v5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=In(),n=_w(),s=Mn(),i=Ct();var o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,l=2,c=3,d=0,h=["fill","stroke","shadowColor"];class f{constructor(m,y,b,C,v,x,S){this.prop=m,this.propFunc=y,this.begin=C,this._pos=C,this.duration=x,this._change=0,this.prevPos=0,this.yoyo=S,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=v-this.begin,this.pause()}fire(m){var y=this[m];y&&y()}setTime(m){m>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():m<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=m,this.update())}getTime(){return this._time}setPosition(m){this.prevPos=this._pos,this.propFunc(m),this._pos=m}getPosition(m){return m===void 0&&(m=this._time),this.func(m,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(m){this.pause(),this._time=m,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var m=this.getTimer()-this._startTime;this.state===l?this.setTime(m):this.state===c&&this.setTime(this.duration-m)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(m){var y=this,b=m.node,C=b._id,v,x=m.easing||e.Easings.Linear,S=!!m.yoyo,w;typeof m.duration>"u"?v=.3:m.duration===0?v=.001:v=m.duration,this.node=b,this._id=d++;var j=b.getLayer()||(b instanceof i.Konva.Stage?b.getLayers():null);j||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){y.tween.onEnterFrame()},j),this.tween=new f(w,function(P){y._tweenFunc(P)},x,0,1,v*1e3,S),this._addListeners(),p.attrs[C]||(p.attrs[C]={}),p.attrs[C][this._id]||(p.attrs[C][this._id]={}),p.tweens[C]||(p.tweens[C]={});for(w in m)o[w]===void 0&&this._addAttr(w,m[w]);this.reset(),this.onFinish=m.onFinish,this.onReset=m.onReset,this.onUpdate=m.onUpdate}_addAttr(m,y){var b=this.node,C=b._id,v,x,S,w,j,P,T,L;if(S=p.tweens[C][m],S&&delete p.attrs[C][S][m],v=b.getAttr(m),t.Util._isArray(y))if(x=[],j=Math.max(y.length,v.length),m==="points"&&y.length!==v.length&&(y.length>v.length?(T=v,v=t.Util._prepareArrayForTween(v,y,b.closed())):(P=y,y=t.Util._prepareArrayForTween(y,v,b.closed()))),m.indexOf("fill")===0)for(w=0;w<j;w++)if(w%2===0)x.push(y[w]-v[w]);else{var E=t.Util.colorToRGBA(v[w]);L=t.Util.colorToRGBA(y[w]),v[w]=E,x.push({r:L.r-E.r,g:L.g-E.g,b:L.b-E.b,a:L.a-E.a})}else for(w=0;w<j;w++)x.push(y[w]-v[w]);else h.indexOf(m)!==-1?(v=t.Util.colorToRGBA(v),L=t.Util.colorToRGBA(y),x={r:L.r-v.r,g:L.g-v.g,b:L.b-v.b,a:L.a-v.a}):x=y-v;p.attrs[C][this._id][m]={start:v,diff:x,end:y,trueEnd:P,trueStart:T},p.tweens[C][m]=this._id}_tweenFunc(m){var y=this.node,b=p.attrs[y._id][this._id],C,v,x,S,w,j,P,T;for(C in b){if(v=b[C],x=v.start,S=v.diff,T=v.end,t.Util._isArray(x))if(w=[],P=Math.max(x.length,T.length),C.indexOf("fill")===0)for(j=0;j<P;j++)j%2===0?w.push((x[j]||0)+S[j]*m):w.push("rgba("+Math.round(x[j].r+S[j].r*m)+","+Math.round(x[j].g+S[j].g*m)+","+Math.round(x[j].b+S[j].b*m)+","+(x[j].a+S[j].a*m)+")");else for(j=0;j<P;j++)w.push((x[j]||0)+S[j]*m);else h.indexOf(C)!==-1?w="rgba("+Math.round(x.r+S.r*m)+","+Math.round(x.g+S.g*m)+","+Math.round(x.b+S.b*m)+","+(x.a+S.a*m)+")":w=x+S*m;y.setAttr(C,w)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueEnd&&m.setAttr("points",y.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueStart&&m.points(y.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(m){return this.tween.seek(m*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var m=this.node._id,y=this._id,b=p.tweens[m],C;this.pause();for(C in b)delete p.tweens[m][C];delete p.attrs[m][y]}}e.Tween=p,p.attrs={},p.tweens={},s.Node.prototype.to=function(g){var m=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),m&&m()};var y=new p(g);y.play()},e.Easings={BackEaseIn(g,m,y,b){var C=1.70158;return y*(g/=b)*g*((C+1)*g-C)+m},BackEaseOut(g,m,y,b){var C=1.70158;return y*((g=g/b-1)*g*((C+1)*g+C)+1)+m},BackEaseInOut(g,m,y,b){var C=1.70158;return(g/=b/2)<1?y/2*(g*g*(((C*=1.525)+1)*g-C))+m:y/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+m},ElasticEaseIn(g,m,y,b,C,v){var x=0;return g===0?m:(g/=b)===1?m+y:(v||(v=b*.3),!C||C<Math.abs(y)?(C=y,x=v/4):x=v/(2*Math.PI)*Math.asin(y/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*b-x)*(2*Math.PI)/v))+m)},ElasticEaseOut(g,m,y,b,C,v){var x=0;return g===0?m:(g/=b)===1?m+y:(v||(v=b*.3),!C||C<Math.abs(y)?(C=y,x=v/4):x=v/(2*Math.PI)*Math.asin(y/C),C*Math.pow(2,-10*g)*Math.sin((g*b-x)*(2*Math.PI)/v)+y+m)},ElasticEaseInOut(g,m,y,b,C,v){var x=0;return g===0?m:(g/=b/2)===2?m+y:(v||(v=b*(.3*1.5)),!C||C<Math.abs(y)?(C=y,x=v/4):x=v/(2*Math.PI)*Math.asin(y/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*b-x)*(2*Math.PI)/v))+m:C*Math.pow(2,-10*(g-=1))*Math.sin((g*b-x)*(2*Math.PI)/v)*.5+y+m)},BounceEaseOut(g,m,y,b){return(g/=b)<1/2.75?y*(7.5625*g*g)+m:g<2/2.75?y*(7.5625*(g-=1.5/2.75)*g+.75)+m:g<2.5/2.75?y*(7.5625*(g-=2.25/2.75)*g+.9375)+m:y*(7.5625*(g-=2.625/2.75)*g+.984375)+m},BounceEaseIn(g,m,y,b){return y-e.Easings.BounceEaseOut(b-g,0,y,b)+m},BounceEaseInOut(g,m,y,b){return g<b/2?e.Easings.BounceEaseIn(g*2,0,y,b)*.5+m:e.Easings.BounceEaseOut(g*2-b,0,y,b)*.5+y*.5+m},EaseIn(g,m,y,b){return y*(g/=b)*g+m},EaseOut(g,m,y,b){return-y*(g/=b)*(g-2)+m},EaseInOut(g,m,y,b){return(g/=b/2)<1?y/2*g*g+m:-y/2*(--g*(g-2)-1)+m},StrongEaseIn(g,m,y,b){return y*(g/=b)*g*g*g*g+m},StrongEaseOut(g,m,y,b){return y*((g=g/b-1)*g*g*g*g+1)+m},StrongEaseInOut(g,m,y,b){return(g/=b/2)<1?y/2*g*g*g*g*g+m:y/2*((g-=2)*g*g*g*g+2)+m},Linear(g,m,y,b){return y*g/b+m}}}(pb)),pb}var b5;function ioe(){return b5||(b5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=Ct(),n=In(),s=Mn(),i=_y(),o=noe(),a=CL(),l=soe(),c=kw(),d=jw(),h=Jn(),f=_w(),p=roe(),g=bL(),m=ky();e.Konva=n.Util._assign(t.Konva,{Util:n.Util,Transform:n.Transform,Node:s.Node,Container:i.Container,Stage:o.Stage,stages:o.stages,Layer:a.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:h.Shape,shapes:h.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:g.Context,Canvas:m.Canvas}),e.default=e.Konva}(ab)),ab}var Vd={},x5;function ooe(){if(x5)return Vd;x5=1,Object.defineProperty(Vd,"__esModule",{value:!0}),Vd.Arc=void 0;const e=St(),t=Jn(),n=Ct(),s=wt(),i=Ct();let o=class extends t.Shape{_sceneFunc(l){var c=n.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),h=n.Konva.getAngle(d?360-this.angle():this.angle()),f=Math.cos(Math.min(h,Math.PI)),p=1,g=Math.sin(Math.min(Math.max(Math.PI,h),3*Math.PI/2)),m=Math.sin(Math.min(h,Math.PI/2)),y=f*(f>0?l:c),b=p*c,C=g*(g>0?l:c),v=m*(m>0?c:l);return{x:y,y:d?-1*v:C,width:b-y,height:v-C}}};return Vd.Arc=o,o.prototype._centroid=!0,o.prototype.className="Arc",o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1,(0,s.getBooleanValidator)()),Vd}var Gd={},zd={},C5;function SL(){if(C5)return zd;C5=1,Object.defineProperty(zd,"__esModule",{value:!0}),zd.Line=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();function i(l,c,d,h,f,p,g){var m=Math.sqrt(Math.pow(d-l,2)+Math.pow(h-c,2)),y=Math.sqrt(Math.pow(f-d,2)+Math.pow(p-h,2)),b=g*m/(m+y),C=g*y/(m+y),v=d-b*(f-l),x=h-b*(p-c),S=d+C*(f-l),w=h+C*(p-c);return[v,x,S,w]}function o(l,c){var d=l.length,h=[],f,p;for(f=2;f<d-2;f+=2)p=i(l[f-2],l[f-1],l[f],l[f+1],l[f+2],l[f+3],c),!isNaN(p[0])&&(h.push(p[0]),h.push(p[1]),h.push(l[f]),h.push(l[f+1]),h.push(p[2]),h.push(p[3]));return h}let a=class extends t.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){var d=this.points(),h=d.length,f=this.tension(),p=this.closed(),g=this.bezier(),m,y,b;if(h){if(c.beginPath(),c.moveTo(d[0],d[1]),f!==0&&h>4){for(m=this.getTensionPoints(),y=m.length,b=p?0:4,p||c.quadraticCurveTo(m[0],m[1],m[2],m[3]);b<y-2;)c.bezierCurveTo(m[b++],m[b++],m[b++],m[b++],m[b++],m[b++]);p||c.quadraticCurveTo(m[y-2],m[y-1],d[h-2],d[h-1])}else if(g)for(b=2;b<h;)c.bezierCurveTo(d[b++],d[b++],d[b++],d[b++],d[b++],d[b++]);else for(b=2;b<h;b+=2)c.lineTo(d[b],d[b+1]);p?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){var c=this.points(),d=c.length,h=this.tension(),f=i(c[d-2],c[d-1],c[0],c[1],c[2],c[3],h),p=i(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],h),g=o(c,h),m=[f[2],f[3]].concat(g).concat([p[0],p[1],c[d-2],c[d-1],p[2],p[3],f[0],f[1],c[0],c[1]]);return m}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();for(var d=c[0],h=c[0],f=c[1],p=c[1],g,m,y=0;y<c.length/2;y++)g=c[y*2],m=c[y*2+1],d=Math.min(d,g),h=Math.max(h,g),f=Math.min(f,m),p=Math.max(p,m);return{x:d,y:f,width:h-d,height:p-f}}};return zd.Line=a,a.prototype.className="Line",a.prototype._attrsAffectingSize=["points","bezier","tension"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"closed",!1),e.Factory.addGetterSetter(a,"bezier",!1),e.Factory.addGetterSetter(a,"tension",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"points",[],(0,n.getNumberArrayValidator)()),zd}var Hd={},gb={},S5;function aoe(){return S5||(S5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(a,l,c)=>{let d,h,f;d=c/2,h=0;for(let g=0;g<20;g++)f=d*e.tValues[20][g]+d,h+=e.cValues[20][g]*s(a,l,f);return d*h};e.getCubicArcLength=t;const n=(a,l,c)=>{c===void 0&&(c=1);const d=a[0]-2*a[1]+a[2],h=l[0]-2*l[1]+l[2],f=2*a[1]-2*a[0],p=2*l[1]-2*l[0],g=4*(d*d+h*h),m=4*(d*f+h*p),y=f*f+p*p;if(g===0)return c*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(l[2]-l[0],2));const b=m/(2*g),C=y/g,v=c+b,x=C-b*b,S=v*v+x>0?Math.sqrt(v*v+x):0,w=b*b+x>0?Math.sqrt(b*b+x):0,j=b+Math.sqrt(b*b+x)!==0?x*Math.log(Math.abs((v+S)/(b+w))):0;return Math.sqrt(g)/2*(v*S-b*w+j)};e.getQuadraticArcLength=n;function s(a,l,c){const d=i(1,c,a),h=i(1,c,l),f=d*d+h*h;return Math.sqrt(f)}const i=(a,l,c)=>{const d=c.length-1;let h,f;if(d===0)return 0;if(a===0){f=0;for(let p=0;p<=d;p++)f+=e.binomialCoefficients[d][p]*Math.pow(1-l,d-p)*Math.pow(l,p)*c[p];return f}else{h=new Array(d);for(let p=0;p<d;p++)h[p]=d*(c[p+1]-c[p]);return i(a-1,l,h)}},o=(a,l,c)=>{let d=1,h=a/l,f=(a-c(h))/l,p=0;for(;d>.001;){const g=c(h+f),m=Math.abs(a-g)/l;if(m<d)d=m,h+=f;else{const y=c(h-f),b=Math.abs(a-y)/l;b<d?(d=b,h-=f):f/=2}if(p++,p>500)break}return h};e.t2length=o}(gb)),gb}var w5;function Iw(){if(w5)return Hd;w5=1,Object.defineProperty(Hd,"__esModule",{value:!0}),Hd.Path=void 0;const e=St(),t=Jn(),n=Ct(),s=aoe();let i=class Gs extends t.Shape{constructor(a){super(a),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Gs.parsePathData(this.data()),this.pathLength=Gs.getPathLength(this.dataArray)}_sceneFunc(a){var l=this.dataArray;a.beginPath();for(var c=!1,d=0;d<l.length;d++){var h=l[d].command,f=l[d].points;switch(h){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var p=f[0],g=f[1],m=f[2],y=f[3],b=f[4],C=f[5],v=f[6],x=f[7],S=m>y?m:y,w=m>y?1:m/y,j=m>y?y/m:1;a.translate(p,g),a.rotate(v),a.scale(w,j),a.arc(0,0,S,b,b+C,1-x),a.scale(1/w,1/j),a.rotate(-v),a.translate(-p,-g);break;case"z":c=!0,a.closePath();break}}!c&&!this.hasFill()?a.strokeShape(this):a.fillStrokeShape(this)}getSelfRect(){var a=[];this.dataArray.forEach(function(m){if(m.command==="A"){var y=m.points[4],b=m.points[5],C=m.points[4]+b,v=Math.PI/180;if(Math.abs(y-C)<v&&(v=Math.abs(y-C)),b<0)for(let x=y-v;x>C;x-=v){const S=Gs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],x,0);a.push(S.x,S.y)}else for(let x=y+v;x<C;x+=v){const S=Gs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],x,0);a.push(S.x,S.y)}}else if(m.command==="C")for(let x=0;x<=1;x+=.01){const S=Gs.getPointOnCubicBezier(x,m.start.x,m.start.y,m.points[0],m.points[1],m.points[2],m.points[3],m.points[4],m.points[5]);a.push(S.x,S.y)}else a=a.concat(m.points)});for(var l=a[0],c=a[0],d=a[1],h=a[1],f,p,g=0;g<a.length/2;g++)f=a[g*2],p=a[g*2+1],isNaN(f)||(l=Math.min(l,f),c=Math.max(c,f)),isNaN(p)||(d=Math.min(d,p),h=Math.max(h,p));return{x:l,y:d,width:c-l,height:h-d}}getLength(){return this.pathLength}getPointAtLength(a){return Gs.getPointAtLengthOfDataArray(a,this.dataArray)}static getLineLength(a,l,c,d){return Math.sqrt((c-a)*(c-a)+(d-l)*(d-l))}static getPathLength(a){let l=0;for(var c=0;c<a.length;++c)l+=a[c].pathLength;return l}static getPointAtLengthOfDataArray(a,l){var c,d=0,h=l.length;if(!h)return null;for(;d<h&&a>l[d].pathLength;)a-=l[d].pathLength,++d;if(d===h)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(a<.01)return c=l[d].points.slice(0,2),{x:c[0],y:c[1]};var f=l[d],p=f.points;switch(f.command){case"L":return Gs.getPointOnLine(a,f.start.x,f.start.y,p[0],p[1]);case"C":return Gs.getPointOnCubicBezier((0,s.t2length)(a,Gs.getPathLength(l),S=>(0,s.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],S)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return Gs.getPointOnQuadraticBezier((0,s.t2length)(a,Gs.getPathLength(l),S=>(0,s.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],S)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var g=p[0],m=p[1],y=p[2],b=p[3],C=p[4],v=p[5],x=p[6];return C+=v*a/f.pathLength,Gs.getPointOnEllipticalArc(g,m,y,b,C,x)}return null}static getPointOnLine(a,l,c,d,h,f,p){f=f??l,p=p??c;const g=this.getLineLength(l,c,d,h);if(g<1e-10)return{x:l,y:c};if(d===l)return{x:f,y:p+(h>c?a:-a)};const m=(h-c)/(d-l),y=Math.sqrt(a*a/(1+m*m))*(d<l?-1:1),b=m*y;if(Math.abs(p-c-m*(f-l))<1e-10)return{x:f+y,y:p+b};const C=((f-l)*(d-l)+(p-c)*(h-c))/(g*g),v=l+C*(d-l),x=c+C*(h-c),S=this.getLineLength(f,p,v,x),w=Math.sqrt(a*a-S*S),j=Math.sqrt(w*w/(1+m*m))*(d<l?-1:1),P=m*j;return{x:v+j,y:x+P}}static getPointOnCubicBezier(a,l,c,d,h,f,p,g,m){function y(w){return w*w*w}function b(w){return 3*w*w*(1-w)}function C(w){return 3*w*(1-w)*(1-w)}function v(w){return(1-w)*(1-w)*(1-w)}var x=g*y(a)+f*b(a)+d*C(a)+l*v(a),S=m*y(a)+p*b(a)+h*C(a)+c*v(a);return{x,y:S}}static getPointOnQuadraticBezier(a,l,c,d,h,f,p){function g(v){return v*v}function m(v){return 2*v*(1-v)}function y(v){return(1-v)*(1-v)}var b=f*g(a)+d*m(a)+l*y(a),C=p*g(a)+h*m(a)+c*y(a);return{x:b,y:C}}static getPointOnEllipticalArc(a,l,c,d,h,f){var p=Math.cos(f),g=Math.sin(f),m={x:c*Math.cos(h),y:d*Math.sin(h)};return{x:a+(m.x*p-m.y*g),y:l+(m.x*g+m.y*p)}}static parsePathData(a){if(!a)return[];var l=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)l=l.replace(new RegExp(c[d],"g"),"|"+c[d]);var h=l.split("|"),f=[],p=[],g=0,m=0,y=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,b;for(d=1;d<h.length;d++){var C=h[d],v=C.charAt(0);for(C=C.slice(1),p.length=0;b=y.exec(C);)p.push(b[0]);for(var x=[],S=0,w=p.length;S<w;S++){if(p[S]==="00"){x.push(0,0);continue}var j=parseFloat(p[S]);isNaN(j)?x.push(0):x.push(j)}for(;x.length>0&&!isNaN(x[0]);){var P="",T=[],L=g,E=m,O,F,_,R,D,$,G,ee,Q,se;switch(v){case"l":g+=x.shift(),m+=x.shift(),P="L",T.push(g,m);break;case"L":g=x.shift(),m=x.shift(),T.push(g,m);break;case"m":var ne=x.shift(),H=x.shift();if(g+=ne,m+=H,P="M",f.length>2&&f[f.length-1].command==="z"){for(var V=f.length-2;V>=0;V--)if(f[V].command==="M"){g=f[V].points[0]+ne,m=f[V].points[1]+H;break}}T.push(g,m),v="l";break;case"M":g=x.shift(),m=x.shift(),P="M",T.push(g,m),v="L";break;case"h":g+=x.shift(),P="L",T.push(g,m);break;case"H":g=x.shift(),P="L",T.push(g,m);break;case"v":m+=x.shift(),P="L",T.push(g,m);break;case"V":m=x.shift(),P="L",T.push(g,m);break;case"C":T.push(x.shift(),x.shift(),x.shift(),x.shift()),g=x.shift(),m=x.shift(),T.push(g,m);break;case"c":T.push(g+x.shift(),m+x.shift(),g+x.shift(),m+x.shift()),g+=x.shift(),m+=x.shift(),P="C",T.push(g,m);break;case"S":F=g,_=m,O=f[f.length-1],O.command==="C"&&(F=g+(g-O.points[2]),_=m+(m-O.points[3])),T.push(F,_,x.shift(),x.shift()),g=x.shift(),m=x.shift(),P="C",T.push(g,m);break;case"s":F=g,_=m,O=f[f.length-1],O.command==="C"&&(F=g+(g-O.points[2]),_=m+(m-O.points[3])),T.push(F,_,g+x.shift(),m+x.shift()),g+=x.shift(),m+=x.shift(),P="C",T.push(g,m);break;case"Q":T.push(x.shift(),x.shift()),g=x.shift(),m=x.shift(),T.push(g,m);break;case"q":T.push(g+x.shift(),m+x.shift()),g+=x.shift(),m+=x.shift(),P="Q",T.push(g,m);break;case"T":F=g,_=m,O=f[f.length-1],O.command==="Q"&&(F=g+(g-O.points[0]),_=m+(m-O.points[1])),g=x.shift(),m=x.shift(),P="Q",T.push(F,_,g,m);break;case"t":F=g,_=m,O=f[f.length-1],O.command==="Q"&&(F=g+(g-O.points[0]),_=m+(m-O.points[1])),g+=x.shift(),m+=x.shift(),P="Q",T.push(F,_,g,m);break;case"A":R=x.shift(),D=x.shift(),$=x.shift(),G=x.shift(),ee=x.shift(),Q=g,se=m,g=x.shift(),m=x.shift(),P="A",T=this.convertEndpointToCenterParameterization(Q,se,g,m,G,ee,R,D,$);break;case"a":R=x.shift(),D=x.shift(),$=x.shift(),G=x.shift(),ee=x.shift(),Q=g,se=m,g+=x.shift(),m+=x.shift(),P="A",T=this.convertEndpointToCenterParameterization(Q,se,g,m,G,ee,R,D,$);break}f.push({command:P||v,points:T,start:{x:L,y:E},pathLength:this.calcLength(L,E,P||v,T)})}(v==="z"||v==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(a,l,c,d){var h,f,p,g,m=Gs;switch(c){case"L":return m.getLineLength(a,l,d[0],d[1]);case"C":return(0,s.getCubicArcLength)([a,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,s.getQuadraticArcLength)([a,d[0],d[2]],[l,d[1],d[3]],1);case"A":h=0;var y=d[4],b=d[5],C=d[4]+b,v=Math.PI/180;if(Math.abs(y-C)<v&&(v=Math.abs(y-C)),f=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),b<0)for(g=y-v;g>C;g-=v)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(g=y+v;g<C;g+=v)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],C,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),h}return 0}static convertEndpointToCenterParameterization(a,l,c,d,h,f,p,g,m){var y=m*(Math.PI/180),b=Math.cos(y)*(a-c)/2+Math.sin(y)*(l-d)/2,C=-1*Math.sin(y)*(a-c)/2+Math.cos(y)*(l-d)/2,v=b*b/(p*p)+C*C/(g*g);v>1&&(p*=Math.sqrt(v),g*=Math.sqrt(v));var x=Math.sqrt((p*p*(g*g)-p*p*(C*C)-g*g*(b*b))/(p*p*(C*C)+g*g*(b*b)));h===f&&(x*=-1),isNaN(x)&&(x=0);var S=x*p*C/g,w=x*-g*b/p,j=(a+c)/2+Math.cos(y)*S-Math.sin(y)*w,P=(l+d)/2+Math.sin(y)*S+Math.cos(y)*w,T=function(D){return Math.sqrt(D[0]*D[0]+D[1]*D[1])},L=function(D,$){return(D[0]*$[0]+D[1]*$[1])/(T(D)*T($))},E=function(D,$){return(D[0]*$[1]<D[1]*$[0]?-1:1)*Math.acos(L(D,$))},O=E([1,0],[(b-S)/p,(C-w)/g]),F=[(b-S)/p,(C-w)/g],_=[(-1*b-S)/p,(-1*C-w)/g],R=E(F,_);return L(F,_)<=-1&&(R=Math.PI),L(F,_)>=1&&(R=0),f===0&&R>0&&(R=R-2*Math.PI),f===1&&R<0&&(R=R+2*Math.PI),[j,P,p,g,O,R,y,f]}};return Hd.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,n._registerNode)(i),e.Factory.addGetterSetter(i,"data"),Hd}var j5;function loe(){if(j5)return Gd;j5=1,Object.defineProperty(Gd,"__esModule",{value:!0}),Gd.Arrow=void 0;const e=St(),t=SL(),n=wt(),s=Ct(),i=Iw();let o=class extends t.Line{_sceneFunc(l){super._sceneFunc(l);var c=Math.PI*2,d=this.points(),h=d,f=this.tension()!==0&&d.length>4;f&&(h=this.getTensionPoints());var p=this.pointerLength(),g=d.length,m,y;if(f){const v=[h[h.length-4],h[h.length-3],h[h.length-2],h[h.length-1],d[g-2],d[g-1]],x=i.Path.calcLength(h[h.length-4],h[h.length-3],"C",v),S=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/x),v[0],v[1],v[2],v[3],v[4],v[5]);m=d[g-2]-S.x,y=d[g-1]-S.y}else m=d[g-2]-d[g-4],y=d[g-1]-d[g-3];var b=(Math.atan2(y,m)+c)%c,C=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[g-2],d[g-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),f?(m=(h[0]+h[2])/2-d[0],y=(h[1]+h[3])/2-d[1]):(m=d[2]-d[0],y=d[3]-d[1]),l.rotate((Math.atan2(-y,-m)+c)%c),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){var c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x-c,y:l.y-c,width:l.width+c*2,height:l.height+c*2}}};return Gd.Arrow=o,o.prototype.className="Arrow",(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"pointerLength",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerWidth",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerAtBeginning",!1),e.Factory.addGetterSetter(o,"pointerAtEnding",!0),Gd}var Wd={},k5;function coe(){if(k5)return Wd;k5=1,Object.defineProperty(Wd,"__esModule",{value:!0}),Wd.Circle=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();let i=class extends t.Shape{_sceneFunc(a){a.beginPath(),a.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius()!==a/2&&this.radius(a/2)}setHeight(a){this.radius()!==a/2&&this.radius(a/2)}};return Wd.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),Wd}var Ud={},_5;function uoe(){if(_5)return Ud;_5=1,Object.defineProperty(Ud,"__esModule",{value:!0}),Ud.Ellipse=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();let i=class extends t.Shape{_sceneFunc(a){var l=this.radiusX(),c=this.radiusY();a.beginPath(),a.save(),l!==c&&a.scale(1,c/l),a.arc(0,0,l,0,Math.PI*2,!1),a.restore(),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(a){this.radiusX(a/2)}setHeight(a){this.radiusY(a/2)}};return Ud.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,s._registerNode)(i),e.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),e.Factory.addGetterSetter(i,"radiusX",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"radiusY",0,(0,n.getNumberValidator)()),Ud}var qd={},I5;function doe(){if(I5)return qd;I5=1,Object.defineProperty(qd,"__esModule",{value:!0}),qd.Image=void 0;const e=In(),t=St(),n=Jn(),s=Ct(),i=wt();class o extends n.Shape{constructor(l){super(l),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),h=this.cornerRadius(),f=this.attrs.image;let p;if(f){const g=this.attrs.cropWidth,m=this.attrs.cropHeight;g&&m?p=[f,this.cropX(),this.cropY(),g,m,0,0,c,d]:p=[f,0,0,c,d]}(this.hasFill()||this.hasStroke()||h)&&(l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),f&&(h&&l.clip(),l.drawImage.apply(l,p))}_hitFunc(l){var c=this.width(),d=this.height(),h=this.cornerRadius();l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){var h=e.Util.createImageElement();h.onload=function(){var f=new o({image:h});c(f)},h.onerror=d,h.crossOrigin="Anonymous",h.src=l}}return qd.Image=o,o.prototype.className="Image",(0,s._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(o,"image"),t.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(o,"cropX",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropY",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropWidth",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropHeight",0,(0,i.getNumberValidator)()),qd}var ol={},A5;function hoe(){if(A5)return ol;A5=1,Object.defineProperty(ol,"__esModule",{value:!0}),ol.Tag=ol.Label=void 0;const e=St(),t=Jn(),n=kw(),s=wt(),i=Ct();var o=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],a="Change.konva",l="none",c="up",d="right",h="down",f="left",p=o.length;class g extends n.Group{constructor(b){super(b),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){var C=this,v,x=function(){C._sync()};for(v=0;v<p;v++)b.on(o[v]+a,x)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var b=this.getText(),C=this.getTag(),v,x,S,w,j,P,T;if(b&&C){switch(v=b.width(),x=b.height(),S=C.pointerDirection(),w=C.pointerWidth(),T=C.pointerHeight(),j=0,P=0,S){case c:j=v/2,P=-1*T;break;case d:j=v+w,P=x/2;break;case h:j=v/2,P=x+T;break;case f:j=-1*w,P=x/2;break}C.setAttrs({x:-1*j,y:-1*P,width:v,height:x}),b.setAttrs({x:-1*j,y:-1*P})}}}ol.Label=g,g.prototype.className="Label",(0,i._registerNode)(g);class m extends t.Shape{_sceneFunc(b){var C=this.width(),v=this.height(),x=this.pointerDirection(),S=this.pointerWidth(),w=this.pointerHeight(),j=this.cornerRadius();let P=0,T=0,L=0,E=0;typeof j=="number"?P=T=L=E=Math.min(j,C/2,v/2):(P=Math.min(j[0]||0,C/2,v/2),T=Math.min(j[1]||0,C/2,v/2),E=Math.min(j[2]||0,C/2,v/2),L=Math.min(j[3]||0,C/2,v/2)),b.beginPath(),b.moveTo(P,0),x===c&&(b.lineTo((C-S)/2,0),b.lineTo(C/2,-1*w),b.lineTo((C+S)/2,0)),b.lineTo(C-T,0),b.arc(C-T,T,T,Math.PI*3/2,0,!1),x===d&&(b.lineTo(C,(v-w)/2),b.lineTo(C+S,v/2),b.lineTo(C,(v+w)/2)),b.lineTo(C,v-E),b.arc(C-E,v-E,E,0,Math.PI/2,!1),x===h&&(b.lineTo((C+S)/2,v),b.lineTo(C/2,v+w),b.lineTo((C-S)/2,v)),b.lineTo(L,v),b.arc(L,v-L,L,Math.PI/2,Math.PI,!1),x===f&&(b.lineTo(0,(v+w)/2),b.lineTo(-1*S,v/2),b.lineTo(0,(v-w)/2)),b.lineTo(0,P),b.arc(P,P,P,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){var b=0,C=0,v=this.pointerWidth(),x=this.pointerHeight(),S=this.pointerDirection(),w=this.width(),j=this.height();return S===c?(C-=x,j+=x):S===h?j+=x:S===f?(b-=v*1.5,w+=v):S===d&&(w+=v*1.5),{x:b,y:C,width:w,height:j}}}return ol.Tag=m,m.prototype.className="Tag",(0,i._registerNode)(m),e.Factory.addGetterSetter(m,"pointerDirection",l),e.Factory.addGetterSetter(m,"pointerWidth",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"pointerHeight",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),ol}var Kd={},T5;function wL(){if(T5)return Kd;T5=1,Object.defineProperty(Kd,"__esModule",{value:!0}),Kd.Rect=void 0;const e=St(),t=Jn(),n=Ct(),s=In(),i=wt();let o=class extends t.Shape{_sceneFunc(l){var c=this.cornerRadius(),d=this.width(),h=this.height();l.beginPath(),c?s.Util.drawRoundedRectPath(l,d,h,c):l.rect(0,0,d,h),l.closePath(),l.fillStrokeShape(this)}};return Kd.Rect=o,o.prototype.className="Rect",(0,n._registerNode)(o),e.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),Kd}var Zd={},E5;function foe(){if(E5)return Zd;E5=1,Object.defineProperty(Zd,"__esModule",{value:!0}),Zd.RegularPolygon=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();let i=class extends t.Shape{_sceneFunc(a){const l=this._getPoints();a.beginPath(),a.moveTo(l[0].x,l[0].y);for(var c=1;c<l.length;c++)a.lineTo(l[c].x,l[c].y);a.closePath(),a.fillStrokeShape(this)}_getPoints(){const a=this.attrs.sides,l=this.attrs.radius||0,c=[];for(var d=0;d<a;d++)c.push({x:l*Math.sin(d*2*Math.PI/a),y:-1*l*Math.cos(d*2*Math.PI/a)});return c}getSelfRect(){const a=this._getPoints();var l=a[0].x,c=a[0].y,d=a[0].x,h=a[0].y;return a.forEach(f=>{l=Math.min(l,f.x),c=Math.max(c,f.x),d=Math.min(d,f.y),h=Math.max(h,f.y)}),{x:l,y:d,width:c-l,height:h-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius(a/2)}setHeight(a){this.radius(a/2)}};return Zd.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"sides",0,(0,n.getNumberValidator)()),Zd}var Yd={},M5;function poe(){if(M5)return Yd;M5=1,Object.defineProperty(Yd,"__esModule",{value:!0}),Yd.Ring=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();var i=Math.PI*2;let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,i,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),i,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return Yd.Ring=o,o.prototype.className="Ring",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,n.getNumberValidator)()),Yd}var Xd={},P5;function goe(){if(P5)return Xd;P5=1,Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.Sprite=void 0;const e=St(),t=Jn(),n=_w(),s=wt(),i=Ct();let o=class extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new n.Animation(()=>{var c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+0],m=f[h+1],y=f[h+2],b=f[h+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,y,b),l.closePath(),l.fillStrokeShape(this)),C)if(p){var v=p[c],x=d*2;l.drawImage(C,g,m,y,b,v[x+0],v[x+1],y,b)}else l.drawImage(C,g,m,y,b,0,0,y,b)}_hitFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+2],m=f[h+3];if(l.beginPath(),p){var y=p[c],b=d*2;l.rect(y[b+0],y[b+1],g,m)}else l.rect(0,0,g,m);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var l=this.frameIndex(),c=this.animation(),d=this.animations(),h=d[c],f=h.length/4;l<f-1?this.frameIndex(l+1):this.frameIndex(0)}};return Xd.Sprite=o,o.prototype.className="Sprite",(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"animation"),e.Factory.addGetterSetter(o,"animations"),e.Factory.addGetterSetter(o,"frameOffsets"),e.Factory.addGetterSetter(o,"image"),e.Factory.addGetterSetter(o,"frameIndex",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"frameRate",17,(0,s.getNumberValidator)()),e.Factory.backCompat(o,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Xd}var Qd={},L5;function moe(){if(L5)return Qd;L5=1,Object.defineProperty(Qd,"__esModule",{value:!0}),Qd.Star=void 0;const e=St(),t=Jn(),n=wt(),s=Ct();let i=class extends t.Shape{_sceneFunc(a){var l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var h=1;h<d*2;h++){var f=h%2===0?c:l,p=f*Math.sin(h*Math.PI/d),g=-1*f*Math.cos(h*Math.PI/d);a.lineTo(p,g)}a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(a){this.outerRadius(a/2)}setHeight(a){this.outerRadius(a/2)}};return Qd.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"numPoints",5,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"outerRadius",0,(0,n.getNumberValidator)()),Qd}var al={},D5;function jL(){if(D5)return al;D5=1,Object.defineProperty(al,"__esModule",{value:!0}),al.Text=al.stringToArray=void 0;const e=In(),t=St(),n=Jn(),s=Ct(),i=wt(),o=Ct();function a(H){return[...H].reduce((V,Y,W,J)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(Y)?V.push(Y):new RegExp("\\p{Regional_Indicator}{2}","u").test(Y+(J[W+1]||""))?V.push(Y+J[W+1]):W>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(Y)?V[V.length-1]+=Y:V.push(Y),V),[])}al.stringToArray=a;var l="auto",c="center",d="inherit",h="justify",f="Change.konva",p="2d",g="-",m="left",y="text",b="Text",C="top",v="bottom",x="middle",S="normal",w="px ",j=" ",P="right",T="rtl",L="word",E="char",O="none",F="",_=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],R=_.length;function D(H){return H.split(",").map(V=>{V=V.trim();const Y=V.indexOf(" ")>=0,W=V.indexOf('"')>=0||V.indexOf("'")>=0;return Y&&!W&&(V=`"${V}"`),V}).join(", ")}var $;function G(){return $||($=e.Util.createCanvasElement().getContext(p),$)}function ee(H){H.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Q(H){H.setAttr("miterLimit",2),H.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function se(H){return H=H||{},!H.fillLinearGradientColorStops&&!H.fillRadialGradientColorStops&&!H.fillPatternImage&&(H.fill=H.fill||"black"),H}class ne extends n.Shape{constructor(V){super(se(V)),this._partialTextX=0,this._partialTextY=0;for(var Y=0;Y<R;Y++)this.on(_[Y]+f,this._setTextData);this._setTextData()}_sceneFunc(V){var Y=this.textArr,W=Y.length;if(this.text()){var J=this.padding(),N=this.fontSize(),B=this.lineHeight()*N,U=this.verticalAlign(),ie=this.direction(),de=0,be=this.align(),Ee=this.getWidth(),je=this.letterSpacing(),Be=this.fill(),Xe=this.textDecoration(),Re=Xe.indexOf("underline")!==-1,K=Xe.indexOf("line-through")!==-1,re;ie=ie===d?V.direction:ie;var ae=B/2,xe=x;if(s.Konva._fixTextRendering){var ge=this.measureSize("M");xe="alphabetic",ae=(ge.fontBoundingBoxAscent-ge.fontBoundingBoxDescent)/2+B/2}var fe=0,le=0;for(ie===T&&V.setAttr("direction",ie),V.setAttr("font",this._getContextFont()),V.setAttr("textBaseline",xe),V.setAttr("textAlign",m),U===x?de=(this.getHeight()-W*B-J*2)/2:U===v&&(de=this.getHeight()-W*B-J*2),V.translate(J,de+J),re=0;re<W;re++){var fe=0,le=0,Ce=Y[re],ze=Ce.text,Qe=Ce.width,gt=Ce.lastInParagraph,fn,cn,pn;if(V.save(),be===P?fe+=Ee-Qe-J*2:be===c&&(fe+=(Ee-Qe-J*2)/2),Re){V.save(),V.beginPath();let as=s.Konva._fixTextRendering?Math.round(N/4):Math.round(N/2);const $s=fe,ai=ae+le+as;V.moveTo($s,ai),fn=ze.split(" ").length-1,cn=fn===0,pn=be===h&&!gt?Ee-J*2:Qe,V.lineTo($s+Math.round(pn),ai),V.lineWidth=N/15;const mc=this._getLinearGradient();V.strokeStyle=mc||Be,V.stroke(),V.restore()}if(K){V.save(),V.beginPath();let as=s.Konva._fixTextRendering?-Math.round(N/4):0;V.moveTo(fe,ae+le+as),fn=ze.split(" ").length-1,cn=fn===0,pn=be===h&&gt&&!cn?Ee-J*2:Qe,V.lineTo(fe+Math.round(pn),ae+le+as),V.lineWidth=N/15;const $s=this._getLinearGradient();V.strokeStyle=$s||Be,V.stroke(),V.restore()}if(ie!==T&&(je!==0||be===h)){fn=ze.split(" ").length-1;for(var es=a(ze),ks=0;ks<es.length;ks++){var gn=es[ks];gn===" "&&!gt&&be===h&&(fe+=(Ee-J*2-Qe)/fn),this._partialTextX=fe,this._partialTextY=ae+le,this._partialText=gn,V.fillStrokeShape(this),fe+=this.measureSize(gn).width+je}}else je!==0&&V.setAttr("letterSpacing",`${je}px`),this._partialTextX=fe,this._partialTextY=ae+le,this._partialText=ze,V.fillStrokeShape(this);V.restore(),W>1&&(ae+=B)}}}_hitFunc(V){var Y=this.getWidth(),W=this.getHeight();V.beginPath(),V.rect(0,0,Y,W),V.closePath(),V.fillStrokeShape(this)}setText(V){var Y=e.Util._isString(V)?V:V==null?"":V+"";return this._setAttr(y,Y),this}getWidth(){var V=this.attrs.width===l||this.attrs.width===void 0;return V?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var V=this.attrs.height===l||this.attrs.height===void 0;return V?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(V){var Y,W,J,N,B,U,ie,de,be,Ee,je,Be=G(),Xe=this.fontSize(),Re;Be.save(),Be.font=this._getContextFont(),Re=Be.measureText(V),Be.restore();const K=Xe/100;return{actualBoundingBoxAscent:(Y=Re.actualBoundingBoxAscent)!==null&&Y!==void 0?Y:71.58203125*K,actualBoundingBoxDescent:(W=Re.actualBoundingBoxDescent)!==null&&W!==void 0?W:0,actualBoundingBoxLeft:(J=Re.actualBoundingBoxLeft)!==null&&J!==void 0?J:-7.421875*K,actualBoundingBoxRight:(N=Re.actualBoundingBoxRight)!==null&&N!==void 0?N:75.732421875*K,alphabeticBaseline:(B=Re.alphabeticBaseline)!==null&&B!==void 0?B:0,emHeightAscent:(U=Re.emHeightAscent)!==null&&U!==void 0?U:100*K,emHeightDescent:(ie=Re.emHeightDescent)!==null&&ie!==void 0?ie:-20*K,fontBoundingBoxAscent:(de=Re.fontBoundingBoxAscent)!==null&&de!==void 0?de:91*K,fontBoundingBoxDescent:(be=Re.fontBoundingBoxDescent)!==null&&be!==void 0?be:21*K,hangingBaseline:(Ee=Re.hangingBaseline)!==null&&Ee!==void 0?Ee:72.80000305175781*K,ideographicBaseline:(je=Re.ideographicBaseline)!==null&&je!==void 0?je:-21*K,width:Re.width,height:Xe}}_getContextFont(){return this.fontStyle()+j+this.fontVariant()+j+(this.fontSize()+w)+D(this.fontFamily())}_addTextLine(V){this.align()===h&&(V=V.trim());var W=this._getTextWidth(V);return this.textArr.push({text:V,width:W,lastInParagraph:!1})}_getTextWidth(V){var Y=this.letterSpacing(),W=V.length;return G().measureText(V).width+(W?Y*(W-1):0)}_setTextData(){var V=this.text().split(`
`),Y=+this.fontSize(),W=0,J=this.lineHeight()*Y,N=this.attrs.width,B=this.attrs.height,U=N!==l&&N!==void 0,ie=B!==l&&B!==void 0,de=this.padding(),be=N-de*2,Ee=B-de*2,je=0,Be=this.wrap(),Xe=Be!==O,Re=Be!==E&&Xe,K=this.ellipsis();this.textArr=[],G().font=this._getContextFont();for(var re=K?this._getTextWidth(F):0,ae=0,xe=V.length;ae<xe;++ae){var ge=V[ae],fe=this._getTextWidth(ge);if(U&&fe>be)for(;ge.length>0;){for(var le=0,Ce=ge.length,ze="",Qe=0;le<Ce;){var gt=le+Ce>>>1,fn=ge.slice(0,gt+1),cn=this._getTextWidth(fn)+re;cn<=be?(le=gt+1,ze=fn,Qe=cn):Ce=gt}if(ze){if(Re){var pn,es=ge[ze.length],ks=es===j||es===g;ks&&Qe<=be?pn=ze.length:pn=Math.max(ze.lastIndexOf(j),ze.lastIndexOf(g))+1,pn>0&&(le=pn,ze=ze.slice(0,le),Qe=this._getTextWidth(ze))}ze=ze.trimRight(),this._addTextLine(ze),W=Math.max(W,Qe),je+=J;var gn=this._shouldHandleEllipsis(je);if(gn){this._tryToAddEllipsisToLastLine();break}if(ge=ge.slice(le),ge=ge.trimLeft(),ge.length>0&&(fe=this._getTextWidth(ge),fe<=be)){this._addTextLine(ge),je+=J,W=Math.max(W,fe);break}}else break}else this._addTextLine(ge),je+=J,W=Math.max(W,fe),this._shouldHandleEllipsis(je)&&ae<xe-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ie&&je+J>Ee)break}this.textHeight=Y,this.textWidth=W}_shouldHandleEllipsis(V){var Y=+this.fontSize(),W=this.lineHeight()*Y,J=this.attrs.height,N=J!==l&&J!==void 0,B=this.padding(),U=J-B*2,ie=this.wrap(),de=ie!==O;return!de||N&&V+W>U}_tryToAddEllipsisToLastLine(){var V=this.attrs.width,Y=V!==l&&V!==void 0,W=this.padding(),J=V-W*2,N=this.ellipsis(),B=this.textArr[this.textArr.length-1];if(!(!B||!N)){if(Y){var U=this._getTextWidth(B.text+F)<J;U||(B.text=B.text.slice(0,B.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(B.text+F)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const V=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,Y=this.hasShadow();return V&&Y?!0:super._useBufferCanvas()}}return al.Text=ne,ne.prototype._fillFunc=ee,ne.prototype._strokeFunc=Q,ne.prototype.className=b,ne.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(ne),t.Factory.overWriteSetter(ne,"width",(0,i.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(ne,"height",(0,i.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(ne,"direction",d),t.Factory.addGetterSetter(ne,"fontFamily","Arial"),t.Factory.addGetterSetter(ne,"fontSize",12,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"fontStyle",S),t.Factory.addGetterSetter(ne,"fontVariant",S),t.Factory.addGetterSetter(ne,"padding",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"align",m),t.Factory.addGetterSetter(ne,"verticalAlign",C),t.Factory.addGetterSetter(ne,"lineHeight",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"wrap",L),t.Factory.addGetterSetter(ne,"ellipsis",!1,(0,i.getBooleanValidator)()),t.Factory.addGetterSetter(ne,"letterSpacing",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"text","",(0,i.getStringValidator)()),t.Factory.addGetterSetter(ne,"textDecoration",""),al}var Jd={},R5;function yoe(){if(R5)return Jd;R5=1,Object.defineProperty(Jd,"__esModule",{value:!0}),Jd.TextPath=void 0;const e=In(),t=St(),n=Jn(),s=Iw(),i=jL(),o=wt(),a=Ct();var l="",c="normal";function d(p){p.fillText(this.partialText,0,0)}function h(p){p.strokeText(this.partialText,0,0)}let f=class extends n.Shape{constructor(g){super(g),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return s.Path.getPathLength(this.dataArray)}_getPointAtLength(g){if(!this.attrs.data)return null;const m=this.pathLength;return g-1>m?null:s.Path.getPointAtLengthOfDataArray(g,this.dataArray)}_readDataAttribute(){this.dataArray=s.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(g){g.setAttr("font",this._getContextFont()),g.setAttr("textBaseline",this.textBaseline()),g.setAttr("textAlign","left"),g.save();var m=this.textDecoration(),y=this.fill(),b=this.fontSize(),C=this.glyphInfo;m==="underline"&&g.beginPath();for(var v=0;v<C.length;v++){g.save();var x=C[v].p0;g.translate(x.x,x.y),g.rotate(C[v].rotation),this.partialText=C[v].text,g.fillStrokeShape(this),m==="underline"&&(v===0&&g.moveTo(0,b/2+1),g.lineTo(b,b/2+1)),g.restore()}m==="underline"&&(g.strokeStyle=y,g.lineWidth=b/20,g.stroke()),g.restore()}_hitFunc(g){g.beginPath();var m=this.glyphInfo;if(m.length>=1){var y=m[0].p0;g.moveTo(y.x,y.y)}for(var b=0;b<m.length;b++){var C=m[b].p1;g.lineTo(C.x,C.y)}g.setAttr("lineWidth",this.fontSize()),g.setAttr("strokeStyle",this.colorKey),g.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(g){return i.Text.prototype.setText.call(this,g)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(g){var m=this.dummyCanvas,y=m.getContext("2d");y.save(),y.font=this._getContextFont();var b=y.measureText(g);return y.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:g,height:m}=this._getTextSize(this.attrs.text);if(this.textWidth=g,this.textHeight=m,this.glyphInfo=[],!this.attrs.data)return null;const y=this.letterSpacing(),b=this.align(),C=this.kerningFunc(),v=Math.max(this.textWidth+((this.attrs.text||"").length-1)*y,0);let x=0;b==="center"&&(x=Math.max(0,this.pathLength/2-v/2)),b==="right"&&(x=Math.max(0,this.pathLength-v));const S=(0,i.stringToArray)(this.text());let w=x;for(var j=0;j<S.length;j++){const P=this._getPointAtLength(w);if(!P)return;let T=this._getTextSize(S[j]).width+y;if(S[j]===" "&&b==="justify"){const R=this.text().split(" ").length-1;T+=(this.pathLength-v)/R}const L=this._getPointAtLength(w+T);if(!L)return;const E=s.Path.getLineLength(P.x,P.y,L.x,L.y);let O=0;if(C)try{O=C(S[j-1],S[j])*this.fontSize()}catch{O=0}P.x+=O,L.x+=O,this.textWidth+=O;const F=s.Path.getPointOnLine(O+E/2,P.x,P.y,L.x,L.y),_=Math.atan2(L.y-P.y,L.x-P.x);this.glyphInfo.push({transposeX:F.x,transposeY:F.y,text:S[j],rotation:_,p0:P,p1:L}),w+=T}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var g=[];this.glyphInfo.forEach(function(j){g.push(j.p0.x),g.push(j.p0.y),g.push(j.p1.x),g.push(j.p1.y)});for(var m=g[0]||0,y=g[0]||0,b=g[1]||0,C=g[1]||0,v,x,S=0;S<g.length/2;S++)v=g[S*2],x=g[S*2+1],m=Math.min(m,v),y=Math.max(y,v),b=Math.min(b,x),C=Math.max(C,x);var w=this.fontSize();return{x:m-w/2,y:b-w/2,width:y-m+w,height:C-b+w}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return Jd.TextPath=f,f.prototype._fillFunc=d,f.prototype._strokeFunc=h,f.prototype._fillFuncHit=d,f.prototype._strokeFuncHit=h,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,a._registerNode)(f),t.Factory.addGetterSetter(f,"data"),t.Factory.addGetterSetter(f,"fontFamily","Arial"),t.Factory.addGetterSetter(f,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"fontStyle",c),t.Factory.addGetterSetter(f,"align","left"),t.Factory.addGetterSetter(f,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"textBaseline","middle"),t.Factory.addGetterSetter(f,"fontVariant",c),t.Factory.addGetterSetter(f,"text",l),t.Factory.addGetterSetter(f,"textDecoration",null),t.Factory.addGetterSetter(f,"kerningFunc",null),Jd}var eh={},O5;function voe(){if(O5)return eh;O5=1,Object.defineProperty(eh,"__esModule",{value:!0}),eh.Transformer=void 0;const e=In(),t=St(),n=Mn(),s=Jn(),i=wL(),o=kw(),a=Ct(),l=wt(),c=Ct();var d="tr-konva",h=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(T=>T+`.${d}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],g={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const m="ontouchstart"in a.Konva._global;function y(T,L,E){if(T==="rotater")return E;L+=e.Util.degToRad(g[T]||0);var O=(e.Util.radToDeg(L)%360+360)%360;return e.Util._inRange(O,315+22.5,360)||e.Util._inRange(O,0,22.5)?"ns-resize":e.Util._inRange(O,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(O,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(O,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(O,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(O,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(O,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(O,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+O),"pointer")}var b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(T){return{x:T.x+T.width/2*Math.cos(T.rotation)+T.height/2*Math.sin(-T.rotation),y:T.y+T.height/2*Math.cos(T.rotation)+T.width/2*Math.sin(T.rotation)}}function v(T,L,E){const O=E.x+(T.x-E.x)*Math.cos(L)-(T.y-E.y)*Math.sin(L),F=E.y+(T.x-E.x)*Math.sin(L)+(T.y-E.y)*Math.cos(L);return{...T,rotation:T.rotation+L,x:O,y:F}}function x(T,L){const E=C(T);return v(T,L,E)}function S(T,L,E){let O=L;for(let F=0;F<T.length;F++){const _=a.Konva.getAngle(T[F]),R=Math.abs(_-L)%(Math.PI*2);Math.min(R,Math.PI*2-R)<E&&(O=_)}return O}let w=0,j=class extends o.Group{constructor(L){super(L),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(h,this.update),this.getNode()&&this.update()}attachTo(L){return this.setNode(L),this}setNode(L){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([L])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(L=[]){this._nodes&&this._nodes.length&&this.detach();const E=L.filter(F=>F.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=L=E,L.length===1&&this.useSingleNodeRotation()?this.rotation(L[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(F=>{const _=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},R=F._attrsAffectingSize.map(D=>D+"Change."+this._getEventNamespace()).join(" ");F.on(R,_),F.on(p.map(D=>D+`.${this._getEventNamespace()}`).join(" "),_),F.on(`absoluteTransformChange.${this._getEventNamespace()}`,_),this._proxyDrag(F)}),this._resetTransformCache();var O=!!this.findOne(".top-left");return O&&this.update(),this}_proxyDrag(L){let E;L.on(`dragstart.${this._getEventNamespace()}`,O=>{E=L.getAbsolutePosition(),!this.isDragging()&&L!==this.findOne(".back")&&this.startDrag(O,!1)}),L.on(`dragmove.${this._getEventNamespace()}`,O=>{if(!E)return;const F=L.getAbsolutePosition(),_=F.x-E.x,R=F.y-E.y;this.nodes().forEach(D=>{if(D===L||D.isDragging())return;const $=D.getAbsolutePosition();D.setAbsolutePosition({x:$.x+_,y:$.y+R}),D.startDrag(O)}),E=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(L=>{L.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(L,E=this.rotation(),O){var F=L.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),_=L.getAbsoluteScale(O),R=L.getAbsolutePosition(O),D=F.x*_.x-L.offsetX()*_.x,$=F.y*_.y-L.offsetY()*_.y;const G=(a.Konva.getAngle(L.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),ee={x:R.x+D*Math.cos(G)+$*Math.sin(-G),y:R.y+$*Math.cos(G)+D*Math.sin(G),width:F.width*_.x,height:F.height*_.y,rotation:G};return v(ee,-a.Konva.getAngle(E),{x:0,y:0})}__getNodeRect(){var L=this.getNode();if(!L)return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const E=[];this.nodes().map(G=>{const ee=G.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var Q=[{x:ee.x,y:ee.y},{x:ee.x+ee.width,y:ee.y},{x:ee.x+ee.width,y:ee.y+ee.height},{x:ee.x,y:ee.y+ee.height}],se=G.getAbsoluteTransform();Q.forEach(function(ne){var H=se.point(ne);E.push(H)})});const O=new e.Transform;O.rotate(-a.Konva.getAngle(this.rotation()));var F=1/0,_=1/0,R=-1/0,D=-1/0;E.forEach(function(G){var ee=O.point(G);F===void 0&&(F=R=ee.x,_=D=ee.y),F=Math.min(F,ee.x),_=Math.min(_,ee.y),R=Math.max(R,ee.x),D=Math.max(D,ee.y)}),O.invert();const $=O.point({x:F,y:_});return{x:$.x,y:$.y,width:R-F,height:D-_,rotation:a.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(L=>{this._createAnchor(L)}),this._createAnchor("rotater")}_createAnchor(L){var E=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:L+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:m?10:"auto"}),O=this;E.on("mousedown touchstart",function(F){O._handleMouseDown(F)}),E.on("dragstart",F=>{E.stopDrag(),F.cancelBubble=!0}),E.on("dragend",F=>{F.cancelBubble=!0}),E.on("mouseenter",()=>{var F=a.Konva.getAngle(this.rotation()),_=this.rotateAnchorCursor(),R=y(L,F,_);E.getStage().content&&(E.getStage().content.style.cursor=R),this._cursorChange=!0}),E.on("mouseout",()=>{E.getStage().content&&(E.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(E)}_createBack(){var L=new s.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(E,O){var F=O.getParent(),_=F.padding();E.beginPath(),E.rect(-_,-_,O.width()+_*2,O.height()+_*2),E.moveTo(O.width()/2,-_),F.rotateEnabled()&&F.rotateLineVisible()&&E.lineTo(O.width()/2,-F.rotateAnchorOffset()*e.Util._sign(O.height())-_),E.fillStrokeShape(O)},hitFunc:(E,O)=>{if(this.shouldOverdrawWholeArea()){var F=this.padding();E.beginPath(),E.rect(-F,-F,O.width()+F*2,O.height()+F*2),E.fillStrokeShape(O)}}});this.add(L),this._proxyDrag(L),L.on("dragstart",E=>{E.cancelBubble=!0}),L.on("dragmove",E=>{E.cancelBubble=!0}),L.on("dragend",E=>{E.cancelBubble=!0}),this.on("dragmove",E=>{this.update()})}_handleMouseDown(L){if(!this._transforming){this._movingAnchorName=L.target.name().split(" ")[0];var E=this._getNodeRect(),O=E.width,F=E.height,_=Math.sqrt(Math.pow(O,2)+Math.pow(F,2));this.sin=Math.abs(F/_),this.cos=Math.abs(O/_),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var R=L.target.getAbsolutePosition(),D=L.target.getStage().getPointerPosition();this._anchorDragOffset={x:D.x-R.x,y:D.y-R.y},w++,this._fire("transformstart",{evt:L.evt,target:this.getNode()}),this._nodes.forEach($=>{$._fire("transformstart",{evt:L.evt,target:$})})}}_handleMouseMove(L){var E,O,F,_=this.findOne("."+this._movingAnchorName),R=_.getStage();R.setPointersPositions(L);const D=R.getPointerPosition();let $={x:D.x-this._anchorDragOffset.x,y:D.y-this._anchorDragOffset.y};const G=_.getAbsolutePosition();this.anchorDragBoundFunc()&&($=this.anchorDragBoundFunc()(G,$,L)),_.setAbsolutePosition($);const ee=_.getAbsolutePosition();if(!(G.x===ee.x&&G.y===ee.y)){if(this._movingAnchorName==="rotater"){var Q=this._getNodeRect();E=_.x()-Q.width/2,O=-_.y()+Q.height/2;let Re=Math.atan2(-O,E)+Math.PI/2;Q.height<0&&(Re-=Math.PI);var se=a.Konva.getAngle(this.rotation());const K=se+Re,re=a.Konva.getAngle(this.rotationSnapTolerance()),xe=S(this.rotationSnaps(),K,re)-Q.rotation,ge=x(Q,xe);this._fitNodesInto(ge,L);return}var ne=this.shiftBehavior(),H;ne==="inverted"?H=this.keepRatio()&&!L.shiftKey:ne==="none"?H=this.keepRatio():H=this.keepRatio()||L.shiftKey;var N=this.centeredScaling()||L.altKey;if(this._movingAnchorName==="top-left"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(V.y-_.y(),2));var Y=this.findOne(".top-left").x()>V.x?-1:1,W=this.findOne(".top-left").y()>V.y?-1:1;E=F*this.cos*Y,O=F*this.sin*W,this.findOne(".top-left").x(V.x-E),this.findOne(".top-left").y(V.y-O)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(_.y());else if(this._movingAnchorName==="top-right"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(V.y-_.y(),2));var Y=this.findOne(".top-right").x()<V.x?-1:1,W=this.findOne(".top-right").y()>V.y?-1:1;E=F*this.cos*Y,O=F*this.sin*W,this.findOne(".top-right").x(V.x+E),this.findOne(".top-right").y(V.y-O)}var J=_.position();this.findOne(".top-left").y(J.y),this.findOne(".bottom-right").x(J.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(_.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(_.x());else if(this._movingAnchorName==="bottom-left"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(_.y()-V.y,2));var Y=V.x<_.x()?-1:1,W=_.y()<V.y?-1:1;E=F*this.cos*Y,O=F*this.sin*W,_.x(V.x-E),_.y(V.y+O)}J=_.position(),this.findOne(".top-left").x(J.x),this.findOne(".bottom-right").y(J.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(_.y());else if(this._movingAnchorName==="bottom-right"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(_.y()-V.y,2));var Y=this.findOne(".bottom-right").x()<V.x?-1:1,W=this.findOne(".bottom-right").y()<V.y?-1:1;E=F*this.cos*Y,O=F*this.sin*W,this.findOne(".bottom-right").x(V.x+E),this.findOne(".bottom-right").y(V.y+O)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var N=this.centeredScaling()||L.altKey;if(N){var B=this.findOne(".top-left"),U=this.findOne(".bottom-right"),ie=B.x(),de=B.y(),be=this.getWidth()-U.x(),Ee=this.getHeight()-U.y();U.move({x:-ie,y:-de}),B.move({x:be,y:Ee})}var je=this.findOne(".top-left").getAbsolutePosition();E=je.x,O=je.y;var Be=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),Xe=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:E,y:O,width:Be,height:Xe,rotation:a.Konva.getAngle(this.rotation())},L)}}_handleMouseUp(L){this._removeEvents(L)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(L){var E;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var O=this.getNode();w--,this._fire("transformend",{evt:L,target:O}),(E=this.getLayer())===null||E===void 0||E.batchDraw(),O&&this._nodes.forEach(F=>{var _;F._fire("transformend",{evt:L,target:F}),(_=F.getLayer())===null||_===void 0||_.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(L,E){var O=this._getNodeRect();const F=1;if(e.Util._inRange(L.width,-this.padding()*2-F,F)){this.update();return}if(e.Util._inRange(L.height,-this.padding()*2-F,F)){this.update();return}var _=new e.Transform;if(_.rotate(a.Konva.getAngle(this.rotation())),this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("left")>=0){const se=_.point({x:-this.padding()*2,y:0});L.x+=se.x,L.y+=se.y,L.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y}else if(this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("right")>=0){const se=_.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.width+=this.padding()*2}if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("top")>=0){const se=_.point({x:0,y:-this.padding()*2});L.x+=se.x,L.y+=se.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.height+=this.padding()*2}else if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const se=_.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.height+=this.padding()*2}if(this.boundBoxFunc()){const se=this.boundBoxFunc()(O,L);se?L=se:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const R=1e7,D=new e.Transform;D.translate(O.x,O.y),D.rotate(O.rotation),D.scale(O.width/R,O.height/R);const $=new e.Transform,G=L.width/R,ee=L.height/R;this.flipEnabled()===!1?($.translate(L.x,L.y),$.rotate(L.rotation),$.translate(L.width<0?L.width:0,L.height<0?L.height:0),$.scale(Math.abs(G),Math.abs(ee))):($.translate(L.x,L.y),$.rotate(L.rotation),$.scale(G,ee));const Q=$.multiply(D.invert());this._nodes.forEach(se=>{var ne;const H=se.getParent().getAbsoluteTransform(),V=se.getTransform().copy();V.translate(se.offsetX(),se.offsetY());const Y=new e.Transform;Y.multiply(H.copy().invert()).multiply(Q).multiply(H).multiply(V);const W=Y.decompose();se.setAttrs(W),(ne=se.getLayer())===null||ne===void 0||ne.batchDraw()}),this.rotation(e.Util._getRotation(L.rotation)),this._nodes.forEach(se=>{this._fire("transform",{evt:E,target:se}),se._fire("transform",{evt:E,target:se})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(L,E){this.findOne(L).setAttrs(E)}update(){var L,E=this._getNodeRect();this.rotation(e.Util._getRotation(E.rotation));var O=E.width,F=E.height,_=this.enabledAnchors(),R=this.resizeEnabled(),D=this.padding(),$=this.anchorSize();const G=this.find("._anchor");G.forEach(Q=>{Q.setAttrs({width:$,height:$,offsetX:$/2,offsetY:$/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:$/2+D,offsetY:$/2+D,visible:R&&_.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:O/2,y:0,offsetY:$/2+D,visible:R&&_.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:O,y:0,offsetX:$/2-D,offsetY:$/2+D,visible:R&&_.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:F/2,offsetX:$/2+D,visible:R&&_.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:O,y:F/2,offsetX:$/2-D,visible:R&&_.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:F,offsetX:$/2+D,offsetY:$/2-D,visible:R&&_.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:O/2,y:F,offsetY:$/2-D,visible:R&&_.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:O,y:F,offsetX:$/2-D,offsetY:$/2-D,visible:R&&_.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:O/2,y:-this.rotateAnchorOffset()*e.Util._sign(F)-D,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:O,height:F,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const ee=this.anchorStyleFunc();ee&&G.forEach(Q=>{ee(Q)}),(L=this.getLayer())===null||L===void 0||L.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var L=this.findOne("."+this._movingAnchorName);L&&L.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),o.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return n.Node.prototype.toObject.call(this)}clone(L){var E=n.Node.prototype.clone.call(this,L);return E}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};eh.Transformer=j,j.isTransforming=()=>w>0;function P(T){return T instanceof Array||e.Util.warn("enabledAnchors value should be an array"),T instanceof Array&&T.forEach(function(L){b.indexOf(L)===-1&&e.Util.warn("Unknown anchor name: "+L+". Available names are: "+b.join(", "))}),T||[]}return j.prototype.className="Transformer",(0,c._registerNode)(j),t.Factory.addGetterSetter(j,"enabledAnchors",b,P),t.Factory.addGetterSetter(j,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(j,"resizeEnabled",!0),t.Factory.addGetterSetter(j,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateEnabled",!0),t.Factory.addGetterSetter(j,"rotateLineVisible",!0),t.Factory.addGetterSetter(j,"rotationSnaps",[]),t.Factory.addGetterSetter(j,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(j,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderEnabled",!0),t.Factory.addGetterSetter(j,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"anchorFill","white"),t.Factory.addGetterSetter(j,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderDash"),t.Factory.addGetterSetter(j,"keepRatio",!0),t.Factory.addGetterSetter(j,"shiftBehavior","default"),t.Factory.addGetterSetter(j,"centeredScaling",!1),t.Factory.addGetterSetter(j,"ignoreStroke",!1),t.Factory.addGetterSetter(j,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"node"),t.Factory.addGetterSetter(j,"nodes"),t.Factory.addGetterSetter(j,"boundBoxFunc"),t.Factory.addGetterSetter(j,"anchorDragBoundFunc"),t.Factory.addGetterSetter(j,"anchorStyleFunc"),t.Factory.addGetterSetter(j,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(j,"useSingleNodeRotation",!0),t.Factory.backCompat(j,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),eh}var th={},N5;function boe(){if(N5)return th;N5=1,Object.defineProperty(th,"__esModule",{value:!0}),th.Wedge=void 0;const e=St(),t=Jn(),n=Ct(),s=wt(),i=Ct();let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,n.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return th.Wedge=o,o.prototype.className="Wedge",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1),e.Factory.backCompat(o,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),th}var nh={},F5;function xoe(){if(F5)return nh;F5=1,Object.defineProperty(nh,"__esModule",{value:!0}),nh.Blur=void 0;const e=St(),t=Mn(),n=wt();function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function a(c,d){var h=c.data,f=c.width,p=c.height,g,m,y,b,C,v,x,S,w,j,P,T,L,E,O,F,_,R,D,$,G,ee,Q,se,ne=d+d+1,H=f-1,V=p-1,Y=d+1,W=Y*(Y+1)/2,J=new s,N=null,B=J,U=null,ie=null,de=i[d],be=o[d];for(y=1;y<ne;y++)B=B.next=new s,y===Y&&(N=B);for(B.next=J,x=v=0,m=0;m<p;m++){for(F=_=R=D=S=w=j=P=0,T=Y*($=h[v]),L=Y*(G=h[v+1]),E=Y*(ee=h[v+2]),O=Y*(Q=h[v+3]),S+=W*$,w+=W*G,j+=W*ee,P+=W*Q,B=J,y=0;y<Y;y++)B.r=$,B.g=G,B.b=ee,B.a=Q,B=B.next;for(y=1;y<Y;y++)b=v+((H<y?H:y)<<2),S+=(B.r=$=h[b])*(se=Y-y),w+=(B.g=G=h[b+1])*se,j+=(B.b=ee=h[b+2])*se,P+=(B.a=Q=h[b+3])*se,F+=$,_+=G,R+=ee,D+=Q,B=B.next;for(U=J,ie=N,g=0;g<f;g++)h[v+3]=Q=P*de>>be,Q!==0?(Q=255/Q,h[v]=(S*de>>be)*Q,h[v+1]=(w*de>>be)*Q,h[v+2]=(j*de>>be)*Q):h[v]=h[v+1]=h[v+2]=0,S-=T,w-=L,j-=E,P-=O,T-=U.r,L-=U.g,E-=U.b,O-=U.a,b=x+((b=g+d+1)<H?b:H)<<2,F+=U.r=h[b],_+=U.g=h[b+1],R+=U.b=h[b+2],D+=U.a=h[b+3],S+=F,w+=_,j+=R,P+=D,U=U.next,T+=$=ie.r,L+=G=ie.g,E+=ee=ie.b,O+=Q=ie.a,F-=$,_-=G,R-=ee,D-=Q,ie=ie.next,v+=4;x+=f}for(g=0;g<f;g++){for(_=R=D=F=w=j=P=S=0,v=g<<2,T=Y*($=h[v]),L=Y*(G=h[v+1]),E=Y*(ee=h[v+2]),O=Y*(Q=h[v+3]),S+=W*$,w+=W*G,j+=W*ee,P+=W*Q,B=J,y=0;y<Y;y++)B.r=$,B.g=G,B.b=ee,B.a=Q,B=B.next;for(C=f,y=1;y<=d;y++)v=C+g<<2,S+=(B.r=$=h[v])*(se=Y-y),w+=(B.g=G=h[v+1])*se,j+=(B.b=ee=h[v+2])*se,P+=(B.a=Q=h[v+3])*se,F+=$,_+=G,R+=ee,D+=Q,B=B.next,y<V&&(C+=f);for(v=g,U=J,ie=N,m=0;m<p;m++)b=v<<2,h[b+3]=Q=P*de>>be,Q>0?(Q=255/Q,h[b]=(S*de>>be)*Q,h[b+1]=(w*de>>be)*Q,h[b+2]=(j*de>>be)*Q):h[b]=h[b+1]=h[b+2]=0,S-=T,w-=L,j-=E,P-=O,T-=U.r,L-=U.g,E-=U.b,O-=U.a,b=g+((b=m+Y)<V?b:V)*f<<2,S+=F+=U.r=h[b],w+=_+=U.g=h[b+1],j+=R+=U.b=h[b+2],P+=D+=U.a=h[b+3],U=U.next,T+=$=ie.r,L+=G=ie.g,E+=ee=ie.b,O+=Q=ie.a,F-=$,_-=G,R-=ee,D-=Q,ie=ie.next,v+=f}}const l=function(d){var h=Math.round(this.blurRadius());h>0&&a(d,h)};return nh.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),nh}var sh={},B5;function Coe(){if(B5)return sh;B5=1,Object.defineProperty(sh,"__esModule",{value:!0}),sh.Brighten=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=this.brightness()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=4)a[c]+=o,a[c+1]+=o,a[c+2]+=o};return sh.Brighten=s,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),sh}var rh={},$5;function Soe(){if($5)return rh;$5=1,Object.defineProperty(rh,"__esModule",{value:!0}),rh.Contrast=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=Math.pow((this.contrast()+100)/100,2),a=i.data,l=a.length,c=150,d=150,h=150,f;for(f=0;f<l;f+=4)c=a[f],d=a[f+1],h=a[f+2],c/=255,c-=.5,c*=o,c+=.5,c*=255,d/=255,d-=.5,d*=o,d+=.5,d*=255,h/=255,h-=.5,h*=o,h+=.5,h*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,h=h<0?0:h>255?255:h,a[f]=c,a[f+1]=d,a[f+2]=h};return rh.Contrast=s,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),rh}var ih={},V5;function woe(){if(V5)return ih;V5=1,Object.defineProperty(ih,"__esModule",{value:!0}),ih.Emboss=void 0;const e=St(),t=Mn(),n=In(),s=wt(),i=function(o){var a=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),h=0,f=0,p=o.data,g=o.width,m=o.height,y=g*4,b=m;switch(c){case"top-left":h=-1,f=-1;break;case"top":h=-1,f=0;break;case"top-right":h=-1,f=1;break;case"right":h=0,f=1;break;case"bottom-right":h=1,f=1;break;case"bottom":h=1,f=0;break;case"bottom-left":h=1,f=-1;break;case"left":h=0,f=-1;break;default:n.Util.error("Unknown emboss direction: "+c)}do{var C=(b-1)*y,v=h;b+v<1&&(v=0),b+v>m&&(v=0);var x=(b-1+v)*g*4,S=g;do{var w=C+(S-1)*4,j=f;S+j<1&&(j=0),S+j>g&&(j=0);var P=x+(S-1+j)*4,T=p[w]-p[P],L=p[w+1]-p[P+1],E=p[w+2]-p[P+2],O=T,F=O>0?O:-O,_=L>0?L:-L,R=E>0?E:-E;if(_>F&&(O=L),R>F&&(O=E),O*=a,d){var D=p[w]+O,$=p[w+1]+O,G=p[w+2]+O;p[w]=D>255?255:D<0?0:D,p[w+1]=$>255?255:$<0?0:$,p[w+2]=G>255?255:G<0?0:G}else{var ee=l-O;ee<0?ee=0:ee>255&&(ee=255),p[w]=p[w+1]=p[w+2]=ee}}while(--S)}while(--b)};return ih.Emboss=i,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",null,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,null,e.Factory.afterSetFilter),ih}var oh={},G5;function joe(){if(G5)return oh;G5=1,Object.defineProperty(oh,"__esModule",{value:!0}),oh.Enhance=void 0;const e=St(),t=Mn(),n=wt();function s(o,a,l,c,d){var h=l-a,f=d-c,p;return h===0?c+f/2:f===0?c:(p=(o-a)/h,p=f*p+c,p)}const i=function(o){var a=o.data,l=a.length,c=a[0],d=c,h,f=a[1],p=f,g,m=a[2],y=m,b,C,v=this.enhance();if(v!==0){for(C=0;C<l;C+=4)h=a[C+0],h<c?c=h:h>d&&(d=h),g=a[C+1],g<f?f=g:g>p&&(p=g),b=a[C+2],b<m?m=b:b>y&&(y=b);d===c&&(d=255,c=0),p===f&&(p=255,f=0),y===m&&(y=255,m=0);var x,S,w,j,P,T,L,E,O;for(v>0?(S=d+v*(255-d),w=c-v*(c-0),P=p+v*(255-p),T=f-v*(f-0),E=y+v*(255-y),O=m-v*(m-0)):(x=(d+c)*.5,S=d+v*(d-x),w=c+v*(c-x),j=(p+f)*.5,P=p+v*(p-j),T=f+v*(f-j),L=(y+m)*.5,E=y+v*(y-L),O=m+v*(m-L)),C=0;C<l;C+=4)a[C+0]=s(a[C+0],c,d,w,S),a[C+1]=s(a[C+1],f,p,T,P),a[C+2]=s(a[C+2],m,y,O,E)}};return oh.Enhance=i,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),oh}var ah={},z5;function koe(){if(z5)return ah;z5=1,Object.defineProperty(ah,"__esModule",{value:!0}),ah.Grayscale=void 0;const e=function(t){var n=t.data,s=n.length,i,o;for(i=0;i<s;i+=4)o=.34*n[i]+.5*n[i+1]+.16*n[i+2],n[i]=o,n[i+1]=o,n[i+2]=o};return ah.Grayscale=e,ah}var lh={},H5;function _oe(){if(H5)return lh;H5=1,Object.defineProperty(lh,"__esModule",{value:!0}),lh.HSL=void 0;const e=St(),t=Mn(),n=wt();e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter);const s=function(i){var o=i.data,a=o.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h=this.luminance()*127,f,p=l*c*Math.cos(d*Math.PI/180),g=l*c*Math.sin(d*Math.PI/180),m=.299*l+.701*p+.167*g,y=.587*l-.587*p+.33*g,b=.114*l-.114*p-.497*g,C=.299*l-.299*p-.328*g,v=.587*l+.413*p+.035*g,x=.114*l-.114*p+.293*g,S=.299*l-.3*p+1.25*g,w=.587*l-.586*p-1.05*g,j=.114*l+.886*p-.2*g,P,T,L,E;for(f=0;f<a;f+=4)P=o[f+0],T=o[f+1],L=o[f+2],E=o[f+3],o[f+0]=m*P+y*T+b*L+h,o[f+1]=C*P+v*T+x*L+h,o[f+2]=S*P+w*T+j*L+h,o[f+3]=E};return lh.HSL=s,lh}var ch={},W5;function Ioe(){if(W5)return ch;W5=1,Object.defineProperty(ch,"__esModule",{value:!0}),ch.HSV=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=i.data,a=o.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h,f=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),g=.299*l+.701*f+.167*p,m=.587*l-.587*f+.33*p,y=.114*l-.114*f-.497*p,b=.299*l-.299*f-.328*p,C=.587*l+.413*f+.035*p,v=.114*l-.114*f+.293*p,x=.299*l-.3*f+1.25*p,S=.587*l-.586*f-1.05*p,w=.114*l+.886*f-.2*p,j,P,T,L;for(h=0;h<a;h+=4)j=o[h+0],P=o[h+1],T=o[h+2],L=o[h+3],o[h+0]=g*j+m*P+y*T,o[h+1]=b*j+C*P+v*T,o[h+2]=x*j+S*P+w*T,o[h+3]=L};return ch.HSV=s,e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),ch}var uh={},U5;function Aoe(){if(U5)return uh;U5=1,Object.defineProperty(uh,"__esModule",{value:!0}),uh.Invert=void 0;const e=function(t){var n=t.data,s=n.length,i;for(i=0;i<s;i+=4)n[i]=255-n[i],n[i+1]=255-n[i+1],n[i+2]=255-n[i+2]};return uh.Invert=e,uh}var dh={},q5;function Toe(){if(q5)return dh;q5=1,Object.defineProperty(dh,"__esModule",{value:!0}),dh.Kaleidoscope=void 0;const e=St(),t=Mn(),n=In(),s=wt();var i=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,b,C,v,x=0,S=0,w=0,j=0,P,T=Math.sqrt(m*m+y*y);C=p-m,v=g-y,P=Math.sqrt(C*C+v*v),T=P>T?P:T;var L=g,E=p,O,F,_=360/E*Math.PI/180,R,D;for(F=0;F<E;F+=1)for(R=Math.sin(F*_),D=Math.cos(F*_),O=0;O<L;O+=1)C=Math.floor(m+T*O/L*D),v=Math.floor(y+T*O/L*R),b=(v*p+C)*4,x=h[b+0],S=h[b+1],w=h[b+2],j=h[b+3],b=(F+O*p)*4,f[b+0]=x,f[b+1]=S,f[b+2]=w,f[b+3]=j},o=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,b,C,v,x,S,w=0,j=0,P=0,T=0,L,E=Math.sqrt(m*m+y*y);C=p-m,v=g-y,L=Math.sqrt(C*C+v*v),E=L>E?L:E;var O=g,F=p,_,R,D=0,$,G;for(C=0;C<p;C+=1)for(v=0;v<g;v+=1)x=C-m,S=v-y,_=Math.sqrt(x*x+S*S)*O/E,R=(Math.atan2(S,x)*180/Math.PI+360+D)%360,R=R*F/360,$=Math.floor(R),G=Math.floor(_),b=(G*p+$)*4,w=h[b+0],j=h[b+1],P=h[b+2],T=h[b+3],b=(v*p+C)*4,f[b+0]=w,f[b+1]=j,f[b+2]=P,f[b+3]=T};const a=function(l){var c=l.width,d=l.height,h,f,p,g,m,y,b,C,v,x,S=Math.round(this.kaleidoscopePower()),w=Math.round(this.kaleidoscopeAngle()),j=Math.floor(c*(w%360)/360);if(!(S<1)){var P=n.Util.createCanvasElement();P.width=c,P.height=d;var T=P.getContext("2d").getImageData(0,0,c,d);n.Util.releaseCanvas(P),i(l,T,{polarCenterX:c/2,polarCenterY:d/2});for(var L=c/Math.pow(2,S);L<=8;)L=L*2,S-=1;L=Math.ceil(L);var E=L,O=0,F=E,_=1;for(j+L>c&&(O=E,F=0,_=-1),f=0;f<d;f+=1)for(h=O;h!==F;h+=_)p=Math.round(h+j)%c,v=(c*f+p)*4,m=T.data[v+0],y=T.data[v+1],b=T.data[v+2],C=T.data[v+3],x=(c*f+h)*4,T.data[x+0]=m,T.data[x+1]=y,T.data[x+2]=b,T.data[x+3]=C;for(f=0;f<d;f+=1)for(E=Math.floor(L),g=0;g<S;g+=1){for(h=0;h<E+1;h+=1)v=(c*f+h)*4,m=T.data[v+0],y=T.data[v+1],b=T.data[v+2],C=T.data[v+3],x=(c*f+E*2-h-1)*4,T.data[x+0]=m,T.data[x+1]=y,T.data[x+2]=b,T.data[x+3]=C;E*=2}o(T,l,{})}};return dh.Kaleidoscope=a,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),dh}var hh={},K5;function Eoe(){if(K5)return hh;K5=1,Object.defineProperty(hh,"__esModule",{value:!0}),hh.Mask=void 0;const e=St(),t=Mn(),n=wt();function s(p,g,m){var y=(m*p.width+g)*4,b=[];return b.push(p.data[y++],p.data[y++],p.data[y++],p.data[y++]),b}function i(p,g){return Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2))}function o(p){for(var g=[0,0,0],m=0;m<p.length;m++)g[0]+=p[m][0],g[1]+=p[m][1],g[2]+=p[m][2];return g[0]/=p.length,g[1]/=p.length,g[2]/=p.length,g}function a(p,g){var m=s(p,0,0),y=s(p,p.width-1,0),b=s(p,0,p.height-1),C=s(p,p.width-1,p.height-1),v=g||10;if(i(m,y)<v&&i(y,C)<v&&i(C,b)<v&&i(b,m)<v){for(var x=o([y,m,C,b]),S=[],w=0;w<p.width*p.height;w++){var j=i(x,[p.data[w*4],p.data[w*4+1],p.data[w*4+2]]);S[w]=j<v?0:255}return S}}function l(p,g){for(var m=0;m<p.width*p.height;m++)p.data[4*m+3]=g[m]}function c(p,g,m){for(var y=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),v=[],x=0;x<m;x++)for(var S=0;S<g;S++){for(var w=x*g+S,j=0,P=0;P<b;P++)for(var T=0;T<b;T++){var L=x+P-C,E=S+T-C;if(L>=0&&L<m&&E>=0&&E<g){var O=L*g+E,F=y[P*b+T];j+=p[O]*F}}v[w]=j===255*8?255:0}return v}function d(p,g,m){for(var y=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),v=[],x=0;x<m;x++)for(var S=0;S<g;S++){for(var w=x*g+S,j=0,P=0;P<b;P++)for(var T=0;T<b;T++){var L=x+P-C,E=S+T-C;if(L>=0&&L<m&&E>=0&&E<g){var O=L*g+E,F=y[P*b+T];j+=p[O]*F}}v[w]=j>=255*4?255:0}return v}function h(p,g,m){for(var y=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),v=[],x=0;x<m;x++)for(var S=0;S<g;S++){for(var w=x*g+S,j=0,P=0;P<b;P++)for(var T=0;T<b;T++){var L=x+P-C,E=S+T-C;if(L>=0&&L<m&&E>=0&&E<g){var O=L*g+E,F=y[P*b+T];j+=p[O]*F}}v[w]=j}return v}const f=function(p){var g=this.threshold(),m=a(p,g);return m&&(m=c(m,p.width,p.height),m=d(m,p.width,p.height),m=h(m,p.width,p.height),l(p,m)),p};return hh.Mask=f,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),hh}var fh={},Z5;function Moe(){if(Z5)return fh;Z5=1,Object.defineProperty(fh,"__esModule",{value:!0}),fh.Noise=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=this.noise()*255,a=i.data,l=a.length,c=o/2,d;for(d=0;d<l;d+=4)a[d+0]+=c-2*c*Math.random(),a[d+1]+=c-2*c*Math.random(),a[d+2]+=c-2*c*Math.random()};return fh.Noise=s,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),fh}var ph={},Y5;function Poe(){if(Y5)return ph;Y5=1,Object.defineProperty(ph,"__esModule",{value:!0}),ph.Pixelate=void 0;const e=St(),t=In(),n=Mn(),s=wt(),i=function(o){var a=Math.ceil(this.pixelSize()),l=o.width,c=o.height,d,h,f,p,g,m,y,b=Math.ceil(l/a),C=Math.ceil(c/a),v,x,S,w,j,P,T,L=o.data;if(a<=0){t.Util.error("pixelSize value can not be <= 0");return}for(j=0;j<b;j+=1)for(P=0;P<C;P+=1){for(p=0,g=0,m=0,y=0,v=j*a,x=v+a,S=P*a,w=S+a,T=0,d=v;d<x;d+=1)if(!(d>=l))for(h=S;h<w;h+=1)h>=c||(f=(l*h+d)*4,p+=L[f+0],g+=L[f+1],m+=L[f+2],y+=L[f+3],T+=1);for(p=p/T,g=g/T,m=m/T,y=y/T,d=v;d<x;d+=1)if(!(d>=l))for(h=S;h<w;h+=1)h>=c||(f=(l*h+d)*4,L[f+0]=p,L[f+1]=g,L[f+2]=m,L[f+3]=y)}};return ph.Pixelate=i,e.Factory.addGetterSetter(n.Node,"pixelSize",8,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),ph}var gh={},X5;function Loe(){if(X5)return gh;X5=1,Object.defineProperty(gh,"__esModule",{value:!0}),gh.Posterize=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=Math.round(this.levels()*254)+1,a=i.data,l=a.length,c=255/o,d;for(d=0;d<l;d+=1)a[d]=Math.floor(a[d]/c)*c};return gh.Posterize=s,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),gh}var mh={},Q5;function Doe(){if(Q5)return mh;Q5=1,Object.defineProperty(mh,"__esModule",{value:!0}),mh.RGB=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h,f;for(h=0;h<a;h+=4)f=(.34*o[h]+.5*o[h+1]+.16*o[h+2])/255,o[h]=f*l,o[h+1]=f*c,o[h+2]=f*d,o[h+3]=o[h+3]};return mh.RGB=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),mh}var yh={},J5;function Roe(){if(J5)return yh;J5=1,Object.defineProperty(yh,"__esModule",{value:!0}),yh.RGBA=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h=this.alpha(),f,p;for(f=0;f<a;f+=4)p=1-h,o[f]=l*h+o[f]*p,o[f+1]=c*h+o[f+1]*p,o[f+2]=d*h+o[f+2]*p};return yh.RGBA=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),yh}var vh={},eI;function Ooe(){if(eI)return vh;eI=1,Object.defineProperty(vh,"__esModule",{value:!0}),vh.Sepia=void 0;const e=function(t){var n=t.data,s=n.length,i,o,a,l;for(i=0;i<s;i+=4)o=n[i+0],a=n[i+1],l=n[i+2],n[i+0]=Math.min(255,o*.393+a*.769+l*.189),n[i+1]=Math.min(255,o*.349+a*.686+l*.168),n[i+2]=Math.min(255,o*.272+a*.534+l*.131)};return vh.Sepia=e,vh}var bh={},tI;function Noe(){if(tI)return bh;tI=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.Solarize=void 0;const e=function(t){var n=t.data,s=t.width,i=t.height,o=s*4,a=i;do{var l=(a-1)*o,c=s;do{var d=l+(c-1)*4,h=n[d],f=n[d+1],p=n[d+2];h>127&&(h=255-h),f>127&&(f=255-f),p>127&&(p=255-p),n[d]=h,n[d+1]=f,n[d+2]=p}while(--c)}while(--a)};return bh.Solarize=e,bh}var xh={},nI;function Foe(){if(nI)return xh;nI=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.Threshold=void 0;const e=St(),t=Mn(),n=wt(),s=function(i){var o=this.threshold()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=1)a[c]=a[c]<o?0:255};return xh.Threshold=s,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),xh}var sI;function Boe(){if(sI)return Dd;sI=1,Object.defineProperty(Dd,"__esModule",{value:!0}),Dd.Konva=void 0;const e=ioe(),t=ooe(),n=loe(),s=coe(),i=uoe(),o=doe(),a=hoe(),l=SL(),c=Iw(),d=wL(),h=foe(),f=poe(),p=goe(),g=moe(),m=jL(),y=yoe(),b=voe(),C=boe(),v=xoe(),x=Coe(),S=Soe(),w=woe(),j=joe(),P=koe(),T=_oe(),L=Ioe(),E=Aoe(),O=Toe(),F=Eoe(),_=Moe(),R=Poe(),D=Loe(),$=Doe(),G=Roe(),ee=Ooe(),Q=Noe(),se=Foe();return Dd.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:n.Arrow,Circle:s.Circle,Ellipse:i.Ellipse,Image:o.Image,Label:a.Label,Tag:a.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:h.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:g.Star,Text:m.Text,TextPath:y.TextPath,Transformer:b.Transformer,Wedge:C.Wedge,Filters:{Blur:v.Blur,Brighten:x.Brighten,Contrast:S.Contrast,Emboss:w.Emboss,Enhance:j.Enhance,Grayscale:P.Grayscale,HSL:T.HSL,HSV:L.HSV,Invert:E.Invert,Kaleidoscope:O.Kaleidoscope,Mask:F.Mask,Noise:_.Noise,Pixelate:R.Pixelate,Posterize:D.Posterize,RGB:$.RGB,RGBA:G.RGBA,Sepia:ee.Sepia,Solarize:Q.Solarize,Threshold:se.Threshold}}),Dd}var $oe=Fm.exports,rI;function Voe(){if(rI)return Fm.exports;rI=1,Object.defineProperty($oe,"__esModule",{value:!0});const e=Boe();return Fm.exports=e.Konva,Fm.exports}var Goe=Voe();const Ne=Nu(Goe);var mb,iI;function zoe(){if(iI)return mb;iI=1;var e=function(n){var s=null,i,o=function(c){return function(){s=null,n.apply(c,i)}},a=function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];i=d,s===null&&(s=requestAnimationFrame(o(this)))};return a.cancel=function(){cancelAnimationFrame(s),s=null},a};return mb=e,mb}var Hoe=zoe();const kL=Nu(Hoe),Fg=new WeakMap;let Woe=0;function Nl(e){const t=typeof e,n=e&&e.constructor,s=n==Date;if(Object(e)===e&&!s&&n!=RegExp){let i=Fg.get(e);if(i)return i;i=++Woe+"~",Fg.set(e,i);let o;if(n==Array){for(i="@",o=0;o<e.length;o++)i+=Nl(e[o])+",";Fg.set(e,i)}else if(n==Object){i="#";const a=Object.keys(e).sort();for(;(o=a.pop())!==void 0;)e[o]!==void 0&&(i+=o+":"+Nl(e[o])+",");Fg.set(e,i)}return i}return s?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e}const Lo=class Lo extends Bt{constructor(n,s,i){super();k(this,"type");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"entityIdentifier");k(this,"selectIsTypeHidden");k(this,"selectIsSelected");k(this,"konva");k(this,"state");k(this,"subscriptions",new Set);k(this,"$isLocked",Oe(!1));k(this,"$isDisabled",Oe(!1));k(this,"$isEntityTypeHidden",Oe(!1));k(this,"$isEmpty",Oe(!0));k(this,"$canvasCache",Oe(null));k(this,"$isOnScreen",Oe(!0));k(this,"$intersectsBbox",Oe(!1));k(this,"selectState",pe(et,n=>Ga(n,this.entityIdentifier)));k(this,"selectPosition",pe(this.selectState,n=>n==null?void 0:n.position));k(this,"syncIsOnscreen",()=>{const n=this.manager.stage.getScaledStageRect(),s=this.checkIntersection(n),i=this.$isOnScreen.get();this.$isOnScreen.set(s),i!==s&&this.log.trace(`Moved ${s?"on-screen":"off-screen"}`),this.syncVisibility()});k(this,"syncIntersectsBbox",()=>{const n=this.manager.stateApi.getBbox().rect,s=this.checkIntersection(n),i=this.$intersectsBbox.get();this.$intersectsBbox.set(s),i!==s&&this.log.trace(`Moved ${s?"into bbox":"out of bbox"}`)});k(this,"checkIntersection",n=>{const s=this.transformer.$pixelRect.get(),i=this.manager.stateApi.runSelector(this.selectPosition);if(!i)return!1;const o={x:s.x+i.x,y:s.y+i.y,width:s.width,height:s.height},a=TK(n,o);return a.width>0&&a.height>0});k(this,"initialize",async()=>{this.log.debug("Initializing module"),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIsOnscreen)),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIntersectsBbox)),await this.sync(this.manager.stateApi.runSelector(this.selectState),void 0),this.transformer.initialize(),await this.renderer.initialize(),this.syncZIndices(),this.syncVisibility(),Lo.runInitCallbacks(this)});k(this,"syncZIndices",()=>{this.log.trace("Updating z-indices");let n=0;this.renderer.konva.objectGroup.zIndex(n++),this.bufferRenderer.konva.group.zIndex(n++),this.renderer.konva.compositing&&this.renderer.konva.compositing.group.zIndex(n++),this.transformer.konva.outlineRect.zIndex(n++),this.transformer.konva.proxyRect.zIndex(n++),this.transformer.konva.transformer.zIndex(n++)});k(this,"syncIsEnabled",()=>{this.log.trace("Updating visibility"),this.$isDisabled.set(!this.state.isEnabled),this.syncVisibility(),this.transformer.syncInteractionState()});k(this,"syncObjects",async()=>{this.$isEmpty.set(this.state.objects.length===0),await this.renderer.render()&&(this.transformer.requestRectCalculation(),this.transformer.syncInteractionState())});k(this,"syncPosition",()=>{this.transformer.updatePosition()});k(this,"syncOpacity",()=>{this.renderer.updateOpacity()});k(this,"syncVisibility",kL(()=>{if(this.manager.stateApi.runSelector(this.selectIsTypeHidden)){this.setVisibility(!1);return}if(this.manager.stateApi.runSelector(Yx)){const n=this.manager.stateApi.runSelector(On),s=nE(this.entityIdentifier);if(n&&!s){this.setVisibility(!1);return}}if(this.manager.stateApi.runSelector(c0)){const n=this.manager.stateApi.$filteringAdapter.get();if(n&&n!==this){this.setVisibility(!1);return}const s=this.manager.stateApi.$transformingAdapter.get();if(s&&s!==this&&!s.transformer.$silentTransform.get()){this.setVisibility(!1);return}const i=this.manager.stateApi.$segmentingAdapter.get();if(i&&i!==this){this.setVisibility(!1);return}}if(this.$isDisabled.get()){this.setVisibility(!1);return}if(!this.$isOnScreen.get()&&!this.manager.stateApi.getIsSelected(this.entityIdentifier.id)){this.setVisibility(!1);return}this.setVisibility(!0)}));k(this,"setVisibility",n=>{this.konva.layer.visible()!==n&&(this.log.trace(n?"Showing":"Hiding"),this.konva.layer.visible(n),n&&(this.renderer.updateCompositingRectSize(),this.renderer.updateCompositingRectPosition(),this.renderer.updateCompositingRectFill()),this.renderer.syncKonvaCache())});k(this,"syncIsLocked",()=>{this.$isLocked.set(this.state.isLocked),this.transformer.syncInteractionState()});k(this,"hash",n=>{const s={state:this.getHashableState(),extra:n};return Nl(s)});k(this,"cropToBbox",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=await Ls(()=>this.renderer.rasterize({rect:n,replaceObjects:!0,attrs:{opacity:1,filters:[]}}));if(s.isErr())throw ve({status:"error",title:"Failed to crop to bbox"}),s.error;return s.value});k(this,"destroy",()=>{var n;this.log.debug("Destroying module"),this.subscriptions.forEach(s=>s()),this.subscriptions.clear(),this.renderer.destroy(),this.transformer.$isTransforming.get()&&this.transformer.stopTransform(),this.transformer.destroy(),this.filterer&&(this.filterer.$isFiltering.get()&&this.filterer.cancel(),(n=this.filterer)==null||n.destroy()),this.segmentAnything&&(this.segmentAnything.$isSegmenting.get()&&this.segmentAnything.cancel(),this.segmentAnything.destroy()),this.konva.layer.destroy(),this.manager.deleteAdapter(this.entityIdentifier)});k(this,"repr",()=>{var n,s;return{id:this.id,type:this.type,path:this.path,entityIdentifier:this.entityIdentifier,state:bt(this.state),transformer:this.transformer.repr(),renderer:this.renderer.repr(),bufferRenderer:this.bufferRenderer.repr(),segmentAnything:((n=this.segmentAnything)==null?void 0:n.repr())??null,filterer:((s=this.filterer)==null?void 0:s.repr())??null,hasCache:this.$canvasCache.get()!==null,isLocked:this.$isLocked.get(),isDisabled:this.$isDisabled.get(),isEntityTypeHidden:this.$isEntityTypeHidden.get(),isEmpty:this.$isEmpty.get(),isOnScreen:this.$isOnScreen.get(),intersectsBbox:this.$intersectsBbox.get(),konva:ss(this.konva.layer)}});this.type=i,this.id=n.id,this.entityIdentifier=n,this.manager=s,this.parent=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ne.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1})},this.manager.stage.addLayer(this.konva.layer);const o=this.manager.stateApi.runSelector(this.selectState);Ge(o!==void 0,"Missing entity state on creation"),this.state=o,this.selectIsTypeHidden=IK(this.entityIdentifier.type),this.selectIsSelected=AK(this.entityIdentifier),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsTypeHidden,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(c0,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Yx,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(On,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$filteringAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$transformingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$segmentingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsSelected,this.syncVisibility)),this.subscriptions.add(this.$isDisabled.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isLocked.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isEntityTypeHidden.subscribe(this.manager.tool.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(pp,this.syncIntersectsBbox)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIntersectsBbox))}};k(Lo,"initCallbacks",new Set),k(Lo,"registerInitCallback",n=>{const s=async i=>{const o=await n(i);return o&&Lo.initCallbacks.delete(s),o};Lo.initCallbacks.add(s)}),k(Lo,"runInitCallbacks",n=>{for(const s of Lo.initCallbacks)s(n)});let Fl=Lo;const _L=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s}=e;s(xS({entityIdentifier:n,imageDTO:t}))},IL=e=>{const{imageDTO:t,entityIdentifier:n,referenceImageId:s,dispatch:i}=e;i(CS({entityIdentifier:n,referenceImageId:s,imageDTO:t}))},Uoe=e=>{const{imageDTO:t,dispatch:n}=e;n(u0(t))},qoe=e=>{const{imageDTO:t,fieldIdentifier:n,dispatch:s}=e;s(Xx({...n,value:t}))},Koe=e=>{const{imageDTO:t,dispatch:n}=e;n(gp(t))},Hr=e=>{const{type:t,imageDTO:n,dispatch:s,getState:i,overrides:o}=e,a=i(),l=Mi(n),{x:c,y:d}=pp(a),h={objects:[l],position:{x:c,y:d},...o};switch(t){case"raster_layer":{s($u({overrides:h,isSelected:!0}));break}case"control_layer":{s(fp({overrides:{...h,controlAdapter:bt(Xl)},isSelected:!0}));break}case"inpaint_mask":{s(W1({overrides:h,isSelected:!0}));break}case"regional_guidance":{s(Ra({overrides:h,isSelected:!0}));break}case"reference_image":{const f=bt(Ko(i()));f.image=Rl(n),s(U1({overrides:{ipAdapter:f},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const f=bt(Ko(i()));f.image=Rl(n);const p=[{id:_e("regional_guidance_reference_image"),ipAdapter:f}];s(Ra({overrides:{referenceImages:p},isSelected:!0}));break}}},Bg=e=>{const{type:t,imageDTO:n,withResize:s,dispatch:i,getState:o}=e,a=o(),l=EK(a),c=n.width/n.height,d=sE(l),{width:h,height:f}=MK(c,d**2,l),p=Mi(n),{x:g,y:m}=pp(a),y=b=>{Fl.registerInitCallback(async C=>C.id!==b?!1:(await C.transformer.startTransform({silent:!0}),C.transformer.fitToBboxFill(),await C.transformer.applyTransform(),!0))};switch(t){case"raster_layer":{const b={id:_e("raster_layer"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(yc()),i(Gh({x:0,y:0,width:h,height:f})),i($u({overrides:b,isSelected:!0}));break}case"control_layer":{const b={id:_e("control_layer"),objects:[p],position:{x:g,y:m},controlAdapter:bt(Xl)};s&&y(b.id),i(yc()),i(Gh({x:0,y:0,width:h,height:f})),i(fp({overrides:b,isSelected:!0}));break}case"inpaint_mask":{const b={id:_e("inpaint_mask"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(yc()),i(Gh({x:0,y:0,width:h,height:f})),i(W1({overrides:b,isSelected:!0}));break}case"regional_guidance":{const b={id:_e("regional_guidance"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(yc()),i(Gh({x:0,y:0,width:h,height:f})),i(Ra({overrides:b,isSelected:!0}));break}case"reference_image":{const b=bt(Ko(o()));b.image=Rl(n),i(yc()),i(U1({overrides:{ipAdapter:b},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const b=bt(Ko(o()));b.image=Rl(n);const C=[{id:_e("regional_guidance_reference_image"),ipAdapter:b}];i(yc()),i(Ra({overrides:{referenceImages:C},isSelected:!0}));break}default:Ge(!1)}},Aw=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s,getState:i}=e,o=Mi(t),{x:a,y:l}=pp(i());s(SS({entityIdentifier:n,imageObject:o,position:{x:a,y:l},replaceObjects:!0,isSelected:!0}))},oI=e=>{const{imageDTOs:t,boardId:n,dispatch:s}=e;s(wS.endpoints.addImagesToBoard.initiate({imageDTOs:t,board_id:n},{track:!1})),s(q1([]))},aI=e=>{const{imageDTOs:t,dispatch:n}=e;n(wS.endpoints.removeImagesFromBoard.initiate({imageDTOs:t},{track:!1})),n(q1([]))};var AL={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},lI=me.createContext&&me.createContext(AL),Zoe=["attr","size","title"];function Yoe(e,t){if(e==null)return{};var n=Xoe(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Xoe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function y0(){return y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},y0.apply(this,arguments)}function cI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function v0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cI(Object(n),!0).forEach(function(s){Qoe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Qoe(e,t,n){return t=Joe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Joe(e){var t=eae(e,"string");return typeof t=="symbol"?t:t+""}function eae(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function TL(e){return e&&e.map((t,n)=>me.createElement(t.tag,v0({key:n},t.attr),TL(t.child)))}function ue(e){return t=>me.createElement(tae,y0({attr:v0({},e.attr)},t),TL(e.child))}function tae(e){var t=n=>{var{attr:s,size:i,title:o}=e,a=Yoe(e,Zoe),l=i||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),me.createElement("svg",y0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,a,{className:c,style:v0(v0({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&me.createElement("title",null,o),e.children)};return lI!==void 0?me.createElement(lI.Consumer,null,n=>t(n)):t(AL)}function EL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function ML(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function nae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Di(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function sae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function rae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function iae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function oae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function aae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function Iy(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function PL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function lae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function b0(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function cae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function uae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},child:[]}]})(e)}function Ay(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function LL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function dae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function qa(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function hae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function fae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function pae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function ii(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function Tw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function Ty(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function DL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function Bp(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function gae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function mae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function RL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function yae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function an(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function OL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function vae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function bae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function NL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},child:[]}]})(e)}function FL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function ed(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function xae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function Cae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function BL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function $p(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function Sae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function wae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function jae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function $g(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function Lf(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function Ew(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function eo(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function Ey(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function $L(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function Vp(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function kae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function _ae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,116H219.22A92.21,92.21,0,0,0,140,36.78V16a12,12,0,0,0-24,0V36.78A92.21,92.21,0,0,0,36.78,116H16a12,12,0,0,0,0,24H36.78A92.21,92.21,0,0,0,116,219.22V240a12,12,0,0,0,24,0V219.22A92.21,92.21,0,0,0,219.22,140H240a12,12,0,0,0,0-24ZM128,196a68,68,0,1,1,68-68A68.07,68.07,0,0,1,128,196Zm0-112a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function VL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function Iae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function Aae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function wu(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function GL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function Tae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function td(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function Eae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function Mae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function Pae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Lae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.45,122.43l-30.08,30.06a12,12,0,0,1-17-17l30.08-30.07a36,36,0,0,0-50.93-50.92L120.48,84.59a12,12,0,0,1-17-17l30.07-30.06a60,60,0,0,1,84.87,84.88Zm-82.93,49-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Dae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function zL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function HL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function WL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function UL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function Rae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function Oae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,108A12,12,0,0,1,96,96h64a12,12,0,0,1,0,24H96A12,12,0,0,1,84,108Zm32,28H96a12,12,0,0,0,0,24h20a12,12,0,0,0,0-24ZM228,48V156.69a19.86,19.86,0,0,1-5.86,14.14l-51.31,51.31A19.86,19.86,0,0,1,156.69,228H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48ZM52,204h92V156a12,12,0,0,1,12-12h48V52H52Zm139-36H168v23Z"},child:[]}]})(e)}function Mw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function My(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function qL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Gt(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function KL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function ZL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function Nae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function Fae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function Bae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function $ae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function YL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function Vae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function Gae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function zae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,128a12,12,0,0,1-12,12H48a12,12,0,0,1,0-24h68A12,12,0,0,1,128,128ZM48,76H180a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24Zm52,104H48a12,12,0,0,0,0,24h52a12,12,0,0,0,0-24Zm132.49-20.49a12,12,0,0,0-17,0L196,179V112a12,12,0,0,0-24,0v67l-19.51-19.52a12,12,0,0,0-17,17l40,40a12,12,0,0,0,17,0l40-40A12,12,0,0,0,232.49,159.51Z"},child:[]}]})(e)}function Hae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M36,128a12,12,0,0,1,12-12h68a12,12,0,0,1,0,24H48A12,12,0,0,1,36,128ZM48,76h52a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24ZM180,180H48a12,12,0,0,0,0,24H180a12,12,0,0,0,0-24ZM232.49,79.51l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,0,0,17,17L172,77v67a12,12,0,0,0,24,0V77l19.51,19.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function Wae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function XL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function Pw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function qr(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function Lw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function ei(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function Gp(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function Py(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function Uae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M125.18,156.94a64,64,0,1,0-82.36,0,100.23,100.23,0,0,0-39.49,32,12,12,0,0,0,19.35,14.2,76,76,0,0,1,122.64,0,12,12,0,0,0,19.36-14.2A100.33,100.33,0,0,0,125.18,156.94ZM44,108a40,40,0,1,1,40,40A40,40,0,0,1,44,108Zm206.1,97.67a12,12,0,0,1-16.78-2.57A76.31,76.31,0,0,0,172,172a12,12,0,0,1,0-24,40,40,0,1,0-10.3-78.67,12,12,0,1,1-6.16-23.19,64,64,0,0,1,57.64,110.8,100.23,100.23,0,0,1,39.49,32A12,12,0,0,1,250.1,205.67Z"},child:[]}]})(e)}function zp(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function QL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function Nt(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function qae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function Kae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function Zae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function JL(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function Yae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function Dw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function Xae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function Qae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},child:[]}]})(e)}function nd(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function Ly(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function eD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function tD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function Jae(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM192,108.68,147.31,64l24-24L216,84.68Z"},child:[]}]})(e)}function nD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function ele(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function sD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M111.59,181.47A8,8,0,0,1,104,192H24a8,8,0,0,1-7.59-10.53l40-120a8,8,0,0,1,15.18,0ZM208,76a52,52,0,1,0-52,52A52.06,52.06,0,0,0,208,76Zm16,68H136a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h88a8,8,0,0,0,8-8V152A8,8,0,0,0,224,144Z"},child:[]}]})(e)}function tle(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212,200a36,36,0,1,1-69.85-12.25l-53-34.05a36,36,0,1,1,0-51.4l53-34a36.09,36.09,0,1,1,8.67,13.45l-53,34.05a36,36,0,0,1,0,24.5l53,34.05A36,36,0,0,1,212,200Z"},child:[]}]})(e)}function Rw(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M235.24,84.38l-28.06,23.68,8.56,35.39a13.34,13.34,0,0,1-5.09,13.91,13.54,13.54,0,0,1-15,.69L164,139l-31.65,19.06a13.51,13.51,0,0,1-15-.69,13.32,13.32,0,0,1-5.1-13.91l8.56-35.39L92.76,84.38a13.39,13.39,0,0,1,7.66-23.58l36.94-2.92,14.21-33.66a13.51,13.51,0,0,1,24.86,0l14.21,33.66,36.94,2.92a13.39,13.39,0,0,1,7.66,23.58ZM88.11,111.89a8,8,0,0,0-11.32,0L18.34,170.34a8,8,0,0,0,11.32,11.32l58.45-58.45A8,8,0,0,0,88.11,111.89Zm-.5,61.19L34.34,226.34a8,8,0,0,0,11.32,11.32l53.26-53.27a8,8,0,0,0-11.31-11.31Zm73-1-54.29,54.28a8,8,0,0,0,11.32,11.32l54.28-54.28a8,8,0,0,0-11.31-11.32Z"},child:[]}]})(e)}function Dy(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function Ow(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function nle(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function Ry(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function sle(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"},child:[]}]})(e)}function rD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,96a72,72,0,0,1-100.94,66L79,222.22c-.12.14-.26.29-.39.42a32,32,0,0,1-45.26-45.26c.14-.13.28-.27.43-.39L94,124.94a72.07,72.07,0,0,1,83.54-98.78,8,8,0,0,1,3.93,13.19L144,80l5.66,26.35L176,112l40.65-37.52a8,8,0,0,1,13.19,3.93A72.6,72.6,0,0,1,232,96Z"},child:[]}]})(e)}function rle(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.33,69.52a24,24,0,0,0-14.49-16.4C185.56,39.88,131,40,128,40s-57.56-.12-91.84,13.12a24,24,0,0,0-14.49,16.4C19.08,79.5,16,97.74,16,128s3.08,48.5,5.67,58.48a24,24,0,0,0,14.49,16.41C69,215.56,120.4,216,127.34,216h1.32c6.94,0,58.37-.44,91.18-13.11a24,24,0,0,0,14.49-16.41c2.59-10,5.67-28.22,5.67-58.48S236.92,79.5,234.33,69.52Zm-73.74,65-40,28A8,8,0,0,1,108,156V100a8,8,0,0,1,12.59-6.55l40,28a8,8,0,0,1,0,13.1Z"},child:[]}]})(e)}function uI(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M104,60A12,12,0,1,1,92,48,12,12,0,0,1,104,60Zm60,12a12,12,0,1,0-12-12A12,12,0,0,0,164,72ZM92,116a12,12,0,1,0,12,12A12,12,0,0,0,92,116Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,116ZM92,184a12,12,0,1,0,12,12A12,12,0,0,0,92,184Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,184Z"},child:[]}]})(e)}function dI(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M72,92A12,12,0,1,1,60,80,12,12,0,0,1,72,92Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,128,80Zm68,24a12,12,0,1,0-12-12A12,12,0,0,0,196,104ZM60,152a12,12,0,1,0,12,12A12,12,0,0,0,60,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,128,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,196,152Z"},child:[]}]})(e)}function ile(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function iD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function ole(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function oD(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}function ale(e){return ue({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}const Nw=Oe(null),lle=e=>Nw.set(e),yb=()=>Nw.set(null),aD=u.memo(()=>{kt("CanvasPasteModal");const{dispatch:e,getState:t}=jn(),{t:n}=M(),s=ce(Nw),i=Et(),o=I(Er),[a,{isLoading:l}]=rE({fixedCacheKey:"canvasPasteModal"}),c=u.useCallback(g=>{const{x:m,y}=i.stateApi.getBbox().rect;if(g==="bbox")return{x:m,y};const b=i.compositor.getVisibleAdaptersOfType("raster_layer");if(b.length===0)return{x:m,y};{const{x:C,y:v}=i.compositor.getRectOfAdapters(b);return{x:C,y:v}}},[i.compositor,i.stateApi]),d=u.useCallback(async(g,m)=>{try{const b=await a({file:g,is_intermediate:m!=="assets",image_category:"user",board_id:o==="none"?void 0:o}).unwrap();m!=="assets"&&Hr({type:"raster_layer",imageDTO:b,dispatch:e,getState:t,overrides:{position:c(m)}})}catch{ve({title:n("toast.pasteFailed"),status:"error"})}finally{yb(),ve({title:n("toast.pasteSuccess",{destination:n(m==="assets"?"controlLayers.pasteToAssets":m==="bbox"?"controlLayers.pasteToBbox":"controlLayers.pasteToCanvas")}),status:"success"})}},[o,e,c,t,n,a]),h=u.useCallback(()=>{s&&d(s,"assets")},[d,s]),f=u.useCallback(()=>{s&&d(s,"canvas")},[d,s]),p=u.useCallback(()=>{s&&d(s,"bbox")},[d,s]);return r.jsxs(ni,{isOpen:s!==null,onClose:yb,useInert:!1,isCentered:!0,size:"2xl",children:[r.jsx(nr,{}),r.jsxs(si,{children:[r.jsx(Mr,{children:n("controlLayers.pasteTo")}),r.jsx(yo,{}),r.jsx(sr,{display:"flex",justifyContent:"center",children:r.jsxs(A,{flexDir:"column",gap:4,w:"min-content",children:[r.jsx(ye,{size:"lg",onClick:f,isDisabled:l,leftIcon:r.jsx(wu,{}),children:n("controlLayers.pasteToCanvasDesc")}),r.jsx(ye,{size:"lg",onClick:p,isDisabled:l,leftIcon:r.jsx(qa,{}),children:n("controlLayers.pasteToBboxDesc")}),r.jsx(ye,{size:"lg",onClick:h,isDisabled:l,variant:"ghost",children:n("controlLayers.pasteToAssetsDesc")})]})}),r.jsx(vo,{children:r.jsx(ye,{onClick:yb,variant:"ghost",isLoading:l,children:n("common.cancel")})})]})]})});aD.displayName="CanvasPasteModal";const[lD]=Ql(!1),[cD]=Ql(!1),uD=()=>{const e=z(),t=Lt(),n=I(mp),s=lD(),i=u.useCallback(()=>{e(PK()),t.open(),e(Cr("gallery"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newGallerySessionImmediate:i,newGallerySessionWithDialog:o}},dD=()=>{const e=z(),t=Lt(),n=I(mp),s=cD(),i=u.useCallback(()=>{e(LK()),t.close(),e(Cr("layers"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newCanvasSessionImmediate:i,newCanvasSessionWithDialog:o}},hD=u.memo(()=>{kt("NewGallerySessionDialog");const{t:e}=M(),t=z(),n=lD(),{newGallerySessionImmediate:s}=uD(),i=I(mp),o=u.useCallback(()=>{t(jS())},[t]);return r.jsx(Tr,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newGallerySession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(A,{direction:"column",gap:3,children:[r.jsx(q,{children:e("controlLayers.newGallerySessionDesc")}),r.jsx(q,{children:e("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("common.dontAskMeAgain")}),r.jsx(kn,{isChecked:!i,onChange:o})]})]})})});hD.displayName="NewGallerySessionDialog";const fD=u.memo(()=>{kt("NewCanvasSessionDialog");const{t:e}=M(),t=z(),n=cD(),{newCanvasSessionImmediate:s}=dD(),i=I(mp),o=u.useCallback(()=>{t(jS())},[t]);return r.jsx(Tr,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newCanvasSession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(A,{direction:"column",gap:3,children:[r.jsx(q,{children:e("controlLayers.newCanvasSessionDesc")}),r.jsx(q,{children:e("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("common.dontAskMeAgain")}),r.jsx(kn,{isChecked:!i,onChange:o})]})]})})});fD.displayName="NewCanvasSessionDialog";const cle=e=>{const{t}=M(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:i=t("gallery.featuresWillReset")}=e;return!n||!ds(n)?null:r.jsxs(r.Fragment,{children:[r.jsx(q,{children:s}),r.jsxs(Pi,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&r.jsx(Vt,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&r.jsx(Vt,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&r.jsx(Vt,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&r.jsx(Vt,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&r.jsx(Vt,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&r.jsx(Vt,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&r.jsx(Vt,{children:t("ui.tabs.workflowsTab")})]}),r.jsx(q,{children:i})]})},pD=u.memo(cle),ule=tn([oE,lt,et,OK,hp],(e,t,n,s,i)=>{const{imagesToDelete:o}=e,a=(o??[]).map(({image_name:c})=>aE(t,n,i,c)),l={isUpscaleImage:ds(a,c=>c.isUpscaleImage),isRasterLayerImage:ds(a,c=>c.isRasterLayerImage),isInpaintMaskImage:ds(a,c=>c.isInpaintMaskImage),isRegionalGuidanceImage:ds(a,c=>c.isRegionalGuidanceImage),isNodesImage:ds(a,c=>c.isNodesImage),isControlLayerImage:ds(a,c=>c.isControlLayerImage),isReferenceImage:ds(a,c=>c.isReferenceImage)};return{imagesToDelete:o,imagesUsage:s,imageUsageSummary:l}}),dle=pe(K1,e=>e.shouldConfirmOnDelete),hle=pe(oE,e=>e.isModalOpen),fle=()=>{kt("DeleteImageModal");const e=z(),{t}=M(),n=I(dle),s=I(hle),{imagesToDelete:i,imagesUsage:o,imageUsageSummary:a}=I(ule),l=u.useCallback(h=>e(iE(!h.target.checked)),[e]),c=u.useCallback(()=>{e(i4()),e(DK(!1))},[e]),d=u.useCallback(()=>{!i.length||!o.length||(e(i4()),e(RK({imageDTOs:i,imagesUsage:o})))},[e,i,o]);return r.jsx(Tr,{title:t("gallery.deleteImage",{count:i.length}),isOpen:s,onClose:c,cancelButtonText:t("common.cancel"),acceptButtonText:t("common.delete"),acceptCallback:d,useInert:!1,children:r.jsxs(A,{direction:"column",gap:3,children:[r.jsx(pD,{imageUsage:a}),r.jsx(Pt,{}),r.jsx(q,{children:t("gallery.deleteImagePermanent")}),r.jsx(q,{children:t("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:t("common.dontAskMeAgain")}),r.jsx(at,{isChecked:!n,onChange:l})]})]})})},ple=u.memo(fle);function Hn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){t.forEach(function(i){return i()})}}function v2(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function gle(e){if(Array.isArray(e))return v2(e)}function mle(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gD(e,t){if(e){if(typeof e=="string")return v2(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v2(e,t):void 0}}function yle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Oy(e){return gle(e)||mle(e)||gD(e)||yle()}var vb={},Ch={},hI;function mD(){if(hI)return Ch;hI=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.bind=void 0;function e(t,n){var s=n.type,i=n.listener,o=n.options;return t.addEventListener(s,i,o),function(){t.removeEventListener(s,i,o)}}return Ch.bind=e,Ch}var ll={},fI;function vle(){if(fI)return ll;fI=1;var e=ll&&ll.__assign||function(){return e=Object.assign||function(o){for(var a,l=1,c=arguments.length;l<c;l++){a=arguments[l];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(o[d]=a[d])}return o},e.apply(this,arguments)};Object.defineProperty(ll,"__esModule",{value:!0}),ll.bindAll=void 0;var t=mD();function n(o){if(!(typeof o>"u"))return typeof o=="boolean"?{capture:o}:o}function s(o,a){if(a==null)return o;var l=e(e({},o),{options:e(e({},n(a)),n(o.options))});return l}function i(o,a,l){var c=a.map(function(d){var h=s(d,l);return(0,t.bind)(o,h)});return function(){c.forEach(function(h){return h()})}}return ll.bindAll=i,ll}var pI;function ble(){return pI||(pI=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=e.bind=void 0;var t=mD();Object.defineProperty(e,"bind",{enumerable:!0,get:function(){return t.bind}});var n=vle();Object.defineProperty(e,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}(vb)),vb}var fo=ble();function xle(e){if(Array.isArray(e))return e}function Cle(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,i,o,a,l=[],c=!0,d=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=o.call(n)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw i}}return l}}function Sle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fw(e,t){return xle(e)||Cle(e,t)||gD(e,t)||Sle()}var yD="data-pdnd-honey-pot";function vD(e){return e instanceof Element&&e.hasAttribute(yD)}function Bw(e){var t=document.elementsFromPoint(e.x,e.y),n=Fw(t,2),s=n[0],i=n[1];return s?vD(s)?i??null:s:null}function $w(e){var t=null;return function(){if(!t){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];var a=e.apply(this,i);t={result:a}}return t.result}}var bD=$w(function(){return navigator.userAgent.includes("Firefox")}),sd=$w(function(){var t=navigator,n=t.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),x0={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function wle(e){var t=e.dragEnter;return sd()?t.hasOwnProperty(x0.isEnteringWindow):!1}function jle(e){var t=e.dragLeave;return sd()?t.hasOwnProperty(x0.isLeavingWindow):!1}(function(){if(typeof window>"u"||!sd())return;function t(){return{enterCount:0,isOverWindow:!1}}var n=t();function s(){n=t()}fo.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:s},{type:"dragend",listener:s},{type:"dragenter",listener:function(o){!n.isOverWindow&&n.enterCount===0&&(o[x0.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(o){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(o[x0.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function kle(e){return"nodeName"in e}function xD(e){return kle(e)&&e.ownerDocument!==document}function _le(e){var t=e.dragLeave,n=t.type,s=t.relatedTarget;return n!=="dragleave"?!1:sd()?jle({dragLeave:t}):s==null?!0:bD()?xD(s):s instanceof HTMLIFrameElement}function Vw(e){var t=e.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}t()}}()},{type:"pointerdown",listener:t}]}function of(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var Ile=function(t){var n=[],s=null,i=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];n=l,!s&&(s=requestAnimationFrame(function(){s=null,t.apply(void 0,n)}))};return i.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},i},bb=Ile(function(e){return e()}),Vg=function(){var e=null;function t(s){var i=requestAnimationFrame(function(){e=null,s()});e={frameId:i,fn:s}}function n(){e&&(cancelAnimationFrame(e.frameId),e.fn(),e=null)}return{schedule:t,flush:n}}();function Ale(e){var t=e.source,n=e.initial,s=e.dispatchEvent,i={dropTargets:[]};function o(l){s(l),i={dropTargets:l.payload.location.current.dropTargets}}var a={start:function(c){var d=c.nativeSetDragImage,h={current:n,previous:i,initial:n};o({eventName:"onGenerateDragPreview",payload:{source:t,location:h,nativeSetDragImage:d}}),Vg.schedule(function(){o({eventName:"onDragStart",payload:{source:t,location:h}})})},dragUpdate:function(c){var d=c.current;Vg.flush(),bb.cancel(),o({eventName:"onDropTargetChange",payload:{source:t,location:{initial:n,previous:i,current:d}}})},drag:function(c){var d=c.current;bb(function(){Vg.flush();var h={initial:n,previous:i,current:d};o({eventName:"onDrag",payload:{source:t,location:h}})})},drop:function(c){var d=c.current,h=c.updatedSourcePayload;Vg.flush(),bb.cancel(),o({eventName:"onDrop",payload:{source:h??t,location:{current:d,previous:i,initial:n}}})}};return a}var b2={isActive:!1};function CD(){return!b2.isActive}function Tle(e){return e.dataTransfer?e.dataTransfer.setDragImage.bind(e.dataTransfer):null}function Ele(e){var t=e.current,n=e.next;if(t.length!==n.length)return!0;for(var s=0;s<t.length;s++)if(t[s].element!==n[s].element)return!0;return!1}function Mle(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=e.dispatchEvent;if(!CD())return;var o=Ple({event:t,dragType:n,getDropTargetsOver:s});b2.isActive=!0;var a={current:o};xb({event:t,current:o.dropTargets});var l=Ale({source:n.payload,dispatchEvent:i,initial:o});function c(g){var m=Ele({current:a.current.dropTargets,next:g.dropTargets});a.current=g,m&&l.dragUpdate({current:a.current})}function d(g){var m=of(g),y=vD(g.target)?Bw({x:m.clientX,y:m.clientY}):g.target,b=s({target:y,input:m,source:n.payload,current:a.current.dropTargets});b.length&&(g.preventDefault(),xb({event:g,current:b})),c({dropTargets:b,input:m})}function h(){a.current.dropTargets.length&&c({dropTargets:[],input:a.current.input}),l.drop({current:a.current,updatedSourcePayload:null}),f()}function f(){b2.isActive=!1,p()}var p=fo.bindAll(window,[{type:"dragover",listener:function(m){d(m),l.drag({current:a.current})}},{type:"dragenter",listener:d},{type:"dragleave",listener:function(m){_le({dragLeave:m})&&(c({input:a.current.input,dropTargets:[]}),n.startedFrom==="external"&&h())}},{type:"drop",listener:function(m){if(a.current={dropTargets:a.current.dropTargets,input:of(m)},!a.current.dropTargets.length){h();return}m.preventDefault(),xb({event:m,current:a.current.dropTargets}),l.drop({current:a.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(m):null}),f()}},{type:"dragend",listener:function(m){a.current={dropTargets:a.current.dropTargets,input:of(m)},h()}}].concat(Oy(Vw({onDragEnd:h}))),{capture:!0});l.start({nativeSetDragImage:Tle(t)})}function xb(e){var t,n=e.event,s=e.current,i=(t=s[0])===null||t===void 0?void 0:t.dropEffect;i!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=i)}function Ple(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=of(t);if(n.startedFrom==="external")return{input:i,dropTargets:[]};var o=s({input:i,source:n.payload,target:t.target,current:[]});return{input:i,dropTargets:o}}var gI={canStart:CD,start:Mle},x2=new Map;function Lle(e){var t=e.typeKey,n=e.mount,s=x2.get(t);if(s)return s.usageCount++,s;var i={typeKey:t,unmount:n(),usageCount:1};return x2.set(t,i),i}function Dle(e){var t=Lle(e);return function(){t.usageCount--,!(t.usageCount>0)&&(t.unmount(),x2.delete(e.typeKey))}}function Df(e){"@babel/helpers - typeof";return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Df(e)}function Rle(e,t){if(Df(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Df(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ole(e){var t=Rle(e,"string");return Df(t)=="symbol"?t:t+""}function Ci(e,t,n){return(t=Ole(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SD(e,t){var n=t.attribute,s=t.value;return e.setAttribute(n,s),function(){return e.removeAttribute(n)}}function mI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function la(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mI(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Cb(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Nle(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function Nle(e,t){if(e){if(typeof e=="string")return yI(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yI(e,t):void 0}}function yI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function Sb(e){return e.slice(0).reverse()}function Fle(e){var t=e.typeKey,n=e.defaultDropEffect,s=new WeakMap,i="data-drop-target-for-".concat(t),o="[".concat(i,"]");function a(g){return s.set(g.element,g),function(){return s.delete(g.element)}}function l(g){return Hn(SD(g.element,{attribute:i,value:"true"}),a(g))}function c(g){var m,y,b,C,v=g.source,x=g.target,S=g.input,w=g.result,j=w===void 0?[]:w;if(x==null)return j;if(!(x instanceof Element))return x instanceof Node?c({source:v,target:x.parentElement,input:S,result:j}):j;var P=x.closest(o);if(P==null)return j;var T=s.get(P);if(T==null)return j;var L={input:S,source:v,element:T.element};if(T.canDrop&&!T.canDrop(L))return c({source:v,target:T.element.parentElement,input:S,result:j});var E=(m=(y=T.getData)===null||y===void 0?void 0:y.call(T,L))!==null&&m!==void 0?m:{},O=(b=(C=T.getDropEffect)===null||C===void 0?void 0:C.call(T,L))!==null&&b!==void 0?b:n,F={data:E,element:T.element,dropEffect:O,isActiveDueToStickiness:!1};return c({source:v,target:T.element.parentElement,input:S,result:[].concat(Oy(j),[F])})}function d(g){var m=g.eventName,y=g.payload,b=Cb(y.location.current.dropTargets),C;try{for(b.s();!(C=b.n()).done;){var v,x=C.value,S=s.get(x.element),w=la(la({},y),{},{self:x});S==null||(v=S[m])===null||v===void 0||v.call(S,w)}}catch(j){b.e(j)}finally{b.f()}}var h={onGenerateDragPreview:d,onDrag:d,onDragStart:d,onDrop:d,onDropTargetChange:function(m){var y=m.payload,b=new Set(y.location.current.dropTargets.map(function(G){return G.element})),C=new Set,v=Cb(y.location.previous.dropTargets),x;try{for(v.s();!(x=v.n()).done;){var S,w=x.value;C.add(w.element);var j=s.get(w.element),P=b.has(w.element),T=la(la({},y),{},{self:w});if(j==null||(S=j.onDropTargetChange)===null||S===void 0||S.call(j,T),!P){var L;j==null||(L=j.onDragLeave)===null||L===void 0||L.call(j,T)}}}catch(G){v.e(G)}finally{v.f()}var E=Cb(y.location.current.dropTargets),O;try{for(E.s();!(O=E.n()).done;){var F,_,R=O.value;if(!C.has(R.element)){var D=la(la({},y),{},{self:R}),$=s.get(R.element);$==null||(F=$.onDropTargetChange)===null||F===void 0||F.call($,D),$==null||(_=$.onDragEnter)===null||_===void 0||_.call($,D)}}}catch(G){E.e(G)}finally{E.f()}}};function f(g){h[g.eventName](g)}function p(g){var m=g.source,y=g.target,b=g.input,C=g.current,v=c({source:m,target:y,input:b});if(v.length>=C.length)return v;for(var x=Sb(C),S=Sb(v),w=[],j=0;j<x.length;j++){var P,T=x[j],L=S[j];if(L!=null){w.push(L);continue}var E=w[j-1],O=x[j-1];if((E==null?void 0:E.element)!==(O==null?void 0:O.element))break;var F=s.get(T.element);if(!F)break;var _={input:b,source:m,element:F.element};if(F.canDrop&&!F.canDrop(_)||!((P=F.getIsSticky)!==null&&P!==void 0&&P.call(F,_)))break;w.push(la(la({},T),{},{isActiveDueToStickiness:!0}))}return Sb(w)}return{dropTargetForConsumers:l,getIsOver:p,dispatchEvent:f}}function Ble(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=$le(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function $le(e,t){if(e){if(typeof e=="string")return vI(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vI(e,t):void 0}}function vI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function bI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Vle(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bI(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Gle(){var e=new Set,t=null;function n(o){t&&(!o.canMonitor||o.canMonitor(t.canMonitorArgs))&&t.active.add(o)}function s(o){var a=Vle({},o);return e.add(a),n(a),function(){e.delete(a),t&&t.active.delete(a)}}function i(o){var a=o.eventName,l=o.payload;if(a==="onGenerateDragPreview"){t={canMonitorArgs:{initial:l.location.initial,source:l.source},active:new Set};var c=Ble(e),d;try{for(c.s();!(d=c.n()).done;){var h=d.value;n(h)}}catch(b){c.e(b)}finally{c.f()}}if(t){for(var f=Array.from(t.active),p=0,g=f;p<g.length;p++){var m=g[p];if(t.active.has(m)){var y;(y=m[a])===null||y===void 0||y.call(m,l)}}a==="onDrop"&&(t.active.clear(),t=null)}}return{dispatchEvent:i,monitorForConsumers:s}}function wD(e){var t=e.typeKey,n=e.mount,s=e.dispatchEventToSource,i=e.onPostDispatch,o=e.defaultDropEffect,a=Gle(),l=Fle({typeKey:t,defaultDropEffect:o});function c(f){s==null||s(f),l.dispatchEvent(f),a.dispatchEvent(f),i==null||i(f)}function d(f){var p=f.event,g=f.dragType;gI.start({event:p,dragType:g,getDropTargetsOver:l.getIsOver,dispatchEvent:c})}function h(){function f(){var p={canStart:gI.canStart,start:d};return n(p)}return Dle({typeKey:t,mount:f})}return{registerUsage:h,dropTarget:l.dropTargetForConsumers,monitor:a.monitorForConsumers}}var zle=$w(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),jD="pdnd:android-fallback";function Hle(e){var t=e.dragEnter,n=t.type,s=t.relatedTarget;return n!=="dragenter"?!1:sd()?wle({dragEnter:t}):s==null?!0:bD()?xD(s):s instanceof HTMLIFrameElement}var C2="text/plain",kD="application/vnd.pdnd";function Gw(e){var t=e.type,n=e.value;return!(t===kD||t===C2&&n===jD)}function Wle(e){return Array.from(e.types).filter(function(t){return Gw({type:t,value:e.getData(t)})})}function Ule(e){return Array.from(e.items).filter(function(t){return t.kind==="file"||Gw({type:t.type,value:e.getData(t.type)})})}var S2=!1,zw=wD({typeKey:"external",defaultDropEffect:"copy",mount:function(t){return fo.bind(window,{type:"dragenter",listener:function(s){if(!S2&&s.dataTransfer&&t.canStart(s)&&Hle({dragEnter:s})){var i=Wle(s.dataTransfer);if(i.length){var o={types:i,items:[],getStringData:function(){return null}};t.start({event:s,dragType:{type:"external",startedFrom:"external",payload:o,getDropPayload:function(l){if(!l.dataTransfer)return o;var c=Ule(l.dataTransfer),d=l.dataTransfer.getData.bind(l.dataTransfer);return{types:i,items:c,getStringData:function(f){if(!i.includes(f))return null;var p=d(f);return Gw({type:f,value:p})?p:null}}}}})}}}})}});function w2(e){return zw.dropTarget(e)}function af(e){return zw.monitor(e)}(function(){if(typeof window>"u")return;zw.registerUsage();var t={type:"idle"},n=t;function s(){n.type==="dragging"&&(S2=!1,n.cleanup(),n=t)}function i(){return fo.bindAll(window,[{type:"dragend",listener:s}].concat(Oy(Vw({onDragEnd:s}))),{capture:!0})}fo.bind(window,{type:"dragstart",listener:function(){n.type==="idle"&&(S2=!0,n={type:"dragging",cleanup:i()})},options:{capture:!0}})})();function xI(e){var t=e.source;return t.types.includes("Files")}function qle(e){var t=e.source;return t.items.filter(function(n){return n.kind==="file"}).map(function(n){return n.getAsFile()}).filter(function(n){return n!=null})}function CI(e){e.defaultPrevented||(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault())}var j2=null;function Kle(){Uh(),j2=fo.bindAll(window,[{type:"dragover",listener:CI},{type:"dragenter",listener:CI},{type:"drop",listener:function(t){t.preventDefault(),Uh()}},{type:"dragend",listener:Uh}].concat(Oy(Vw({onDragEnd:Uh}))),{capture:!1})}function Uh(){var e;(e=j2)===null||e===void 0||e(),j2=null}function Zle(){var e;if(((e=window.event)===null||e===void 0?void 0:e.type)==="drop"){var t;(t=window.event)===null||t===void 0||t.preventDefault()}Uh()}var SI={start:Kle,stop:Zle};const Yle={position:"absolute",top:0,right:0,bottom:0,left:0,color:"base.300",borderColor:"base.300",transitionProperty:"common",transitionDuration:"0.1s",".dnd-drop-overlay-backdrop":{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-content":{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderRadius:"base",borderStyle:"dashed",alignItems:"center",justifyContent:"center",borderColor:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-label":{fontSize:"lg",fontWeight:"semibold",textAlign:"center",color:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},'&[data-dnd-state="over"]':{color:"invokeYellow.300",borderColor:"invokeYellow.300"}},Rf=u.memo(e=>{const{dndState:t,label:n,withBackdrop:s=!0}=e;return t==="idle"?null:r.jsxs(A,{className:"dnd-drop-overlay","data-dnd-state":t,sx:Yle,children:[s&&r.jsx(A,{className:"dnd-drop-overlay-backdrop"}),r.jsxs(A,{className:"dnd-drop-overlay-content",children:[Tf(n)&&r.jsx(q,{className:"dnd-drop-overlay-label",children:n}),!qe(n)&&!Tf(n)&&n]})]})});Rf.displayName="DndDropOverlay";const Hp=e=>{const{boardName:t}=Zl({include_archived:!0},{selectFromResult:({data:n})=>{const s=n==null?void 0:n.find(o=>o.board_id===e);return{boardName:(s==null?void 0:s.board_name)||Te("boards.uncategorized")}}});return t},Xle=["image/png","image/jpg","image/jpeg"],Qle=[".png",".jpg",".jpeg"],wI=$e.custom().refine(e=>Xle.includes(e.type),e=>({message:`File type ${e.type} is not supported`})).refine(e=>Qle.some(t=>e.name.endsWith(t)),e=>({message:`File extension .${e.name.split(".").at(-1)} is not supported`})),Jle=e=>e===void 0?$e.array(wI):$e.array(wI).max(e),ece={position:"absolute",top:2,right:2,bottom:2,left:2,'&[data-dnd-state="idle"]':{pointerEvents:"none"}},_D=u.memo(()=>{const{t:e}=M(),t=u.useRef(null),n=I(kS),[s,i]=u.useState("idle"),o=I(En),a=ce(_S),l=u.useCallback(d=>{const{getState:h}=yp();if(!Jle(n).safeParse(d).success){const b=n===void 0?e("toast.uploadFailedInvalidUploadDesc"):e("toast.uploadFailedInvalidUploadDesc_withCount",{count:n});ve({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:b,status:"error"});return}const[g]=d;if(!a&&o==="canvas"&&d.length===1&&g){lle(g);return}const m=Er(h()),y=d.map((b,C)=>({file:b,image_category:"user",is_intermediate:!1,board_id:m==="none"?void 0:m,isFirstUploadOfBatch:C===0}));lE(y)},[o,a,n,e]),c=u.useCallback(d=>{var f;if(!((f=d.clipboardData)!=null&&f.files))return;const h=Array.from(d.clipboardData.files);l(h)},[l]);return u.useEffect(()=>{const d=t.current;if(d)return Hn(w2({element:d,canDrop:xI,onDrop:({source:h})=>{const f=qle({source:h});l(f)},onDragEnter:()=>{i("over")},onDragLeave:()=>{i("idle")}}),af({canMonitor:xI,onDragStart:()=>{i("potential"),SI.start()},onDrop:()=>{i("idle"),SI.stop()}}))},[l]),u.useEffect(()=>(window.addEventListener("paste",c),()=>{window.removeEventListener("paste",c)}),[c]),r.jsx(Se,{ref:t,"data-dnd-state":s,sx:ece,children:r.jsx(Rf,{dndState:s,label:r.jsx(ID,{})})})});_D.displayName="FullscreenDropzone";const ID=u.memo(()=>{const{t:e}=M(),t=I(Er),n=Hp(t);return r.jsxs(A,{flexDir:"column",gap:4,color:"base.100",alignItems:"center",children:[r.jsx(Rt,{size:"lg",children:e("gallery.dropToUpload")}),r.jsx(Rt,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})});ID.displayName="DropLabel";const wb=Oe(!1),AD=()=>{const e=ce(wb),t=u.useCallback(()=>{wb.set(!0)},[]),n=u.useCallback(()=>{wb.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},tce=""+new URL("commercial-license-bg-C_dHp7on.png",import.meta.url).href,nce=""+new URL("denoising-strength-4mznP2tj.png",import.meta.url).href,sce={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},inpainting:{href:"https://support.invoke.ai/support/solutions/articles/151000096702-inpainting-outpainting-and-bounding-box"},rasterLayer:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-raster-layers-and-initial-images"},regionalGuidance:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},regionalGuidanceAndReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},globalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},regionalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000179777-scale-before-processing"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image",image:nce},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},fluxDevLicense:{href:"https://www.invoke.com/get-a-commercial-license-for-flux",image:tce}},rce=1e3,ice=[{name:"preventOverflow",options:{padding:10}}],oce=pe(K1,e=>e.shouldEnableInformationalPopovers),Ve=u.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...i})=>{const o=I(oce),a=u.useMemo(()=>sce[e],[e]),l=u.useMemo(()=>cE(Ol(a,["image","href","buttonLabel"]),i),[a,i]);return!s&&!o?t:r.jsxs(Fn,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:rce,modifiers:ice,placement:"top",...l,children:[r.jsx(Un,{children:t}),n?r.jsx(za,{children:r.jsx(jI,{data:a,feature:e,hideDisable:s})}):r.jsx(jI,{data:a,feature:e,hideDisable:s})]})});Ve.displayName="InformationalPopover";const jI=({data:e,feature:t,hideDisable:n})=>{const{t:s}=M(),i=z(),o=u.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),a=u.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),l=u.useCallback(()=>{e!=null&&e.href&&window.open(e.href)},[e==null?void 0:e.href]),c=u.useCallback(()=>{i(uE(!1)),ve({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[i,s]);return r.jsxs(Bn,{maxW:300,children:[r.jsx(dE,{top:2}),r.jsx(qn,{children:r.jsxs(A,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[o&&r.jsxs(r.Fragment,{children:[r.jsx(Rt,{size:"sm",children:o}),r.jsx(Pt,{})]}),(e==null?void 0:e.image)&&r.jsxs(r.Fragment,{children:[r.jsx(dn,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),r.jsx(Pt,{})]}),a.map(d=>r.jsx(q,{children:d},d)),r.jsx(Pt,{}),r.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&r.jsx(ye,{onClick:c,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),r.jsx(rt,{}),(e==null?void 0:e.href)&&r.jsx(ye,{onClick:l,leftIcon:r.jsx(Iy,{}),variant:"link",size:"sm",children:s("common.learnMore")??o})]})]})})]})},ace=()=>{const e=I(NK),t=I(FK),n=I(BK),s=z(),{t:i}=M(),o=u.useCallback(a=>{s($K(a))},[s]);return r.jsxs(Z,{isDisabled:!n,children:[r.jsx(Ve,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:r.jsx(te,{children:i("dynamicPrompts.maxPrompts")})}),r.jsx(Ze,{min:t.sliderMin,max:t.sliderMax,value:e,defaultValue:t.initial,onChange:o,marks:!0}),r.jsx(Ae,{min:t.numberInputMin,max:t.numberInputMax,value:e,defaultValue:t.initial,onChange:o})]})},lce=u.memo(ace),cce=u.memo(e=>e.image?r.jsx(IS,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):r.jsx(A,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:r.jsx(rr,{size:"xl"})}));cce.displayName="IAILoadingImageFallback";const Ot=u.memo(e=>{const{icon:t=wu,boxSize:n=16,...s}=e;return r.jsxs(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&r.jsx(dt,{as:t,boxSize:n,opacity:.7}),e.label&&r.jsx(q,{textAlign:"center",children:e.label})]})});Ot.displayName="IAINoContentFallback";const Ny=u.memo(e=>{const{sx:t,...n}=e,s=u.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return r.jsxs(A,{sx:s,...n,children:[r.jsx(rr,{size:"xl"}),e.label&&r.jsx(q,{textAlign:"center",children:e.label})]})});Ny.displayName="IAINoContentFallbackWithSpinner";var TD=2147483647;function kI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function _I(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kI(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Of=2,II=Of/2;function uce(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}}function dce(e){return{x:e.x-II,y:e.y-II}}function hce(e){return{x:Math.max(e.x,0),y:Math.max(e.y,0)}}function fce(e){return{x:Math.min(e.x,window.innerWidth-Of),y:Math.min(e.y,window.innerHeight-Of)}}function AI(e){var t=e.client,n=fce(hce(dce(uce(t))));return DOMRect.fromRect({x:n.x,y:n.y,width:Of,height:Of})}function TI(e){var t=e.clientRect;return{left:"".concat(t.left,"px"),top:"".concat(t.top,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}function pce(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function gce(e){var t=e.initial,n=document.createElement("div");n.setAttribute(yD,"true");var s=AI({client:t});Object.assign(n.style,_I(_I({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},TI({clientRect:s})),{},{pointerEvents:"auto",zIndex:TD})),document.body.appendChild(n);var i=fo.bind(window,{type:"pointermove",listener:function(a){var l={x:a.clientX,y:a.clientY};s=AI({client:l}),Object.assign(n.style,TI({clientRect:s}))},options:{capture:!0}});return function(a){var l=a.current;if(i(),pce({client:l,clientRect:s})){n.remove();return}function c(){d(),n.remove()}var d=fo.bindAll(window,[{type:"pointerdown",listener:c},{type:"pointermove",listener:c},{type:"focusin",listener:c},{type:"focusout",listener:c},{type:"dragstart",listener:c},{type:"dragenter",listener:c},{type:"dragover",listener:c}],{capture:!0})}}function mce(){var e=null;function t(){return e=null,fo.bind(window,{type:"pointermove",listener:function(i){e={x:i.clientX,y:i.clientY}},options:{capture:!0}})}function n(){var s=null;return function(o){var a=o.eventName,l=o.payload;if(a==="onDragStart"){var c,d=l.location.initial.input,h=(c=e)!==null&&c!==void 0?c:{x:d.clientX,y:d.clientY};s=gce({initial:h})}if(a==="onDrop"){var f,p=l.location.current.input;(f=s)===null||f===void 0||f({current:{x:p.clientX,y:p.clientY}}),s=null,e=null}}}return{bindEvents:t,getOnPostDispatch:n}}var yce="text/uri-list",C0=new WeakMap;function vce(e){return C0.set(e.element,e),function(){C0.delete(e.element)}}var EI=mce(),Hw=wD({typeKey:"element",defaultDropEffect:"move",mount:function(t){return Hn(EI.bindEvents(),fo.bind(document,{type:"dragstart",listener:function(s){var i,o,a,l,c,d;if(t.canStart(s)&&!s.defaultPrevented&&s.dataTransfer){var h=s.target;if(!(h instanceof HTMLElement))return null;var f=C0.get(h);if(!f)return null;var p=of(s),g={element:f.element,dragHandle:(i=f.dragHandle)!==null&&i!==void 0?i:null,input:p};if(f.canDrag&&!f.canDrag(g))return s.preventDefault(),null;if(f.dragHandle){var m=Bw({x:p.clientX,y:p.clientY});if(!f.dragHandle.contains(m))return s.preventDefault(),null}var y=(o=(a=f.getInitialDataForExternal)===null||a===void 0?void 0:a.call(f,g))!==null&&o!==void 0?o:null;if(y)for(var b=0,C=Object.entries(y);b<C.length;b++){var v=Fw(C[b],2),x=v[0],S=v[1];s.dataTransfer.setData(x,S??"")}zle()&&!s.dataTransfer.types.includes(C2)&&!s.dataTransfer.types.includes(yce)&&s.dataTransfer.setData(C2,jD),s.dataTransfer.setData(kD,"");var w={element:f.element,dragHandle:(l=f.dragHandle)!==null&&l!==void 0?l:null,data:(c=(d=f.getInitialData)===null||d===void 0?void 0:d.call(f,g))!==null&&c!==void 0?c:{}},j={type:"element",payload:w,startedFrom:"internal"};t.start({event:s,dragType:j})}}}))},dispatchEventToSource:function(t){var n,s,i=t.eventName,o=t.payload;(n=C0.get(o.source.element))===null||n===void 0||(s=n[i])===null||s===void 0||s.call(n,o)},onPostDispatch:EI.getOnPostDispatch()}),ju=Hw.dropTarget,to=Hw.monitor;function rd(e){return Hn(Hw.registerUsage(),vce(e),SD(e.element,{attribute:"draggable",value:"true"}))}var Nf=new Map,Bm=new Set;function ED(e){bce(e);var t=Nf.get(e);if(t)return t;var n={timeOfEngagementStart:Date.now()};return Nf.set(e,n),n}function bce(e){Bm.add(e)}function xce(e){Bm.clear(),e(),Nf.forEach(function(t,n){Bm.has(n)||Nf.delete(n)}),Bm.clear()}function Cce(){Nf.clear()}var MI=new Map;function Sce(e){var t=MI.get(e);if(t)return t;var n=wce(e);return MI.set(e,n),n}function wce(e){var t={type:"idle"},n=[];function s(c){if(t.type==="running"){var d=c-t.timeLastFrameFinished,h=t,f=h.latestArgs,p=Bw({x:f.location.current.input.clientX,y:f.location.current.input.clientY});xce(function(){n.forEach(function(g){return g({underUsersPointer:p,latestArgs:f,timeSinceLastFrame:d})})}),t.timeLastFrameFinished=c,t.frameId=requestAnimationFrame(s)}}function i(){t.type!=="idle"&&(cancelAnimationFrame(t.frameId),Cce(),t={type:"idle"})}function o(c){t.type==="idle"&&(t={type:"initializing",latestArgs:c,frameId:requestAnimationFrame(function(d){t.type==="initializing"&&(t={type:"running",timeLastFrameFinished:d,latestArgs:t.latestArgs,frameId:requestAnimationFrame(s)})})})}function a(c){if(t.type==="idle"){o(c);return}t.latestArgs=c}e({onDragStart:o,onDropTargetChange:a,onDrag:a,onDrop:i});var l={onFrame:function(d){n.push(d)}};return l}var k2="data-auto-scrollable",jce="[".concat(k2,'="true"]');function kce(e){return e.setAttribute(k2,"true"),function(){return e.removeAttribute(k2)}}function PI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function LI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PI(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var _ce={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:300,maxMainAxisHitboxSize:180},Ice={standard:15*60,fast:25*60};function MD(e){var t;return LI(LI({},_ce),{},{maxPixelScrollPerSecond:Ice[(t=e==null?void 0:e.maxScrollSpeed)!==null&&t!==void 0?t:"standard"]})}var Ace={top:function(t){return t.scrollTop>0},right:function(t){return Math.ceil(t.scrollLeft)+t.clientWidth<t.scrollWidth},bottom:function(t){return Math.ceil(t.scrollTop)+t.clientHeight<t.scrollHeight},left:function(t){return t.scrollLeft>0}},Tce=["top","right","bottom","left"],Ece={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},DI={start:"top",end:"bottom",point:"y",size:"height"},RI={start:"left",end:"right",point:"x",size:"width"},PD={vertical:{mainAxis:DI,crossAxis:RI},horizontal:{mainAxis:RI,crossAxis:DI}},Ww={top:"start",right:"end",bottom:"end",left:"start"};function Gg(e){var t=e.edge,n=e.axis;return function(i){var o,a=i.clientRect,l=i.config,c=PD[n],d=c.mainAxis,h=c.crossAxis,f=Ww[t],p=Math.min(l.startHitboxAtPercentageRemainingOfElement[t]*a[d.size],l.maxMainAxisHitboxSize);return DOMRect.fromRect((o={},Ci(o,d.point,f==="start"?a[d.point]:a[d.point]+a[d.size]-p),Ci(o,h.point,a[h.point]),Ci(o,d.size,p),Ci(o,h.size,a[h.size]),o))}}var Mce={top:Gg({axis:"vertical",edge:"top"}),right:Gg({axis:"horizontal",edge:"right"}),bottom:Gg({axis:"vertical",edge:"bottom"}),left:Gg({axis:"horizontal",edge:"left"})};function _2(e){var t=e.startOfRange,n=e.endOfRange,s=e.value,i=t<n;if(!i||s<t)return 0;if(s>n)return 1;var o=n-t;return(s-t)/o}function Pce(e){var t=e.timeSinceLastFrame,n=e.config,s=n.maxPixelScrollPerSecond/1e3,i=Math.ceil(s*t),o=n.maxPixelScrollPerSecond/60;return Math.min(i,o)}function Lce(e){var t=e.client,n=e.axis,s=e.edge,i=e.hitbox,o=e.config,a=PD[n].mainAxis,l=Ww[s],c=i[a.size]*o.maxScrollAtPercentageRemainingOfHitbox[s];if(l==="end")return _2({startOfRange:i[a.start],endOfRange:i[a.end]-c,value:t[a.point]});var d=_2({startOfRange:i[a.start]+c,endOfRange:i[a.end],value:t[a.point]});return 1-d}function zg(e){var t=e.client,n=e.timeSinceLastFrame,s=e.engagement,i=e.axis,o=e.hitbox,a=e.edge,l=e.isDistanceDampeningEnabled,c=e.config,d=Pce({timeSinceLastFrame:n,config:c}),h=l?Lce({client:t,edge:a,hitbox:o,axis:i,config:c}):1,f=_2({startOfRange:s.timeOfEngagementStart,endOfRange:s.timeOfEngagementStart+c.timeDampeningDurationMs,value:Date.now()}),p=h*f,g=Math.max(d*p,1),m=Ww[a];return m==="end"?g:-1*g}function Dce(e,t){return t==="all"||e===t}function Rce(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function Oce(e){return e.getBoundingClientRect()}function LD(e){var t=e.element,n=e.input,s=e.timeSinceLastFrame,i=e.engagement,o=e.config,a=e.allowedAxis,l=e.getRect,c=l===void 0?Oce:l,d={x:n.clientX,y:n.clientY},h=c(t),f=Tce.reduce(function(m,y){var b=Mce[y]({clientRect:h,config:o}),C=Ece[y];return!Dce(C,a)||!Rce({client:d,clientRect:b})||!Ace[y](t)||m.set(y,{edge:y,hitbox:b}),m},new Map),p=function(){var m="horizontal",y=f.get("left");if(y)return zg({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=f.get("right");return b?zg({client:d,edge:b.edge,hitbox:b.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}(),g=function(){var m="vertical",y=f.get("bottom");if(y)return zg({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=f.get("top");return b?zg({client:d,edge:b.edge,hitbox:b.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}();return{left:p,top:g}}function Nce(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Fce(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return o=d.done,d},e:function(d){a=!0,l=d},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw l}}}}function Fce(e,t){if(e){if(typeof e=="string")return OI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OI(e,t)}}function OI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function DD(e){return!!(e.top||e.left)}function RD(e){var t,n,s,i=e.target,o=e.input,a=e.source,l=e.findEntry,c=e.timeSinceLastFrame,d=e.available,h=d===void 0?{top:!0,left:!0}:d;if(!DD(h)||!i)return h;var f=i.closest(jce);if(!f)return h;var p=l(f);if(!p)return h;function g(){var S;return RD({target:(S=f==null?void 0:f.parentElement)!==null&&S!==void 0?S:null,findEntry:l,source:a,timeSinceLastFrame:c,input:o,available:h})}var m={input:o,source:a,element:f};if(p.canScroll&&!p.canScroll(m))return g();var y=ED(f),b=MD((t=p.getConfiguration)===null||t===void 0?void 0:t.call(p,m)),C=(n=(s=p.getAllowedAxis)===null||s===void 0?void 0:s.call(p,m))!==null&&n!==void 0?n:"all",v=LD({element:f,engagement:y,input:o,timeSinceLastFrame:c,allowedAxis:C,config:b}),x={top:0,left:0};return h.top&&v.top!==0&&(x.top=v.top,h.top=!1),h.left&&v.left!==0&&(x.left=v.left,h.left=!1),(x.top!==0||x.left!==0)&&f.scrollBy(x),g()}function Bce(e){var t=e.input,n=e.timeSinceLastFrame,s=e.available,i=e.source,o=e.entries,a=document.documentElement,l={input:t,source:i,element:a},c=Nce(o),d;try{for(c.s();!(d=c.n()).done;){var h,f,p,g=d.value;if(!(g.canScroll&&!g.canScroll(l))){var m=ED(a),y=MD((h=g.getConfiguration)===null||h===void 0?void 0:h.call(g,l)),b=(f=(p=g.getAllowedAxis)===null||p===void 0?void 0:p.call(g,l))!==null&&f!==void 0?f:"all",C=LD({element:a,engagement:m,input:t,config:y,allowedAxis:b,getRect:function(S){return DOMRect.fromRect({y:0,x:0,width:S.clientWidth,height:S.clientHeight})},timeSinceLastFrame:n}),v={top:s.top?C.top:0,left:s.left?C.left:0};(v.top!==0||v.left!==0)&&a.scrollBy(v);break}}}catch(x){c.e(x)}finally{c.f()}}function $ce(e){var t=e.input,n=e.findEntry,s=e.timeSinceLastFrame,i=e.source,o=e.getWindowScrollEntries,a=e.underUsersPointer,l=RD({target:a,timeSinceLastFrame:s,input:t,source:i,findEntry:n});DD(l)&&Bce({input:t,source:i,entries:o(),timeSinceLastFrame:s,available:l})}function NI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Vce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NI(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function OD(e){var t=e.monitor,n=new Map,s=new Set;function i(d){return n.set(d.element,d),Hn(kce(d.element),function(){return n.delete(d.element)})}function o(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=Vce({},d);return s.add(h),function(){return s.delete(h)}}function a(d){var h;return(h=n.get(d))!==null&&h!==void 0?h:null}function l(){return Array.from(s)}function c(d){var h=d.latestArgs,f=d.underUsersPointer,p=d.timeSinceLastFrame;$ce({input:h.location.current.input,source:h.source,findEntry:a,underUsersPointer:f,timeSinceLastFrame:p,getWindowScrollEntries:l})}return Sce(t).onFrame(c),{autoScroll:i,autoScrollWindow:o}}var Gce=OD({monitor:to}),Uw=Gce.autoScroll,zce=OD({monitor:af}),ND=zce.autoScroll;/*!
 * OverlayScrollbars
 * Version: 2.10.0
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const fr=(e,t)=>{const{o:n,i:s,u:i}=e;let o=n,a;const l=(h,f)=>{const p=o,g=h,m=f||(s?!s(p,g):p!==g);return(m||i)&&(o=g,a=p),[o,m,a]};return[t?h=>l(t(o,a),h):l,h=>[o,!!h,a]]},Hce=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,Qs=Hce?window:{},S0=Math.max,Wce=Math.min,I2=Math.round,w0=Math.abs,FI=Math.sign,qw=Qs.cancelAnimationFrame,Fy=Qs.requestAnimationFrame,j0=Qs.setTimeout,A2=Qs.clearTimeout,By=e=>typeof Qs[e]<"u"?Qs[e]:void 0,Uce=By("MutationObserver"),BI=By("IntersectionObserver"),k0=By("ResizeObserver"),$m=By("ScrollTimeline"),Kw=e=>e===void 0,$y=e=>e===null,no=e=>typeof e=="number",Wp=e=>typeof e=="string",Zw=e=>typeof e=="boolean",_r=e=>typeof e=="function",po=e=>Array.isArray(e),_0=e=>typeof e=="object"&&!po(e)&&!$y(e),Yw=e=>{const t=!!e&&e.length,n=no(t)&&t>-1&&t%1==0;return po(e)||!_r(e)&&n?t>0&&_0(e)?t-1 in e:!0:!1},I0=e=>!!e&&e.constructor===Object,A0=e=>e instanceof HTMLElement,Vy=e=>e instanceof Element,$I=()=>performance.now(),jb=(e,t,n,s,i)=>{let o=0;const a=$I(),l=S0(0,n),c=d=>{const h=$I(),p=h-a>=l,g=d?1:1-(S0(0,a+l-h)/l||0),m=(t-e)*(_r(i)?i(g,g*l,0,1,l):g)+e,y=p||g===1;s&&s(m,g,y),o=y?0:Fy(()=>c())};return c(),d=>{qw(o),d&&c(d)}};function Wt(e,t){if(Yw(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Wt(Object.keys(e),n=>t(e[n],n,e));return e}const FD=(e,t)=>e.indexOf(t)>=0,Ff=(e,t)=>e.concat(t),vn=(e,t,n)=>(!Wp(t)&&Yw(t)?Array.prototype.push.apply(e,t):e.push(t),e),Ka=e=>Array.from(e||[]),Xw=e=>po(e)?e:!Wp(e)&&Yw(e)?Ka(e):[e],T2=e=>!!e&&!e.length,E2=e=>Ka(new Set(e)),Sr=(e,t,n)=>{Wt(e,i=>i?i.apply(void 0,t||[]):!0),!n&&(e.length=0)},BD="paddingTop",$D="paddingRight",VD="paddingLeft",GD="paddingBottom",zD="marginLeft",HD="marginRight",WD="marginBottom",UD="overflowX",qD="overflowY",Gy="width",zy="height",va="visible",xl="hidden",ku="scroll",qce=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},Hy=(e,t,n,s)=>{if(e&&t){let i=!0;return Wt(n,o=>{const a=e[o],l=t[o];a!==l&&(i=!1)}),i}return!1},KD=(e,t)=>Hy(e,t,["w","h"]),Vm=(e,t)=>Hy(e,t,["x","y"]),Kce=(e,t)=>Hy(e,t,["t","r","b","l"]),Ma=()=>{},nt=(e,...t)=>e.bind(0,...t),Cl=e=>{let t;const n=e?j0:Fy,s=e?A2:qw;return[i=>{s(t),t=n(()=>i(),_r(e)?e():e)},()=>s(t)]},M2=(e,t)=>{const{_:n,v:s,p:i,S:o}=t||{};let a,l,c,d,h=Ma;const f=function(b){h(),A2(a),d=a=l=void 0,h=Ma,e.apply(this,b)},p=y=>o&&l?o(l,y):y,g=()=>{h!==Ma&&f(p(c)||c)},m=function(){const b=Ka(arguments),C=_r(n)?n():n;if(no(C)&&C>=0){const x=_r(s)?s():s,S=no(x)&&x>=0,w=C>0?j0:Fy,j=C>0?A2:qw,T=p(b)||b,L=f.bind(0,T);let E;h(),i&&!d?(L(),d=!0,E=w(()=>d=void 0,C)):(E=w(L,C),S&&!a&&(a=j0(g,x))),h=()=>j(E),l=c=T}else f(b)};return m.m=g,m},ZD=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ai=e=>e?Object.keys(e):[],Mt=(e,t,n,s,i,o,a)=>{const l=[t,n,s,i,o,a];return(typeof e!="object"||$y(e))&&!_r(e)&&(e={}),Wt(l,c=>{Wt(c,(d,h)=>{const f=c[h];if(e===f)return!0;const p=po(f);if(f&&I0(f)){const g=e[h];let m=g;p&&!po(g)?m=[]:!p&&!I0(g)&&(m={}),e[h]=Mt(m,f)}else e[h]=p?f.slice():f})}),e},YD=(e,t)=>Wt(Mt({},e),(n,s,i)=>{n===void 0?delete i[s]:n&&I0(n)&&(i[s]=YD(n))}),Qw=e=>!Ai(e).length,XD=(e,t,n)=>S0(e,Wce(t,n)),El=e=>E2((po(e)?e:(e||"").split(" ")).filter(t=>t)),Jw=(e,t)=>e&&e.getAttribute(t),VI=(e,t)=>e&&e.hasAttribute(t),Mo=(e,t,n)=>{Wt(El(t),s=>{e&&e.setAttribute(s,String(n||""))})},Vi=(e,t)=>{Wt(El(t),n=>e&&e.removeAttribute(n))},Wy=(e,t)=>{const n=El(Jw(e,t)),s=nt(Mo,e,t),i=(o,a)=>{const l=new Set(n);return Wt(El(o),c=>{l[a](c)}),Ka(l).join(" ")};return{O:o=>s(i(o,"delete")),$:o=>s(i(o,"add")),C:o=>{const a=El(o);return a.reduce((l,c)=>l&&n.includes(c),a.length>0)}}},QD=(e,t,n)=>(Wy(e,t).O(n),nt(ej,e,t,n)),ej=(e,t,n)=>(Wy(e,t).$(n),nt(QD,e,t,n)),T0=(e,t,n,s)=>(s?ej:QD)(e,t,n),tj=(e,t,n)=>Wy(e,t).C(n),JD=e=>Wy(e,"class"),eR=(e,t)=>{JD(e).O(t)},nj=(e,t)=>(JD(e).$(t),nt(eR,e,t)),tR=(e,t)=>{const n=t?Vy(t)&&t:document;return n?Ka(n.querySelectorAll(e)):[]},Zce=(e,t)=>{const n=t?Vy(t)&&t:document;return n&&n.querySelector(e)},P2=(e,t)=>Vy(e)&&e.matches(t),nR=e=>P2(e,"body"),L2=e=>e?Ka(e.childNodes):[],Bf=e=>e&&e.parentElement,qc=(e,t)=>Vy(e)&&e.closest(t),D2=e=>document.activeElement,Yce=(e,t,n)=>{const s=qc(e,t),i=e&&Zce(n,s),o=qc(i,t)===s;return s&&i?s===e||i===e||o&&qc(qc(e,n),t)!==s:!1},_u=e=>{Wt(Xw(e),t=>{const n=Bf(t);t&&n&&n.removeChild(t)})},yr=(e,t)=>nt(_u,e&&t&&Wt(Xw(t),n=>{n&&e.appendChild(n)})),lu=e=>{const t=document.createElement("div");return Mo(t,"class",e),t},sR=e=>{const t=lu();return t.innerHTML=e.trim(),Wt(L2(t),n=>_u(n))},GI=(e,t)=>e.getPropertyValue(t)||e[t]||"",rR=e=>{const t=e||0;return isFinite(t)?t:0},Hg=e=>rR(parseFloat(e||"")),R2=e=>Math.round(e*1e4)/1e4,iR=e=>`${R2(rR(e))}px`;function $f(e,t){e&&t&&Wt(t,(n,s)=>{try{const i=e.style,o=$y(n)||Zw(n)?"":no(n)?iR(n):n;s.indexOf("--")===0?i.setProperty(s,o):i[s]=o}catch{}})}function Zo(e,t,n){const s=Wp(t);let i=s?"":{};if(e){const o=Qs.getComputedStyle(e,n)||e.style;i=s?GI(o,t):Ka(t).reduce((a,l)=>(a[l]=GI(o,l),a),i)}return i}const zI=(e,t,n)=>{const s=t?`${t}-`:"",i=n?`-${n}`:"",o=`${s}top${i}`,a=`${s}right${i}`,l=`${s}bottom${i}`,c=`${s}left${i}`,d=Zo(e,[o,a,l,c]);return{t:Hg(d[o]),r:Hg(d[a]),b:Hg(d[l]),l:Hg(d[c])}},Xce=(e,t)=>`translate${_0(e)?`(${e.x},${e.y})`:`Y(${e})`}`,Qce=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),Jce={w:0,h:0},Uy=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:Jce,eue=e=>Uy("inner",e||Qs),cu=nt(Uy,"offset"),oR=nt(Uy,"client"),E0=nt(Uy,"scroll"),sj=e=>{const t=parseFloat(Zo(e,Gy))||0,n=parseFloat(Zo(e,zy))||0;return{w:t-I2(t),h:n-I2(n)}},kb=e=>e.getBoundingClientRect(),tue=e=>!!e&&Qce(e),O2=e=>!!(e&&(e[zy]||e[Gy])),aR=(e,t)=>{const n=O2(e);return!O2(t)&&n},HI=(e,t,n,s)=>{Wt(El(t),i=>{e&&e.removeEventListener(i,n,s)})},un=(e,t,n,s)=>{var i;const o=(i=s&&s.H)!=null?i:!0,a=s&&s.I||!1,l=s&&s.A||!1,c={passive:o,capture:a};return nt(Sr,El(t).map(d=>{const h=l?f=>{HI(e,d,h,a),n&&n(f)}:n;return e&&e.addEventListener(d,h,c),nt(HI,e,d,h,a)}))},lR=e=>e.stopPropagation(),N2=e=>e.preventDefault(),cR=e=>lR(e)||N2(e),Yi=(e,t)=>{const{x:n,y:s}=no(t)?{x:t,y:t}:t||{};no(n)&&(e.scrollLeft=n),no(s)&&(e.scrollTop=s)},vr=e=>({x:e.scrollLeft,y:e.scrollTop}),uR=()=>({D:{x:0,y:0},M:{x:0,y:0}}),nue=(e,t)=>{const{D:n,M:s}=e,{w:i,h:o}=t,a=(f,p,g)=>{let m=FI(f)*g,y=FI(p)*g;if(m===y){const b=w0(f),C=w0(p);y=b>C?0:y,m=b<C?0:m}return m=m===y?0:m,[m+0,y+0]},[l,c]=a(n.x,s.x,i),[d,h]=a(n.y,s.y,o);return{D:{x:l,y:d},M:{x:c,y:h}}},WI=({D:e,M:t})=>{const n=(s,i)=>s===0&&s<=i;return{x:n(e.x,t.x),y:n(e.y,t.y)}},UI=({D:e,M:t},n)=>{const s=(i,o,a)=>XD(0,1,(i-a)/(i-o)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},F2=e=>{e&&e.focus&&e.focus({preventScroll:!0})},qI=(e,t)=>{Wt(Xw(t),e)},B2=e=>{const t=new Map,n=(o,a)=>{if(o){const l=t.get(o);qI(c=>{l&&l[c?"delete":"clear"](c)},a)}else t.forEach(l=>{l.clear()}),t.clear()},s=(o,a)=>{if(Wp(o)){const d=t.get(o)||new Set;return t.set(o,d),qI(h=>{_r(h)&&d.add(h)},a),nt(n,o,a)}Zw(a)&&a&&n();const l=Ai(o),c=[];return Wt(l,d=>{const h=o[d];h&&vn(c,s(d,h))}),nt(Sr,c)},i=(o,a)=>{Wt(Ka(t.get(o)),l=>{a&&!T2(a)?l.apply(0,a):l()})};return s(e||{}),[s,n,i]},KI=e=>JSON.stringify(e,(t,n)=>{if(_r(n))throw 0;return n}),ZI=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&ZD(n,s)?n[s]:void 0,e):void 0,sue={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},dR=(e,t)=>{const n={},s=Ff(Ai(t),Ai(e));return Wt(s,i=>{const o=e[i],a=t[i];if(_0(o)&&_0(a))Mt(n[i]={},dR(o,a)),Qw(n[i])&&delete n[i];else if(ZD(t,i)&&a!==o){let l=!0;if(po(o)||po(a))try{KI(o)===KI(a)&&(l=!1)}catch{}l&&(n[i]=a)}}),n},YI=(e,t,n)=>s=>[ZI(e,s),n||ZI(t,s)!==void 0],id="data-overlayscrollbars",Gm="os-environment",Wg=`${Gm}-scrollbar-hidden`,_b=`${id}-initialize`,zm="noClipping",XI=`${id}-body`,Pa=id,rue="host",Po=`${id}-viewport`,iue=UD,oue=qD,aue="arrange",hR="measuring",lue="scrolling",fR="scrollbarHidden",cue="noContent",$2=`${id}-padding`,QI=`${id}-content`,rj="os-size-observer",uue=`${rj}-appear`,due=`${rj}-listener`,hue="os-trinsic-observer",fue="os-theme-none",Lr="os-scrollbar",pue=`${Lr}-rtl`,gue=`${Lr}-horizontal`,mue=`${Lr}-vertical`,pR=`${Lr}-track`,ij=`${Lr}-handle`,yue=`${Lr}-visible`,vue=`${Lr}-cornerless`,JI=`${Lr}-interaction`,e6=`${Lr}-unusable`,V2=`${Lr}-auto-hide`,t6=`${V2}-hidden`,n6=`${Lr}-wheel`,bue=`${pR}-interactive`,xue=`${ij}-interactive`;let gR;const Cue=()=>gR,Sue=e=>{gR=e};let Ib;const wue=()=>{const e=(S,w,j)=>{yr(document.body,S),yr(document.body,S);const P=oR(S),T=cu(S),L=sj(w);return j&&_u(S),{x:T.h-P.h+L.h,y:T.w-P.w+L.w}},t=S=>{let w=!1;const j=nj(S,Wg);try{w=Zo(S,"scrollbar-width")==="none"||Zo(S,"display","::-webkit-scrollbar")==="none"}catch{}return j(),w},n=`.${Gm}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${Gm} div{width:200%;height:200%;margin:10px 0}.${Wg}{scrollbar-width:none!important}.${Wg}::-webkit-scrollbar,.${Wg}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,i=sR(`<div class="${Gm}"><div></div><style>${n}</style></div>`)[0],o=i.firstChild,a=i.lastChild,l=Cue();l&&(a.nonce=l);const[c,,d]=B2(),[h,f]=fr({o:e(i,o),i:Vm},nt(e,i,o,!0)),[p]=f(),g=t(i),m={x:p.x===0,y:p.y===0},y={elements:{host:null,padding:!g,viewport:S=>g&&nR(S)&&S,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},b=Mt({},sue),C=nt(Mt,{},b),v=nt(Mt,{},y),x={T:p,k:m,R:g,V:!!$m,L:nt(c,"r"),U:v,P:S=>Mt(y,S)&&v(),N:C,q:S=>Mt(b,S)&&C(),B:Mt({},y),F:Mt({},b)};if(Vi(i,"style"),_u(i),un(Qs,"resize",()=>{d("r",[])}),_r(Qs.matchMedia)&&!g&&(!m.x||!m.y)){const S=w=>{const j=Qs.matchMedia(`(resolution: ${Qs.devicePixelRatio}dppx)`);un(j,"change",()=>{w(),S(w)},{A:!0})};S(()=>{const[w,j]=h();Mt(x.T,w),d("r",[j])})}return x},xo=()=>(Ib||(Ib=wue()),Ib),mR=(e,t)=>_r(t)?t.apply(0,e):t,jue=(e,t,n,s)=>{const i=Kw(s)?n:s;return mR(e,i)||t.apply(0,e)},yR=(e,t,n,s)=>{const i=Kw(s)?n:s,o=mR(e,i);return!!o&&(A0(o)?o:t.apply(0,e))},kue=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:i,R:o,U:a}=xo(),{nativeScrollbarsOverlaid:l,body:c}=a().cancel,d=n??l,h=Kw(s)?c:s,f=(i.x||i.y)&&d,p=e&&($y(h)?!o:h);return!!f||!!p},oj=new WeakMap,_ue=(e,t)=>{oj.set(e,t)},Iue=e=>{oj.delete(e)},vR=e=>oj.get(e),Aue=(e,t,n)=>{let s=!1;const i=n?new WeakMap:!1,o=()=>{s=!0},a=l=>{if(i&&n){const c=n.map(d=>{const[h,f]=d||[];return[f&&h?(l||tR)(h,e):[],f]});Wt(c,d=>Wt(d[0],h=>{const f=d[1],p=i.get(h)||[];if(e.contains(h)&&f){const m=un(h,f,y=>{s?(m(),i.delete(h)):t(y)});i.set(h,vn(p,m))}else Sr(p),i.delete(h)}))}};return a(),[o,a]},s6=(e,t,n,s)=>{let i=!1;const{j:o,X:a,Y:l,W:c,J:d,G:h}=s||{},f=M2(()=>i&&n(!0),{_:33,v:99}),[p,g]=Aue(e,f,l),m=o||[],y=a||[],b=Ff(m,y),C=(x,S)=>{if(!T2(S)){const w=d||Ma,j=h||Ma,P=[],T=[];let L=!1,E=!1;if(Wt(S,O=>{const{attributeName:F,target:_,type:R,oldValue:D,addedNodes:$,removedNodes:G}=O,ee=R==="attributes",Q=R==="childList",se=e===_,ne=ee&&F,H=ne&&Jw(_,F||""),V=Wp(H)?H:null,Y=ne&&D!==V,W=FD(y,F)&&Y;if(t&&(Q||!se)){const J=ee&&Y,N=J&&c&&P2(_,c),U=(N?!w(_,F,D,V):!ee||J)&&!j(O,!!N,e,s);Wt($,ie=>vn(P,ie)),Wt(G,ie=>vn(P,ie)),E=E||U}!t&&se&&Y&&!w(_,F,D,V)&&(vn(T,F),L=L||W)}),g(O=>E2(P).reduce((F,_)=>(vn(F,tR(O,_)),P2(_,O)?vn(F,_):F),[])),t)return!x&&E&&n(!1),[!1];if(!T2(T)||L){const O=[E2(T),L];return!x&&n.apply(0,O),O}}},v=new Uce(nt(C,!1));return[()=>(v.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:b,subtree:t,childList:t,characterData:t}),i=!0,()=>{i&&(p(),v.disconnect(),i=!1)}),()=>{if(i)return f.m(),C(!0,v.takeRecords())}]},bR={},xR={},Tue=e=>{Wt(e,t=>Wt(t,(n,s)=>{bR[s]=t[s]}))},CR=(e,t,n)=>Ai(e).map(s=>{const{static:i,instance:o}=e[s],[a,l,c]=n||[],d=n?o:i;if(d){const h=n?d(a,l,t):d(t);return(c||xR)[s]=h}}),Up=e=>xR[e],Eue="__osOptionsValidationPlugin",Mue="__osSizeObserverPlugin",Pue=(e,t)=>{const{k:n}=t,[s,i]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,i]},Iu=e=>e.indexOf(va)===0,Lue=(e,t)=>{const n=(i,o,a,l)=>{const c=i===va?xl:i.replace(`${va}-`,""),d=Iu(i),h=Iu(a);return!o&&!l?xl:d&&h?va:d?o&&l?c:o?va:xl:o?c:h&&l?va:xl},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{K:s,Z:{x:s.x===ku,y:s.y===ku}}},SR="__osScrollbarsHidingPlugin",wR="__osClickScrollPlugin",Due={[wR]:{static:()=>(e,t,n,s)=>{let i=!1,o=Ma;const a=133,l=222,[c,d]=Cl(a),h=Math.sign(t),f=n*h,p=f/2,g=C=>1-(1-C)*(1-C),m=(C,v)=>jb(C,v,l,e,g),y=(C,v)=>jb(C,t-f,a*v,(x,S,w)=>{e(x),w&&(o=m(x,t))}),b=jb(0,f,l,(C,v,x)=>{if(e(C),x&&(s(i),!i)){const S=t-C;Math.sign(S-p)===h&&c(()=>{const j=S-f;o=Math.sign(j)===h?y(C,Math.abs(j)/n):m(C,t)})}},g);return C=>{i=!0,C&&b(),d(),o()}}}},jR=(e,t,n)=>{const{dt:s}=n||{},i=Up(Mue),[o]=fr({o:!1,u:!0});return()=>{const a=[],c=sR(`<div class="${rj}"><div class="${due}"></div></div>`)[0],d=c.firstChild,h=f=>{const p=f instanceof ResizeObserverEntry;let g=!1,m=!1;if(p){const[y,,b]=o(f.contentRect),C=O2(y);m=aR(y,b),g=!m&&!C}else m=f===!0;g||t({ft:!0,dt:m})};if(k0){const f=new k0(p=>h(p.pop()));f.observe(d),vn(a,()=>{f.disconnect()})}else if(i){const[f,p]=i(d,h,s);vn(a,Ff([nj(c,uue),un(c,"animationstart",f)],p))}else return Ma;return nt(Sr,vn(a,yr(e,c)))}},Rue=(e,t)=>{let n;const s=c=>c.h===0||c.isIntersecting||c.intersectionRatio>0,i=lu(hue),[o]=fr({o:!1}),a=(c,d)=>{if(c){const h=o(s(c)),[,f]=h;return f&&!d&&t(h)&&[h]}},l=(c,d)=>a(d.pop(),c);return[()=>{const c=[];if(BI)n=new BI(nt(l,!1),{root:e}),n.observe(i),vn(c,()=>{n.disconnect()});else{const d=()=>{const h=cu(i);a(h)};vn(c,jR(i,d)()),d()}return nt(Sr,vn(c,yr(e,i)))},()=>n&&l(!0,n.takeRecords())]},Oue=(e,t,n,s)=>{let i,o,a,l,c,d;const h=`[${Pa}]`,f=`[${Po}]`,p=["id","class","style","open","wrap","cols","rows"],{vt:g,ht:m,ot:y,gt:b,bt:C,nt:v,wt:x,yt:S,St:w,Ot:j}=e,P=W=>Zo(W,"direction")==="rtl",T={$t:!1,ct:P(g)},L=xo(),E=Up(SR),[O]=fr({i:KD,o:{w:0,h:0}},()=>{const W=E&&E.tt(e,t,T,L,n).ut,N=!(x&&v)&&tj(m,Pa,zm),B=!v&&S(aue),U=B&&vr(b),ie=U&&j(),de=w(hR,N),be=B&&W&&W()[0],Ee=E0(y),je=sj(y);return be&&be(),Yi(b,U),ie&&ie(),N&&de(),{w:Ee.w+je.w,h:Ee.h+je.h}}),F=M2(s,{_:()=>i,v:()=>o,S(W,J){const[N]=W,[B]=J;return[Ff(Ai(N),Ai(B)).reduce((U,ie)=>(U[ie]=N[ie]||B[ie],U),{})]}}),_=W=>{const J=P(g);Mt(W,{Ct:d!==J}),Mt(T,{ct:J}),d=J},R=(W,J)=>{const[N,B]=W,U={xt:B};return Mt(T,{$t:N}),!J&&s(U),U},D=({ft:W,dt:J})=>{const B=!(W&&!J)&&L.R?F:s,U={ft:W||J,dt:J};_(U),B(U)},$=(W,J)=>{const[,N]=O(),B={Ht:N};return _(B),N&&!J&&(W?s:F)(B),B},G=(W,J,N)=>{const B={Et:J};return _(B),J&&!N&&F(B),B},[ee,Q]=C?Rue(m,R):[],se=!v&&jR(m,D,{dt:!0}),[ne,H]=s6(m,!1,G,{X:p,j:p}),V=v&&k0&&new k0(W=>{const J=W[W.length-1].contentRect;D({ft:!0,dt:aR(J,c)}),c=J}),Y=M2(()=>{const[,W]=O();s({Ht:W})},{_:222,p:!0});return[()=>{V&&V.observe(m);const W=se&&se(),J=ee&&ee(),N=ne(),B=L.L(U=>{U?F({zt:U}):Y()});return()=>{V&&V.disconnect(),W&&W(),J&&J(),l&&l(),N(),B()}},({It:W,At:J,Dt:N})=>{const B={},[U]=W("update.ignoreMutation"),[ie,de]=W("update.attributes"),[be,Ee]=W("update.elementEvents"),[je,Be]=W("update.debounce"),Xe=Ee||de,Re=J||N,K=re=>_r(U)&&U(re);if(Xe){a&&a(),l&&l();const[re,ae]=s6(C||y,!0,$,{j:Ff(p,ie||[]),Y:be,W:h,G:(xe,ge)=>{const{target:fe,attributeName:le}=xe;return(!ge&&le&&!v?Yce(fe,h,f):!1)||!!qc(fe,`.${Lr}`)||!!K(xe)}});l=re(),a=ae}if(Be)if(F.m(),po(je)){const re=je[0],ae=je[1];i=no(re)&&re,o=no(ae)&&ae}else no(je)?(i=je,o=!1):(i=!1,o=!1);if(Re){const re=H(),ae=Q&&Q(),xe=a&&a();re&&Mt(B,G(re[0],re[1],Re)),ae&&Mt(B,R(ae[0],Re)),xe&&Mt(B,$(xe[0],Re))}return _(B),B},T]},Nue=(e,t,n,s)=>{const i="--os-viewport-percent",o="--os-scroll-percent",a="--os-scroll-direction",{U:l}=xo(),{scrollbars:c}=l(),{slot:d}=c,{vt:h,ht:f,ot:p,Mt:g,gt:m,wt:y,nt:b}=t,{scrollbars:C}=g?{}:e,{slot:v}=C||{},x=[],S=[],w=[],j=yR([h,f,p],()=>b&&y?h:f,d,v),P=ne=>{if($m){const H=new $m({source:m,axis:ne});return{kt:Y=>{const W=Y.Tt.animate({clear:["left"],[o]:[0,1]},{timeline:H});return()=>W.cancel()}}}},T={x:P("x"),y:P("y")},L=()=>{const{Rt:ne,Vt:H}=n,V=(Y,W)=>XD(0,1,Y/(Y+W)||0);return{x:V(H.x,ne.x),y:V(H.y,ne.y)}},E=(ne,H,V)=>{const Y=V?nj:eR;Wt(ne,W=>{Y(W.Tt,H)})},O=(ne,H)=>{Wt(ne,V=>{const[Y,W]=H(V);$f(Y,W)})},F=(ne,H,V)=>{const Y=Zw(V),W=Y?V:!0,J=Y?!V:!0;W&&E(S,ne,H),J&&E(w,ne,H)},_=()=>{const ne=L(),H=V=>Y=>[Y.Tt,{[i]:R2(V)+""}];O(S,H(ne.x)),O(w,H(ne.y))},R=()=>{if(!$m){const{Lt:ne}=n,H=UI(ne,vr(m)),V=Y=>W=>[W.Tt,{[o]:R2(Y)+""}];O(S,V(H.x)),O(w,V(H.y))}},D=()=>{const{Lt:ne}=n,H=WI(ne),V=Y=>W=>[W.Tt,{[a]:Y?"0":"1"}];O(S,V(H.x)),O(w,V(H.y))},$=()=>{if(b&&!y){const{Rt:ne,Lt:H}=n,V=WI(H),Y=UI(H,vr(m)),W=J=>{const{Tt:N}=J,B=Bf(N)===p&&N,U=(ie,de,be)=>{const Ee=de*ie;return iR(be?Ee:-Ee)};return[B,B&&{transform:Xce({x:U(Y.x,ne.x,V.x),y:U(Y.y,ne.y,V.y)})}]};O(S,W),O(w,W)}},G=ne=>{const H=ne?"x":"y",Y=lu(`${Lr} ${ne?gue:mue}`),W=lu(pR),J=lu(ij),N={Tt:Y,Ut:W,Pt:J},B=T[H];return vn(ne?S:w,N),vn(x,[yr(Y,W),yr(W,J),nt(_u,Y),B&&B.kt(N),s(N,F,ne)]),N},ee=nt(G,!0),Q=nt(G,!1),se=()=>(yr(j,S[0].Tt),yr(j,w[0].Tt),nt(Sr,x));return ee(),Q(),[{Nt:_,qt:R,Bt:D,Ft:$,jt:F,Xt:{Yt:S,Wt:ee,Jt:nt(O,S)},Gt:{Yt:w,Wt:Q,Jt:nt(O,w)}},se]},Fue=(e,t,n,s)=>(i,o,a)=>{const{ht:l,ot:c,nt:d,gt:h,Kt:f,Ot:p}=t,{Tt:g,Ut:m,Pt:y}=i,[b,C]=Cl(333),[v,x]=Cl(444),S=P=>{_r(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:P.x,top:P.y})},w=()=>{const P="pointerup pointercancel lostpointercapture",T=`client${a?"X":"Y"}`,L=a?Gy:zy,E=a?"left":"top",O=a?"w":"h",F=a?"x":"y",_=(D,$)=>G=>{const{Rt:ee}=n,Q=cu(m)[O]-cu(y)[O],ne=$*G/Q*ee[F];Yi(h,{[F]:D+ne})},R=[];return un(m,"pointerdown",D=>{const $=qc(D.target,`.${ij}`)===y,G=$?y:m,ee=e.scrollbars,Q=ee[$?"dragScroll":"clickScroll"],{button:se,isPrimary:ne,pointerType:H}=D,{pointers:V}=ee;if(se===0&&ne&&Q&&(V||[]).includes(H)){Sr(R),x();const W=!$&&(D.shiftKey||Q==="instant"),J=nt(kb,y),N=nt(kb,m),B=(ge,fe)=>(ge||J())[E]-(fe||N())[E],U=I2(kb(h)[L])/cu(h)[O]||1,ie=_(vr(h)[F],1/U),de=D[T],be=J(),Ee=N(),je=be[L],Be=B(be,Ee)+je/2,Xe=de-Ee[E],Re=$?0:Xe-Be,K=ge=>{Sr(xe),G.releasePointerCapture(ge.pointerId)},re=$||W,ae=p(),xe=[un(f,P,K),un(f,"selectstart",ge=>N2(ge),{H:!1}),un(m,P,K),re&&un(m,"pointermove",ge=>ie(Re+(ge[T]-de))),re&&(()=>{const ge=vr(h);ae();const fe=vr(h),le={x:fe.x-ge.x,y:fe.y-ge.y};(w0(le.x)>3||w0(le.y)>3)&&(p(),Yi(h,ge),S(le),v(ae))})];if(G.setPointerCapture(D.pointerId),W)ie(Re);else if(!$){const ge=Up(wR);if(ge){const fe=ge(ie,Re,je,le=>{le?ae():vn(xe,ae)});vn(xe,fe),vn(R,nt(fe,!0))}}}})};let j=!0;return nt(Sr,[un(y,"pointermove pointerleave",s),un(g,"pointerenter",()=>{o(JI,!0)}),un(g,"pointerleave pointercancel",()=>{o(JI,!1)}),!d&&un(g,"mousedown",()=>{const P=D2();(VI(P,Po)||VI(P,Pa)||P===document.body)&&j0(nt(F2,c),25)}),un(g,"wheel",P=>{const{deltaX:T,deltaY:L,deltaMode:E}=P;j&&E===0&&Bf(g)===l&&S({x:T,y:L}),j=!1,o(n6,!0),b(()=>{j=!0,o(n6)}),N2(P)},{H:!1,I:!0}),un(g,"pointerdown",nt(un,f,"click",cR,{A:!0,I:!0,H:!1}),{I:!0}),w(),C,x])},Bue=(e,t,n,s,i,o)=>{let a,l,c,d,h,f=Ma,p=0;const g=ne=>ne.pointerType==="mouse",[m,y]=Cl(),[b,C]=Cl(100),[v,x]=Cl(100),[S,w]=Cl(()=>p),[j,P]=Nue(e,i,s,Fue(t,i,s,ne=>g(ne)&&G())),{ht:T,Qt:L,wt:E}=i,{jt:O,Nt:F,qt:_,Bt:R,Ft:D}=j,$=(ne,H)=>{if(w(),ne)O(t6);else{const V=nt(O,t6,!0);p>0&&!H?S(V):V()}},G=()=>{(c?!a:!d)&&($(!0),b(()=>{$(!1)}))},ee=ne=>{O(V2,ne,!0),O(V2,ne,!1)},Q=ne=>{g(ne)&&(a=c,c&&$(!0))},se=[w,C,x,y,()=>f(),un(T,"pointerover",Q,{A:!0}),un(T,"pointerenter",Q),un(T,"pointerleave",ne=>{g(ne)&&(a=!1,c&&$(!1))}),un(T,"pointermove",ne=>{g(ne)&&l&&G()}),un(L,"scroll",ne=>{m(()=>{_(),G()}),o(ne),D()})];return[()=>nt(Sr,vn(se,P())),({It:ne,Dt:H,Zt:V,tn:Y})=>{const{nn:W,sn:J,en:N,cn:B}=Y||{},{Ct:U,dt:ie}=V||{},{ct:de}=n,{k:be}=xo(),{K:Ee,rn:je}=s,[Be,Xe]=ne("showNativeOverlaidScrollbars"),[Re,K]=ne("scrollbars.theme"),[re,ae]=ne("scrollbars.visibility"),[xe,ge]=ne("scrollbars.autoHide"),[fe,le]=ne("scrollbars.autoHideSuspend"),[Ce]=ne("scrollbars.autoHideDelay"),[ze,Qe]=ne("scrollbars.dragScroll"),[gt,fn]=ne("scrollbars.clickScroll"),[cn,pn]=ne("overflow"),es=ie&&!H,ks=je.x||je.y,gn=W||J||B||U||H,Bi=N||ae||pn,aa=Be&&be.x&&be.y,as=($s,ai,mc)=>{const Tg=$s.includes(ku)&&(re===va||re==="auto"&&ai===ku);return O(yue,Tg,mc),Tg};if(p=Ce,es&&(fe&&ks?(ee(!1),f(),v(()=>{f=un(L,"scroll",nt(ee,!0),{A:!0})})):ee(!0)),Xe&&O(fue,aa),K&&(O(h),O(Re,!0),h=Re),le&&!fe&&ee(!0),ge&&(l=xe==="move",c=xe==="leave",d=xe==="never",$(d,!0)),Qe&&O(xue,ze),fn&&O(bue,!!gt),Bi){const $s=as(cn.x,Ee.x,!0),ai=as(cn.y,Ee.y,!1);O(vue,!($s&&ai))}gn&&(_(),F(),D(),B&&R(),O(e6,!je.x,!0),O(e6,!je.y,!1),O(pue,de&&!E))},{},j]},$ue=e=>{const t=xo(),{U:n,R:s}=t,{elements:i}=n(),{padding:o,viewport:a,content:l}=i,c=A0(e),d=c?{}:e,{elements:h}=d,{padding:f,viewport:p,content:g}=h||{},m=c?e:d.target,y=nR(m),b=m.ownerDocument,C=b.documentElement,v=()=>b.defaultView||Qs,x=nt(jue,[m]),S=nt(yR,[m]),w=nt(lu,""),j=nt(x,w,a),P=nt(S,w,l),T=je=>{const Be=cu(je),Xe=E0(je),Re=Zo(je,UD),K=Zo(je,qD);return Xe.w-Be.w>0&&!Iu(Re)||Xe.h-Be.h>0&&!Iu(K)},L=j(p),E=L===m,O=E&&y,F=!E&&P(g),_=!E&&L===F,R=O?C:L,D=O?R:m,$=!E&&S(w,o,f),G=!_&&F,ee=[G,R,$,D].map(je=>A0(je)&&!Bf(je)&&je),Q=je=>je&&FD(ee,je),se=!Q(R)&&T(R)?R:m,ne=O?C:R,V={vt:m,ht:D,ot:R,ln:$,bt:G,gt:ne,Qt:O?b:R,an:y?C:se,Kt:b,wt:y,Mt:c,nt:E,un:v,yt:je=>tj(R,Po,je),St:(je,Be)=>T0(R,Po,je,Be),Ot:()=>T0(ne,Po,lue,!0)},{vt:Y,ht:W,ln:J,ot:N,bt:B}=V,U=[()=>{Vi(W,[Pa,_b]),Vi(Y,_b),y&&Vi(C,[_b,Pa])}];let ie=L2([B,N,J,W,Y].find(je=>je&&!Q(je)));const de=O?Y:B||N,be=nt(Sr,U);return[V,()=>{const je=v(),Be=D2(),Xe=xe=>{yr(Bf(xe),L2(xe)),_u(xe)},Re=xe=>un(xe,"focusin focusout focus blur",cR,{I:!0,H:!1}),K="tabindex",re=Jw(N,K),ae=Re(Be);return Mo(W,Pa,E?"":rue),Mo(J,$2,""),Mo(N,Po,""),Mo(B,QI,""),E||(Mo(N,K,re||"-1"),y&&Mo(C,XI,"")),yr(de,ie),yr(W,J),yr(J||W,!E&&N),yr(N,B),vn(U,[ae,()=>{const xe=D2(),ge=Q(N),fe=ge&&xe===N?Y:xe,le=Re(fe);Vi(J,$2),Vi(B,QI),Vi(N,Po),y&&Vi(C,XI),re?Mo(N,K,re):Vi(N,K),Q(B)&&Xe(B),ge&&Xe(N),Q(J)&&Xe(J),F2(fe),le()}]),s&&!E&&(ej(N,Po,fR),vn(U,nt(Vi,N,Po))),F2(!E&&y&&Be===Y&&je.top===je?N:Be),ae(),ie=0,be},be]},Vue=({bt:e})=>({Zt:t,_n:n,Dt:s})=>{const{xt:i}=t||{},{$t:o}=n;e&&(i||s)&&$f(e,{[zy]:o&&"100%"})},Gue=({ht:e,ln:t,ot:n,nt:s},i)=>{const[o,a]=fr({i:Kce,o:zI()},nt(zI,e,"padding",""));return({It:l,Zt:c,_n:d,Dt:h})=>{let[f,p]=a(h);const{R:g}=xo(),{ft:m,Ht:y,Ct:b}=c||{},{ct:C}=d,[v,x]=l("paddingAbsolute");(m||p||(h||y))&&([f,p]=o(h));const w=!s&&(x||b||p);if(w){const j=!v||!t&&!g,P=f.r+f.l,T=f.t+f.b,L={[HD]:j&&!C?-P:0,[WD]:j?-T:0,[zD]:j&&C?-P:0,top:j?-f.t:0,right:j?C?-f.r:"auto":0,left:j?C?"auto":-f.l:0,[Gy]:j&&`calc(100% + ${P}px)`},E={[BD]:j?f.t:0,[$D]:j?f.r:0,[GD]:j?f.b:0,[VD]:j?f.l:0};$f(t||n,L),$f(n,E),Mt(i,{ln:f,dn:!j,rt:t?E:Mt({},L,E)})}return{fn:w}}},zue=(e,t)=>{const n=xo(),{ht:s,ln:i,ot:o,nt:a,Qt:l,gt:c,wt:d,St:h,un:f}=e,{R:p}=n,g=d&&a,m=nt(S0,0),y={display:()=>!1,direction:H=>H!=="ltr",flexDirection:H=>H.endsWith("-reverse"),writingMode:H=>H!=="horizontal-tb"},b=Ai(y),C={i:KD,o:{w:0,h:0}},v={i:Vm,o:{}},x=H=>{h(hR,!g&&H)},S=H=>{if(!b.some(de=>{const be=H[de];return be&&y[de](be)}))return{D:{x:0,y:0},M:{x:1,y:1}};x(!0);const Y=vr(c),W=h(cue,!0),J=un(l,ku,de=>{const be=vr(c);de.isTrusted&&be.x===Y.x&&be.y===Y.y&&lR(de)},{I:!0,A:!0});Yi(c,{x:0,y:0}),W();const N=vr(c),B=E0(c);Yi(c,{x:B.w,y:B.h});const U=vr(c);Yi(c,{x:U.x-N.x<1&&-B.w,y:U.y-N.y<1&&-B.h});const ie=vr(c);return Yi(c,Y),Fy(()=>J()),{D:N,M:ie}},w=(H,V)=>{const Y=Qs.devicePixelRatio%1!==0?1:0,W={w:m(H.w-V.w),h:m(H.h-V.h)};return{w:W.w>Y?W.w:0,h:W.h>Y?W.h:0}},[j,P]=fr(C,nt(sj,o)),[T,L]=fr(C,nt(E0,o)),[E,O]=fr(C),[F]=fr(v),[_,R]=fr(C),[D]=fr(v),[$]=fr({i:(H,V)=>Hy(H,V,b),o:{}},()=>tue(o)?Zo(o,b):{}),[G,ee]=fr({i:(H,V)=>Vm(H.D,V.D)&&Vm(H.M,V.M),o:uR()}),Q=Up(SR),se=(H,V)=>`${V?iue:oue}${qce(H)}`,ne=H=>{const V=W=>[va,xl,ku].map(J=>se(J,W)),Y=V(!0).concat(V()).join(" ");h(Y),h(Ai(H).map(W=>se(H[W],W==="x")).join(" "),!0)};return({It:H,Zt:V,_n:Y,Dt:W},{fn:J})=>{const{ft:N,Ht:B,Ct:U,dt:ie,zt:de}=V||{},be=Q&&Q.tt(e,t,Y,n,H),{it:Ee,ut:je,_t:Be}=be||{},[Xe,Re]=Pue(H,n),[K,re]=H("overflow"),ae=Iu(K.x),xe=Iu(K.y);let ge=P(W),fe=L(W),le=O(W),Ce=R(W);Re&&p&&h(fR,!Xe);{tj(s,Pa,zm)&&x(!0);const[Y_]=je?je():[],[Eg]=ge=j(W),[Mg]=fe=T(W),Pg=oR(o),Lg=g&&eue(f()),Uq={w:m(Mg.w+Eg.w),h:m(Mg.h+Eg.h)},X_={w:m((Lg?Lg.w:Pg.w+m(Pg.w-Mg.w))+Eg.w),h:m((Lg?Lg.h:Pg.h+m(Pg.h-Mg.h))+Eg.h)};Y_&&Y_(),Ce=_(X_),le=E(w(Uq,X_),W)}const[ze,Qe]=Ce,[gt,fn]=le,[cn,pn]=fe,[es,ks]=ge,[gn,Bi]=F({x:gt.w>0,y:gt.h>0}),aa=ae&&xe&&(gn.x||gn.y)||ae&&gn.x&&!gn.y||xe&&gn.y&&!gn.x,as=Lue(gn,K),[$s,ai]=D(as.K),[mc,Tg]=$(W),Z_=U||ie||Tg||Bi||W,[Hq,Wq]=Z_?G(S(mc),W):ee();return ai&&ne(as.K),Be&&Ee&&$f(o,Be(as,Y,Ee(as,cn,es))),x(!1),T0(s,Pa,zm,aa),T0(i,$2,zm,aa),Mt(t,{K:$s,Vt:{x:ze.w,y:ze.h},Rt:{x:gt.w,y:gt.h},rn:gn,Lt:nue(Hq,gt)}),{en:ai,nn:Qe,sn:fn,cn:Wq||fn,vn:Z_}}},Hue=e=>{const[t,n,s]=$ue(e),i={ln:{t:0,r:0,b:0,l:0},dn:!1,rt:{[HD]:0,[WD]:0,[zD]:0,[BD]:0,[$D]:0,[GD]:0,[VD]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},K:{x:xl,y:xl},rn:{x:!1,y:!1},Lt:uR()},{vt:o,gt:a,nt:l,Ot:c}=t,{R:d,k:h}=xo(),f=!d&&(h.x||h.y),p=[Vue(t),Gue(t,i),zue(t,i)];return[n,g=>{const m={},b=f&&vr(a),C=b&&c();return Wt(p,v=>{Mt(m,v(g,m)||{})}),Yi(a,b),C&&C(),!l&&Yi(o,0),m},i,t,s]},Wue=(e,t,n,s,i)=>{let o=!1;const a=YI(t,{}),[l,c,d,h,f]=Hue(e),[p,g,m]=Oue(h,d,a,S=>{x({},S)}),[y,b,,C]=Bue(e,t,m,d,h,i),v=S=>Ai(S).some(w=>!!S[w]),x=(S,w)=>{if(n())return!1;const{pn:j,Dt:P,At:T,hn:L}=S,E=j||{},O=!!P||!o,F={It:YI(t,E,O),pn:E,Dt:O};if(L)return b(F),!1;const _=w||g(Mt({},F,{At:T})),R=c(Mt({},F,{_n:m,Zt:_}));b(Mt({},F,{Zt:_,tn:R}));const D=v(_),$=v(R),G=D||$||!Qw(E)||O;return o=!0,G&&s(S,{Zt:_,tn:R}),G};return[()=>{const{an:S,gt:w,Ot:j}=h,P=vr(S),T=[p(),l(),y()],L=j();return Yi(w,P),L(),nt(Sr,T)},x,()=>({gn:m,bn:d}),{wn:h,yn:C},f]},Si=(e,t,n)=>{const{N:s}=xo(),i=A0(e),o=i?e:e.target,a=vR(o);if(t&&!a){let l=!1;const c=[],d={},h=E=>{const O=YD(E),F=Up(Eue);return F?F(O,!0):O},f=Mt({},s(),h(t)),[p,g,m]=B2(),[y,b,C]=B2(n),v=(E,O)=>{C(E,O),m(E,O)},[x,S,w,j,P]=Wue(e,f,()=>l,({pn:E,Dt:O},{Zt:F,tn:_})=>{const{ft:R,Ct:D,xt:$,Ht:G,Et:ee,dt:Q}=F,{nn:se,sn:ne,en:H,cn:V}=_;v("updated",[L,{updateHints:{sizeChanged:!!R,directionChanged:!!D,heightIntrinsicChanged:!!$,overflowEdgeChanged:!!se,overflowAmountChanged:!!ne,overflowStyleChanged:!!H,scrollCoordinatesChanged:!!V,contentMutation:!!G,hostMutation:!!ee,appear:!!Q},changedOptions:E||{},force:!!O}])},E=>v("scroll",[L,E])),T=E=>{Iue(o),Sr(c),l=!0,v("destroyed",[L,E]),g(),b()},L={options(E,O){if(E){const F=O?s():{},_=dR(f,Mt(F,h(E)));Qw(_)||(Mt(f,_),S({pn:_}))}return Mt({},f)},on:y,off:(E,O)=>{E&&O&&b(E,O)},state(){const{gn:E,bn:O}=w(),{ct:F}=E,{Vt:_,Rt:R,K:D,rn:$,ln:G,dn:ee,Lt:Q}=O;return Mt({},{overflowEdge:_,overflowAmount:R,overflowStyle:D,hasOverflow:$,scrollCoordinates:{start:Q.D,end:Q.M},padding:G,paddingAbsolute:ee,directionRTL:F,destroyed:l})},elements(){const{vt:E,ht:O,ln:F,ot:_,bt:R,gt:D,Qt:$}=j.wn,{Xt:G,Gt:ee}=j.yn,Q=ne=>{const{Pt:H,Ut:V,Tt:Y}=ne;return{scrollbar:Y,track:V,handle:H}},se=ne=>{const{Yt:H,Wt:V}=ne,Y=Q(H[0]);return Mt({},Y,{clone:()=>{const W=Q(V());return S({hn:!0}),W}})};return Mt({},{target:E,host:O,padding:F||_,viewport:_,content:R||_,scrollOffsetElement:D,scrollEventElement:$,scrollbarHorizontal:se(G),scrollbarVertical:se(ee)})},update:E=>S({Dt:E,At:!0}),destroy:nt(T,!1),plugin:E=>d[Ai(E)[0]]};return vn(c,[P]),_ue(o,L),CR(bR,Si,[L,p,d]),kue(j.wn.wt,!i&&e.cancel)?(T(!0),L):(vn(c,x()),v("initialized",[L]),L.update(),L)}return a};Si.plugin=e=>{const t=po(e),n=t?e:[e],s=n.map(i=>CR(i,Si)[0]);return Tue(n),t?s:s[0]};Si.valid=e=>{const t=e&&e.elements,n=_r(t)&&t();return I0(n)&&!!vR(n.target)};Si.env=()=>{const{T:e,k:t,R:n,V:s,B:i,F:o,U:a,P:l,N:c,q:d}=xo();return Mt({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:i,staticDefaultOptions:o,getDefaultInitialization:a,setDefaultInitialization:l,getDefaultOptions:c,setDefaultOptions:d})};Si.nonce=Sue;Si.plugin(Due);const Bl={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},Co=(e="hidden",t="scroll")=>{const n=bt(Bl);return cE(n,{options:{overflow:{y:t,x:e}}}),n},Za={height:"100%",width:"100%"},Uue=()=>{if(typeof window>"u"){const d=()=>{};return[d,d]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",i=n.requestAnimationFrame,o=n.cancelAnimationFrame,a=s?n.requestIdleCallback:i,l=s?n.cancelIdleCallback:o,c=()=>{l(e),o(t)};return[(d,h)=>{c(),e=a(s?()=>{c(),t=i(d)}:d,typeof h=="object"?h:{timeout:2233})},c]},kR=e=>{const{options:t,events:n,defer:s}=e||{},[i,o]=u.useMemo(Uue,[]),a=u.useRef(null),l=u.useRef(s),c=u.useRef(t),d=u.useRef(n);return u.useEffect(()=>{l.current=s},[s]),u.useEffect(()=>{const{current:h}=a;c.current=t,Si.valid(h)&&h.options(t||{},!0)},[t]),u.useEffect(()=>{const{current:h}=a;d.current=n,Si.valid(h)&&h.on(n||{},!0)},[n]),u.useEffect(()=>()=>{var h;o(),(h=a.current)==null||h.destroy()},[]),u.useMemo(()=>[h=>{const f=a.current;if(Si.valid(f))return;const p=l.current,g=c.current||{},m=d.current||{},y=()=>a.current=Si(h,g,m);p?i(y,p):y()},()=>a.current],[])},que=(e,t)=>{const{element:n="div",options:s,events:i,defer:o,children:a,...l}=e,c=n,d=u.useRef(null),h=u.useRef(null),[f,p]=kR({options:s,events:i,defer:o});return u.useEffect(()=>{const{current:g}=d,{current:m}=h;if(!g)return;const y=g;return f(n==="body"?{target:y,cancel:{body:null}}:{target:y,elements:{viewport:m,content:m}}),()=>{var b;return(b=p())==null?void 0:b.destroy()}},[f,n]),u.useImperativeHandle(t,()=>({osInstance:p,getElement:()=>d.current}),[]),me.createElement(c,{"data-overlayscrollbars-initialize":"",ref:d,...l},n==="body"?a:me.createElement("div",{"data-overlayscrollbars-contents":"",ref:h},a))},Ns=u.forwardRef(que),Kue={position:"absolute",top:0,left:0,right:0,bottom:0},Zue=({children:e,maxHeight:t,overflowX:n="hidden",overflowY:s="scroll"})=>{const i=u.useMemo(()=>Co(n,s).options,[n,s]),[o,a]=u.useState(null);return u.useEffect(()=>{const l=o==null?void 0:o.osInstance();if(!l)return;const c=l.elements().viewport,d=c.style.overflowY;c.style.setProperty("overflow-y","scroll","important");const h=Hn(Uw({element:c}),ND({element:c}));return c.style.setProperty("overflow-y",d),h},[o]),r.jsx(A,{w:"full",h:"full",maxHeight:t,position:"relative",children:r.jsx(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:r.jsx(Ns,{ref:a,style:Kue,options:i,children:e})})})},$n=u.memo(Zue),Yue={"&::marker":{color:"base.500"}},Xue=()=>{const{t:e}=M(),t=I(VK),n=I(hE),s=I(Z1),i=I(GK),o=u.useMemo(()=>{let a=`${e("dynamicPrompts.promptsPreview")} (${i.length})`;return t&&(a+=` - ${t}`),a},[t,i.length,e]);return n?r.jsx(A,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:r.jsx(Ot,{icon:QL,label:"Problem generating prompts"})}):r.jsxs(Z,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[r.jsx(Ve,{feature:"dynamicPrompts",inPortal:!1,children:r.jsx(te,{children:o})}),r.jsxs(A,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[r.jsx($n,{children:r.jsx(zK,{stylePosition:"inside",ms:0,children:i.map((a,l)=>r.jsx(Vt,{fontSize:"sm",sx:Yue,children:r.jsx(q,{as:"span",children:a})},`${a}.${l}`))})}),s&&r.jsx(A,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:r.jsx(rr,{})})]})]})},Que=u.memo(Xue),Jue=()=>{const e=z(),{t}=M(),n=I(HK),s=u.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),i=u.useCallback(a=>{WK(a==null?void 0:a.value)&&e(UK(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[s,n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:r.jsx(te,{children:t("dynamicPrompts.seedBehaviour.label")})}),r.jsx(Fe,{value:o,options:s,onChange:i})]})},ede=u.memo(Jue),_R=u.memo(()=>{kt("DynamicPromptsModal");const{t:e}=M(),{isOpen:t,onClose:n}=AD();return r.jsxs(ni,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(Mr,{children:e("dynamicPrompts.dynamicPrompts")}),r.jsx(yo,{}),r.jsxs(sr,{as:A,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(A,{gap:4,children:[r.jsx(ede,{}),r.jsx(lce,{})]}),r.jsx(Que,{})]})]})]})});_R.displayName="DynamicPromptsModal";const qh=Oe(null),tde=()=>{kt("DeleteBoardModal");const e=ce(qh),{t}=M(),{currentData:n,isFetching:s}=qK(e!=null&&e.board_id?{board_id:e==null?void 0:e.board_id,categories:void 0,is_intermediate:void 0}:ws),i=u.useMemo(()=>tn([lt,et,hp],(y,b,C)=>{const v=(n??[]).map(S=>aE(y,b,C,S));return{isUpscaleImage:ds(v,S=>S.isUpscaleImage),isRasterLayerImage:ds(v,S=>S.isRasterLayerImage),isInpaintMaskImage:ds(v,S=>S.isInpaintMaskImage),isRegionalGuidanceImage:ds(v,S=>S.isRegionalGuidanceImage),isNodesImage:ds(v,S=>S.isNodesImage),isControlLayerImage:ds(v,S=>S.isControlLayerImage),isReferenceImage:ds(v,S=>S.isReferenceImage)}}),[n]),[o,{isLoading:a}]=KK(),[l,{isLoading:c}]=ZK(),d=I(i),h=u.useCallback(()=>{e&&(o(e.board_id),qh.set(null))},[e,o]),f=u.useCallback(()=>{e&&(l(e.board_id),qh.set(null))},[e,l]),p=u.useCallback(()=>{qh.set(null)},[]),g=u.useRef(null),m=u.useMemo(()=>c||a||s,[c,a,s]);return e?r.jsx(fE,{isOpen:!!e,onClose:p,leastDestructiveRef:g,isCentered:!0,children:r.jsx(nr,{children:r.jsxs(pE,{children:[r.jsxs(Mr,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e.board_name]}),r.jsx(sr,{children:r.jsxs(A,{direction:"column",gap:3,children:[s?r.jsx(IS,{children:r.jsx(A,{w:"full",h:32})}):r.jsx(pD,{imageUsage:d,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),r.jsx(q,{children:e.is_private?t("boards.deletedPrivateBoardsCannotbeRestored"):t("boards.deletedBoardsCannotbeRestored")}),r.jsx(q,{children:t("gallery.deleteImagePermanent")})]})}),r.jsx(vo,{children:r.jsxs(A,{w:"full",gap:2,justifyContent:"end",children:[r.jsx(ye,{ref:g,onClick:p,children:t("boards.cancel")}),r.jsx(ye,{colorScheme:"warning",isLoading:m,onClick:h,children:t("boards.deleteBoardOnly")}),r.jsx(ye,{colorScheme:"error",isLoading:m,onClick:f,children:t("boards.deleteBoardAndImages")})]})})]})})}):null},nde=u.memo(tde),sde=()=>{const{t:e}=M(),t=z(),n=I(y=>y.gallery.selection),s=ce(AS),i=en("bulkDownload"),[o]=TS(),[a]=ES(),[l]=MS(),c=u.useCallback(()=>{t(gE(n)),t(yS(!0))},[t,n]),d=u.useCallback(()=>{t(up(n))},[t,n]),h=u.useCallback(()=>{o({imageDTOs:n})},[o,n]),f=u.useCallback(()=>{a({imageDTOs:n})},[a,n]),p=u.useCallback(()=>{l({image_names:n.map(y=>y.image_name)})},[n,l]),g=u.useMemo(()=>n.every(y=>y.starred),[n]),m=u.useMemo(()=>n.every(y=>!y.starred),[n]);return r.jsxs(r.Fragment,{children:[g&&r.jsx(he,{icon:s?s.on.icon:r.jsx(Pw,{}),onClickCapture:f,children:s?s.off.text:"Unstar All"}),(m||!g&&!m)&&r.jsx(he,{icon:s?s.on.icon:r.jsx(Ow,{}),onClickCapture:h,children:s?s.on.text:"Star All"}),i&&r.jsx(he,{icon:r.jsx(ed,{}),onClickCapture:p,children:e("gallery.downloadSelection")}),r.jsx(he,{icon:r.jsx($L,{}),onClickCapture:c,children:e("boards.changeBoard")}),r.jsx(vs,{}),r.jsx(he,{color:"error.300",icon:r.jsx(ei,{}),onClickCapture:d,children:e("gallery.deleteSelection")})]})},rde=u.memo(sde),Kr=({tooltip:e,icon:t,...n})=>r.jsx(De,{label:e,placement:"top",gutter:12,children:r.jsx(he,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),od=({children:e})=>r.jsx(A,{gap:2,justifyContent:"space-between",children:e}),IR=u.createContext(null),ide=IR.Provider,Dr=()=>{const e=u.useContext(IR);return Ge(e!==null,"useImageDTOContext must be used within ImageDTOContextProvider"),e},AR=u.memo(()=>{const{t:e}=M(),t=z(),n=Dr(),s=u.useCallback(()=>{t(gE([n])),t(yS(!0))},[t,n]);return r.jsx(he,{icon:r.jsx($L,{}),onClickCapture:s,children:e("boards.changeBoard")})});AR.displayName="ImageMenuItemChangeBoard";const ode="https://invoke-ai.github.io/InvokeAI/faq/#unable-to-copy-on-firefox",na=()=>{const{t:e}=M(),t=u.useCallback(()=>{ve({id:"CLIPBOARD_UNAVAILABLE",title:e("toast.unableToCopy"),description:r.jsx(r.Fragment,{children:r.jsxs(q,{fontSize:"md",children:[e("toast.unableToCopyDesc"),r.jsx(Js,{display:"inline",fontWeight:"semibold",href:ode,label:e("toast.unableToCopyDesc_theseSteps")}),"."]})}),status:"error"})},[e]),n=u.useMemo(()=>!(!navigator.clipboard||!window.ClipboardItem),[]),s=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.writeText(a),l==null||l()},[t,n]),i=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.write(a),l==null||l()},[t,n]),o=u.useCallback((a,l)=>{if(!n){t();return}const c=[new ClipboardItem({"image/png":a})];navigator.clipboard.write(c),l==null||l()},[t,n]);return{isAvailable:n,writeText:s,write:i,writeImage:o}},TR=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{const i=document.createElement("canvas");i.width=s.width,i.height=s.height;const o=i.getContext("2d");if(!o){n(new Error("Failed to get canvas context"));return}o.drawImage(s,0,0),i.toBlob(a=>{a?t(a):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin=vp.get()?"use-credentials":"anonymous",s.src=e}),ade=()=>{const{t:e}=M(),t=na(),n=z();return u.useCallback(async i=>{try{const o=await TR(i);if(!o)throw new Error("Unable to create Blob");t.writeImage(o,()=>{ve({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"}),n(YK())})}catch(o){ve({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(o),status:"error"})}},[t,e,n])},ER=u.memo(()=>{const{t:e}=M(),t=Dr(),n=ade(),s=u.useCallback(()=>{n(t.image_url)},[n,t.image_url]);return r.jsx(Kr,{icon:r.jsx(an,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:s})});ER.displayName="ImageMenuItemCopy";const MR=u.memo(()=>{const{t:e}=M(),t=z(),n=Dr(),s=u.useCallback(()=>{t(up([n]))},[t,n]);return r.jsx(Kr,{icon:r.jsx(ei,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});MR.displayName="ImageMenuItemDelete";const lde=()=>{const{t:e}=M(),t=z(),n=ce(vp);return{downloadImage:u.useCallback(async(i,o)=>{try{const a=n?{headers:{Authorization:`Bearer ${n}`}}:{},l=await fetch(i,a).then(h=>h.blob());if(!l)throw new Error("Unable to create Blob");const c=window.URL.createObjectURL(l),d=document.createElement("a");d.style.display="none",d.href=c,d.download=o,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),t(XK())}catch(a){ve({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(a),status:"error"})}},[e,t,n])}},PR=u.memo(()=>{const{t:e}=M(),t=Dr(),{downloadImage:n}=lde(),s=u.useCallback(()=>{n(t.image_url,t.image_name)},[n,t.image_name,t.image_url]);return r.jsx(Kr,{icon:r.jsx(ed,{}),"aria-label":e("parameters.downloadImage"),tooltip:e("parameters.downloadImage"),onClick:s})});PR.displayName="ImageMenuItemDownload";const cde=()=>r.jsx(A,{w:"14px",alignItems:"center",justifyContent:"center",children:r.jsx(rr,{size:"xs"})}),LR=u.memo(()=>{const{t:e}=M(),t=Dr(),[n,{isLoading:s}]=QP(),i=ce(cp),o=u.useCallback(()=>{n(t.image_name)},[n,t.image_name]);return r.jsx(he,{icon:s?r.jsx(cde,{}):r.jsx(Ey,{}),onClickCapture:o,isDisabled:!t.has_workflow||!i,children:e("nodes.loadWorkflow")})});LR.displayName="ImageMenuItemLoadWorkflow";const ude=[0,8],er=()=>{const e=QK(!1),t=u.useRef(null),n=JP(e.close,300),s=u.useCallback(()=>{n.cancel(),e.open()},[n,e]),i=u.useCallback(()=>{if(e.isOpen){e.close();return}else n.cancel(),e.toggle()},[n,e]),o=u.useCallback(l=>{if(l.currentTarget.contains(l.relatedTarget)){n.cancel();return}e.close()},[n,e]),a=u.useCallback(l=>{l.pointerType==="pen"||l.pointerType==="touch"||e.close()},[e]);return u.useEffect(()=>{if(!t.current)return;const c=new AbortController;return window.addEventListener("click",d=>{var h;(h=t.current)!=null&&h.contains(d.target)||e.close()},{signal:c.signal}),()=>{c.abort()}},[e]),{parentMenuItemProps:{onClick:i,onPointerEnter:s,onPointerLeave:a,closeOnSelect:!1},menuProps:{isOpen:e.isOpen,onClose:e.close,placement:"right",offset:ude,closeOnBlur:!1},menuButtonProps:{as:Se,width:"full",height:"full"},menuListProps:{ref:t,onPointerEnter:s,onPointerLeave:n,onBlur:o}}},tr=({label:e})=>r.jsxs(A,{w:"full",h:"full",flexDir:"row",justifyContent:"space-between",alignItems:"center",children:[r.jsx(q,{children:e}),r.jsx(dt,{as:Ty})]}),DR=u.memo(()=>{const{t:e}=M(),t=Dr(),n=er(),{recallAll:s,remix:i,recallSeed:o,recallPrompts:a,hasMetadata:l,hasSeed:c,hasPrompts:d,createAsPreset:h}=gw(t);return r.jsx(he,{...n.parentMenuItemProps,icon:r.jsx(ML,{}),children:r.jsxs(Yt,{...n.menuProps,children:[r.jsx(Xt,{...n.menuButtonProps,children:r.jsx(tr,{label:e("parameters.recallMetadata")})}),r.jsxs(It,{...n.menuListProps,children:[r.jsx(he,{icon:r.jsx(b0,{}),onClick:i,isDisabled:!l,children:e("parameters.remixImage")}),r.jsx(he,{icon:r.jsx(ZL,{}),onClick:a,isDisabled:!d,children:e("parameters.usePrompt")}),r.jsx(he,{icon:r.jsx(qL,{}),onClick:o,isDisabled:!c,children:e("parameters.useSeed")}),r.jsx(he,{icon:r.jsx(LL,{}),onClick:s,isDisabled:!l,children:e("parameters.useAll")}),r.jsx(he,{icon:r.jsx(Mw,{}),onClick:h,isDisabled:!d,children:e("stylePresets.useForTemplate")})]})]})})});DR.displayName="ImageMenuItemMetadataRecallActions";const st=()=>{const e=Et();return ce(e.$isBusy)},RR=u.memo(()=>{const{t:e}=M(),t=er(),n=jn(),s=Dr(),i=Lt(),o=st(),a=I(Jl),l=u.useCallback(()=>{const{dispatch:f,getState:p}=n;Bg({imageDTO:s,withResize:!1,type:"raster_layer",dispatch:f,getState:p}),f(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),c=u.useCallback(()=>{const{dispatch:f,getState:p}=n;Bg({imageDTO:s,withResize:!1,type:"control_layer",dispatch:f,getState:p}),f(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:f,getState:p}=n;Bg({imageDTO:s,withResize:!0,type:"raster_layer",dispatch:f,getState:p}),f(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),h=u.useCallback(()=>{const{dispatch:f,getState:p}=n;Bg({imageDTO:s,withResize:!0,type:"control_layer",dispatch:f,getState:p}),f(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Gt,{}),children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.newCanvasFromImage")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx($g,{}),onClickCapture:l,isDisabled:o,children:e("controlLayers.asRasterLayer")}),r.jsx(he,{icon:r.jsx($g,{}),onClickCapture:d,isDisabled:o,children:e("controlLayers.asRasterLayerResize")}),r.jsx(he,{icon:r.jsx($g,{}),onClickCapture:c,isDisabled:o||a,children:e("controlLayers.asControlLayer")}),r.jsx(he,{icon:r.jsx($g,{}),onClickCapture:h,isDisabled:o||a,children:e("controlLayers.asControlLayerResize")})]})]})})});RR.displayName="ImageMenuItemNewCanvasFromImageSubMenu";const dde=Qo(ele),hs=()=>r.jsx(dde,{transform:"rotate(90deg)"}),OR=u.memo(()=>{const{t:e}=M(),t=er(),n=jn(),s=Dr(),i=Lt(),o=st(),a=I(ji),l=I(Jl),c=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"raster_layer",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"control_layer",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),h=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"inpaint_mask",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),f=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"regional_guidance",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),p=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"reference_image",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),g=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Hr({imageDTO:s,type:"regional_guidance_with_reference_image",dispatch:m,getState:y}),m(vc()),m(Kt("canvas")),i.close(),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Gt,{}),children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.newLayerFromImage")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:h,isDisabled:o,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:f,isDisabled:o||a||l,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:d,isDisabled:o||l,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:c,isDisabled:o,children:e("controlLayers.rasterLayer")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:g,isDisabled:o,children:e("controlLayers.referenceImageRegional")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:p,isDisabled:o,children:e("controlLayers.referenceImageGlobal")})]})]})})});OR.displayName="ImageMenuItemNewLayerFromImageSubMenu";const NR=u.memo(()=>{const{t:e}=M(),t=Dr(),n=z(),s=u.useCallback(()=>{window.open(t.image_url,"_blank"),n(JK())},[t.image_url,n]);return r.jsx(Kr,{onClickCapture:s,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:r.jsx(Iy,{})})});NR.displayName="ImageMenuItemOpenInNewTab";const FR=u.memo(()=>{const{t:e}=M(),t=Dr(),n=Lt(),s=u.useCallback(()=>{n.openImageInViewer(t)},[t,n]);return r.jsx(Kr,{icon:r.jsx(Ay,{}),onClickCapture:s,"aria-label":e("common.openInViewer"),tooltip:e("common.openInViewer")})});FR.displayName="ImageMenuItemOpenInViewer";const BR=u.memo(()=>{const{t:e}=M(),t=z(),n=Dr(),s=u.useMemo(()=>pe(kr,a=>{var l;return((l=a.imageToCompare)==null?void 0:l.image_name)!==n.image_name}),[n.image_name]),i=I(s),o=u.useCallback(()=>{t(gp(n))},[t,n]);return r.jsx(Kr,{icon:r.jsx(GL,{}),isDisabled:!i,onClick:o,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});BR.displayName="ImageMenuItemSelectForCompare";const $R=u.memo(()=>{const{t:e}=M(),t=z(),n=Dr(),s=u.useCallback(()=>{t(u0(n)),t(Kt("upscaling")),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return r.jsx(he,{icon:r.jsx(YL,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});$R.displayName="ImageMenuItemSendToUpscale";const VR=u.memo(()=>{const{t:e}=M(),t=Dr(),n=ce(AS),[s]=TS(),[i]=ES(),o=u.useCallback(()=>{t&&s({imageDTOs:[t]})},[s,t]),a=u.useCallback(()=>{t&&i({imageDTOs:[t]})},[i,t]);return t.starred?r.jsx(he,{icon:n?n.off.icon:r.jsx(Ow,{}),onClickCapture:a,children:n?n.off.text:e("gallery.unstarImage")}):r.jsx(he,{icon:n?n.on.icon:r.jsx(Pw,{}),onClickCapture:o,children:n?n.on.text:e("gallery.starImage")})});VR.displayName="ImageMenuItemStarUnstar";const hde=({imageDTO:e})=>r.jsxs(ide,{value:e,children:[r.jsxs(od,{children:[r.jsx(NR,{}),r.jsx(ER,{}),r.jsx(PR,{}),r.jsx(FR,{}),r.jsx(BR,{}),r.jsx(MR,{})]}),r.jsx(vs,{}),r.jsx(LR,{}),r.jsx(DR,{}),r.jsx(vs,{}),r.jsx($R,{}),r.jsxs(bi,{children:[r.jsx(RR,{}),r.jsx(OR,{})]}),r.jsx(vs,{}),r.jsx(AR,{}),r.jsx(VR,{})]}),GR=u.memo(hde),fde=500,pde=10,uu=eZ({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),lf=()=>{uu.setKey("isOpen",!1)},G2=new Map,gde=e=>{const t=Array.from(G2.entries()).find(n=>n[0].contains(e));return t==null?void 0:t[1]},zR=(e,t)=>{u.useEffect(()=>{if(!t||!e)return;const n=t;return G2.set(n,e),()=>{G2.delete(n)}},[e,t])},HR=u.memo(()=>{kt("ImageContextMenu");const e=ce(uu);return bp(lf),r.jsxs(za,{children:[r.jsxs(Yt,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:lf,children:[r.jsx(Xt,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:mde,pointerEvents:"none"}),r.jsx(UR,{})]}),r.jsx(WR,{})]})});HR.displayName="ImageContextMenu";const mde={bg:"transparent"},WR=u.memo(()=>{const e=u.useRef({x:-1,y:-1}),t=u.useRef(0),n=u.useRef(0),s=u.useCallback(c=>{if(c.shiftKey){lf();return}const d=gde(c.target);if(!d){lf();return}window.clearTimeout(n.current),c.preventDefault(),e.current.x!==c.pageX||e.current.y!==c.pageY?(uu.get().isOpen&&lf(),n.current=window.setTimeout(()=>{uu.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d})},100)):uu.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d}),e.current={x:c.pageX,y:c.pageY}},[]),i=u.useCallback(c=>{c.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(c)},fde),e.current={x:c.pageX,y:c.pageY})},[s]),o=u.useCallback(c=>{if(c.pointerType==="mouse"||t.current===null)return;const d=e.current;Math.hypot(c.pageX-d.x,c.pageY-d.y)>pde&&clearTimeout(t.current)},[]),a=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),l=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return u.useEffect(()=>{const c=new AbortController;return window.addEventListener("contextmenu",s,{signal:c.signal}),window.addEventListener("pointerdown",i,{signal:c.signal}),window.addEventListener("pointerup",a,{signal:c.signal}),window.addEventListener("pointercancel",l,{signal:c.signal}),window.addEventListener("pointermove",o,{signal:c.signal}),()=>{c.abort()}},[s,l,i,o,a]),u.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});WR.displayName="ImageContextMenuEventLogical";const UR=u.memo(()=>{const e=I(PS),t=ce(uu);return t.imageDTO?e>1?r.jsx(It,{visibility:"visible",children:r.jsx(rde,{})}):r.jsx(It,{visibility:"visible",children:r.jsx(GR,{imageDTO:t.imageDTO})}):null});UR.displayName="MenuContent";const As=u.memo(({loadingMessage:e})=>r.jsx(A,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:r.jsxs(A,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[r.jsx(rr,{}),r.jsx(q,{variant:"subtext",children:e||"Fetching..."})]})}));As.displayName="FetchingModelsLoader";const z2=e=>[e,...e.dependencies||[]],qR=()=>{const{modelList:e}=xp(void 0,{selectFromResult:({data:s})=>({modelList:s?Va.selectAll(s):xs})}),t=u.useCallback(({source:s,name:i,base:o,type:a,is_installed:l,previous_names:c})=>e.some(d=>l||s===d.source||o===d.base&&(i===d.name||(c==null?void 0:c.includes(i)))&&a===d.type),[e]),n=u.useCallback(s=>{const{name:i,base:o,type:a,source:l,description:c,format:d}=s;return{config:{name:i,base:o,type:a,description:c,format:d},source:l}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},yde=({bundleName:e,bundle:t})=>{const[n]=mE(),{getIsInstalled:s,buildModelInstallArg:i}=qR(),{t:o}=M(),a=u.useMemo(()=>{const c=fie(t,z2),d=ZP(c,(p,g)=>p.source===g.source||p.name===g.name&&p.base===g.base&&p.type===g.type),h=d.filter(KP(s)).map(i),f=d.filter(s).map(i);return{install:h,skip:f}},[i,t,s]),l=u.useCallback(()=>{a.install.forEach(n);let c=o("modelManager.installingXModels",{count:a.install.length});a.skip.length>1&&(c+=o("modelManager.skippingXDuplicates",{count:a.skip.length-1})),ve({status:"info",title:o("modelManager.installingBundle"),description:c})},[a.install,a.skip.length,n,o]);return r.jsx(De,{label:r.jsxs(A,{flexDir:"column",p:1,children:[r.jsxs(q,{children:[o("modelManager.includesNModels",{n:t.length}),":"]}),r.jsx(Pi,{children:t.map((c,d)=>r.jsx(Vt,{wordBreak:"break-all",children:c.name},d))})]}),children:r.jsx(ye,{size:"sm",onClick:l,py:6,isDisabled:a.install.length===0,children:r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{children:tZ(e)?yE[e]:e}),a.install.length>0&&r.jsxs(q,{fontSize:"xs",children:["(",t.length," ",o("settings.models"),")"]}),a.install.length===0&&r.jsx(q,{fontSize:"xs",children:o("common.installed")})]})})})},ad=()=>{const{t:e}=M(),[t,n]=mE();return[u.useCallback(({source:i,inplace:o,config:a,onSuccess:l,onError:c})=>{a||(a={}),t({source:i,inplace:o,config:a}).unwrap().then(d=>{l&&l(),ve({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(d=>{c&&c(d),d&&ve({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${d.data.detail} `,status:"error"})})},[t,e]),n]},vde={any:"base","sd-1":"green","sd-2":"teal","sd-3":"purple",sdxl:"invokeBlue","sdxl-refiner":"invokeBlue",flux:"gold"},bde=({base:e})=>r.jsx(is,{flexGrow:0,colorScheme:vde[e],variant:"subtle",h:"min-content",children:yE[e]}),KR=u.memo(bde),ZR=u.memo(({starterModel:e})=>{const{t}=M(),{getIsInstalled:n,buildModelInstallArg:s}=qR(),i=u.useMemo(()=>z2(e).every(n),[n,e]),o=u.useMemo(()=>z2(e).filter(KP(n)).map(s),[n,e,s]),[a]=ad(),l=u.useCallback(()=>{o.forEach(a),ve({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:o.length})})},[o,a,t]);return r.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(A,{fontSize:"sm",flexDir:"column",children:[r.jsxs(A,{gap:3,children:[r.jsx(is,{h:"min-content",children:e.type.replaceAll("_"," ")}),r.jsx(KR,{base:e.base}),r.jsx(q,{fontWeight:"semibold",children:e.name})]}),r.jsx(q,{variant:"subtext",children:e.description})]}),r.jsx(Se,{children:i?r.jsx(is,{children:t("common.installed")}):r.jsx(oe,{"aria-label":t("modelManager.install"),icon:r.jsx(Gt,{}),onClick:l,size:"sm"})})]})});ZR.displayName="StarterModelsResultItem";const YR=u.memo(({results:e})=>{const{t}=M(),[n,s]=u.useState(""),i=u.useMemo(()=>e.starter_models.filter(l=>{const c=n.trim().toLowerCase(),d=[l.name.toLowerCase(),l.type.toLowerCase().replaceAll("_"," "),l.description.toLowerCase(),l.base.toLowerCase()];return l.type==="spandrel_image_to_image"&&(d.push("upscale"),d.push("post-processing"),d.push("postprocessing"),d.push("post processing")),d.some(h=>h.includes(c))}),[e,n]),o=u.useCallback(l=>{s(l.target.value)},[]),a=u.useCallback(()=>{s("")},[]);return r.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[LS(e.starter_bundles)>0&&r.jsxs(A,{gap:4,alignItems:"center",children:[r.jsxs(A,{gap:2,alignItems:"center",children:[r.jsx(q,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),r.jsx(De,{label:t("modelManager.starterBundleHelpText"),children:r.jsx(A,{alignItems:"center",children:r.jsx(dt,{as:td,color:"base.200"})})})]}),r.jsx(A,{gap:2,children:_i(e.starter_bundles,(l,c)=>r.jsx(yde,{bundleName:c,bundle:l},c))})]}),r.jsxs(Jo,{w:64,size:"xs",children:[r.jsx(jt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:o,size:"xs"}),n&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:a,flexShrink:0})})]})]}),r.jsx(A,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx($n,{children:r.jsx(A,{flexDir:"column",gap:3,children:i.map(l=>r.jsx(ZR,{starterModel:l},l.source))})})})]})});YR.displayName="StarterModelsResults";const XR=u.memo(()=>{const{isLoading:e,data:t}=nZ(),{t:n}=M();return r.jsxs(A,{flexDir:"column",height:"100%",gap:3,children:[e&&r.jsx(As,{loadingMessage:n("common.loading")}),t&&r.jsx(YR,{results:t})]})});XR.displayName="StarterModelsForm";const r6=Fs("events"),xde=Hi.endpoints.listModelInstalls.select(),M0=_e("unauthorized-toast"),i6=_e("forbidden-toast"),Cde=e=>{switch(e){case"invalid":return Te("modelManager.hfTokenInvalid");case"unknown":return Te("modelManager.hfTokenUnableToVerify");case"valid":return"HF Token is valid, but does not have access to model"}},Sde=async e=>{const t=e(Hi.endpoints.getHFTokenStatus.initiate(void 0,{subscribe:!1}));try{return await t.unwrap()}catch{return null}},wde=(e,t)=>async n=>{r6.error({data:n},"Model install error");const s=xde(e()).data;if(n.error==="Unauthorized")if(n.source.type==="hf"){const o=await Sde(t);if(o===null)r6.error("Error getting HF token status");else{const a=Cde(o);ve({id:M0,title:a,description:r.jsx(jde,{}),status:"error",isClosable:!0,duration:null})}}else n.source.type==="url"?ve({id:M0,title:"Model requires authorization",description:r.jsxs(q,{fontSize:"md",children:[Te("modelManager.urlUnauthorizedErrorMessage"),r.jsx(Js,{label:Te("modelManager.urlUnauthorizedErrorMessage2"),href:"https://invoke-ai.github.io/InvokeAI/configuration/#model-marketplace-api-keys"})]}),status:"error",isClosable:!0,duration:null}):Ge(!1,"Unexpected unauthorized error for path source");else n.error==="Forbidden"?n.source.type==="hf"?ve({id:i6,title:Te("modelManager.hfForbidden"),description:r.jsxs(q,{fontSize:"md",children:[Te("modelManager.hfForbiddenErrorMessage"),r.jsx(Js,{label:n.source.repo_id,href:`https://huggingface.co/${n.source.repo_id}`})]}),status:"error",isClosable:!0,duration:null}):n.source.type==="url"?ve({id:i6,title:Te("modelManager.urlForbidden"),description:Te("modelManager.urlForbiddenErrorMessage"),status:"error",isClosable:!0,duration:null}):Ge(!1,"Unexpected forbidden error for path source"):ve({title:"Model install error",description:n.error,status:"error",isClosable:!0,duration:null});const i=s==null?void 0:s.find(o=>o.id===n.id);i?(i.source,t(Hi.util.updateQueryData("listModelInstalls",void 0,o=>{const a=o.find(l=>l.id===n.id);return a&&(a.status="error",a.error_reason=n.error_type,a.error=n.error),o}))):t(To.util.invalidateTags([{type:"ModelInstalls"}]))},jde=()=>{const e=en("hfToken"),{data:t}=DS(e?void 0:ws),{t:n}=M(),s=z(),i=u.useCallback(()=>{s(Kt("models")),sZ.close(M0)},[s]);if(!t)return r.jsx(rr,{});if(t==="invalid")return r.jsxs(q,{fontSize:"md",children:[n("modelManager.hfTokenInvalidErrorMessage")," ",n("modelManager.hfTokenRequired")," ",n("modelManager.hfTokenInvalidErrorMessage2"),r.jsxs(ye,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});if(t==="unknown")return r.jsxs(q,{fontSize:"md",children:[n("modelManager.hfTokenUnableToErrorMessage")," ",r.jsxs(ye,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});Ge(!1,"Unexpected valid HF token with unauthorized error")},kde=()=>{const{t:e}=M(),t=en("hfToken"),[n,s]=u.useState(""),{currentData:i}=DS(t?void 0:ws),[o,{isLoading:a,isUninitialized:l}]=rZ(),c=u.useCallback(f=>{s(f.target.value)},[]),d=u.useCallback(()=>{o({token:n}).unwrap().then(f=>{f==="valid"&&(s(""),ve({id:M0,title:e("modelManager.hfTokenSaved"),status:"success",duration:3e3}))})},[e,n,o]),h=u.useMemo(()=>!i||l||a?null:i==="invalid"?e("modelManager.hfTokenInvalidErrorMessage"):i==="unknown"?e("modelManager.hfTokenUnableToVerifyErrorMessage"):null,[i,a,l,e]);return!i||i==="valid"?null:r.jsx(A,{borderRadius:"base",w:"full",children:r.jsxs(Z,{isInvalid:!l&&!!h,orientation:"vertical",children:[r.jsx(te,{children:e("modelManager.hfTokenLabel")}),r.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[r.jsx(jt,{type:"password",value:n,onChange:c}),r.jsx(ye,{onClick:d,size:"sm",isDisabled:n.trim().length===0,isLoading:a,children:e("common.save")})]}),r.jsx(Zs,{children:r.jsx(Js,{label:e("modelManager.hfTokenHelperText"),href:"https://huggingface.co/settings/tokens"})}),r.jsx(Cp,{children:h})]})})},QR=u.memo(({result:e})=>{const{t}=M(),[n]=ad(),s=u.useCallback(()=>{n({source:e})},[n,e]);return r.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(A,{fontSize:"sm",flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),r.jsx(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),r.jsx(oe,{"aria-label":t("modelManager.install"),icon:r.jsx(Gt,{}),onClick:s,size:"sm"})]})});QR.displayName="HuggingFaceResultItem";const JR=u.memo(({results:e})=>{const{t}=M(),[n,s]=u.useState(""),[i]=ad(),o=u.useMemo(()=>e.filter(d=>{const h=d.split("/").slice(-1)[0];return h==null?void 0:h.toLowerCase().includes(n.toLowerCase())}),[e,n]),a=u.useCallback(d=>{s(d.target.value.trim())},[]),l=u.useCallback(()=>{s("")},[]),c=u.useCallback(()=>{for(const d of o)i({source:d})},[o,i]);return r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Rt,{size:"sm",children:t("modelManager.availableModels")}),r.jsxs(A,{alignItems:"center",gap:3,children:[r.jsx(ye,{size:"sm",onClick:c,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),r.jsxs(Jo,{w:64,size:"xs",children:[r.jsx(jt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:a,size:"xs"}),n&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:l})})]})]})]}),r.jsx(A,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx($n,{children:r.jsx(A,{flexDir:"column",gap:3,children:o.map(d=>r.jsx(QR,{result:d},d))})})})]})]})});JR.displayName="HuggingFaceResults";const e7=u.memo(()=>{const[e,t]=u.useState(""),[n,s]=u.useState(!1),[i,o]=u.useState(""),{t:a}=M(),l=en("hfToken"),{currentData:c}=DS(l?void 0:ws),[d,{isLoading:h,data:f}]=iZ(),[p]=ad(),g=u.useCallback(()=>{d(e).unwrap().then(y=>{var b;y.is_diffusers?(p({source:e}),s(!1)):((b=y.urls)==null?void 0:b.length)===1&&y.urls[0]?(p({source:y.urls[0]}),s(!1)):s(!0)}).catch(y=>{o(y.data.detail||"")})},[d,p,e]),m=u.useCallback(y=>{t(y.target.value),o("")},[]);return r.jsxs(A,{flexDir:"column",height:"100%",gap:4,children:[r.jsxs(Z,{isInvalid:!!i.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(te,{children:a("modelManager.huggingFaceRepoID")}),r.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[r.jsx(jt,{placeholder:a("modelManager.huggingFacePlaceholder"),value:e,onChange:m}),r.jsx(ye,{onClick:g,isLoading:h,isDisabled:e.length===0,size:"sm",flexShrink:0,children:a("modelManager.installRepo")})]}),r.jsx(Zs,{children:a("modelManager.huggingFaceHelper")}),!!i.length&&r.jsx(Cp,{children:i})]}),c!=="valid"&&r.jsx(kde,{}),f&&f.urls&&n&&r.jsx(JR,{results:f.urls})]})});e7.displayName="HuggingFaceForm";var qp=e=>e.type==="checkbox",Kc=e=>e instanceof Date,Ms=e=>e==null;const t7=e=>typeof e=="object";var Nn=e=>!Ms(e)&&!Array.isArray(e)&&t7(e)&&!Kc(e),n7=e=>Nn(e)&&e.target?qp(e.target)?e.target.checked:e.target.value:e,_de=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,s7=(e,t)=>e.has(_de(t)),Ide=e=>{const t=e.constructor&&e.constructor.prototype;return Nn(t)&&t.hasOwnProperty("isPrototypeOf")},aj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ws(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(aj&&(e instanceof Blob||e instanceof FileList))&&(n||Nn(e)))if(t=n?[]:{},!n&&!Ide(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=Ws(e[s]));else return e;return t}var qy=e=>Array.isArray(e)?e.filter(Boolean):[],Cn=e=>e===void 0,Me=(e,t,n)=>{if(!t||!Nn(e))return n;const s=qy(t.split(/[,[\].]+?/)).reduce((i,o)=>Ms(i)?i:i[o],e);return Cn(s)||s===e?Cn(e[t])?n:e[t]:s},zr=e=>typeof e=="boolean",lj=e=>/^\w*$/.test(e),r7=e=>qy(e.replace(/["|']|\]/g,"").split(/\.|\[/)),qt=(e,t,n)=>{let s=-1;const i=lj(t)?[t]:r7(t),o=i.length,a=o-1;for(;++s<o;){const l=i[s];let c=n;if(s!==a){const d=e[l];c=Nn(d)||Array.isArray(d)?d:isNaN(+i[s+1])?{}:[]}if(l==="__proto__")return;e[l]=c,e=e[l]}return e};const P0={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},xi={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},_o={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Ade=me.createContext(null),cj=()=>me.useContext(Ade);var i7=(e,t,n,s=!0)=>{const i={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(i,o,{get:()=>{const a=o;return t._proxyFormState[a]!==xi.all&&(t._proxyFormState[a]=!s||xi.all),n&&(n[a]=!0),e[a]}});return i},Us=e=>Nn(e)&&!Object.keys(e).length,o7=(e,t,n,s)=>{n(e);const{name:i,...o}=e;return Us(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(a=>t[a]===(!s||xi.all))},cf=e=>Array.isArray(e)?e:[e],a7=(e,t,n)=>!e||!t||e===t||cf(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s)));function uj(e){const t=me.useRef(e);t.current=e,me.useEffect(()=>{const n=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{n&&n.unsubscribe()}},[e.disabled])}function Tde(e){const t=cj(),{control:n=t.control,disabled:s,name:i,exact:o}=e||{},[a,l]=me.useState(n._formState),c=me.useRef(!0),d=me.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),h=me.useRef(i);return h.current=i,uj({disabled:s,next:f=>c.current&&a7(h.current,f.name,o)&&o7(f,d.current,n._updateFormState)&&l({...n._formState,...f}),subject:n._subjects.state}),me.useEffect(()=>(c.current=!0,d.current.isValid&&n._updateValid(!0),()=>{c.current=!1}),[n]),i7(a,n,d.current,!1)}var Xi=e=>typeof e=="string",l7=(e,t,n,s,i)=>Xi(e)?(s&&t.watch.add(e),Me(n,e,i)):Array.isArray(e)?e.map(o=>(s&&t.watch.add(o),Me(n,o))):(s&&(t.watchAll=!0),n);function Ede(e){const t=cj(),{control:n=t.control,name:s,defaultValue:i,disabled:o,exact:a}=e||{},l=me.useRef(s);l.current=s,uj({disabled:o,subject:n._subjects.values,next:h=>{a7(l.current,h.name,a)&&d(Ws(l7(l.current,n._names,h.values||n._formValues,!1,i)))}});const[c,d]=me.useState(n._getWatch(s,i));return me.useEffect(()=>n._removeUnmounted()),c}function os(e){const t=cj(),{name:n,disabled:s,control:i=t.control,shouldUnregister:o}=e,a=s7(i._names.array,n),l=Ede({control:i,name:n,defaultValue:Me(i._formValues,n,Me(i._defaultValues,n,e.defaultValue)),exact:!0}),c=Tde({control:i,name:n,exact:!0}),d=me.useRef(i.register(n,{...e.rules,value:l,...zr(e.disabled)?{disabled:e.disabled}:{}}));return me.useEffect(()=>{const h=i._options.shouldUnregister||o,f=(p,g)=>{const m=Me(i._fields,p);m&&m._f&&(m._f.mount=g)};if(f(n,!0),h){const p=Ws(Me(i._options.defaultValues,n));qt(i._defaultValues,n,p),Cn(Me(i._formValues,n))&&qt(i._formValues,n,p)}return()=>{(a?h&&!i._state.action:h)?i.unregister(n):f(n,!1)}},[n,i,a,o]),me.useEffect(()=>{Me(i._fields,n)&&i._updateDisabledField({disabled:s,fields:i._fields,name:n,value:Me(i._fields,n)._f.value})},[s,n,i]),{field:{name:n,value:l,...zr(s)||c.disabled?{disabled:c.disabled||s}:{},onChange:me.useCallback(h=>d.current.onChange({target:{value:n7(h),name:n},type:P0.CHANGE}),[n]),onBlur:me.useCallback(()=>d.current.onBlur({target:{value:Me(i._formValues,n),name:n},type:P0.BLUR}),[n,i]),ref:me.useCallback(h=>{const f=Me(i._fields,n);f&&h&&(f._f.ref={focus:()=>h.focus(),select:()=>h.select(),setCustomValidity:p=>h.setCustomValidity(p),reportValidity:()=>h.reportValidity()})},[i._fields,n])},formState:c,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Me(c.errors,n)},isDirty:{enumerable:!0,get:()=>!!Me(c.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Me(c.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!Me(c.validatingFields,n)},error:{enumerable:!0,get:()=>Me(c.errors,n)}})}}var Mde=(e,t,n,s,i)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:i||!0}}:{},o6=e=>({isOnSubmit:!e||e===xi.onSubmit,isOnBlur:e===xi.onBlur,isOnChange:e===xi.onChange,isOnAll:e===xi.all,isOnTouch:e===xi.onTouched}),a6=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const uf=(e,t,n,s)=>{for(const i of n||Object.keys(e)){const o=Me(e,i);if(o){const{_f:a,...l}=o;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],i)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if(uf(l,t))break}else if(Nn(l)&&uf(l,t))break}}};var Pde=(e,t,n)=>{const s=cf(Me(e,n));return qt(s,"root",t[n]),qt(e,n,s),e},dj=e=>e.type==="file",$o=e=>typeof e=="function",L0=e=>{if(!aj)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Hm=e=>Xi(e),hj=e=>e.type==="radio",D0=e=>e instanceof RegExp;const l6={value:!1,isValid:!1},c6={value:!0,isValid:!0};var c7=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Cn(e[0].attributes.value)?Cn(e[0].value)||e[0].value===""?c6:{value:e[0].value,isValid:!0}:c6:l6}return l6};const u6={isValid:!1,value:null};var u7=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,u6):u6;function d6(e,t,n="validate"){if(Hm(e)||Array.isArray(e)&&e.every(Hm)||zr(e)&&!e)return{type:n,message:Hm(e)?e:"",ref:t}}var Sc=e=>Nn(e)&&!D0(e)?e:{value:e,message:""},h6=async(e,t,n,s,i)=>{const{ref:o,refs:a,required:l,maxLength:c,minLength:d,min:h,max:f,pattern:p,validate:g,name:m,valueAsNumber:y,mount:b,disabled:C}=e._f,v=Me(t,m);if(!b||C)return{};const x=a?a[0]:o,S=F=>{s&&x.reportValidity&&(x.setCustomValidity(zr(F)?"":F||""),x.reportValidity())},w={},j=hj(o),P=qp(o),T=j||P,L=(y||dj(o))&&Cn(o.value)&&Cn(v)||L0(o)&&o.value===""||v===""||Array.isArray(v)&&!v.length,E=Mde.bind(null,m,n,w),O=(F,_,R,D=_o.maxLength,$=_o.minLength)=>{const G=F?_:R;w[m]={type:F?D:$,message:G,ref:o,...E(F?D:$,G)}};if(i?!Array.isArray(v)||!v.length:l&&(!T&&(L||Ms(v))||zr(v)&&!v||P&&!c7(a).isValid||j&&!u7(a).isValid)){const{value:F,message:_}=Hm(l)?{value:!!l,message:l}:Sc(l);if(F&&(w[m]={type:_o.required,message:_,ref:x,...E(_o.required,_)},!n))return S(_),w}if(!L&&(!Ms(h)||!Ms(f))){let F,_;const R=Sc(f),D=Sc(h);if(!Ms(v)&&!isNaN(v)){const $=o.valueAsNumber||v&&+v;Ms(R.value)||(F=$>R.value),Ms(D.value)||(_=$<D.value)}else{const $=o.valueAsDate||new Date(v),G=se=>new Date(new Date().toDateString()+" "+se),ee=o.type=="time",Q=o.type=="week";Xi(R.value)&&v&&(F=ee?G(v)>G(R.value):Q?v>R.value:$>new Date(R.value)),Xi(D.value)&&v&&(_=ee?G(v)<G(D.value):Q?v<D.value:$<new Date(D.value))}if((F||_)&&(O(!!F,R.message,D.message,_o.max,_o.min),!n))return S(w[m].message),w}if((c||d)&&!L&&(Xi(v)||i&&Array.isArray(v))){const F=Sc(c),_=Sc(d),R=!Ms(F.value)&&v.length>+F.value,D=!Ms(_.value)&&v.length<+_.value;if((R||D)&&(O(R,F.message,_.message),!n))return S(w[m].message),w}if(p&&!L&&Xi(v)){const{value:F,message:_}=Sc(p);if(D0(F)&&!v.match(F)&&(w[m]={type:_o.pattern,message:_,ref:o,...E(_o.pattern,_)},!n))return S(_),w}if(g){if($o(g)){const F=await g(v,t),_=d6(F,x);if(_&&(w[m]={..._,...E(_o.validate,_.message)},!n))return S(_.message),w}else if(Nn(g)){let F={};for(const _ in g){if(!Us(F)&&!n)break;const R=d6(await g[_](v,t),x,_);R&&(F={...R,...E(_,R.message)},S(R.message),n&&(w[m]=F))}if(!Us(F)&&(w[m]={ref:x,...F},!n))return w}}return S(!0),w};function Lde(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=Cn(e)?s++:e[t[s++]];return e}function Dde(e){for(const t in e)if(e.hasOwnProperty(t)&&!Cn(e[t]))return!1;return!0}function Vn(e,t){const n=Array.isArray(t)?t:lj(t)?[t]:r7(t),s=n.length===1?e:Lde(e,n),i=n.length-1,o=n[i];return s&&delete s[o],i!==0&&(Nn(s)&&Us(s)||Array.isArray(s)&&Dde(s))&&Vn(e,n.slice(0,-1)),e}var Ab=()=>{let e=[];return{get observers(){return e},next:i=>{for(const o of e)o.next&&o.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(o=>o!==i)}}),unsubscribe:()=>{e=[]}}},R0=e=>Ms(e)||!t7(e);function ba(e,t){if(R0(e)||R0(t))return e===t;if(Kc(e)&&Kc(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const i of n){const o=e[i];if(!s.includes(i))return!1;if(i!=="ref"){const a=t[i];if(Kc(o)&&Kc(a)||Nn(o)&&Nn(a)||Array.isArray(o)&&Array.isArray(a)?!ba(o,a):o!==a)return!1}}return!0}var d7=e=>e.type==="select-multiple",Rde=e=>hj(e)||qp(e),Tb=e=>L0(e)&&e.isConnected,h7=e=>{for(const t in e)if($o(e[t]))return!0;return!1};function O0(e,t={}){const n=Array.isArray(e);if(Nn(e)||n)for(const s in e)Array.isArray(e[s])||Nn(e[s])&&!h7(e[s])?(t[s]=Array.isArray(e[s])?[]:{},O0(e[s],t[s])):Ms(e[s])||(t[s]=!0);return t}function f7(e,t,n){const s=Array.isArray(e);if(Nn(e)||s)for(const i in e)Array.isArray(e[i])||Nn(e[i])&&!h7(e[i])?Cn(t)||R0(n[i])?n[i]=Array.isArray(e[i])?O0(e[i],[]):{...O0(e[i])}:f7(e[i],Ms(t)?{}:t[i],n[i]):n[i]=!ba(e[i],t[i]);return n}var Ug=(e,t)=>f7(e,t,O0(t)),p7=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>Cn(e)?e:t?e===""?NaN:e&&+e:n&&Xi(e)?new Date(e):s?s(e):e;function Eb(e){const t=e.ref;if(!(e.refs?e.refs.every(n=>n.disabled):t.disabled))return dj(t)?t.files:hj(t)?u7(e.refs).value:d7(t)?[...t.selectedOptions].map(({value:n})=>n):qp(t)?c7(e.refs).value:p7(Cn(t.value)?e.ref.value:t.value,e)}var Ode=(e,t,n,s)=>{const i={};for(const o of e){const a=Me(t,o);a&&qt(i,o,a._f)}return{criteriaMode:n,names:[...e],fields:i,shouldUseNativeValidation:s}},Sh=e=>Cn(e)?e:D0(e)?e.source:Nn(e)?D0(e.value)?e.value.source:e.value:e;const f6="AsyncFunction";var Nde=e=>(!e||!e.validate)&&!!($o(e.validate)&&e.validate.constructor.name===f6||Nn(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===f6)),Fde=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function p6(e,t,n){const s=Me(e,n);if(s||lj(n))return{error:s,name:n};const i=n.split(".");for(;i.length;){const o=i.join("."),a=Me(t,o),l=Me(e,o);if(a&&!Array.isArray(a)&&n!==o)return{name:n};if(l&&l.type)return{name:o,error:l};i.pop()}return{name:n}}var Bde=(e,t,n,s,i)=>i.isOnAll?!1:!n&&i.isOnTouch?!(t||e):(n?s.isOnBlur:i.isOnBlur)?!e:(n?s.isOnChange:i.isOnChange)?e:!0,$de=(e,t)=>!qy(Me(e,t)).length&&Vn(e,t);const Vde={mode:xi.onSubmit,reValidateMode:xi.onChange,shouldFocusError:!0};function Gde(e={}){let t={...Vde,...e},n={submitCount:0,isDirty:!1,isLoading:$o(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},i=Nn(t.defaultValues)||Nn(t.values)?Ws(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:Ws(i),a={action:!1,mount:!1,watch:!1},l={mount:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={values:Ab(),array:Ab(),state:Ab()},p=o6(t.mode),g=o6(t.reValidateMode),m=t.criteriaMode===xi.all,y=K=>re=>{clearTimeout(d),d=setTimeout(K,re)},b=async K=>{if(h.isValid||K){const re=t.resolver?Us((await T()).errors):await E(s,!0);re!==n.isValid&&f.state.next({isValid:re})}},C=(K,re)=>{(h.isValidating||h.validatingFields)&&((K||Array.from(l.mount)).forEach(ae=>{ae&&(re?qt(n.validatingFields,ae,re):Vn(n.validatingFields,ae))}),f.state.next({validatingFields:n.validatingFields,isValidating:!Us(n.validatingFields)}))},v=(K,re=[],ae,xe,ge=!0,fe=!0)=>{if(xe&&ae){if(a.action=!0,fe&&Array.isArray(Me(s,K))){const le=ae(Me(s,K),xe.argA,xe.argB);ge&&qt(s,K,le)}if(fe&&Array.isArray(Me(n.errors,K))){const le=ae(Me(n.errors,K),xe.argA,xe.argB);ge&&qt(n.errors,K,le),$de(n.errors,K)}if(h.touchedFields&&fe&&Array.isArray(Me(n.touchedFields,K))){const le=ae(Me(n.touchedFields,K),xe.argA,xe.argB);ge&&qt(n.touchedFields,K,le)}h.dirtyFields&&(n.dirtyFields=Ug(i,o)),f.state.next({name:K,isDirty:F(K,re),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else qt(o,K,re)},x=(K,re)=>{qt(n.errors,K,re),f.state.next({errors:n.errors})},S=K=>{n.errors=K,f.state.next({errors:n.errors,isValid:!1})},w=(K,re,ae,xe)=>{const ge=Me(s,K);if(ge){const fe=Me(o,K,Cn(ae)?Me(i,K):ae);Cn(fe)||xe&&xe.defaultChecked||re?qt(o,K,re?fe:Eb(ge._f)):D(K,fe),a.mount&&b()}},j=(K,re,ae,xe,ge)=>{let fe=!1,le=!1;const Ce={name:K},ze=!!(Me(s,K)&&Me(s,K)._f&&Me(s,K)._f.disabled);if(!ae||xe){h.isDirty&&(le=n.isDirty,n.isDirty=Ce.isDirty=F(),fe=le!==Ce.isDirty);const Qe=ze||ba(Me(i,K),re);le=!!(!ze&&Me(n.dirtyFields,K)),Qe||ze?Vn(n.dirtyFields,K):qt(n.dirtyFields,K,!0),Ce.dirtyFields=n.dirtyFields,fe=fe||h.dirtyFields&&le!==!Qe}if(ae){const Qe=Me(n.touchedFields,K);Qe||(qt(n.touchedFields,K,ae),Ce.touchedFields=n.touchedFields,fe=fe||h.touchedFields&&Qe!==ae)}return fe&&ge&&f.state.next(Ce),fe?Ce:{}},P=(K,re,ae,xe)=>{const ge=Me(n.errors,K),fe=h.isValid&&zr(re)&&n.isValid!==re;if(e.delayError&&ae?(c=y(()=>x(K,ae)),c(e.delayError)):(clearTimeout(d),c=null,ae?qt(n.errors,K,ae):Vn(n.errors,K)),(ae?!ba(ge,ae):ge)||!Us(xe)||fe){const le={...xe,...fe&&zr(re)?{isValid:re}:{},errors:n.errors,name:K};n={...n,...le},f.state.next(le)}},T=async K=>{C(K,!0);const re=await t.resolver(o,t.context,Ode(K||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return C(K),re},L=async K=>{const{errors:re}=await T(K);if(K)for(const ae of K){const xe=Me(re,ae);xe?qt(n.errors,ae,xe):Vn(n.errors,ae)}else n.errors=re;return re},E=async(K,re,ae={valid:!0})=>{for(const xe in K){const ge=K[xe];if(ge){const{_f:fe,...le}=ge;if(fe){const Ce=l.array.has(fe.name),ze=ge._f&&Nde(ge._f);ze&&h.validatingFields&&C([xe],!0);const Qe=await h6(ge,o,m,t.shouldUseNativeValidation&&!re,Ce);if(ze&&h.validatingFields&&C([xe]),Qe[fe.name]&&(ae.valid=!1,re))break;!re&&(Me(Qe,fe.name)?Ce?Pde(n.errors,Qe,fe.name):qt(n.errors,fe.name,Qe[fe.name]):Vn(n.errors,fe.name))}!Us(le)&&await E(le,re,ae)}}return ae.valid},O=()=>{for(const K of l.unMount){const re=Me(s,K);re&&(re._f.refs?re._f.refs.every(ae=>!Tb(ae)):!Tb(re._f.ref))&&J(K)}l.unMount=new Set},F=(K,re)=>(K&&re&&qt(o,K,re),!ba(ne(),i)),_=(K,re,ae)=>l7(K,l,{...a.mount?o:Cn(re)?i:Xi(K)?{[K]:re}:re},ae,re),R=K=>qy(Me(a.mount?o:i,K,e.shouldUnregister?Me(i,K,[]):[])),D=(K,re,ae={})=>{const xe=Me(s,K);let ge=re;if(xe){const fe=xe._f;fe&&(!fe.disabled&&qt(o,K,p7(re,fe)),ge=L0(fe.ref)&&Ms(re)?"":re,d7(fe.ref)?[...fe.ref.options].forEach(le=>le.selected=ge.includes(le.value)):fe.refs?qp(fe.ref)?fe.refs.length>1?fe.refs.forEach(le=>(!le.defaultChecked||!le.disabled)&&(le.checked=Array.isArray(ge)?!!ge.find(Ce=>Ce===le.value):ge===le.value)):fe.refs[0]&&(fe.refs[0].checked=!!ge):fe.refs.forEach(le=>le.checked=le.value===ge):dj(fe.ref)?fe.ref.value="":(fe.ref.value=ge,fe.ref.type||f.values.next({name:K,values:{...o}})))}(ae.shouldDirty||ae.shouldTouch)&&j(K,ge,ae.shouldTouch,ae.shouldDirty,!0),ae.shouldValidate&&se(K)},$=(K,re,ae)=>{for(const xe in re){const ge=re[xe],fe=`${K}.${xe}`,le=Me(s,fe);(l.array.has(K)||!R0(ge)||le&&!le._f)&&!Kc(ge)?$(fe,ge,ae):D(fe,ge,ae)}},G=(K,re,ae={})=>{const xe=Me(s,K),ge=l.array.has(K),fe=Ws(re);qt(o,K,fe),ge?(f.array.next({name:K,values:{...o}}),(h.isDirty||h.dirtyFields)&&ae.shouldDirty&&f.state.next({name:K,dirtyFields:Ug(i,o),isDirty:F(K,fe)})):xe&&!xe._f&&!Ms(fe)?$(K,fe,ae):D(K,fe,ae),a6(K,l)&&f.state.next({...n}),f.values.next({name:a.mount?K:void 0,values:{...o}})},ee=async K=>{a.mount=!0;const re=K.target;let ae=re.name,xe=!0;const ge=Me(s,ae),fe=()=>re.type?Eb(ge._f):n7(K),le=Ce=>{xe=Number.isNaN(Ce)||ba(Ce,Me(o,ae,Ce))};if(ge){let Ce,ze;const Qe=fe(),gt=K.type===P0.BLUR||K.type===P0.FOCUS_OUT,fn=!Fde(ge._f)&&!t.resolver&&!Me(n.errors,ae)&&!ge._f.deps||Bde(gt,Me(n.touchedFields,ae),n.isSubmitted,g,p),cn=a6(ae,l,gt);qt(o,ae,Qe),gt?(ge._f.onBlur&&ge._f.onBlur(K),c&&c(0)):ge._f.onChange&&ge._f.onChange(K);const pn=j(ae,Qe,gt,!1),es=!Us(pn)||cn;if(!gt&&f.values.next({name:ae,type:K.type,values:{...o}}),fn)return h.isValid&&(e.mode==="onBlur"?gt&&b():b()),es&&f.state.next({name:ae,...cn?{}:pn});if(!gt&&cn&&f.state.next({...n}),t.resolver){const{errors:ks}=await T([ae]);if(le(Qe),xe){const gn=p6(n.errors,s,ae),Bi=p6(ks,s,gn.name||ae);Ce=Bi.error,ae=Bi.name,ze=Us(ks)}}else C([ae],!0),Ce=(await h6(ge,o,m,t.shouldUseNativeValidation))[ae],C([ae]),le(Qe),xe&&(Ce?ze=!1:h.isValid&&(ze=await E(s,!0)));xe&&(ge._f.deps&&se(ge._f.deps),P(ae,ze,Ce,pn))}},Q=(K,re)=>{if(Me(n.errors,re)&&K.focus)return K.focus(),1},se=async(K,re={})=>{let ae,xe;const ge=cf(K);if(t.resolver){const fe=await L(Cn(K)?K:ge);ae=Us(fe),xe=K?!ge.some(le=>Me(fe,le)):ae}else K?(xe=(await Promise.all(ge.map(async fe=>{const le=Me(s,fe);return await E(le&&le._f?{[fe]:le}:le)}))).every(Boolean),!(!xe&&!n.isValid)&&b()):xe=ae=await E(s);return f.state.next({...!Xi(K)||h.isValid&&ae!==n.isValid?{}:{name:K},...t.resolver||!K?{isValid:ae}:{},errors:n.errors}),re.shouldFocus&&!xe&&uf(s,Q,K?ge:l.mount),xe},ne=K=>{const re={...a.mount?o:i};return Cn(K)?re:Xi(K)?Me(re,K):K.map(ae=>Me(re,ae))},H=(K,re)=>({invalid:!!Me((re||n).errors,K),isDirty:!!Me((re||n).dirtyFields,K),error:Me((re||n).errors,K),isValidating:!!Me(n.validatingFields,K),isTouched:!!Me((re||n).touchedFields,K)}),V=K=>{K&&cf(K).forEach(re=>Vn(n.errors,re)),f.state.next({errors:K?n.errors:{}})},Y=(K,re,ae)=>{const xe=(Me(s,K,{_f:{}})._f||{}).ref,ge=Me(n.errors,K)||{},{ref:fe,message:le,type:Ce,...ze}=ge;qt(n.errors,K,{...ze,...re,ref:xe}),f.state.next({name:K,errors:n.errors,isValid:!1}),ae&&ae.shouldFocus&&xe&&xe.focus&&xe.focus()},W=(K,re)=>$o(K)?f.values.subscribe({next:ae=>K(_(void 0,re),ae)}):_(K,re,!0),J=(K,re={})=>{for(const ae of K?cf(K):l.mount)l.mount.delete(ae),l.array.delete(ae),re.keepValue||(Vn(s,ae),Vn(o,ae)),!re.keepError&&Vn(n.errors,ae),!re.keepDirty&&Vn(n.dirtyFields,ae),!re.keepTouched&&Vn(n.touchedFields,ae),!re.keepIsValidating&&Vn(n.validatingFields,ae),!t.shouldUnregister&&!re.keepDefaultValue&&Vn(i,ae);f.values.next({values:{...o}}),f.state.next({...n,...re.keepDirty?{isDirty:F()}:{}}),!re.keepIsValid&&b()},N=({disabled:K,name:re,field:ae,fields:xe,value:ge})=>{if(zr(K)&&a.mount||K){const fe=K?void 0:Cn(ge)?Eb(ae?ae._f:Me(xe,re)._f):ge;qt(o,re,fe),j(re,fe,!1,!1,!0)}},B=(K,re={})=>{let ae=Me(s,K);const xe=zr(re.disabled)||zr(e.disabled);return qt(s,K,{...ae||{},_f:{...ae&&ae._f?ae._f:{ref:{name:K}},name:K,mount:!0,...re}}),l.mount.add(K),ae?N({field:ae,disabled:zr(re.disabled)?re.disabled:e.disabled,name:K,value:re.value}):w(K,!0,re.value),{...xe?{disabled:re.disabled||e.disabled}:{},...t.progressive?{required:!!re.required,min:Sh(re.min),max:Sh(re.max),minLength:Sh(re.minLength),maxLength:Sh(re.maxLength),pattern:Sh(re.pattern)}:{},name:K,onChange:ee,onBlur:ee,ref:ge=>{if(ge){B(K,re),ae=Me(s,K);const fe=Cn(ge.value)&&ge.querySelectorAll&&ge.querySelectorAll("input,select,textarea")[0]||ge,le=Rde(fe),Ce=ae._f.refs||[];if(le?Ce.find(ze=>ze===fe):fe===ae._f.ref)return;qt(s,K,{_f:{...ae._f,...le?{refs:[...Ce.filter(Tb),fe,...Array.isArray(Me(i,K))?[{}]:[]],ref:{type:fe.type,name:K}}:{ref:fe}}}),w(K,!1,void 0,fe)}else ae=Me(s,K,{}),ae._f&&(ae._f.mount=!1),(t.shouldUnregister||re.shouldUnregister)&&!(s7(l.array,K)&&a.action)&&l.unMount.add(K)}}},U=()=>t.shouldFocusError&&uf(s,Q,l.mount),ie=K=>{zr(K)&&(f.state.next({disabled:K}),uf(s,(re,ae)=>{const xe=Me(s,ae);xe&&(re.disabled=xe._f.disabled||K,Array.isArray(xe._f.refs)&&xe._f.refs.forEach(ge=>{ge.disabled=xe._f.disabled||K}))},0,!1))},de=(K,re)=>async ae=>{let xe;ae&&(ae.preventDefault&&ae.preventDefault(),ae.persist&&ae.persist());let ge=Ws(o);if(f.state.next({isSubmitting:!0}),t.resolver){const{errors:fe,values:le}=await T();n.errors=fe,ge=le}else await E(s);if(Vn(n.errors,"root"),Us(n.errors)){f.state.next({errors:{}});try{await K(ge,ae)}catch(fe){xe=fe}}else re&&await re({...n.errors},ae),U(),setTimeout(U);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Us(n.errors)&&!xe,submitCount:n.submitCount+1,errors:n.errors}),xe)throw xe},be=(K,re={})=>{Me(s,K)&&(Cn(re.defaultValue)?G(K,Ws(Me(i,K))):(G(K,re.defaultValue),qt(i,K,Ws(re.defaultValue))),re.keepTouched||Vn(n.touchedFields,K),re.keepDirty||(Vn(n.dirtyFields,K),n.isDirty=re.defaultValue?F(K,Ws(Me(i,K))):F()),re.keepError||(Vn(n.errors,K),h.isValid&&b()),f.state.next({...n}))},Ee=(K,re={})=>{const ae=K?Ws(K):i,xe=Ws(ae),ge=Us(K),fe=ge?i:xe;if(re.keepDefaultValues||(i=ae),!re.keepValues){if(re.keepDirtyValues)for(const le of l.mount)Me(n.dirtyFields,le)?qt(fe,le,Me(o,le)):G(le,Me(fe,le));else{if(aj&&Cn(K))for(const le of l.mount){const Ce=Me(s,le);if(Ce&&Ce._f){const ze=Array.isArray(Ce._f.refs)?Ce._f.refs[0]:Ce._f.ref;if(L0(ze)){const Qe=ze.closest("form");if(Qe){Qe.reset();break}}}}s={}}o=e.shouldUnregister?re.keepDefaultValues?Ws(i):{}:Ws(fe),f.array.next({values:{...fe}}),f.values.next({values:{...fe}})}l={mount:re.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!h.isValid||!!re.keepIsValid||!!re.keepDirtyValues,a.watch=!!e.shouldUnregister,f.state.next({submitCount:re.keepSubmitCount?n.submitCount:0,isDirty:ge?!1:re.keepDirty?n.isDirty:!!(re.keepDefaultValues&&!ba(K,i)),isSubmitted:re.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:ge?{}:re.keepDirtyValues?re.keepDefaultValues&&o?Ug(i,o):n.dirtyFields:re.keepDefaultValues&&K?Ug(i,K):re.keepDirty?n.dirtyFields:{},touchedFields:re.keepTouched?n.touchedFields:{},errors:re.keepErrors?n.errors:{},isSubmitSuccessful:re.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},je=(K,re)=>Ee($o(K)?K(o):K,re);return{control:{register:B,unregister:J,getFieldState:H,handleSubmit:de,setError:Y,_executeSchema:T,_getWatch:_,_getDirty:F,_updateValid:b,_removeUnmounted:O,_updateFieldArray:v,_updateDisabledField:N,_getFieldArray:R,_reset:Ee,_resetDefaultValues:()=>$o(t.defaultValues)&&t.defaultValues().then(K=>{je(K,t.resetOptions),f.state.next({isLoading:!1})}),_updateFormState:K=>{n={...n,...K}},_disableForm:ie,_subjects:f,_proxyFormState:h,_setErrors:S,get _fields(){return s},get _formValues(){return o},get _state(){return a},set _state(K){a=K},get _defaultValues(){return i},get _names(){return l},set _names(K){l=K},get _formState(){return n},set _formState(K){n=K},get _options(){return t},set _options(K){t={...t,...K}}},trigger:se,register:B,handleSubmit:de,watch:W,setValue:G,getValues:ne,reset:je,resetField:be,clearErrors:V,unregister:J,setError:Y,setFocus:(K,re={})=>{const ae=Me(s,K),xe=ae&&ae._f;if(xe){const ge=xe.refs?xe.refs[0]:xe.ref;ge.focus&&(ge.focus(),re.shouldSelect&&ge.select())}},getFieldState:H}}function Kp(e={}){const t=me.useRef(),n=me.useRef(),[s,i]=me.useState({isDirty:!1,isValidating:!1,isLoading:$o(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:$o(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...Gde(e),formState:s});const o=t.current.control;return o._options=e,uj({subject:o._subjects.state,next:a=>{o7(a,o._proxyFormState,o._updateFormState,!0)&&i({...o._formState})}}),me.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),me.useEffect(()=>{if(o._proxyFormState.isDirty){const a=o._getDirty();a!==s.isDirty&&o._subjects.state.next({isDirty:a})}},[o,s.isDirty]),me.useEffect(()=>{e.values&&!ba(e.values,n.current)?(o._reset(e.values,o._options.resetOptions),n.current=e.values,i(a=>({...a}))):o._resetDefaultValues()},[e.values,o]),me.useEffect(()=>{e.errors&&o._setErrors(e.errors)},[e.errors,o]),me.useEffect(()=>{o._state.mount||(o._updateValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),me.useEffect(()=>{e.shouldUnregister&&o._subjects.values.next({values:o._getWatch()})},[e.shouldUnregister,o]),t.current.formState=i7(s,o),t.current}const g7=u.memo(()=>{const e=I(vE),t=z(),[n,{isLoading:s}]=ad(),{register:i,handleSubmit:o,formState:a,reset:l}=Kp({defaultValues:{location:""},mode:"onChange"}),c=u.useCallback(()=>l(void 0,{keepValues:!0}),[l]),d=u.useCallback(f=>{f!=null&&f.location&&n({source:f.location,inplace:e,onSuccess:c,onError:c})},[n,c,e]),h=u.useCallback(f=>{t(bE(f.target.checked))},[t]);return r.jsx("form",{onSubmit:o(d),children:r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsx(A,{gap:2,alignItems:"flex-end",justifyContent:"space-between",children:r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:Te("modelManager.urlOrLocalPath")}),r.jsxs(A,{alignItems:"center",gap:3,w:"full",children:[r.jsx(jt,{placeholder:Te("modelManager.simpleModelPlaceholder"),...i("location")}),r.jsx(ye,{onClick:o(d),isDisabled:!a.dirtyFields.location,isLoading:s,size:"sm",children:Te("modelManager.install")})]}),r.jsx(Zs,{children:Te("modelManager.urlOrLocalPathHelper")})]})}),r.jsx(Z,{children:r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsxs(A,{gap:4,children:[r.jsx(kn,{isChecked:e,onChange:h}),r.jsxs(te,{children:[Te("modelManager.inplaceInstall")," (",Te("modelManager.localOnly"),")"]})]}),r.jsx(Zs,{children:Te("modelManager.inplaceInstallDesc")})]})})]})})});g7.displayName="InstallModelForm";const Mb={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},zde=({status:e})=>{const{t}=M();return!e||!Object.keys(Mb).includes(e)?null:r.jsx(is,{textAlign:"center",w:"134px",colorScheme:Mb[e].colorScheme,children:t(Mb[e].translationKey)})},Hde=u.memo(zde),g6=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},m7=u.memo(e=>{const{installJob:t}=e,[n]=oZ(),s=u.useCallback(()=>{n(t.id).unwrap().then(l=>{ve({id:"MODEL_INSTALL_CANCELED",title:Te("toast.modelImportCanceled"),status:"success"})}).catch(l=>{l&&ve({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${l.data.detail} `,status:"error"})})},[n,t]),i=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return Te("common.unknown")}},[t.source]),o=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??Te("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??Te("common.unknown");default:return Te("common.unknown")}},[t.source]),a=u.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:qe(t.bytes)||qe(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return r.jsxs(A,{gap:3,w:"full",alignItems:"center",children:[r.jsx(De,{maxW:600,label:r.jsx(y7,{name:o,source:i,installJob:t}),children:r.jsxs(A,{gap:3,w:"full",alignItems:"center",children:[r.jsx(q,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:o}),r.jsx(xE,{w:"full",flexGrow:1,value:a??0,isIndeterminate:a===null,"aria-label":Te("accessibility.invokeProgressBar"),h:2}),r.jsx(Hde,{status:t.status})]})}),r.jsx(oe,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:Te("modelManager.cancel"),"aria-label":Te("modelManager.cancel"),icon:r.jsx(Nt,{}),onClick:s,variant:"ghost"})]})});m7.displayName="ModelInstallQueueItem";const y7=u.memo(({name:e,source:t,installJob:n})=>{const s=u.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${g6(n.bytes)} / ${g6(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{gap:3,justifyContent:"space-between",children:[r.jsx(q,{fontWeight:"semibold",children:e}),s&&r.jsx(q,{children:s})]}),r.jsx(q,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&r.jsxs(q,{color:"error.500",children:[Te("queue.failed"),": ",n.error]})]})});y7.displayName="TooltipLabel";const v7=u.memo(()=>{const{data:e}=aZ(),[t]=lZ(),n=u.useCallback(()=>{t().unwrap().then(i=>{ve({id:"MODEL_INSTALL_QUEUE_PRUNED",title:Te("toast.prunedQueue"),status:"success"})}).catch(i=>{i&&ve({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${i.data.detail} `,status:"error"})})},[t]),s=u.useMemo(()=>e==null?void 0:e.some(i=>i.status==="cancelled"||i.status==="error"||i.status==="completed"),[e]);return r.jsxs(A,{flexDir:"column",p:3,h:"full",gap:3,children:[r.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Rt,{size:"sm",children:Te("modelManager.installQueue")}),r.jsx(ye,{size:"sm",isDisabled:!s,onClick:n,tooltip:Te("modelManager.pruneTooltip"),children:Te("modelManager.prune")})]}),r.jsx(Se,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:r.jsx($n,{children:r.jsx(A,{flexDir:"column-reverse",gap:"2",w:"full",children:e==null?void 0:e.map(i=>r.jsx(m7,{installJob:i},i.id))})})})]})});v7.displayName="ModelInstallQueue";const b7=u.memo(({result:e,installModel:t})=>{const{t:n}=M(),s=u.useCallback(()=>{t(e.path)},[t,e]);return r.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(A,{fontSize:"sm",flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e.path.split("\\").slice(-1)[0]}),r.jsx(q,{variant:"subtext",children:e.path})]}),r.jsx(Se,{children:e.is_installed?r.jsx(is,{children:n("common.installed")}):r.jsx(oe,{"aria-label":n("modelManager.install"),icon:r.jsx(Gt,{}),onClick:s,size:"sm"})})]})});b7.displayName="ScanModelResultItem";const x7=u.memo(({results:e})=>{const t=I(vE),n=z(),{t:s}=M(),[i,o]=u.useState(""),[a]=ad(),l=u.useMemo(()=>e.filter(g=>{const m=g.path.split("\\").slice(-1)[0];return m==null?void 0:m.toLowerCase().includes(i.toLowerCase())}),[e,i]),c=u.useCallback(g=>{o(g.target.value.trim())},[]),d=u.useCallback(g=>{n(bE(g.target.checked))},[n]),h=u.useCallback(()=>{o("")},[]),f=u.useCallback(()=>{for(const g of l)g.is_installed||a({source:g.path,inplace:t})},[l,a,t]),p=u.useCallback(g=>{a({source:g,inplace:t})},[a,t]);return r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Rt,{size:"sm",children:s("modelManager.scanResults")}),r.jsxs(A,{alignItems:"center",gap:3,children:[r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:s("modelManager.inplaceInstall")}),r.jsx(kn,{isChecked:t,onChange:d,size:"md"})]}),r.jsx(ye,{size:"sm",onClick:f,isDisabled:l.length===0,children:s("modelManager.installAll")}),r.jsxs(Jo,{w:64,size:"xs",children:[r.jsx(jt,{placeholder:s("modelManager.search"),value:i,"data-testid":"board-search-input",onChange:c,size:"xs"}),i&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:h,flexShrink:0})})]})]})]}),r.jsx(A,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx($n,{children:r.jsx(A,{flexDir:"column",gap:3,children:l.map(g=>r.jsx(b7,{result:g,installModel:p},g.path))})})})]})]})});x7.displayName="ScanModelsResults";const Wde=cZ(e=>e.scanPath),C7=u.memo(()=>{const e=I(Wde),t=z(),[n,s]=u.useState(""),{t:i}=M(),[o,{isLoading:a,data:l}]=uZ(),c=u.useCallback(()=>{o({scan_path:e}).unwrap().catch(h=>{h&&s(h.data.detail)})},[o,e]),d=u.useCallback(h=>{t(dZ(h.target.value)),s("")},[t]);return r.jsxs(A,{flexDir:"column",height:"100%",gap:3,children:[r.jsxs(Z,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(te,{children:i("common.folder")}),r.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[r.jsx(jt,{placeholder:i("modelManager.scanPlaceholder"),value:e,onChange:d}),r.jsx(ye,{onClick:c,isLoading:a,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:i("modelManager.scanFolder")})]}),r.jsx(Zs,{children:i("modelManager.scanFolderHelper")}),!!n.length&&r.jsx(Cp,{children:n})]}),l&&r.jsx(x7,{results:l})]})});C7.displayName="ScanModelsForm";const $l=Oe(0),S7=u.memo(()=>{const{t:e}=M(),t=ce($l),n=u.useCallback(i=>{$l.set(i)},[]),s=u.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return r.jsxs(A,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[r.jsxs(A,{alignItems:"center",justifyContent:"space-between",children:[r.jsx(Rt,{fontSize:"xl",children:e("modelManager.addModel")}),r.jsx(ye,{alignItems:"center",variant:"link",leftIcon:r.jsx(td,{}),onClick:s,children:r.jsx(q,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),r.jsxs(ec,{variant:"collapse",height:"50%",display:"flex",flexDir:"column",index:t,onChange:n,children:[r.jsxs(tc,{children:[r.jsx(Sn,{children:e("modelManager.urlOrLocalPath")}),r.jsx(Sn,{children:e("modelManager.huggingFace")}),r.jsx(Sn,{children:e("modelManager.scanFolder")}),r.jsx(Sn,{children:e("modelManager.starterModels")})]}),r.jsxs(Vu,{p:3,height:"100%",children:[r.jsx(Ln,{children:r.jsx(g7,{})}),r.jsx(Ln,{height:"100%",children:r.jsx(e7,{})}),r.jsx(Ln,{height:"100%",children:r.jsx(C7,{})}),r.jsx(Ln,{height:"100%",children:r.jsx(XR,{})})]})]}),r.jsx(Se,{layerStyle:"second",borderRadius:"base",h:"50%",children:r.jsx(v7,{})})]})});S7.displayName="InstallModels";const Kn=(e,t)=>()=>{const n=xp(void 0);return[u.useMemo(()=>n.data?Va.selectAll(n.data).filter(i=>e(i,t)):xs,[n]),n]},Ky=Kn(d0),Ude=Kn(wZ),Zy=Kn(fZ),qde=Kn(jZ),Kde=Kn(kZ),Zde=Kn(_Z),Yy=Kn(hZ),w7=Kn(CE),Yde=Kn(bS),fj=Kn(bZ),j7=Kn(CZ),pj=e=>Kn(mZ,e==null?void 0:e.excludeSubmodels)(),oc=e=>Kn(yZ,e==null?void 0:e.excludeSubmodels)(),Zp=Kn(vZ),gj=Kn(tE),k7=Kn(xZ),Xy=e=>Kn(gZ,e==null?void 0:e.excludeSubmodels)(),_7=e=>Kn(pZ,e==null?void 0:e.excludeSubmodels)(),Xde=Kn(SZ),Qde=(e,t)=>pe(vS,n=>n.data?Va.selectAll(n.data).filter(t).find(s=>s.key===e)??null:null),Wm="starterModels",Jde=()=>{const{t:e}=M(),t=en("starterModels"),[n,s]=u.useState(!1),[i,{data:o}]=Ky(),a=Y1();u.useEffect(()=>{if(a.isActive(Wm)){if(i.length===0)return;a.close(Wm)}o&&i.length===0&&!n&&t&&a({id:Wm,title:e("modelManager.noModelsInstalled"),description:r.jsx(ehe,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>s(!0)})},[o,n,t,i.length,e,a])},ehe=()=>{const{t:e}=M(),t=z(),n=Y1(),s=u.useCallback(()=>{t(Kt("models")),$l.set(3),n.close(Wm)},[t,n]);return r.jsxs(q,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",r.jsxs(ye,{onClick:s,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},N0=Oe(null),m6=()=>N0.set(null),the=()=>u.useCallback(t=>{N0.set(t)},[]),nhe=()=>{kt("ShareWorkflowModal");const e=ce(N0),t=ce(RS),{t:n}=M(),s=na(),i=u.useMemo(()=>!e||!t?null:`${window.location.origin}${t}/studio?selectedWorkflowId=${e.workflow_id}`,[t,e]),o=u.useCallback(()=>{i&&(s.writeText(i,()=>{ve({status:"success",title:n("toast.linkCopied")})}),N0.set(null))},[i,s,n]);return r.jsxs(ni,{isOpen:e!==null,onClose:m6,isCentered:!0,size:"lg",useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{children:[r.jsx(Mr,{children:r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(Rt,{fontSize:"xl",children:n("workflows.copyShareLinkForWorkflow")}),r.jsx(q,{fontSize:"md",children:e==null?void 0:e.name})]})}),r.jsx(yo,{}),r.jsx(sr,{children:r.jsxs(A,{layerStyle:"third",p:4,borderRadius:"base",alignItems:"center",children:[r.jsx(q,{fontWeight:"semibold",children:i}),r.jsx(oe,{variant:"ghost","aria-label":n("common.copy"),tooltip:n("common.copy"),icon:r.jsx(an,{}),onClick:o})]})}),r.jsx(vo,{children:r.jsx(ye,{onClick:m6,children:n("common.close")})})]})]})},she=()=>{const{t:e}=M(),{data:t}=ti(),n=ce(Wn),[s,{isLoading:i}]=IZ({fixedCacheKey:"cancelAllExceptCurrent"}),o=u.useCallback(async()=>{if(t!=null&&t.queue.pending)try{await s().unwrap(),ve({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{ve({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t==null?void 0:t.queue.pending,s,e]),a=u.useMemo(()=>!n||!(t!=null&&t.queue.pending),[n,t==null?void 0:t.queue.pending]);return{cancelAllExceptCurrentQueueItem:o,isLoading:i,queueStatus:t,isDisabled:a}},[rhe]=Ql(!1),I7=()=>{const e=rhe(),{cancelAllExceptCurrentQueueItem:t,isLoading:n,isDisabled:s,queueStatus:i}=she();return{cancelAllExceptCurrentQueueItem:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},A7=u.memo(()=>{kt("CancelAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=M(),t=I7();return r.jsxs(Tr,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.cancelAllExceptCurrentQueueItem,acceptButtonText:e("queue.confirm"),useInert:!1,children:[r.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),r.jsx("br",{}),r.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});A7.displayName="CancelAllExceptCurrentQueueItemConfirmationAlertDialog";const[ihe]=Ql(!1),Yp=()=>{const e=ihe(),{clearQueue:t,isLoading:n,isDisabled:s,queueStatus:i}=dL();return{clearQueue:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},T7=u.memo(()=>{kt("ClearQueueConfirmationsAlertDialog");const{t:e}=M(),t=Yp();return r.jsxs(Tr,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.clearQueue,acceptButtonText:e("queue.clear"),useInert:!1,children:[r.jsx(q,{children:e("queue.clearQueueAlertDialog")}),r.jsx("br",{}),r.jsx(q,{children:e("queue.clearQueueAlertDialog2")})]})});T7.displayName="ClearQueueConfirmationsAlertDialog";const mj=Oe(null),ohe=()=>mj.set(null),ahe=()=>u.useCallback(t=>{mj.set(t)},[]),E7=u.memo(()=>{kt("DeleteStylePresetDialog");const{t:e}=M(),t=ce(mj),[n]=AZ(),s=u.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),ve({status:"success",title:e("stylePresets.templateDeleted")})}catch{ve({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return r.jsx(Tr,{isOpen:t!==null,onClose:ohe,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(q,{children:e("stylePresets.deleteTemplate2")})})});E7.displayName="DeleteStylePresetDialog";var Pb={exports:{}},Lb,y6;function lhe(){if(y6)return Lb;y6=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Lb=e,Lb}var Db,v6;function che(){if(v6)return Db;v6=1;var e=lhe();function t(){}function n(){}return n.resetWarningCache=t,Db=function(){function s(a,l,c,d,h,f){if(f!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}s.isRequired=s;function i(){return s}var o={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:t};return o.PropTypes=o,o},Db}var b6;function uhe(){return b6||(b6=1,Pb.exports=che()()),Pb.exports}var dhe=uhe();const Ut=Nu(dhe);var Zi=function(){return Zi=Object.assign||function(t){for(var n,s=1,i=arguments.length;s<i;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Zi.apply(this,arguments)};function M7(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n}function ld(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})}function cd(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,i,o,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(h){return c([d,h])}}function c(d){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(n=0)),n;)try{if(s=1,i&&(o=d[0]&2?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,i=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){n.label=d[1];break}if(d[0]===6&&n.label<o[1]){n.label=o[1],o=d;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(d);break}o[2]&&n.ops.pop(),n.trys.pop();continue}d=t.call(e,n)}catch(h){d=[6,h],i=0}finally{s=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function x6(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var s=n.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o}function H2(e,t,n){if(n||arguments.length===2)for(var s=0,i=t.length,o;s<i;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}var hhe=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function Xp(e,t){var n=fhe(e);if(typeof n.path!="string"){var s=e.webkitRelativePath;Object.defineProperty(n,"path",{value:typeof t=="string"?t:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}function fhe(e){var t=e.name,n=t&&t.lastIndexOf(".")!==-1;if(n&&!e.type){var s=t.split(".").pop().toLowerCase(),i=hhe.get(s);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}var phe=[".DS_Store","Thumbs.db"];function ghe(e){return ld(this,void 0,void 0,function(){return cd(this,function(t){return F0(e)&&mhe(e.dataTransfer)?[2,xhe(e.dataTransfer,e.type)]:yhe(e)?[2,vhe(e)]:Array.isArray(e)&&e.every(function(n){return"getFile"in n&&typeof n.getFile=="function"})?[2,bhe(e)]:[2,[]]})})}function mhe(e){return F0(e)}function yhe(e){return F0(e)&&F0(e.target)}function F0(e){return typeof e=="object"&&e!==null}function vhe(e){return W2(e.target.files).map(function(t){return Xp(t)})}function bhe(e){return ld(this,void 0,void 0,function(){var t;return cd(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(s){return s.getFile()}))];case 1:return t=n.sent(),[2,t.map(function(s){return Xp(s)})]}})})}function xhe(e,t){return ld(this,void 0,void 0,function(){var n,s;return cd(this,function(i){switch(i.label){case 0:return e.items?(n=W2(e.items).filter(function(o){return o.kind==="file"}),t!=="drop"?[2,n]:[4,Promise.all(n.map(Che))]):[3,2];case 1:return s=i.sent(),[2,C6(P7(s))];case 2:return[2,C6(W2(e.files).map(function(o){return Xp(o)}))]}})})}function C6(e){return e.filter(function(t){return phe.indexOf(t.name)===-1})}function W2(e){if(e===null)return[];for(var t=[],n=0;n<e.length;n++){var s=e[n];t.push(s)}return t}function Che(e){if(typeof e.webkitGetAsEntry!="function")return S6(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?L7(t):S6(e)}function P7(e){return e.reduce(function(t,n){return H2(H2([],x6(t),!1),x6(Array.isArray(n)?P7(n):[n]),!1)},[])}function S6(e){var t=e.getAsFile();if(!t)return Promise.reject("".concat(e," is not a File"));var n=Xp(t);return Promise.resolve(n)}function She(e){return ld(this,void 0,void 0,function(){return cd(this,function(t){return[2,e.isDirectory?L7(e):whe(e)]})})}function L7(e){var t=e.createReader();return new Promise(function(n,s){var i=[];function o(){var a=this;t.readEntries(function(l){return ld(a,void 0,void 0,function(){var c,d,h;return cd(this,function(f){switch(f.label){case 0:if(l.length)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return c=f.sent(),n(c),[3,4];case 3:return d=f.sent(),s(d),[3,4];case 4:return[3,6];case 5:h=Promise.all(l.map(She)),i.push(h),o(),f.label=6;case 6:return[2]}})})},function(l){s(l)})}o()})}function whe(e){return ld(this,void 0,void 0,function(){return cd(this,function(t){return[2,new Promise(function(n,s){e.file(function(i){var o=Xp(i,e.fullPath);n(o)},function(i){s(i)})})]})})}var qg={},w6;function jhe(){return w6||(w6=1,qg.__esModule=!0,qg.default=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),s=e.name||"",i=(e.type||"").toLowerCase(),o=i.replace(/\/.*$/,"");return n.some(function(a){var l=a.trim().toLowerCase();return l.charAt(0)==="."?s.toLowerCase().endsWith(l):l.endsWith("/*")?o===l.replace(/\/.*$/,""):i===l})}return!0}),qg}var khe=jhe();const Rb=Nu(khe);function j6(e){return Ahe(e)||Ihe(e)||R7(e)||_he()}function _he(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ihe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ahe(e){if(Array.isArray(e))return U2(e)}function k6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function _6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k6(Object(n),!0).forEach(function(s){D7(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k6(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function D7(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vf(e,t){return Mhe(e)||Ehe(e,t)||R7(e,t)||The()}function The(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R7(e,t){if(e){if(typeof e=="string")return U2(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U2(e,t)}}function U2(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Ehe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function Mhe(e){if(Array.isArray(e))return e}var Phe=typeof Rb=="function"?Rb:Rb.default,Lhe="file-invalid-type",Dhe="file-too-large",Rhe="file-too-small",Ohe="too-many-files",Nhe=function(t){t=Array.isArray(t)&&t.length===1?t[0]:t;var n=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:Lhe,message:"File type must be ".concat(n)}},I6=function(t){return{code:Dhe,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},A6=function(t){return{code:Rhe,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},Fhe={code:Ohe,message:"Too many files"};function O7(e,t){var n=e.type==="application/x-moz-file"||Phe(e,t);return[n,n?null:Nhe(t)]}function N7(e,t,n){if(pl(e.size))if(pl(t)&&pl(n)){if(e.size>n)return[!1,I6(n)];if(e.size<t)return[!1,A6(t)]}else{if(pl(t)&&e.size<t)return[!1,A6(t)];if(pl(n)&&e.size>n)return[!1,I6(n)]}return[!0,null]}function pl(e){return e!=null}function Bhe(e){var t=e.files,n=e.accept,s=e.minSize,i=e.maxSize,o=e.multiple,a=e.maxFiles,l=e.validator;return!o&&t.length>1||o&&a>=1&&t.length>a?!1:t.every(function(c){var d=O7(c,n),h=Vf(d,1),f=h[0],p=N7(c,s,i),g=Vf(p,1),m=g[0],y=l?l(c):null;return f&&m&&!y})}function B0(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Kg(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function T6(e){e.preventDefault()}function $he(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function Vhe(e){return e.indexOf("Edge/")!==-1}function Ghe(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return $he(e)||Vhe(e)}function $i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return t.some(function(l){return!B0(s)&&l&&l.apply(void 0,[s].concat(o)),B0(s)})}}function zhe(){return"showOpenFilePicker"in window}function Hhe(e){if(pl(e)){var t=Object.entries(e).filter(function(n){var s=Vf(n,2),i=s[0],o=s[1],a=!0;return F7(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),a=!1),(!Array.isArray(o)||!o.every(B7))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),a=!1),a}).reduce(function(n,s){var i=Vf(s,2),o=i[0],a=i[1];return _6(_6({},n),{},D7({},o,a))},{});return[{description:"Files",accept:t}]}return e}function Whe(e){if(pl(e))return Object.entries(e).reduce(function(t,n){var s=Vf(n,2),i=s[0],o=s[1];return[].concat(j6(t),[i],j6(o))},[]).filter(function(t){return F7(t)||B7(t)}).join(",")}function Uhe(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function qhe(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function F7(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function B7(e){return/^.*\.[\w]+$/.test(e)}var Khe=["children"],Zhe=["open"],Yhe=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Xhe=["refKey","onChange","onClick"];function Qhe(e){return tfe(e)||efe(e)||$7(e)||Jhe()}function Jhe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function efe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function tfe(e){if(Array.isArray(e))return q2(e)}function Ob(e,t){return rfe(e)||sfe(e,t)||$7(e,t)||nfe()}function nfe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $7(e,t){if(e){if(typeof e=="string")return q2(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q2(e,t)}}function q2(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function sfe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function rfe(e){if(Array.isArray(e))return e}function E6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E6(Object(n),!0).forEach(function(s){K2(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E6(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function K2(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $0(e,t){if(e==null)return{};var n=ife(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function ife(e,t){if(e==null)return{};var n={},s=Object.keys(e),i,o;for(o=0;o<s.length;o++)i=s[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}var yj=u.forwardRef(function(e,t){var n=e.children,s=$0(e,Khe),i=Ya(s),o=i.open,a=$0(i,Zhe);return u.useImperativeHandle(t,function(){return{open:o}},[o]),me.createElement(u.Fragment,null,n(mn(mn({},a),{},{open:o})))});yj.displayName="Dropzone";var V7={disabled:!1,getFilesFromEvent:ghe,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};yj.defaultProps=V7;yj.propTypes={children:Ut.func,accept:Ut.objectOf(Ut.arrayOf(Ut.string)),multiple:Ut.bool,preventDropOnDocument:Ut.bool,noClick:Ut.bool,noKeyboard:Ut.bool,noDrag:Ut.bool,noDragEventsBubbling:Ut.bool,minSize:Ut.number,maxSize:Ut.number,maxFiles:Ut.number,disabled:Ut.bool,getFilesFromEvent:Ut.func,onFileDialogCancel:Ut.func,onFileDialogOpen:Ut.func,useFsAccessApi:Ut.bool,autoFocus:Ut.bool,onDragEnter:Ut.func,onDragLeave:Ut.func,onDragOver:Ut.func,onDrop:Ut.func,onDropAccepted:Ut.func,onDropRejected:Ut.func,onError:Ut.func,validator:Ut.func};var Z2={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Ya(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=mn(mn({},V7),e),n=t.accept,s=t.disabled,i=t.getFilesFromEvent,o=t.maxSize,a=t.minSize,l=t.multiple,c=t.maxFiles,d=t.onDragEnter,h=t.onDragLeave,f=t.onDragOver,p=t.onDrop,g=t.onDropAccepted,m=t.onDropRejected,y=t.onFileDialogCancel,b=t.onFileDialogOpen,C=t.useFsAccessApi,v=t.autoFocus,x=t.preventDropOnDocument,S=t.noClick,w=t.noKeyboard,j=t.noDrag,P=t.noDragEventsBubbling,T=t.onError,L=t.validator,E=u.useMemo(function(){return Whe(n)},[n]),O=u.useMemo(function(){return Hhe(n)},[n]),F=u.useMemo(function(){return typeof b=="function"?b:M6},[b]),_=u.useMemo(function(){return typeof y=="function"?y:M6},[y]),R=u.useRef(null),D=u.useRef(null),$=u.useReducer(ofe,Z2),G=Ob($,2),ee=G[0],Q=G[1],se=ee.isFocused,ne=ee.isFileDialogActive,H=u.useRef(typeof window<"u"&&window.isSecureContext&&C&&zhe()),V=function(){!H.current&&ne&&setTimeout(function(){if(D.current){var Ce=D.current.files;Ce.length||(Q({type:"closeDialog"}),_())}},300)};u.useEffect(function(){return window.addEventListener("focus",V,!1),function(){window.removeEventListener("focus",V,!1)}},[D,ne,_,H]);var Y=u.useRef([]),W=function(Ce){R.current&&R.current.contains(Ce.target)||(Ce.preventDefault(),Y.current=[])};u.useEffect(function(){return x&&(document.addEventListener("dragover",T6,!1),document.addEventListener("drop",W,!1)),function(){x&&(document.removeEventListener("dragover",T6),document.removeEventListener("drop",W))}},[R,x]),u.useEffect(function(){return!s&&v&&R.current&&R.current.focus(),function(){}},[R,v,s]);var J=u.useCallback(function(le){T?T(le):console.error(le)},[T]),N=u.useCallback(function(le){le.preventDefault(),le.persist(),ae(le),Y.current=[].concat(Qhe(Y.current),[le.target]),Kg(le)&&Promise.resolve(i(le)).then(function(Ce){if(!(B0(le)&&!P)){var ze=Ce.length,Qe=ze>0&&Bhe({files:Ce,accept:E,minSize:a,maxSize:o,multiple:l,maxFiles:c,validator:L}),gt=ze>0&&!Qe;Q({isDragAccept:Qe,isDragReject:gt,isDragActive:!0,type:"setDraggedFiles"}),d&&d(le)}}).catch(function(Ce){return J(Ce)})},[i,d,J,P,E,a,o,l,c,L]),B=u.useCallback(function(le){le.preventDefault(),le.persist(),ae(le);var Ce=Kg(le);if(Ce&&le.dataTransfer)try{le.dataTransfer.dropEffect="copy"}catch{}return Ce&&f&&f(le),!1},[f,P]),U=u.useCallback(function(le){le.preventDefault(),le.persist(),ae(le);var Ce=Y.current.filter(function(Qe){return R.current&&R.current.contains(Qe)}),ze=Ce.indexOf(le.target);ze!==-1&&Ce.splice(ze,1),Y.current=Ce,!(Ce.length>0)&&(Q({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Kg(le)&&h&&h(le))},[R,h,P]),ie=u.useCallback(function(le,Ce){var ze=[],Qe=[];le.forEach(function(gt){var fn=O7(gt,E),cn=Ob(fn,2),pn=cn[0],es=cn[1],ks=N7(gt,a,o),gn=Ob(ks,2),Bi=gn[0],aa=gn[1],as=L?L(gt):null;if(pn&&Bi&&!as)ze.push(gt);else{var $s=[es,aa];as&&($s=$s.concat(as)),Qe.push({file:gt,errors:$s.filter(function(ai){return ai})})}}),(!l&&ze.length>1||l&&c>=1&&ze.length>c)&&(ze.forEach(function(gt){Qe.push({file:gt,errors:[Fhe]})}),ze.splice(0)),Q({acceptedFiles:ze,fileRejections:Qe,type:"setFiles"}),p&&p(ze,Qe,Ce),Qe.length>0&&m&&m(Qe,Ce),ze.length>0&&g&&g(ze,Ce)},[Q,l,E,a,o,c,p,g,m,L]),de=u.useCallback(function(le){le.preventDefault(),le.persist(),ae(le),Y.current=[],Kg(le)&&Promise.resolve(i(le)).then(function(Ce){B0(le)&&!P||ie(Ce,le)}).catch(function(Ce){return J(Ce)}),Q({type:"reset"})},[i,ie,J,P]),be=u.useCallback(function(){if(H.current){Q({type:"openDialog"}),F();var le={multiple:l,types:O};window.showOpenFilePicker(le).then(function(Ce){return i(Ce)}).then(function(Ce){ie(Ce,null),Q({type:"closeDialog"})}).catch(function(Ce){Uhe(Ce)?(_(Ce),Q({type:"closeDialog"})):qhe(Ce)?(H.current=!1,D.current?(D.current.value=null,D.current.click()):J(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):J(Ce)});return}D.current&&(Q({type:"openDialog"}),F(),D.current.value=null,D.current.click())},[Q,F,_,C,ie,J,O,l]),Ee=u.useCallback(function(le){!R.current||!R.current.isEqualNode(le.target)||(le.key===" "||le.key==="Enter"||le.keyCode===32||le.keyCode===13)&&(le.preventDefault(),be())},[R,be]),je=u.useCallback(function(){Q({type:"focus"})},[]),Be=u.useCallback(function(){Q({type:"blur"})},[]),Xe=u.useCallback(function(){S||(Ghe()?setTimeout(be,0):be())},[S,be]),Re=function(Ce){return s?null:Ce},K=function(Ce){return w?null:Re(Ce)},re=function(Ce){return j?null:Re(Ce)},ae=function(Ce){P&&Ce.stopPropagation()},xe=u.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ce=le.refKey,ze=Ce===void 0?"ref":Ce,Qe=le.role,gt=le.onKeyDown,fn=le.onFocus,cn=le.onBlur,pn=le.onClick,es=le.onDragEnter,ks=le.onDragOver,gn=le.onDragLeave,Bi=le.onDrop,aa=$0(le,Yhe);return mn(mn(K2({onKeyDown:K($i(gt,Ee)),onFocus:K($i(fn,je)),onBlur:K($i(cn,Be)),onClick:Re($i(pn,Xe)),onDragEnter:re($i(es,N)),onDragOver:re($i(ks,B)),onDragLeave:re($i(gn,U)),onDrop:re($i(Bi,de)),role:typeof Qe=="string"&&Qe!==""?Qe:"presentation"},ze,R),!s&&!w?{tabIndex:0}:{}),aa)}},[R,Ee,je,Be,Xe,N,B,U,de,w,j,s]),ge=u.useCallback(function(le){le.stopPropagation()},[]),fe=u.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ce=le.refKey,ze=Ce===void 0?"ref":Ce,Qe=le.onChange,gt=le.onClick,fn=$0(le,Xhe),cn=K2({accept:E,multiple:l,type:"file",style:{display:"none"},onChange:Re($i(Qe,de)),onClick:Re($i(gt,ge)),tabIndex:-1},ze,D);return mn(mn({},cn),fn)}},[D,n,l,de,s]);return mn(mn({},ee),{},{isFocused:se&&!s,getRootProps:xe,getInputProps:fe,rootRef:R,inputRef:D,open:Re(be)})}function ofe(e,t){switch(t.type){case"focus":return mn(mn({},e),{},{isFocused:!0});case"blur":return mn(mn({},e),{},{isFocused:!1});case"openDialog":return mn(mn({},Z2),{},{isFileDialogActive:!0});case"closeDialog":return mn(mn({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return mn(mn({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return mn(mn({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return mn({},Z2);default:return e}}function M6(){}const afe=e=>{const{field:t}=os(e),{t:n}=M(),s=u.useCallback(l=>{const c=l[0];c&&t.onChange(c)},[t]),i=u.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:o,getRootProps:a}=Ya({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?r.jsxs(Se,{position:"relative",flexShrink:0,children:[r.jsx(dn,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),r.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:i,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:r.jsx(Di,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(De,{label:n("stylePresets.uploadImage"),children:r.jsx(A,{as:ye,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...a(),children:r.jsx(dt,{as:Py,w:8,h:8})})}),r.jsx("input",{...o()})]})},P6=e=>{const{field:t}=os(e),n=u.useRef(null),{t:s}=M(),i=u.useCallback(c=>{t.onChange(c.target.value)},[t]),o=u.useMemo(()=>t.value,[t.value]),a=u.useCallback(()=>{var c;if(n.current){const d=n.current.selectionStart,h=o.slice(0,d),f=o.slice(d),p=h+Al+f;t.onChange(p)}else t.onChange(o+Al);(c=n.current)==null||c.focus()},[o,t,n]),l=u.useMemo(()=>o==null?void 0:o.includes(Al),[o]);return r.jsxs(Z,{orientation:"vertical",gap:3,children:[r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(te,{children:e.label}),r.jsx(ye,{onClick:a,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:l,children:s("stylePresets.insertPlaceholder")})]}),r.jsx(Qn,{size:"sm",ref:n,value:o,onChange:i})]})},L6=[{label:Te("stylePresets.private"),value:"user"},{label:Te("stylePresets.shared"),value:"project"}],lfe=e=>{var a;const{field:t}=os(e),n=ce(Oa),{t:s}=M(),i=u.useCallback(l=>{l&&t.onChange(l.value)},[t]),o=u.useMemo(()=>L6.find(l=>l.value===t.value),[t.value]);return r.jsxs(Z,{orientation:"vertical",maxW:48,isDisabled:((a=n.prefilledFormData)==null?void 0:a.type)==="project",children:[r.jsx(te,{children:s("stylePresets.type")}),r.jsx(Fe,{value:o,options:L6,onChange:i})]})},cfe=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=TZ(),[i,{isLoading:o}]=EZ(),{t:a}=M(),l=I(SE),{handleSubmit:c,control:d,register:h,formState:f}=Kp({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),p=u.useCallback(async g=>{const m={data:{name:g.name,positive_prompt:g.positivePrompt,negative_prompt:g.negativePrompt,type:g.type},image:g.image};try{e?await i({id:e,...m}).unwrap():await n(m).unwrap()}catch{ve({status:"error",title:"Failed to save style preset"})}Oa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,i,n]);return r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(A,{alignItems:"center",gap:4,children:[r.jsx(afe,{control:d,name:"image"}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:a("stylePresets.name")}),r.jsx(jt,{size:"md",...h("name",{required:!0,minLength:1})})]})]}),r.jsx(P6,{label:a("stylePresets.positivePrompt"),control:d,name:"positivePrompt"}),r.jsx(P6,{label:a("stylePresets.negativePrompt"),control:d,name:"negativePrompt"}),r.jsxs(Se,{children:[r.jsx(q,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc1")}),r.jsx(q,{variant:"subtext",children:r.jsx(Jt,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:r.jsx(ufe,{})},values:{placeholder:Al}})}),r.jsx(q,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc3")})]}),r.jsxs(A,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[l?r.jsx(lfe,{control:d,name:"type"}):r.jsx(rt,{}),r.jsx(ye,{onClick:c(p),isDisabled:!f.isValid,isLoading:s||o,children:a("common.save")})]})]})},ufe=e=>r.jsx(q,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),dfe=()=>{kt("StylePresetModal");const[e,t]=u.useState(null),{t:n}=M(),s=ce(Oa),i=u.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),o=u.useCallback(()=>{Oa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return u.useEffect(()=>{t(null)},[]),u.useEffect(()=>{(async l=>{if(!l)t(null);else{let c=null;if(l.imageUrl)try{const d=await TR(l.imageUrl);d&&(c=new File([d],"style_preset.png",{type:"image/png"}))}catch{}t({...l,image:c})}})(s.prefilledFormData)},[s.prefilledFormData]),r.jsxs(ni,{isOpen:s.isModalOpen,onClose:o,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{children:[r.jsx(Mr,{children:i}),r.jsx(yo,{}),r.jsx(sr,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?r.jsx(cfe,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):r.jsx(rr,{})}),r.jsx(vo,{p:2})]})]})},[G7]=Ql(!1),hfe=()=>{kt("RefreshAfterResetModal");const{t:e}=M(),[t,n]=u.useState(3),s=G7();return u.useEffect(()=>{if(!s.isTrue)return;const i=window.setInterval(()=>n(o=>o-1),1e3);return()=>{window.clearInterval(i)}},[s.isTrue]),u.useEffect(()=>{t<=0&&window.location.reload()},[t]),r.jsx(r.Fragment,{children:r.jsxs(ni,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[r.jsx(nr,{backdropFilter:"blur(40px)"}),r.jsxs(si,{children:[r.jsx(Mr,{}),r.jsx(sr,{children:r.jsx(A,{justifyContent:"center",children:r.jsx(q,{fontSize:"lg",children:r.jsxs(q,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),r.jsx(vo,{})]})]})})},ffe=u.memo(hfe),z7=[{tKey:"creatingYourFirstImage",link:"https://www.youtube.com/watch?v=jVi2XgSGrfY&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=1&t=29s&pp=iAQB",length:{minutes:6,seconds:0}},{tKey:"usingControlLayersAndReferenceGuides",link:"https://www.youtube.com/watch?v=crgw6bEgyrw&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=2&t=70s&pp=iAQB",length:{minutes:5,seconds:30}},{tKey:"understandingImageToImageAndDenoising",link:"https://www.youtube.com/watch?v=tvj8-0s6S2U&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=3&t=1s&pp=iAQB",length:{minutes:2,seconds:37}},{tKey:"exploringAIModelsAndConceptAdapters",link:"https://www.youtube.com/watch?v=iwBmBQMZ0UA&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=4&pp=iAQB",length:{minutes:8,seconds:52}},{tKey:"creatingAndComposingOnInvokesControlCanvas",link:"https://www.youtube.com/watch?v=O4LaFcYFxlA",length:{minutes:2,seconds:52}},{tKey:"upscaling",link:"https://www.youtube.com/watch?v=OCb19_P0nro&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=6&t=2s&pp=iAQB",length:{minutes:4,seconds:0}}],pfe=[{tKey:"howDoIGenerateAndSaveToTheGallery",link:"https://youtu.be/Tl-69JvwJ2s?si=dbjmBc1iDAUpE1k5&t=26",length:{minutes:0,seconds:49}},{tKey:"howDoIEditOnTheCanvas",link:"https://youtu.be/Tl-69JvwJ2s?si=U_bFl9HsvSuejbxp&t=76",length:{minutes:0,seconds:58}},{tKey:"howDoIDoImageToImageTransformation",link:"https://youtu.be/Tl-69JvwJ2s?si=fjhTeY-yZ3qsEzEM&t=138",length:{minutes:0,seconds:51}},{tKey:"howDoIUseControlNetsAndControlLayers",link:"https://youtu.be/Tl-69JvwJ2s?si=x5KcYvkHbvR9ifsX&t=192",length:{minutes:1,seconds:41}},{tKey:"howDoIUseGlobalIPAdaptersAndReferenceImages",link:"https://youtu.be/Tl-69JvwJ2s?si=O940rNHiHGKXknK2&t=297",length:{minutes:0,seconds:43}},{tKey:"howDoIUseInpaintMasks",link:"https://youtu.be/Tl-69JvwJ2s?si=3DZhmerkzUmvJJSn&t=345",length:{minutes:1,seconds:9}},{tKey:"howDoIOutpaint",link:"https://youtu.be/Tl-69JvwJ2s?si=IIwkGZLq1PfLf80Q&t=420",length:{minutes:0,seconds:48}}],gfe="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U",H7=u.memo(e=>r.jsx(A,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:r.jsx(Rt,{size:"sm",children:e.title})}));H7.displayName="StickyScrollableHeading";const W7=u.memo(e=>r.jsx(A,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));W7.displayName="StickyScrollableContent";const Wi=u.memo(e=>r.jsxs(A,{flexDir:"column",children:[r.jsx(H7,{title:e.title,sx:e.headingSx}),r.jsx(W7,{sx:e.contentSx,children:e.children})]},e.title));Wi.displayName="StickyScrollable";const vj=Gu("system/videoModalLinkClicked"),mfe=Gu("system/videoModalOpened"),yfe=({minutes:e,seconds:t})=>`${e}:${t.toString().padStart(2,"0")}`,U7=u.memo(({video:e})=>{const{t}=M(),n=z(),{tKey:s,link:i,length:o}=e,a=u.useCallback(()=>{n(vj(t(`supportVideos.videos.${s}.title`)))},[n,t,s]);return r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(q,{fontSize:"md",fontWeight:"semibold",children:t(`supportVideos.videos.${s}.title`)}),r.jsx(rt,{}),r.jsx(q,{variant:"subtext",children:yfe(o)}),r.jsx(Js,{fontSize:"sm",href:i,label:t("supportVideos.watch"),onClick:a})]}),r.jsx(q,{fontSize:"md",variant:"subtext",children:t(`supportVideos.videos.${s}.description`)})]})});U7.displayName="VideoCard";const Y2=u.memo(({category:e,videos:t})=>r.jsx(Wi,{title:e,children:t.map((n,s)=>r.jsxs(u.Fragment,{children:[r.jsx(U7,{video:n}),s<z7.length-1&&r.jsx(Pt,{})]},`${n.tKey}-${s}`))}));Y2.displayName="VideoCardList";const X2="http://github.com/invoke-ai/InvokeAI",bj="https://discord.gg/ZmtBAhwWhy",D6="https://www.invoke.com/",[q7]=wE(!1),vfe=()=>{const e=z(),t=u.useCallback(()=>{e(vj("Studio session playlist"))},[e]);return r.jsx(Js,{fontWeight:"semibold",href:gfe,display:"inline-flex",label:"Studio Sessions playlist",onClick:t})},bfe=()=>{const e=z(),t=u.useCallback(()=>{e(vj("Discord"))},[e]);return r.jsx(Js,{fontWeight:"semibold",href:bj,display:"inline-flex",label:"Discord",onClick:t})},R6={StudioSessionsPlaylistLink:r.jsx(vfe,{}),DiscordLink:r.jsx(bfe,{})},K7=u.memo(()=>{const{t:e}=M(),t=q7();return r.jsxs(ni,{isOpen:t.isOpen,onClose:t.close,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{maxH:"80vh",h:"80vh",children:[r.jsx(Mr,{bg:"none",children:e("supportVideos.supportVideos")}),r.jsx(yo,{}),r.jsx(sr,{children:r.jsx($n,{children:r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(A,{flexDir:"column",gap:2,pb:2,children:[r.jsx(q,{fontSize:"md",children:r.jsx(Jt,{i18nKey:"supportVideos.studioSessionsDesc1",components:R6})}),r.jsx(q,{fontSize:"md",children:r.jsx(Jt,{i18nKey:"supportVideos.studioSessionsDesc2",components:R6})})]}),r.jsx(Y2,{category:e("supportVideos.gettingStarted"),videos:z7}),r.jsx(Y2,{category:e("supportVideos.controlCanvas"),videos:pfe})]})})}),r.jsx(vo,{})]})]})});K7.displayName="VideosModal";const Z7=pe(K1,e=>e.language),Y7=u.memo(()=>{const{t:e}=M();return I(jE)?r.jsxs(zu,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hu,{}),r.jsx(X1,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});Y7.displayName="CanvasAlertsPreserveMask";const sa=u.memo(e=>{const t=u.useMemo(()=>MZ(e.entityIdentifier),[e.entityIdentifier]);return I(t)?e.children:null});sa.displayName="CanvasEntityStateGate";const ac=u.createContext(null),Ye=e=>{const t=u.useContext(ac);return Ge(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&Ge(t.type===e,"useEntityIdentifier must be used with the correct type"),t},Qp=u.createContext(null),X7=u.memo(({children:e})=>{const t=Et(),n=Ye(),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Qp.Provider,{value:i,children:e}):null});X7.displayName="RasterLayerAdapterGate";const Q7=u.memo(({children:e})=>{const t=Et(),n=Ye(),s=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Qp.Provider,{value:i,children:e}):null});Q7.displayName="ControlLayerAdapterGate";const J7=u.memo(({children:e})=>{const t=Et(),n=Ye(),s=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Qp.Provider,{value:i,children:e}):null});J7.displayName="InpaintMaskAdapterGate";const e9=u.memo(({children:e})=>{const t=Et(),n=Ye(),s=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Qp.Provider,{value:i,children:e}):null}),xfe=e=>{const t=u.useContext(Qp);return Ge(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),Ge(t.entityIdentifier.type===e,"useEntityIdentifier must be used with the correct type"),t};e9.displayName="RegionalGuidanceAdapterGate";const So=e=>{const t=Et(),n=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),o=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return u.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?i.get(e.id)??null:e.type==="inpaint_mask"?o.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[i,e,o,s,n])},Cfe=e=>{const t=So(e);return Ge(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},Sfe=e=>pe(et,t=>{const n=Ga(t,e);return n?n.name:null}),t9=e=>{const t=u.useMemo(()=>Sfe(e),[e]);return I(t)},n9=e=>{const{t}=M();return u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"reference_image":return t("controlLayers.globalReferenceImage");case"regional_guidance":return t("controlLayers.regionalGuidance");default:Ge(!1,"Unexpected entity type")}},[e,t])},s9=e=>{const t=t9(e),n=n9(e.type);return u.useMemo(()=>t||n,[t,n])},xj=e=>{const t=u.useMemo(()=>pe(et,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;case"reference_image":default:return!1}}),[e]);return I(t)},wfe=Oe(!1),jfe=e=>pe(et,t=>Pr(t,e,"CanvasAlertsSelectedEntityStatusContent").isEnabled),kfe=e=>pe(et,t=>Pr(t,e,"CanvasAlertsSelectedEntityStatusContent").isLocked),r9=u.memo(({entityIdentifier:e,adapter:t})=>{var g;const{t:n}=M(),s=s9(e),i=u.useMemo(()=>jfe(e),[e]),o=u.useMemo(()=>kfe(e),[e]),a=I(i),l=I(o),c=xj(e.type),d=ce(((g=t.filterer)==null?void 0:g.$isFiltering)??wfe),h=ce(t.transformer.$isTransforming),f=ce(t.$isEmpty),p=u.useMemo(()=>d?{status:"info",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:h?{status:"info",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:f?{status:"info",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:c?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:l?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:a?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[d,h,f,c,l,a,s,n]);return p?r.jsxs(zu,{status:p.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hu,{}),r.jsx(X1,{children:p.title})]}):null});r9.displayName="CanvasAlertsSelectedEntityStatusContent";const i9=u.memo(()=>{const e=I(_n),t=So(e);return!e||!t?null:r.jsx(sa,{entityIdentifier:e,children:r.jsx(r9,{entityIdentifier:e,adapter:t})})});i9.displayName="CanvasAlertsSelectedEntityStatus";const Cj=()=>{const{destination:e}=PZ(void 0,{selectFromResult:({data:t})=>({destination:t?t.destination:null})});return e};function _fe(e){if(typeof Proxy>"u")return e;const t=new Map,n=(...s)=>e(...s);return new Proxy(n,{get:(s,i)=>i==="create"?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}function Gf(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const Q2=e=>Array.isArray(e);function o9(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function zf(e){return typeof e=="string"||Array.isArray(e)}function O6(e){const t=[{},{}];return e==null||e.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function Sj(e,t,n,s){if(typeof t=="function"){const[i,o]=O6(s);t=t(n!==void 0?n:e.custom,i,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,o]=O6(s);t=t(n!==void 0?n:e.custom,i,o)}return t}function Qy(e,t,n){const s=e.getProps();return Sj(s,t,n!==void 0?n:s.custom,e)}const wj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],jj=["initial",...wj],Jp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Xa=new Set(Jp),zo=e=>e*1e3,Ho=e=>e/1e3,Ife={type:"spring",stiffness:500,damping:25,restSpeed:10},Afe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Tfe={type:"keyframes",duration:.8},Efe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Mfe=(e,{keyframes:t})=>t.length>2?Tfe:Xa.has(e)?e.startsWith("scale")?Afe(t[1]):Ife:Efe;function kj(e,t){return e[t]||e.default||e}const Pfe={useManualTiming:!1},Lfe=e=>e!==null;function Jy(e,{repeat:t,repeatType:n="loop"},s){const i=e.filter(Lfe),o=t&&n!=="loop"&&t%2===1?0:i.length-1;return!o||s===void 0?i[o]:s}const bs=e=>e;function Dfe(e){let t=new Set,n=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(d){o.has(d)&&(c.schedule(d),e()),d(a)}const c={schedule:(d,h=!1,f=!1)=>{const g=f&&s?t:n;return h&&o.add(d),g.has(d)||g.add(d),d},cancel:d=>{n.delete(d),o.delete(d)},process:d=>{if(a=d,s){i=!0;return}s=!0,[t,n]=[n,t],n.clear(),t.forEach(l),s=!1,i&&(i=!1,c.process(d))}};return c}const Zg=["read","resolveKeyframes","update","preRender","render","postRender"],Rfe=40;function a9(e,t){let n=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Zg.reduce((C,v)=>(C[v]=Dfe(o),C),{}),{read:l,resolveKeyframes:c,update:d,preRender:h,render:f,postRender:p}=a,g=()=>{const C=performance.now();n=!1,i.delta=s?1e3/60:Math.max(Math.min(C-i.timestamp,Rfe),1),i.timestamp=C,i.isProcessing=!0,l.process(i),c.process(i),d.process(i),h.process(i),f.process(i),p.process(i),i.isProcessing=!1,n&&t&&(s=!1,e(g))},m=()=>{n=!0,s=!0,i.isProcessing||e(g)};return{schedule:Zg.reduce((C,v)=>{const x=a[v];return C[v]=(S,w=!1,j=!1)=>(n||m(),x.schedule(S,w,j)),C},{}),cancel:C=>{for(let v=0;v<Zg.length;v++)a[Zg[v]].cancel(C)},state:i,steps:a}}const{schedule:Ht,cancel:Na,state:ns,steps:Nb}=a9(typeof requestAnimationFrame<"u"?requestAnimationFrame:bs,!0),l9=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Ofe=1e-7,Nfe=12;function Ffe(e,t,n,s,i){let o,a,l=0;do a=t+(n-t)/2,o=l9(a,s,i)-e,o>0?n=a:t=a;while(Math.abs(o)>Ofe&&++l<Nfe);return a}function eg(e,t,n,s){if(e===t&&n===s)return bs;const i=o=>Ffe(o,0,1,e,n);return o=>o===0||o===1?o:l9(i(o),t,s)}const c9=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,u9=e=>t=>1-e(1-t),d9=eg(.33,1.53,.69,.99),_j=u9(d9),h9=c9(_j),f9=e=>(e*=2)<1?.5*_j(e):.5*(2-Math.pow(2,-10*(e-1))),Ij=e=>1-Math.sin(Math.acos(e)),p9=u9(Ij),g9=c9(Ij),m9=e=>/^0[^.\s]+$/u.test(e);function Bfe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||m9(e):!0}let y9=bs;const v9=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),b9=e=>t=>typeof t=="string"&&t.startsWith(e),x9=b9("--"),$fe=b9("var(--"),Aj=e=>$fe(e)?Vfe.test(e.split("/*")[0].trim()):!1,Vfe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Gfe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function zfe(e){const t=Gfe.exec(e);if(!t)return[,];const[,n,s,i]=t;return[`--${n??s}`,i]}function C9(e,t,n=1){const[s,i]=zfe(e);if(!s)return;const o=window.getComputedStyle(t).getPropertyValue(s);if(o){const a=o.trim();return v9(a)?parseFloat(a):a}return Aj(i)?C9(i,t,n+1):i}const Fa=(e,t,n)=>n>t?t:n<e?e:n,ud={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Hf={...ud,transform:e=>Fa(0,1,e)},Yg={...ud,default:1},tg=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ua=tg("deg"),so=tg("%"),tt=tg("px"),Hfe=tg("vh"),Wfe=tg("vw"),N6={...so,parse:e=>so.parse(e)/100,transform:e=>so.transform(e*100)},Ufe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),F6=e=>e===ud||e===tt,B6=(e,t)=>parseFloat(e.split(", ")[t]),$6=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const i=s.match(/^matrix3d\((.+)\)$/u);if(i)return B6(i[1],t);{const o=s.match(/^matrix\((.+)\)$/u);return o?B6(o[1],e):0}},qfe=new Set(["x","y","z"]),Kfe=Jp.filter(e=>!qfe.has(e));function Zfe(e){const t=[];return Kfe.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const Au={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:$6(4,13),y:$6(5,14)};Au.translateX=Au.x;Au.translateY=Au.y;const S9=e=>t=>t.test(e),Yfe={test:e=>e==="auto",parse:e=>e},w9=[ud,tt,so,ua,Wfe,Hfe,Yfe],V6=e=>w9.find(S9(e)),Ml=new Set;let J2=!1,eC=!1;function j9(){if(eC){const e=Array.from(Ml).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const i=Zfe(s);i.length&&(n.set(s,i),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const i=n.get(s);i&&i.forEach(([o,a])=>{var l;(l=s.getValue(o))===null||l===void 0||l.set(a)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}eC=!1,J2=!1,Ml.forEach(e=>e.complete()),Ml.clear()}function k9(){Ml.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(eC=!0)})}function Xfe(){k9(),j9()}class Tj{constructor(t,n,s,i,o,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=i,this.element=o,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ml.add(this),J2||(J2=!0,Ht.read(k9),Ht.resolveKeyframes(j9))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:i}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const a=i==null?void 0:i.get(),l=t[t.length-1];if(a!==void 0)t[0]=a;else if(s&&n){const c=s.readValue(n,l);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=l),i&&a===void 0&&i.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ml.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ml.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const df=e=>Math.round(e*1e5)/1e5,Ej=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Qfe(e){return e==null}const Jfe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Mj=(e,t)=>n=>!!(typeof n=="string"&&Jfe.test(n)&&n.startsWith(e)||t&&!Qfe(n)&&Object.prototype.hasOwnProperty.call(n,t)),_9=(e,t,n)=>s=>{if(typeof s!="string")return s;const[i,o,a,l]=s.match(Ej);return{[e]:parseFloat(i),[t]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},epe=e=>Fa(0,255,e),Fb={...ud,transform:e=>Math.round(epe(e))},Sl={test:Mj("rgb","red"),parse:_9("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+Fb.transform(e)+", "+Fb.transform(t)+", "+Fb.transform(n)+", "+df(Hf.transform(s))+")"};function tpe(e){let t="",n="",s="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,s+=s,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const tC={test:Mj("#"),parse:tpe,transform:Sl.transform},Zc={test:Mj("hsl","hue"),parse:_9("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+so.transform(df(t))+", "+so.transform(df(n))+", "+df(Hf.transform(s))+")"},us={test:e=>Sl.test(e)||tC.test(e)||Zc.test(e),parse:e=>Sl.test(e)?Sl.parse(e):Zc.test(e)?Zc.parse(e):tC.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Sl.transform(e):Zc.transform(e)},npe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function spe(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Ej))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(npe))===null||n===void 0?void 0:n.length)||0)>0}const I9="number",A9="color",rpe="var",ipe="var(",G6="${}",ope=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Wf(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},i=[];let o=0;const l=t.replace(ope,c=>(us.test(c)?(s.color.push(o),i.push(A9),n.push(us.parse(c))):c.startsWith(ipe)?(s.var.push(o),i.push(rpe),n.push(c)):(s.number.push(o),i.push(I9),n.push(parseFloat(c))),++o,G6)).split(G6);return{values:n,split:l,indexes:s,types:i}}function T9(e){return Wf(e).values}function E9(e){const{split:t,types:n}=Wf(e),s=t.length;return i=>{let o="";for(let a=0;a<s;a++)if(o+=t[a],i[a]!==void 0){const l=n[a];l===I9?o+=df(i[a]):l===A9?o+=us.transform(i[a]):o+=i[a]}return o}}const ape=e=>typeof e=="number"?0:e;function lpe(e){const t=T9(e);return E9(e)(t.map(ape))}const Ba={test:spe,parse:T9,createTransformer:E9,getAnimatableNone:lpe},cpe=new Set(["brightness","contrast","saturate","opacity"]);function upe(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(Ej)||[];if(!s)return e;const i=n.replace(s,"");let o=cpe.has(t)?1:0;return s!==n&&(o*=100),t+"("+o+i+")"}const dpe=/\b([a-z-]*)\(.*?\)/gu,nC={...Ba,getAnimatableNone:e=>{const t=e.match(dpe);return t?t.map(upe).join(" "):e}},hpe={borderWidth:tt,borderTopWidth:tt,borderRightWidth:tt,borderBottomWidth:tt,borderLeftWidth:tt,borderRadius:tt,radius:tt,borderTopLeftRadius:tt,borderTopRightRadius:tt,borderBottomRightRadius:tt,borderBottomLeftRadius:tt,width:tt,maxWidth:tt,height:tt,maxHeight:tt,top:tt,right:tt,bottom:tt,left:tt,padding:tt,paddingTop:tt,paddingRight:tt,paddingBottom:tt,paddingLeft:tt,margin:tt,marginTop:tt,marginRight:tt,marginBottom:tt,marginLeft:tt,backgroundPositionX:tt,backgroundPositionY:tt},fpe={rotate:ua,rotateX:ua,rotateY:ua,rotateZ:ua,scale:Yg,scaleX:Yg,scaleY:Yg,scaleZ:Yg,skew:ua,skewX:ua,skewY:ua,distance:tt,translateX:tt,translateY:tt,translateZ:tt,x:tt,y:tt,z:tt,perspective:tt,transformPerspective:tt,opacity:Hf,originX:N6,originY:N6,originZ:tt},z6={...ud,transform:Math.round},Pj={...hpe,...fpe,zIndex:z6,size:tt,fillOpacity:Hf,strokeOpacity:Hf,numOctaves:z6},ppe={...Pj,color:us,backgroundColor:us,outlineColor:us,fill:us,stroke:us,borderColor:us,borderTopColor:us,borderRightColor:us,borderBottomColor:us,borderLeftColor:us,filter:nC,WebkitFilter:nC},Lj=e=>ppe[e];function M9(e,t){let n=Lj(e);return n!==nC&&(n=Ba),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const gpe=new Set(["auto","none","0"]);function mpe(e,t,n){let s=0,i;for(;s<e.length&&!i;){const o=e[s];typeof o=="string"&&!gpe.has(o)&&Wf(o).values.length&&(i=e[s]),s++}if(i&&n)for(const o of t)e[o]=M9(n,i)}class P9 extends Tj{constructor(t,n,s,i,o){super(t,n,s,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),Aj(d))){const h=C9(d,n.current);h!==void 0&&(t[c]=h),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!Ufe.has(s)||t.length!==2)return;const[i,o]=t,a=V6(i),l=V6(o);if(a!==l)if(F6(a)&&F6(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let i=0;i<t.length;i++)Bfe(t[i])&&s.push(i);s.length&&mpe(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Au[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&t.getValue(s,i).jump(i,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const o=n.getValue(s);o&&o.jump(this.measuredOrigin,!1);const a=i.length-1,l=i[a];i[a]=Au[s](n.measureViewportBox(),window.getComputedStyle(n.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{n.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function Dj(e){return typeof e=="function"}let Um;function ype(){Um=void 0}const ro={now:()=>(Um===void 0&&ro.set(ns.isProcessing||Pfe.useManualTiming?ns.timestamp:performance.now()),Um),set:e=>{Um=e,queueMicrotask(ype)}},H6=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Ba.test(e)||e==="0")&&!e.startsWith("url("));function vpe(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function bpe(e,t,n,s){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],a=H6(i,t),l=H6(o,t);return!a||!l?!1:vpe(e)||(n==="spring"||Dj(n))&&s}const xpe=40;class L9{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:a="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ro.now(),this.options={autoplay:t,delay:n,type:s,repeat:i,repeatDelay:o,repeatType:a,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>xpe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Xfe(),this._resolved}onKeyframesResolved(t,n){this.resolvedAt=ro.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:o,delay:a,onComplete:l,onUpdate:c,isGenerator:d}=this.options;if(!d&&!bpe(t,s,i,o))if(a)this.options.duration=0;else{c==null||c(Jy(t,this.options,n)),l==null||l(),this.resolveFinishedPromise();return}const h=this.initPlayback(t,n);h!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...h},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function D9(e,t){return t?e*(1e3/t):0}const Cpe=5;function R9(e,t,n){const s=Math.max(t-Cpe,0);return D9(n-e(s),t-s)}const W6=.001,Spe=.01,wpe=10,jpe=.05,kpe=1;function _pe({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let i,o,a=1-t;a=Fa(jpe,kpe,a),e=Fa(Spe,wpe,Ho(e)),a<1?(i=d=>{const h=d*a,f=h*e,p=h-n,g=sC(d,a),m=Math.exp(-f);return W6-p/g*m},o=d=>{const f=d*a*e,p=f*n+n,g=Math.pow(a,2)*Math.pow(d,2)*e,m=Math.exp(-f),y=sC(Math.pow(d,2),a);return(-i(d)+W6>0?-1:1)*((p-g)*m)/y}):(i=d=>{const h=Math.exp(-d*e),f=(d-n)*e+1;return-.001+h*f},o=d=>{const h=Math.exp(-d*e),f=(n-d)*(e*e);return h*f});const l=5/e,c=Ape(i,o,l);if(e=zo(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:e}}}const Ipe=12;function Ape(e,t,n){let s=n;for(let i=1;i<Ipe;i++)s=s-e(s)/t(s);return s}function sC(e,t){return e*Math.sqrt(1-t*t)}const Tpe=["duration","bounce"],Epe=["stiffness","damping","mass"];function U6(e,t){return t.some(n=>e[n]!==void 0)}function Mpe(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!U6(e,Epe)&&U6(e,Tpe)){const n=_pe(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function O9({keyframes:e,restDelta:t,restSpeed:n,...s}){const i=e[0],o=e[e.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:d,duration:h,velocity:f,isResolvedFromDuration:p}=Mpe({...s,velocity:-Ho(s.velocity||0)}),g=f||0,m=c/(2*Math.sqrt(l*d)),y=o-i,b=Ho(Math.sqrt(l/d)),C=Math.abs(y)<5;n||(n=C?.01:2),t||(t=C?.005:.5);let v;if(m<1){const x=sC(b,m);v=S=>{const w=Math.exp(-m*b*S);return o-w*((g+m*b*y)/x*Math.sin(x*S)+y*Math.cos(x*S))}}else if(m===1)v=x=>o-Math.exp(-b*x)*(y+(g+b*y)*x);else{const x=b*Math.sqrt(m*m-1);v=S=>{const w=Math.exp(-m*b*S),j=Math.min(x*S,300);return o-w*((g+m*b*y)*Math.sinh(j)+x*y*Math.cosh(j))/x}}return{calculatedDuration:p&&h||null,next:x=>{const S=v(x);if(p)a.done=x>=h;else{let w=0;m<1&&(w=x===0?zo(g):R9(v,x,S));const j=Math.abs(w)<=n,P=Math.abs(o-S)<=t;a.done=j&&P}return a.value=a.done?o:S,a}}}function q6({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:h}){const f=e[0],p={done:!1,value:f},g=T=>l!==void 0&&T<l||c!==void 0&&T>c,m=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let y=n*t;const b=f+y,C=a===void 0?b:a(b);C!==b&&(y=C-f);const v=T=>-y*Math.exp(-T/s),x=T=>C+v(T),S=T=>{const L=v(T),E=x(T);p.done=Math.abs(L)<=d,p.value=p.done?C:E};let w,j;const P=T=>{g(p.value)&&(w=T,j=O9({keyframes:[p.value,m(p.value)],velocity:R9(x,T,p.value),damping:i,stiffness:o,restDelta:d,restSpeed:h}))};return P(0),{calculatedDuration:null,next:T=>{let L=!1;return!j&&w===void 0&&(L=!0,S(T),P(T)),w!==void 0&&T>=w?j.next(T-w):(!L&&S(T),p)}}}const Ppe=eg(.42,0,1,1),Lpe=eg(0,0,.58,1),N9=eg(.42,0,.58,1),Dpe=e=>Array.isArray(e)&&typeof e[0]!="number",Rpe={linear:bs,easeIn:Ppe,easeInOut:N9,easeOut:Lpe,circIn:Ij,circInOut:g9,circOut:p9,backIn:_j,backInOut:h9,backOut:d9,anticipate:f9},K6=e=>{if(Array.isArray(e)){y9(e.length===4);const[t,n,s,i]=e;return eg(t,n,s,i)}else if(typeof e=="string")return Rpe[e];return e},Ope=(e,t)=>n=>t(e(n)),Wo=(...e)=>e.reduce(Ope),Tu=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},bn=(e,t,n)=>e+(t-e)*n;function Bb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Npe({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let i=0,o=0,a=0;if(!t)i=o=a=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;i=Bb(c,l,e+1/3),o=Bb(c,l,e),a=Bb(c,l,e-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:s}}function V0(e,t){return n=>n>0?t:e}const $b=(e,t,n)=>{const s=e*e,i=n*(t*t-s)+s;return i<0?0:Math.sqrt(i)},Fpe=[tC,Sl,Zc],Bpe=e=>Fpe.find(t=>t.test(e));function Z6(e){const t=Bpe(e);if(!t)return!1;let n=t.parse(e);return t===Zc&&(n=Npe(n)),n}const Y6=(e,t)=>{const n=Z6(e),s=Z6(t);if(!n||!s)return V0(e,t);const i={...n};return o=>(i.red=$b(n.red,s.red,o),i.green=$b(n.green,s.green,o),i.blue=$b(n.blue,s.blue,o),i.alpha=bn(n.alpha,s.alpha,o),Sl.transform(i))},rC=new Set(["none","hidden"]);function $pe(e,t){return rC.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function Vpe(e,t){return n=>bn(e,t,n)}function Rj(e){return typeof e=="number"?Vpe:typeof e=="string"?Aj(e)?V0:us.test(e)?Y6:Hpe:Array.isArray(e)?F9:typeof e=="object"?us.test(e)?Y6:Gpe:V0}function F9(e,t){const n=[...e],s=n.length,i=e.map((o,a)=>Rj(o)(o,t[a]));return o=>{for(let a=0;a<s;a++)n[a]=i[a](o);return n}}function Gpe(e,t){const n={...e,...t},s={};for(const i in n)e[i]!==void 0&&t[i]!==void 0&&(s[i]=Rj(e[i])(e[i],t[i]));return i=>{for(const o in s)n[o]=s[o](i);return n}}function zpe(e,t){var n;const s=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const a=t.types[o],l=e.indexes[a][i[a]],c=(n=e.values[l])!==null&&n!==void 0?n:0;s[o]=c,i[a]++}return s}const Hpe=(e,t)=>{const n=Ba.createTransformer(t),s=Wf(e),i=Wf(t);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?rC.has(e)&&!i.values.length||rC.has(t)&&!s.values.length?$pe(e,t):Wo(F9(zpe(s,i),i.values),n):V0(e,t)};function B9(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?bn(e,t,n):Rj(e)(e,t)}function Wpe(e,t,n){const s=[],i=n||B9,o=e.length-1;for(let a=0;a<o;a++){let l=i(e[a],e[a+1]);if(t){const c=Array.isArray(t)?t[a]||bs:t;l=Wo(c,l)}s.push(l)}return s}function Upe(e,t,{clamp:n=!0,ease:s,mixer:i}={}){const o=e.length;if(y9(o===t.length),o===1)return()=>t[0];if(o===2&&e[0]===e[1])return()=>t[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Wpe(t,s,i),l=a.length,c=d=>{let h=0;if(l>1)for(;h<e.length-2&&!(d<e[h+1]);h++);const f=Tu(e[h],e[h+1],d);return a[h](f)};return n?d=>c(Fa(e[0],e[o-1],d)):c}function qpe(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const i=Tu(0,t,s);e.push(bn(n,1,i))}}function Kpe(e){const t=[0];return qpe(t,e.length-1),t}function Zpe(e,t){return e.map(n=>n*t)}function Ype(e,t){return e.map(()=>t||N9).splice(0,e.length-1)}function G0({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const i=Dpe(s)?s.map(K6):K6(s),o={done:!1,value:t[0]},a=Zpe(n&&n.length===t.length?n:Kpe(t),e),l=Upe(a,t,{ease:Array.isArray(i)?i:Ype(t,i)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const X6=2e4;function Xpe(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<X6;)t+=n,s=e.next(t);return t>=X6?1/0:t}const Qpe=e=>{const t=({timestamp:n})=>e(n);return{start:()=>Ht.update(t,!0),stop:()=>Na(t),now:()=>ns.isProcessing?ns.timestamp:ro.now()}},Jpe={decay:q6,inertia:q6,tween:G0,keyframes:G0,spring:O9},ege=e=>e/100;class Oj extends L9{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:s,element:i,keyframes:o}=this.options,a=(i==null?void 0:i.KeyframeResolver)||Tj,l=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new a(o,l,n,s,i),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o,velocity:a=0}=this.options,l=Dj(n)?n:Jpe[n]||G0;let c,d;l!==G0&&typeof t[0]!="number"&&(c=Wo(ege,B9(t[0],t[1])),t=[0,100]);const h=l({...this.options,keyframes:t});o==="mirror"&&(d=l({...this.options,keyframes:[...t].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=Xpe(h));const{calculatedDuration:f}=h,p=f+i,g=p*(s+1)-i;return{generator:h,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:p,totalDuration:g}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:T}=this.options;return{done:!0,value:T[T.length-1]}}const{finalKeyframe:i,generator:o,mirroredGenerator:a,mapPercentToKeyframes:l,keyframes:c,calculatedDuration:d,totalDuration:h,resolvedDuration:f}=s;if(this.startTime===null)return o.next(0);const{delay:p,repeat:g,repeatType:m,repeatDelay:y,onUpdate:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-p*(this.speed>=0?1:-1),v=this.speed>=0?C<0:C>h;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let x=this.currentTime,S=o;if(g){const T=Math.min(this.currentTime,h)/f;let L=Math.floor(T),E=T%1;!E&&T>=1&&(E=1),E===1&&L--,L=Math.min(L,g+1),!!(L%2)&&(m==="reverse"?(E=1-E,y&&(E-=y/f)):m==="mirror"&&(S=a)),x=Fa(0,1,E)*f}const w=v?{done:!1,value:c[0]}:S.next(x);l&&(w.value=l(w.value));let{done:j}=w;!v&&d!==null&&(j=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return P&&i!==void 0&&(w.value=Jy(c,this.options,i)),b&&b(w.value),P&&this.finish(),w}get duration(){const{resolved:t}=this;return t?Ho(t.calculatedDuration):0}get time(){return Ho(this.currentTime)}set time(t){t=zo(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Ho(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Qpe,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),n&&n();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const $9=new Set(["opacity","clipPath","filter","transform"]),V9=e=>Array.isArray(e)&&typeof e[0]=="number",tge=10,nge=(e,t)=>{let n="";const s=Math.max(Math.round(t/tge),2);for(let i=0;i<s;i++)n+=e(Tu(0,s-1,i))+", ";return`linear(${n.substring(0,n.length-2)})`};function Nj(e){let t;return()=>(t===void 0&&(t=e()),t)}const sge={linearEasing:void 0};function rge(e,t){const n=Nj(e);return()=>{var s;return(s=sge[t])!==null&&s!==void 0?s:n()}}const z0=rge(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function G9(e){return!!(typeof e=="function"&&z0()||!e||typeof e=="string"&&(e in iC||z0())||V9(e)||Array.isArray(e)&&e.every(G9))}const Kh=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,iC={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Kh([0,.65,.55,1]),circOut:Kh([.55,0,1,.45]),backIn:Kh([.31,.01,.66,-.59]),backOut:Kh([.33,1.53,.69,.99])};function z9(e,t){if(e)return typeof e=="function"&&z0()?nge(e,t):V9(e)?Kh(e):Array.isArray(e)?e.map(n=>z9(n,t)||iC.easeOut):iC[e]}function ige(e,t,n,{delay:s=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:l,times:c}={}){const d={[t]:n};c&&(d.offset=c);const h=z9(l,i);return Array.isArray(h)&&(d.easing=h),e.animate(d,{delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"})}function Q6(e,t){e.timeline=t,e.onfinish=null}const oge=Nj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),H0=10,age=2e4;function lge(e){return Dj(e.type)||e.type==="spring"||!G9(e.ease)}function cge(e,t){const n=new Oj({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const i=[];let o=0;for(;!s.done&&o<age;)s=n.sample(o),i.push(s.value),o+=H0;return{times:void 0,keyframes:i,duration:o-H0,ease:"linear"}}const H9={anticipate:f9,backInOut:h9,circInOut:g9};function uge(e){return e in H9}class J6 extends L9{constructor(t){super(t);const{name:n,motionValue:s,element:i,keyframes:o}=this.options;this.resolver=new P9(o,(a,l)=>this.onKeyframesResolved(a,l),n,s,i),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:i=300,times:o,ease:a,type:l,motionValue:c,name:d,startTime:h}=this.options;if(!(!((s=c.owner)===null||s===void 0)&&s.current))return!1;if(typeof a=="string"&&z0()&&uge(a)&&(a=H9[a]),lge(this.options)){const{onComplete:p,onUpdate:g,motionValue:m,element:y,...b}=this.options,C=cge(t,b);t=C.keyframes,t.length===1&&(t[1]=t[0]),i=C.duration,o=C.times,a=C.ease,l="keyframes"}const f=ige(c.owner.current,d,t,{...this.options,duration:i,times:o,ease:a});return f.startTime=h??this.calcStartTime(),this.pendingTimeline?(Q6(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:p}=this.options;c.set(Jy(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:i,times:o,type:l,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Ho(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Ho(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=zo(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:n}=t;return n.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return bs;const{animation:s}=n;Q6(s,t)}return bs}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:i,type:o,ease:a,times:l}=t;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:h,onComplete:f,element:p,...g}=this.options,m=new Oj({...g,keyframes:s,duration:i,type:o,ease:a,times:l,isGenerator:!0}),y=zo(this.time);d.setWithVelocity(m.sample(y-H0).value,m.sample(y).value,H0)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:i,repeatType:o,damping:a,type:l}=t;return oge()&&s&&$9.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!i&&o!=="mirror"&&a!==0&&l!=="inertia"}}const dge=Nj(()=>window.ScrollTimeline!==void 0);class hge{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,n){return Promise.all(this.animations).then(t).catch(n)}getAll(t){return this.animations[0][t]}setAll(t,n){for(let s=0;s<this.animations.length;s++)this.animations[s][t]=n}attachTimeline(t,n){const s=this.animations.map(i=>dge()&&i.attachTimeline?i.attachTimeline(t):n(i));return()=>{s.forEach((i,o)=>{i&&i(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function fge({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...h}){return!!Object.keys(h).length}const Fj=(e,t,n,s={},i,o)=>a=>{const l=kj(s,e)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-zo(c);let h={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:p=>{t.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:i};fge(l)||(h={...h,...Mfe(e,h)}),h.duration&&(h.duration=zo(h.duration)),h.repeatDelay&&(h.repeatDelay=zo(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let f=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(f=!0)),f&&!o&&t.get()!==void 0){const p=Jy(h.keyframes,l);if(p!==void 0)return Ht.update(()=>{h.onUpdate(p),h.onComplete()}),new hge([])}return!o&&J6.supports(h)?new J6(h):new Oj(h)},pge=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),gge=e=>Q2(e)?e[e.length-1]||0:e;function Bj(e,t){e.indexOf(t)===-1&&e.push(t)}function $j(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Vj{constructor(){this.subscriptions=[]}add(t){return Bj(this.subscriptions,t),()=>$j(this.subscriptions,t)}notify(t,n,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,n,s);else for(let o=0;o<i;o++){const a=this.subscriptions[o];a&&a(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const eA=30,mge=e=>!isNaN(parseFloat(e));class yge{constructor(t,n={}){this.version="11.10.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,i=!0)=>{const o=ro.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=ro.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=mge(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Vj);const s=this.events[t].add(n);return t==="change"?()=>{s(),Ht.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=ro.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>eA)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,eA);return D9(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Uf(e,t){return new yge(e,t)}function vge(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Uf(n))}function bge(e,t){const n=Qy(e,t);let{transitionEnd:s={},transition:i={},...o}=n||{};o={...o,...s};for(const a in o){const l=gge(o[a]);vge(e,a,l)}}const ev=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),xge="framerAppearId",W9="data-"+ev(xge);function U9(e){return e.props[W9]}const ps=e=>!!(e&&e.getVelocity);function Cge(e){return!!(ps(e)&&e.add)}function q9(e){if(Xa.has(e))return"transform";if($9.has(e))return ev(e)}function oC(e,t){var n;if(!e.applyWillChange)return;const s=e.getValue("willChange");if(Cge(s))return s.add(t);!(!((n=e.props.style)===null||n===void 0)&&n.willChange)&&q9(t)&&e.setStaticValue("willChange","transform")}function Sge({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function K9(e,t,{delay:n=0,transitionOverride:s,type:i}={}){var o;let{transition:a=e.getDefaultTransition(),transitionEnd:l,...c}=t;s&&(a=s);const d=[],h=i&&e.animationState&&e.animationState.getState()[i];for(const f in c){const p=e.getValue(f,(o=e.latestValues[f])!==null&&o!==void 0?o:null),g=c[f];if(g===void 0||h&&Sge(h,f))continue;const m={delay:n,...kj(a||{},f)};let y=!1;if(window.MotionHandoffAnimation){const C=U9(e);if(C){const v=window.MotionHandoffAnimation(C,f,Ht);v!==null&&(m.startTime=v,y=!0)}}oC(e,f),p.start(Fj(f,p,g,e.shouldReduceMotion&&Xa.has(f)?{type:!1}:m,e,y));const b=p.animation;b&&d.push(b)}return l&&Promise.all(d).then(()=>{Ht.update(()=>{l&&bge(e,l)})}),d}function aC(e,t,n={}){var s;const i=Qy(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const a=i?()=>Promise.all(K9(e,i,n)):()=>Promise.resolve(),l=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:h=0,staggerChildren:f,staggerDirection:p}=o;return wge(e,t,h+d,f,p,n)}:()=>Promise.resolve(),{when:c}=o;if(c){const[d,h]=c==="beforeChildren"?[a,l]:[l,a];return d().then(()=>h())}else return Promise.all([a(),l(n.delay)])}function wge(e,t,n=0,s=0,i=1,o){const a=[],l=(e.variantChildren.size-1)*s,c=i===1?(d=0)=>d*s:(d=0)=>l-d*s;return Array.from(e.variantChildren).sort(jge).forEach((d,h)=>{d.notify("AnimationStart",t),a.push(aC(d,t,{...o,delay:n+c(h)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(a)}function jge(e,t){return e.sortNodePosition(t)}function kge(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const i=t.map(o=>aC(e,o,n));s=Promise.all(i)}else if(typeof t=="string")s=aC(e,t,n);else{const i=typeof t=="function"?Qy(e,t,n.custom):t;s=Promise.all(K9(e,i,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}const _ge=jj.length;function Z9(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?Z9(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<_ge;n++){const s=jj[n],i=e.props[s];(zf(i)||i===!1)&&(t[s]=i)}return t}const Ige=[...wj].reverse(),Age=wj.length;function Tge(e){return t=>Promise.all(t.map(({animation:n,options:s})=>kge(e,n,s)))}function Ege(e){let t=Tge(e),n=tA(),s=!0;const i=c=>(d,h)=>{var f;const p=Qy(e,h,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(p){const{transition:g,transitionEnd:m,...y}=p;d={...d,...y,...m}}return d};function o(c){t=c(e)}function a(c){const{props:d}=e,h=Z9(e.parent)||{},f=[],p=new Set;let g={},m=1/0;for(let b=0;b<Age;b++){const C=Ige[b],v=n[C],x=d[C]!==void 0?d[C]:h[C],S=zf(x),w=C===c?v.isActive:null;w===!1&&(m=b);let j=x===h[C]&&x!==d[C]&&S;if(j&&s&&e.manuallyAnimateOnMount&&(j=!1),v.protectedKeys={...g},!v.isActive&&w===null||!x&&!v.prevProp||Gf(x)||typeof x=="boolean")continue;const P=Mge(v.prevProp,x);let T=P||C===c&&v.isActive&&!j&&S||b>m&&S,L=!1;const E=Array.isArray(x)?x:[x];let O=E.reduce(i(C),{});w===!1&&(O={});const{prevResolvedValues:F={}}=v,_={...F,...O},R=G=>{T=!0,p.has(G)&&(L=!0,p.delete(G)),v.needsAnimating[G]=!0;const ee=e.getValue(G);ee&&(ee.liveStyle=!1)};for(const G in _){const ee=O[G],Q=F[G];if(g.hasOwnProperty(G))continue;let se=!1;Q2(ee)&&Q2(Q)?se=!o9(ee,Q):se=ee!==Q,se?ee!=null?R(G):p.add(G):ee!==void 0&&p.has(G)?R(G):v.protectedKeys[G]=!0}v.prevProp=x,v.prevResolvedValues=O,v.isActive&&(g={...g,...O}),s&&e.blockInitialAnimation&&(T=!1),T&&(!(j&&P)||L)&&f.push(...E.map(G=>({animation:G,options:{type:C}})))}if(p.size){const b={};p.forEach(C=>{const v=e.getBaseTarget(C),x=e.getValue(C);x&&(x.liveStyle=!0),b[C]=v??null}),f.push({animation:b})}let y=!!f.length;return s&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),s=!1,y?t(f):Promise.resolve()}function l(c,d){var h;if(n[c].isActive===d)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(p=>{var g;return(g=p.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),n[c].isActive=d;const f=a(c);for(const p in n)n[p].protectedKeys={};return f}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=tA(),s=!0}}}function Mge(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!o9(t,e):!1}function cl(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function tA(){return{animate:cl(!0),whileInView:cl(),whileHover:cl(),whileTap:cl(),whileDrag:cl(),whileFocus:cl(),exit:cl()}}class Qa{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Pge extends Qa{constructor(t){super(t),t.animationState||(t.animationState=Ege(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Gf(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Lge=0;class Dge extends Qa{constructor(){super(...arguments),this.id=Lge++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const i=this.node.animationState.setActive("exit",!t);n&&!t&&i.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Rge={animation:{Feature:Pge},exit:{Feature:Dge}},Y9=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function tv(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const Oge=e=>t=>Y9(t)&&e(t,tv(t));function Vo(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function Uo(e,t,n,s){return Vo(e,t,Oge(n),s)}const nA=(e,t)=>Math.abs(e-t);function Nge(e,t){const n=nA(e.x,t.x),s=nA(e.y,t.y);return Math.sqrt(n**2+s**2)}class X9{constructor(t,n,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Gb(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,g=Nge(f.offset,{x:0,y:0})>=3;if(!p&&!g)return;const{point:m}=f,{timestamp:y}=ns;this.history.push({...m,timestamp:y});const{onStart:b,onMove:C}=this.handlers;p||(b&&b(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,f)},this.handlePointerMove=(f,p)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Vb(p,this.transformPagePoint),Ht.update(this.updatePoint,!0)},this.handlePointerUp=(f,p)=>{this.end();const{onEnd:g,onSessionEnd:m,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=Gb(f.type==="pointercancel"?this.lastMoveEventInfo:Vb(p,this.transformPagePoint),this.history);this.startEvent&&g&&g(f,b),m&&m(f,b)},!Y9(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=s,this.contextWindow=i||window;const a=tv(t),l=Vb(a,this.transformPagePoint),{point:c}=l,{timestamp:d}=ns;this.history=[{...c,timestamp:d}];const{onSessionStart:h}=n;h&&h(t,Gb(l,this.history)),this.removeListeners=Wo(Uo(this.contextWindow,"pointermove",this.handlePointerMove),Uo(this.contextWindow,"pointerup",this.handlePointerUp),Uo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Na(this.updatePoint)}}function Vb(e,t){return t?{point:t(e.point)}:e}function sA(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Gb({point:e},t){return{point:e,delta:sA(e,Q9(t)),offset:sA(e,Fge(t)),velocity:Bge(t,.1)}}function Fge(e){return e[0]}function Q9(e){return e[e.length-1]}function Bge(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const i=Q9(e);for(;n>=0&&(s=e[n],!(i.timestamp-s.timestamp>zo(t)));)n--;if(!s)return{x:0,y:0};const o=Ho(i.timestamp-s.timestamp);if(o===0)return{x:0,y:0};const a={x:(i.x-s.x)/o,y:(i.y-s.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function J9(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const rA=J9("dragHorizontal"),iA=J9("dragVertical");function eO(e){let t=!1;if(e==="y")t=iA();else if(e==="x")t=rA();else{const n=rA(),s=iA();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function tO(){const e=eO(!0);return e?(e(),!1):!0}function Yc(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const nO=1e-4,$ge=1-nO,Vge=1+nO,sO=.01,Gge=0-sO,zge=0+sO;function Ir(e){return e.max-e.min}function Hge(e,t,n){return Math.abs(e-t)<=n}function oA(e,t,n,s=.5){e.origin=s,e.originPoint=bn(t.min,t.max,e.origin),e.scale=Ir(n)/Ir(t),e.translate=bn(n.min,n.max,e.origin)-e.originPoint,(e.scale>=$ge&&e.scale<=Vge||isNaN(e.scale))&&(e.scale=1),(e.translate>=Gge&&e.translate<=zge||isNaN(e.translate))&&(e.translate=0)}function hf(e,t,n,s){oA(e.x,t.x,n.x,s?s.originX:void 0),oA(e.y,t.y,n.y,s?s.originY:void 0)}function aA(e,t,n){e.min=n.min+t.min,e.max=e.min+Ir(t)}function Wge(e,t,n){aA(e.x,t.x,n.x),aA(e.y,t.y,n.y)}function lA(e,t,n){e.min=t.min-n.min,e.max=e.min+Ir(t)}function ff(e,t,n){lA(e.x,t.x,n.x),lA(e.y,t.y,n.y)}function Uge(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?bn(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?bn(n,e,s.max):Math.min(e,n)),e}function cA(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function qge(e,{top:t,left:n,bottom:s,right:i}){return{x:cA(e.x,n,i),y:cA(e.y,t,s)}}function uA(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function Kge(e,t){return{x:uA(e.x,t.x),y:uA(e.y,t.y)}}function Zge(e,t){let n=.5;const s=Ir(e),i=Ir(t);return i>s?n=Tu(t.min,t.max-s,e.min):s>i&&(n=Tu(e.min,e.max-i,t.min)),Fa(0,1,n)}function Yge(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const lC=.35;function Xge(e=lC){return e===!1?e=0:e===!0&&(e=lC),{x:dA(e,"left","right"),y:dA(e,"top","bottom")}}function dA(e,t,n){return{min:hA(e,t),max:hA(e,n)}}function hA(e,t){return typeof e=="number"?e:e[t]||0}const fA=()=>({translate:0,scale:1,origin:0,originPoint:0}),Xc=()=>({x:fA(),y:fA()}),pA=()=>({min:0,max:0}),An=()=>({x:pA(),y:pA()});function $r(e){return[e("x"),e("y")]}function rO({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function Qge({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Jge(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function zb(e){return e===void 0||e===1}function cC({scale:e,scaleX:t,scaleY:n}){return!zb(e)||!zb(t)||!zb(n)}function hl(e){return cC(e)||iO(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function iO(e){return gA(e.x)||gA(e.y)}function gA(e){return e&&e!=="0%"}function W0(e,t,n){const s=e-n,i=t*s;return n+i}function mA(e,t,n,s,i){return i!==void 0&&(e=W0(e,i,s)),W0(e,n,s)+t}function uC(e,t=0,n=1,s,i){e.min=mA(e.min,t,n,s,i),e.max=mA(e.max,t,n,s,i)}function oO(e,{x:t,y:n}){uC(e.x,t.translate,t.scale,t.originPoint),uC(e.y,n.translate,n.scale,n.originPoint)}const yA=.999999999999,vA=1.0000000000001;function eme(e,t,n,s=!1){const i=n.length;if(!i)return;t.x=t.y=1;let o,a;for(let l=0;l<i;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Jc(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,oO(e,a)),s&&hl(o.latestValues)&&Jc(e,o.latestValues))}t.x<vA&&t.x>yA&&(t.x=1),t.y<vA&&t.y>yA&&(t.y=1)}function Qc(e,t){e.min=e.min+t,e.max=e.max+t}function bA(e,t,n,s,i=.5){const o=bn(e.min,e.max,i);uC(e,t,n,o,s)}function Jc(e,t){bA(e.x,t.x,t.scaleX,t.scale,t.originX),bA(e.y,t.y,t.scaleY,t.scale,t.originY)}function aO(e,t){return rO(Jge(e.getBoundingClientRect(),t))}function tme(e,t,n){const s=aO(e,n),{scroll:i}=t;return i&&(Qc(s.x,i.offset.x),Qc(s.y,i.offset.y)),s}const lO=({current:e})=>e?e.ownerDocument.defaultView:null,nme=new WeakMap;class sme{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=An(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(tv(h,"page").point)},o=(h,f)=>{const{drag:p,dragPropagation:g,onDragStart:m}=this.getProps();if(p&&!g&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=eO(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),$r(b=>{let C=this.getAxisMotionValue(b).get()||0;if(so.test(C)){const{projection:v}=this.visualElement;if(v&&v.layout){const x=v.layout.layoutBox[b];x&&(C=Ir(x)*(parseFloat(C)/100))}}this.originPoint[b]=C}),m&&Ht.postRender(()=>m(h,f)),oC(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(h,f)=>{const{dragPropagation:p,dragDirectionLock:g,onDirectionLock:m,onDrag:y}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:b}=f;if(g&&this.currentDirection===null){this.currentDirection=rme(b),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",f.point,b),this.updateAxis("y",f.point,b),this.visualElement.render(),y&&y(h,f)},l=(h,f)=>this.stop(h,f),c=()=>$r(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new X9(t,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:lO(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&Ht.postRender(()=>o(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:i}=this.getProps();if(!s||!Xg(t,i,this.currentDirection))return;const o=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=Uge(a,this.constraints[t],this.elastic[t])),o.set(a)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;n&&Yc(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=qge(i.layoutBox,n):this.constraints=!1,this.elastic=Xge(s),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&$r(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Yge(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!Yc(t))return!1;const s=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=tme(s,i.root,this.visualElement.getTransformPagePoint());let a=Kge(i.layout.layoutBox,o);if(n){const l=n(Qge(a));this.hasMutatedConstraints=!!l,l&&(a=rO(l))}return a}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:i,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=$r(h=>{if(!Xg(h,n,this.currentDirection))return;let f=c&&c[h]||{};a&&(f={min:0,max:0});const p=i?200:1e6,g=i?40:1e7,m={type:"inertia",velocity:s?t[h]:0,bounceStiffness:p,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(h,m)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return oC(this.visualElement,t),s.start(Fj(t,s,0,n,this.visualElement,!1))}stopAnimation(){$r(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){$r(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),i=s[n];return i||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){$r(n=>{const{drag:s}=this.getProps();if(!Xg(n,s,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:a,max:l}=i.layout.layoutBox[n];o.set(t[n]-bn(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!Yc(n)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};$r(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();i[a]=Zge({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),$r(a=>{if(!Xg(a,t,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(bn(c,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;nme.set(this.visualElement,this);const t=this.visualElement.current,n=Uo(t,"pointerdown",c=>{const{drag:d,dragListener:h=!0}=this.getProps();d&&h&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();Yc(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Ht.read(s);const a=Vo(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&($r(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=c[h].translate,f.set(f.get()+c[h].translate))}),this.visualElement.render())});return()=>{a(),n(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:a=lC,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:i,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function Xg(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function rme(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class ime extends Qa{constructor(t){super(t),this.removeGroupControls=bs,this.removeListeners=bs,this.controls=new sme(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||bs}unmount(){this.removeGroupControls(),this.removeListeners()}}const xA=e=>(t,n)=>{e&&Ht.postRender(()=>e(t,n))};class ome extends Qa{constructor(){super(...arguments),this.removePointerDownListener=bs}onPointerDown(t){this.session=new X9(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lO(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:xA(t),onStart:xA(n),onMove:s,onEnd:(o,a)=>{delete this.session,i&&Ht.postRender(()=>i(o,a))}}}mount(){this.removePointerDownListener=Uo(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const nv=u.createContext(null);function ame(){const e=u.useContext(nv);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,i=u.useId();u.useEffect(()=>s(i),[]);const o=u.useCallback(()=>n&&n(i),[i,n]);return!t&&n?[!1,o]:[!0]}const Gj=u.createContext({}),cO=u.createContext({}),qm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function CA(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const wh={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(tt.test(e))e=parseFloat(e);else return e;const n=CA(e,t.target.x),s=CA(e,t.target.y);return`${n}% ${s}%`}},lme={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,i=Ba.parse(e);if(i.length>5)return s;const o=Ba.createTransformer(e),a=typeof i[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;i[0+a]/=l,i[1+a]/=c;const d=bn(l,c,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),o(i)}},U0={};function cme(e){Object.assign(U0,e)}const{schedule:zj}=a9(queueMicrotask,!1);class ume extends u.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:i}=this.props,{projection:o}=t;cme(dme),o&&(n.group&&n.group.add(o),s&&s.register&&i&&s.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),qm.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:i,isPresent:o}=this.props,a=s.projection;return a&&(a.isPresent=o,i||t.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?a.promote():a.relegate()||Ht.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),zj.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function uO(e){const[t,n]=ame(),s=u.useContext(Gj);return r.jsx(ume,{...e,layoutGroup:s,switchLayoutGroup:u.useContext(cO),isPresent:t,safeToRemove:n})}const dme={borderRadius:{...wh,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:wh,borderTopRightRadius:wh,borderBottomLeftRadius:wh,borderBottomRightRadius:wh,boxShadow:lme},dO=["TopLeft","TopRight","BottomLeft","BottomRight"],hme=dO.length,SA=e=>typeof e=="string"?parseFloat(e):e,wA=e=>typeof e=="number"||tt.test(e);function fme(e,t,n,s,i,o){i?(e.opacity=bn(0,n.opacity!==void 0?n.opacity:1,pme(s)),e.opacityExit=bn(t.opacity!==void 0?t.opacity:1,0,gme(s))):o&&(e.opacity=bn(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let a=0;a<hme;a++){const l=`border${dO[a]}Radius`;let c=jA(t,l),d=jA(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||wA(c)===wA(d)?(e[l]=Math.max(bn(SA(c),SA(d),s),0),(so.test(d)||so.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=bn(t.rotate||0,n.rotate||0,s))}function jA(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const pme=hO(0,.5,p9),gme=hO(.5,.95,bs);function hO(e,t,n){return s=>s<e?0:s>t?1:n(Tu(e,t,s))}function kA(e,t){e.min=t.min,e.max=t.max}function Fr(e,t){kA(e.x,t.x),kA(e.y,t.y)}function _A(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function IA(e,t,n,s,i){return e-=t,e=W0(e,1/n,s),i!==void 0&&(e=W0(e,1/i,s)),e}function mme(e,t=0,n=1,s=.5,i,o=e,a=e){if(so.test(t)&&(t=parseFloat(t),t=bn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let l=bn(o.min,o.max,s);e===o&&(l-=t),e.min=IA(e.min,t,n,l,i),e.max=IA(e.max,t,n,l,i)}function AA(e,t,[n,s,i],o,a){mme(e,t[n],t[s],t[i],t.scale,o,a)}const yme=["x","scaleX","originX"],vme=["y","scaleY","originY"];function TA(e,t,n,s){AA(e.x,t,yme,n?n.x:void 0,s?s.x:void 0),AA(e.y,t,vme,n?n.y:void 0,s?s.y:void 0)}function EA(e){return e.translate===0&&e.scale===1}function fO(e){return EA(e.x)&&EA(e.y)}function MA(e,t){return e.min===t.min&&e.max===t.max}function bme(e,t){return MA(e.x,t.x)&&MA(e.y,t.y)}function PA(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function pO(e,t){return PA(e.x,t.x)&&PA(e.y,t.y)}function LA(e){return Ir(e.x)/Ir(e.y)}function DA(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class xme{constructor(){this.members=[]}add(t){Bj(this.members,t),t.scheduleRender()}remove(t){if($j(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(i=>t===i);if(n===0)return!1;let s;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){s=o;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Cme(e,t,n){let s="";const i=e.x.translate/t.x,o=e.y.translate/t.y,a=(n==null?void 0:n.z)||0;if((i||o||a)&&(s=`translate3d(${i}px, ${o}px, ${a}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:h,rotateX:f,rotateY:p,skewX:g,skewY:m}=n;d&&(s=`perspective(${d}px) ${s}`),h&&(s+=`rotate(${h}deg) `),f&&(s+=`rotateX(${f}deg) `),p&&(s+=`rotateY(${p}deg) `),g&&(s+=`skewX(${g}deg) `),m&&(s+=`skewY(${m}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const Sme=(e,t)=>e.depth-t.depth;class wme{constructor(){this.children=[],this.isDirty=!1}add(t){Bj(this.children,t),this.isDirty=!0}remove(t){$j(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Sme),this.isDirty=!1,this.children.forEach(t)}}function Km(e){const t=ps(e)?e.get():e;return pge(t)?t.toValue():t}function jme(e,t){const n=ro.now(),s=({timestamp:i})=>{const o=i-n;o>=t&&(Na(s),e(o-t))};return Ht.read(s,!0),()=>Na(s)}function kme(e){return e instanceof SVGElement&&e.tagName!=="svg"}function _me(e,t,n){const s=ps(e)?e:Uf(e);return s.start(Fj("",s,t,n)),s.animation}const fl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Zh=typeof window<"u"&&window.MotionDebug!==void 0,Hb=["","X","Y","Z"],Ime={visibility:"hidden"},RA=1e3;let Ame=0;function Wb(e,t,n,s){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),s&&(s[e]=0))}function gO(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=U9(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:i,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Ht,!(i||o))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&gO(s)}function mO({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},l=t==null?void 0:t()){this.id=Ame++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Zh&&(fl.totalNodes=fl.resolvedTargetDeltas=fl.recalculatedProjection=0),this.nodes.forEach(Mme),this.nodes.forEach(Ome),this.nodes.forEach(Nme),this.nodes.forEach(Pme),Zh&&window.MotionDebug.record(fl)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new wme)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Vj),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=kme(a),this.instance=a;const{layoutId:c,layout:d,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const p=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=jme(p,250),qm.hasAnimatedSinceResize&&(qm.hasAnimatedSinceResize=!1,this.nodes.forEach(NA))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&h&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||h.getDefaultTransition()||Gme,{onLayoutAnimationStart:b,onLayoutAnimationComplete:C}=h.getProps(),v=!this.targetLayout||!pO(this.targetLayout,m)||g,x=!p&&g;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||x||p&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,x);const S={...kj(y,"layout"),onPlay:b,onComplete:C};(h.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S)}else p||NA(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Na(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Fme),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&gO(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(OA);return}this.isUpdating||this.nodes.forEach(Dme),this.isUpdating=!1,this.nodes.forEach(Rme),this.nodes.forEach(Tme),this.nodes.forEach(Eme),this.clearAllSnapshots();const l=ro.now();ns.delta=Fa(0,1e3/60,l-ns.timestamp),ns.timestamp=l,ns.isProcessing=!0,Nb.update.process(ns),Nb.preRender.process(ns),Nb.render.process(ns),ns.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,zj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Lme),this.sharedNodes.forEach(Bme)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ht.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ht.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=An(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!fO(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;a&&(l||hl(this.latestValues)||h)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),zme(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:l}=this.options;if(!l)return An();const c=l.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Hme))){const{scroll:h}=this.root;h&&(Qc(c.x,h.offset.x),Qc(c.y,h.offset.y))}return c}removeElementScroll(a){var l;const c=An();if(Fr(c,a),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return c;for(let d=0;d<this.path.length;d++){const h=this.path[d],{scroll:f,options:p}=h;h!==this.root&&f&&p.layoutScroll&&(f.wasRoot&&Fr(c,a),Qc(c.x,f.offset.x),Qc(c.y,f.offset.y))}return c}applyTransform(a,l=!1){const c=An();Fr(c,a);for(let d=0;d<this.path.length;d++){const h=this.path[d];!l&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Jc(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),hl(h.latestValues)&&Jc(c,h.latestValues)}return hl(this.latestValues)&&Jc(c,this.latestValues),c}removeTransform(a){const l=An();Fr(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!hl(d.latestValues))continue;cC(d.latestValues)&&d.updateSnapshot();const h=An(),f=d.measurePageBox();Fr(h,f),TA(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return hl(this.latestValues)&&TA(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ns.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=ns.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=An(),this.relativeTargetOrigin=An(),ff(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),Fr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=An(),this.targetWithTransforms=An()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Wge(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Fr(this.target,this.layout.layoutBox),oO(this.target,this.targetDelta)):Fr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=An(),this.relativeTargetOrigin=An(),ff(this.relativeTargetOrigin,this.target,g.target),Fr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Zh&&fl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||cC(this.parent.latestValues)||iO(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===ns.timestamp&&(d=!1),d)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;Fr(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;eme(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=An());const{target:m}=l;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(_A(this.prevProjectionDelta.x,this.projectionDelta.x),_A(this.prevProjectionDelta.y,this.projectionDelta.y)),hf(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!DA(this.projectionDelta.x,this.prevProjectionDelta.x)||!DA(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),Zh&&fl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),a){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Xc(),this.projectionDelta=Xc(),this.projectionDeltaWithTransform=Xc()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},h={...this.latestValues},f=Xc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=An(),g=c?c.source:void 0,m=this.layout?this.layout.source:void 0,y=g!==m,b=this.getStack(),C=!b||b.members.length<=1,v=!!(y&&!C&&this.options.crossfade===!0&&!this.path.some(Vme));this.animationProgress=0;let x;this.mixTargetDelta=S=>{const w=S/1e3;FA(f.x,a.x,w),FA(f.y,a.y,w),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ff(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$me(this.relativeTarget,this.relativeTargetOrigin,p,w),x&&bme(this.relativeTarget,x)&&(this.isProjectionDirty=!1),x||(x=An()),Fr(x,this.relativeTarget)),y&&(this.animationValues=h,fme(h,d,this.latestValues,w,v,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Na(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ht.update(()=>{qm.hasAnimatedSinceResize=!0,this.currentAnimation=_me(0,RA,{...a,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(RA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:h}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&yO(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||An();const f=Ir(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+f;const p=Ir(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}Fr(l,c),Jc(l,h),hf(this.projectionDeltaWithTransform,this.layoutCorrected,l,h)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new xme),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:l}=this.options;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:l}=this.options;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Wb("z",a,d,this.animationValues);for(let h=0;h<Hb.length;h++)Wb(`rotate${Hb[h]}`,a,d,this.animationValues),Wb(`skew${Hb[h]}`,a,d,this.animationValues);a.render();for(const h in d)a.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);a.scheduleRender()}getProjectionStyles(a){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ime;const d={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=Km(a==null?void 0:a.pointerEvents)||"",d.transform=h?h(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=Km(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!hl(this.latestValues)&&(y.transform=h?h({},""):"none",this.hasProjected=!1),y}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=Cme(this.projectionDeltaWithTransform,this.treeScale,p),h&&(d.transform=h(p,d.transform));const{x:g,y:m}=this.projectionDelta;d.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=p.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const y in U0){if(p[y]===void 0)continue;const{correct:b,applyTo:C}=U0[y],v=d.transform==="none"?p[y]:b(p[y],f);if(C){const x=C.length;for(let S=0;S<x;S++)d[C[S]]=v}else d[y]=v}return this.options.layoutId&&(d.pointerEvents=f===this?Km(a==null?void 0:a.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(OA),this.root.sharedNodes.clear()}}}function Tme(e){e.updateLayout()}function Eme(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:i}=e.layout,{animationType:o}=e.options,a=n.source!==e.layout.source;o==="size"?$r(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Ir(p);p.min=s[f].min,p.max=p.min+g}):yO(o,n.layoutBox,s)&&$r(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Ir(s[f]);p.max=p.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const l=Xc();hf(l,s,n.layoutBox);const c=Xc();a?hf(c,e.applyTransform(i,!0),n.measuredBox):hf(c,s,n.layoutBox);const d=!fO(l);let h=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:g}=f;if(p&&g){const m=An();ff(m,n.layoutBox,p.layoutBox);const y=An();ff(y,s,g.layoutBox),pO(m,y)||(h=!0),f.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=m,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:h})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function Mme(e){Zh&&fl.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Pme(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Lme(e){e.clearSnapshot()}function OA(e){e.clearMeasurements()}function Dme(e){e.isLayoutDirty=!1}function Rme(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function NA(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Ome(e){e.resolveTargetDelta()}function Nme(e){e.calcProjection()}function Fme(e){e.resetSkewAndRotation()}function Bme(e){e.removeLeadSnapshot()}function FA(e,t,n){e.translate=bn(t.translate,0,n),e.scale=bn(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function BA(e,t,n,s){e.min=bn(t.min,n.min,s),e.max=bn(t.max,n.max,s)}function $me(e,t,n,s){BA(e.x,t.x,n.x,s),BA(e.y,t.y,n.y,s)}function Vme(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Gme={duration:.45,ease:[.4,0,.1,1]},$A=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),VA=$A("applewebkit/")&&!$A("chrome/")?Math.round:bs;function GA(e){e.min=VA(e.min),e.max=VA(e.max)}function zme(e){GA(e.x),GA(e.y)}function yO(e,t,n){return e==="position"||e==="preserve-aspect"&&!Hge(LA(t),LA(n),.2)}function Hme(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Wme=mO({attachResizeListener:(e,t)=>Vo(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Ub={current:void 0},vO=mO({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Ub.current){const e=new Wme({});e.mount(window),e.setOptions({layoutScroll:!0}),Ub.current=e}return Ub.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Ume={pan:{Feature:ome},drag:{Feature:ime,ProjectionNode:vO,MeasureLayout:uO}};function zA(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",i=(o,a)=>{if(o.pointerType==="touch"||tO())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t);const c=l[s];c&&Ht.postRender(()=>c(o,a))};return Uo(e.current,n,i,{passive:!e.getProps()[s]})}class qme extends Qa{mount(){this.unmount=Wo(zA(this.node,!0),zA(this.node,!1))}unmount(){}}class Kme extends Qa{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Wo(Vo(this.node.current,"focus",()=>this.onFocus()),Vo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const bO=(e,t)=>t?e===t?!0:bO(e,t.parentElement):!1;function qb(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,tv(n))}class Zme extends Qa{constructor(){super(...arguments),this.removeStartListeners=bs,this.removeEndListeners=bs,this.removeAccessibleListeners=bs,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),o=Uo(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:h,globalTapTarget:f}=this.node.getProps(),p=!f&&!bO(this.node.current,l.target)?h:d;p&&Ht.update(()=>p(l,c))},{passive:!(s.onTap||s.onPointerUp)}),a=Uo(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=Wo(o,a),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const a=l=>{l.key!=="Enter"||!this.checkPressEnd()||qb("up",(c,d)=>{const{onTap:h}=this.node.getProps();h&&Ht.postRender(()=>h(c,d))})};this.removeEndListeners(),this.removeEndListeners=Vo(this.node.current,"keyup",a),qb("down",(l,c)=>{this.startPress(l,c)})},n=Vo(this.node.current,"keydown",t),s=()=>{this.isPressing&&qb("cancel",(o,a)=>this.cancelPress(o,a))},i=Vo(this.node.current,"blur",s);this.removeAccessibleListeners=Wo(n,i)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&Ht.postRender(()=>s(t,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!tO()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&Ht.postRender(()=>s(t,n))}mount(){const t=this.node.getProps(),n=Uo(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=Vo(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Wo(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const dC=new WeakMap,Kb=new WeakMap,Yme=e=>{const t=dC.get(e.target);t&&t(e)},Xme=e=>{e.forEach(Yme)};function Qme({root:e,...t}){const n=e||document;Kb.has(n)||Kb.set(n,{});const s=Kb.get(n),i=JSON.stringify(t);return s[i]||(s[i]=new IntersectionObserver(Xme,{root:e,...t})),s[i]}function Jme(e,t,n){const s=Qme(t);return dC.set(e,n),s.observe(e),()=>{dC.delete(e),s.unobserve(e)}}const e0e={some:0,all:1};class t0e extends Qa{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:i="some",once:o}=t,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:e0e[i]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),p=d?h:f;p&&p(c)};return Jme(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(n0e(t,n))&&this.startObserver()}unmount(){}}function n0e({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const s0e={inView:{Feature:t0e},tap:{Feature:Zme},focus:{Feature:Kme},hover:{Feature:qme}},r0e={layout:{ProjectionNode:vO,MeasureLayout:uO}},Hj=u.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),sv=u.createContext({}),Wj=typeof window<"u",xO=Wj?u.useLayoutEffect:u.useEffect,CO=u.createContext({strict:!1});let HA=!1;function i0e(e,t,n,s,i){var o;const{visualElement:a}=u.useContext(sv),l=u.useContext(CO),c=u.useContext(nv),d=u.useContext(Hj).reducedMotion,h=u.useRef();s=s||l.renderer,!h.current&&s&&(h.current=s(e,{visualState:t,parent:a,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const f=h.current,p=u.useContext(cO);f&&!f.projection&&i&&(f.type==="html"||f.type==="svg")&&a0e(h.current,n,i,p),u.useInsertionEffect(()=>{f&&f.update(n,c)});const g=n[W9],m=u.useRef(!!g&&!window.MotionHandoffIsComplete&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return xO(()=>{f&&(f.updateFeatures(),zj.render(f.render),m.current&&f.animationState&&f.animationState.animateChanges())}),u.useEffect(()=>{f&&(!m.current&&f.animationState&&f.animationState.animateChanges(),m.current=!1,HA||(HA=!0,queueMicrotask(o0e)))}),f}function o0e(){window.MotionHandoffIsComplete=!0}function a0e(e,t,n,s){const{layoutId:i,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:SO(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!a||l&&Yc(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:s,layoutScroll:c,layoutRoot:d})}function SO(e){if(e)return e.options.allowProjection!==!1?e.projection:SO(e.parent)}function l0e(e,t,n){return u.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):Yc(n)&&(n.current=s))},[t])}function rv(e){return Gf(e.animate)||jj.some(t=>zf(e[t]))}function wO(e){return!!(rv(e)||e.variants)}function c0e(e,t){if(rv(e)){const{initial:n,animate:s}=e;return{initial:n===!1||zf(n)?n:void 0,animate:zf(s)?s:void 0}}return e.inherit!==!1?t:{}}function u0e(e){const{initial:t,animate:n}=c0e(e,u.useContext(sv));return u.useMemo(()=>({initial:t,animate:n}),[WA(t),WA(n)])}function WA(e){return Array.isArray(e)?e.join(" "):e}const UA={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Eu={};for(const e in UA)Eu[e]={isEnabled:t=>UA[e].some(n=>!!t[n])};function d0e(e){for(const t in e)Eu[t]={...Eu[t],...e[t]}}const h0e=Symbol.for("motionComponentSymbol");function f0e({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:i}){e&&d0e(e);function o(l,c){let d;const h={...u.useContext(Hj),...l,layoutId:p0e(l)},{isStatic:f}=h,p=u0e(l),g=s(l,f);if(!f&&Wj){g0e();const m=m0e(h);d=m.MeasureLayout,p.visualElement=i0e(i,g,h,t,m.ProjectionNode)}return r.jsxs(sv.Provider,{value:p,children:[d&&p.visualElement?r.jsx(d,{visualElement:p.visualElement,...h}):null,n(i,l,l0e(g,p.visualElement,c),g,f,p.visualElement)]})}const a=u.forwardRef(o);return a[h0e]=i,a}function p0e({layoutId:e}){const t=u.useContext(Gj).id;return t&&e!==void 0?t+"-"+e:e}function g0e(e,t){u.useContext(CO).strict}function m0e(e){const{drag:t,layout:n}=Eu;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const y0e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Uj(e){return typeof e!="string"||e.includes("-")?!1:!!(y0e.indexOf(e)>-1||/[A-Z]/u.test(e))}function jO(e,{style:t,vars:n},s,i){Object.assign(e.style,t,i&&i.getProjectionStyles(s));for(const o in n)e.style.setProperty(o,n[o])}const kO=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function _O(e,t,n,s){jO(e,t,void 0,s);for(const i in t.attrs)e.setAttribute(kO.has(i)?i:ev(i),t.attrs[i])}function IO(e,{layout:t,layoutId:n}){return Xa.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!U0[e]||e==="opacity")}function qj(e,t,n){var s;const{style:i}=e,o={};for(const a in i)(ps(i[a])||t.style&&ps(t.style[a])||IO(a,e)||((s=n==null?void 0:n.getValue(a))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(o[a]=i[a]);return n&&i&&typeof i.willChange=="string"&&(n.applyWillChange=!1),o}function AO(e,t,n){const s=qj(e,t,n);for(const i in e)if(ps(e[i])||ps(t[i])){const o=Jp.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[o]=e[i]}return s}function Kj(e){const t=u.useRef(null);return t.current===null&&(t.current=e()),t.current}function v0e({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:n,onMount:s},i,o,a,l){const c={latestValues:b0e(i,o,a,l?!1:e,t),renderState:n()};return s&&(c.mount=d=>s(i,d,c)),c}const TO=e=>(t,n)=>{const s=u.useContext(sv),i=u.useContext(nv),o=()=>v0e(e,t,s,i,n);return n?o():Kj(o)};function qA(e,t,n){const s=Array.isArray(t)?t:[t];for(let i=0;i<s.length;i++){const o=Sj(e,s[i]);if(o){const{transitionEnd:a,transition:l,...c}=o;n(c,a)}}}function b0e(e,t,n,s,i){var o;const a={};let l=s&&((o=e.style)===null||o===void 0?void 0:o.willChange)===void 0;const c=i(e,{});for(const y in c)a[y]=Km(c[y]);let{initial:d,animate:h}=e;const f=rv(e),p=wO(e);t&&p&&!f&&e.inherit!==!1&&(d===void 0&&(d=t.initial),h===void 0&&(h=t.animate));let g=n?n.initial===!1:!1;g=g||d===!1;const m=g?h:d;return m&&typeof m!="boolean"&&!Gf(m)&&qA(e,m,(y,b)=>{for(const C in y){let v=y[C];if(Array.isArray(v)){const x=g?v.length-1:0;v=v[x]}v!==null&&(a[C]=v)}for(const C in b)a[C]=b[C]}),l&&h&&d!==!1&&!Gf(h)&&qA(e,h,y=>{for(const b in y)if(q9(b)){a.willChange="transform";return}}),a}const Zj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),EO=()=>({...Zj(),attrs:{}}),MO=(e,t)=>t&&typeof e=="number"?t.transform(e):e,x0e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},C0e=Jp.length;function S0e(e,t,n){let s="",i=!0;for(let o=0;o<C0e;o++){const a=Jp[o],l=e[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=MO(l,Pj[a]);if(!c){i=!1;const h=x0e[a]||a;s+=`${h}(${d}) `}n&&(t[a]=d)}}return s=s.trim(),n?s=n(t,i?"":s):i&&(s="none"),s}function Yj(e,t,n){const{style:s,vars:i,transformOrigin:o}=e;let a=!1,l=!1;for(const c in t){const d=t[c];if(Xa.has(c)){a=!0;continue}else if(x9(c)){i[c]=d;continue}else{const h=MO(d,Pj[c]);c.startsWith("origin")?(l=!0,o[c]=h):s[c]=h}}if(t.transform||(a||n?s.transform=S0e(t,e.transform,n):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:h=0}=o;s.transformOrigin=`${c} ${d} ${h}`}}function KA(e,t,n){return typeof e=="string"?e:tt.transform(t+n*e)}function w0e(e,t,n){const s=KA(t,e.x,e.width),i=KA(n,e.y,e.height);return`${s} ${i}`}const j0e={offset:"stroke-dashoffset",array:"stroke-dasharray"},k0e={offset:"strokeDashoffset",array:"strokeDasharray"};function _0e(e,t,n=1,s=0,i=!0){e.pathLength=1;const o=i?j0e:k0e;e[o.offset]=tt.transform(-s);const a=tt.transform(t),l=tt.transform(n);e[o.array]=`${a} ${l}`}function Xj(e,{attrX:t,attrY:n,attrScale:s,originX:i,originY:o,pathLength:a,pathSpacing:l=1,pathOffset:c=0,...d},h,f){if(Yj(e,d,f),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:g,dimensions:m}=e;p.transform&&(m&&(g.transform=p.transform),delete p.transform),m&&(i!==void 0||o!==void 0||g.transform)&&(g.transformOrigin=w0e(m,i!==void 0?i:.5,o!==void 0?o:.5)),t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),s!==void 0&&(p.scale=s),a!==void 0&&_0e(p,a,l,c,!1)}const Qj=e=>typeof e=="string"&&e.toLowerCase()==="svg",I0e={useVisualState:TO({scrapeMotionValuesFromProps:AO,createRenderState:EO,onMount:(e,t,{renderState:n,latestValues:s})=>{Ht.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Ht.render(()=>{Xj(n,s,Qj(t.tagName),e.transformTemplate),_O(t,n)})}})},A0e={useVisualState:TO({applyWillChange:!0,scrapeMotionValuesFromProps:qj,createRenderState:Zj})};function PO(e,t,n){for(const s in t)!ps(t[s])&&!IO(s,n)&&(e[s]=t[s])}function T0e({transformTemplate:e},t){return u.useMemo(()=>{const n=Zj();return Yj(n,t,e),Object.assign({},n.vars,n.style)},[t])}function E0e(e,t){const n=e.style||{},s={};return PO(s,n,e),Object.assign(s,T0e(e,t)),s}function M0e(e,t){const n={},s=E0e(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const P0e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function q0(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||P0e.has(e)}let LO=e=>!q0(e);function L0e(e){e&&(LO=t=>t.startsWith("on")?!q0(t):e(t))}try{L0e(require("@emotion/is-prop-valid").default)}catch{}function D0e(e,t,n){const s={};for(const i in e)i==="values"&&typeof e.values=="object"||(LO(i)||n===!0&&q0(i)||!t&&!q0(i)||e.draggable&&i.startsWith("onDrag"))&&(s[i]=e[i]);return s}function R0e(e,t,n,s){const i=u.useMemo(()=>{const o=EO();return Xj(o,t,Qj(s),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};PO(o,e.style,e),i.style={...o,...i.style}}return i}function O0e(e=!1){return(n,s,i,{latestValues:o},a)=>{const c=(Uj(n)?R0e:M0e)(s,o,a,n),d=D0e(s,typeof n=="string",e),h=n!==u.Fragment?{...d,...c,ref:i}:{},{children:f}=s,p=u.useMemo(()=>ps(f)?f.get():f,[f]);return u.createElement(n,{...h,children:p})}}function N0e(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){const a={...Uj(s)?I0e:A0e,preloadedFeatures:e,useRender:O0e(i),createVisualElement:t,Component:s};return f0e(a)}}const hC={current:null},DO={current:!1};function F0e(){if(DO.current=!0,!!Wj)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>hC.current=e.matches;e.addListener(t),t()}else hC.current=!1}function B0e(e,t,n){for(const s in t){const i=t[s],o=n[s];if(ps(i))e.addValue(s,i);else if(ps(o))e.addValue(s,Uf(i,{owner:e}));else if(o!==i)if(e.hasValue(s)){const a=e.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=e.getStaticValue(s);e.addValue(s,Uf(a!==void 0?a:i,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const ZA=new WeakMap,$0e=[...w9,us,Ba],V0e=e=>$0e.find(S9(e)),YA=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class G0e{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:o,visualState:a},l={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Tj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=ro.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Ht.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=rv(n),this.isVariantNode=wO(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in f){const g=f[p];c[p]!==void 0&&ps(g)&&g.set(c[p],!1)}}mount(t){this.current=t,ZA.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),DO.current||F0e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:hC.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){ZA.delete(this.current),this.projection&&this.projection.unmount(),Na(this.notifyUpdate),Na(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=Xa.has(t),i=n.on("change",l=>{this.latestValues[t]=l,this.props.onUpdate&&Ht.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{i(),o(),a&&a(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Eu){const n=Eu[t];if(!n)continue;const{isEnabled:s,Feature:i}=n;if(!this.features[t]&&i&&s(this.props)&&(this.features[t]=new i(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):An()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<YA.length;s++){const i=YA[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,a=t[o];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=B0e(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=Uf(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(v9(i)||m9(i))?i=parseFloat(i):!V0e(i)&&Ba.test(n)&&(i=M9(t,n)),this.setBaseTarget(t,ps(i)?i.get():i)),ps(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let i;if(typeof s=="string"||typeof s=="object"){const a=Sj(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(i=a[t])}if(s&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!ps(o)?o:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Vj),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class RO extends G0e{constructor(){super(...arguments),this.KeyframeResolver=P9}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function z0e(e){return window.getComputedStyle(e)}class H0e extends RO{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=jO}readValueFromInstance(t,n){if(Xa.has(n)){const s=Lj(n);return s&&s.default||0}else{const s=z0e(t),i=(x9(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return aO(t,n)}build(t,n,s){Yj(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return qj(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ps(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class W0e extends RO{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=An}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(Xa.has(n)){const s=Lj(n);return s&&s.default||0}return n=kO.has(n)?n:ev(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return AO(t,n,s)}build(t,n,s){Xj(t,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,n,s,i){_O(t,n,s,i)}mount(t){this.isSVGTag=Qj(t.tagName),super.mount(t)}}const U0e=(e,t)=>Uj(e)?new W0e(t):new H0e(t,{allowProjection:e!==u.Fragment}),q0e=N0e({...Rge,...s0e,...Ume,...r0e},U0e),Jj=_fe(q0e);class K0e extends u.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Z0e({children:e,isPresent:t}){const n=u.useId(),s=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=u.useContext(Hj);return u.useInsertionEffect(()=>{const{width:a,height:l,top:c,left:d}=i.current;if(t||!s.current||!a||!l)return;s.current.dataset.motionPopId=n;const h=document.createElement("style");return o&&(h.nonce=o),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${l}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[t]),r.jsx(K0e,{isPresent:t,childRef:s,sizeRef:i,children:u.cloneElement(e,{ref:s})})}const Y0e=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:i,presenceAffectsLayout:o,mode:a})=>{const l=Kj(X0e),c=u.useId(),d=u.useMemo(()=>({id:c,initial:t,isPresent:n,custom:i,onExitComplete:h=>{l.set(h,!0);for(const f of l.values())if(!f)return;s&&s()},register:h=>(l.set(h,!1),()=>l.delete(h))}),o?[Math.random()]:[n]);return u.useMemo(()=>{l.forEach((h,f)=>l.set(f,!1))},[n]),u.useEffect(()=>{!n&&!l.size&&s&&s()},[n]),a==="popLayout"&&(e=r.jsx(Z0e,{isPresent:n,children:e})),r.jsx(nv.Provider,{value:d,children:e})};function X0e(){return new Map}const Qg=e=>e.key||"";function XA(e){const t=[];return u.Children.forEach(e,n=>{u.isValidElement(n)&&t.push(n)}),t}const OO=({children:e,exitBeforeEnter:t,custom:n,initial:s=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:a="sync"})=>{const l=u.useMemo(()=>XA(e),[e]),c=l.map(Qg),d=u.useRef(!0),h=u.useRef(l),f=Kj(()=>new Map),[p,g]=u.useState(l),[m,y]=u.useState(l);xO(()=>{d.current=!1,h.current=l;for(let v=0;v<m.length;v++){const x=Qg(m[v]);c.includes(x)?f.delete(x):f.get(x)!==!0&&f.set(x,!1)}},[m,c.length,c.join("-")]);const b=[];if(l!==p){let v=[...l];for(let x=0;x<m.length;x++){const S=m[x],w=Qg(S);c.includes(w)||(v.splice(x,0,S),b.push(S))}a==="wait"&&b.length&&(v=b),y(XA(v)),g(l);return}const{forceRender:C}=u.useContext(Gj);return r.jsx(r.Fragment,{children:m.map(v=>{const x=Qg(v),S=l===m||c.includes(x),w=()=>{if(f.has(x))f.set(x,!0);else return;let j=!0;f.forEach(P=>{P||(j=!1)}),j&&(C==null||C(),y(h.current),i&&i())};return r.jsx(Y0e,{isPresent:S,initial:!d.current||s?void 0:!1,custom:S?void 0:n,presenceAffectsLayout:o,mode:a,onExitComplete:S?void 0:w,children:v},x)})})},Q0e=e=>{const t=Lt(),n=z(),s=u.useCallback(()=>{t.open(),n(Cr("gallery"))},[t,n]);return r.jsx(ye,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},J0e=()=>{const{t:e}=M(),t=Cj(),n=I(En),s=u.useMemo(()=>n!=="canvas"||!t?!1:t==="gallery",[t,n]);return r.jsx(NO,{title:e("controlLayers.sendingToGallery"),description:r.jsx(Jt,{i18nKey:"controlLayers.viewProgressInViewer",components:{Btn:r.jsx(Q0e,{})}}),isVisible:s})},e1e=e=>{const t=z(),n=Lt(),s=u.useCallback(()=>{t(Kt("canvas")),t(Cr("layers")),n.close()},[t,n]);return r.jsx(ye,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},t1e=()=>{const{t:e}=M(),t=Cj(),n=I(On),s=I(En),i=u.useMemo(()=>s!=="canvas"&&t!=="canvas"?!1:n?!0:t?t==="canvas":!1,[t,n,s]);return r.jsx(NO,{title:e("controlLayers.sendingToCanvas"),description:r.jsx(Jt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(e1e,{})}}),isVisible:i})},NO=({title:e,description:t,isVisible:n})=>{const s=Q1(!1);return r.jsx(OO,{children:(n||s.isTrue)&&r.jsx(Jj.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:s.isTrue?.1:1,ease:"easeIn"}},onMouseEnter:s.setTrue,onMouseLeave:s.setFalse,children:r.jsxs(zu,{status:"warning",flexDir:"column",pointerEvents:"auto",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsxs(A,{w:"full",alignItems:"center",children:[r.jsx(Hu,{}),r.jsx(X1,{children:e})]}),r.jsx(J1,{children:t})]})})})},FO=u.memo(()=>{const{t:e}=M(),t=st(),n=Et(),s=u.useCallback(async()=>{const i=n.getAllAdapters();for(const o of i)await o.cropToBbox()},[n]);return r.jsx(he,{icon:r.jsx(OL,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});FO.displayName="CanvasContextMenuItemsCropCanvasToBbox";const K0=Fs("canvas"),n1e=()=>{const{t:e}=M(),t=na();return u.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await ey(i);t.writeImage(o,()=>{K0.trace("Layer copied to clipboard"),ve({status:"info",title:e("toast.layerCopiedToClipboard")})})}catch(i){K0.error({error:Ds(i)},"Problem copying layer to clipboard"),ve({status:"error",title:e("toast.problemCopyingLayer")})}},[t,e])},QA=e=>{const{t}=M(),n=na(),s=Et();return u.useCallback(async()=>{const o=e==="bbox"?s.stateApi.getBbox().rect:s.compositor.getVisibleRectOfType("raster_layer");if(o.width===0||o.height===0){ve({title:t("controlLayers.copyRegionError",{region:ru(e)}),description:t("controlLayers.regionIsEmpty"),status:"warning"});return}try{const a=s.compositor.getVisibleAdaptersOfType("raster_layer"),l=s.compositor.getCompositeCanvas(a,o),c=await ey(l);n.writeImage(c,()=>{K0.trace("Region copied to clipboard"),ve({title:t("controlLayers.regionCopiedToClipboard",{region:ru(e)})})})}catch(a){K0.error({error:Ds(a)},"Failed to save canvas to gallery"),ve({title:t("controlLayers.copyRegionError",{region:ru(e)}),status:"error"})}},[s.compositor,s.stateApi,n,e,t])},s1e=Fs("canvas"),ra=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:i,withMetadata:o})=>{const{t:a}=M(),l=Wu(),c=Et();return u.useCallback(async()=>{const h=e==="bbox"?c.stateApi.getBbox().rect:c.compositor.getVisibleRectOfType("raster_layer");if(h.width===0||h.height===0){ve({title:s,description:a("controlLayers.regionIsEmpty"),status:"warning"});return}let f;o&&(f=LZ(l.getState()));let p;t&&(p=Er(l.getState()));const g=await Ls(()=>{const m=c.compositor.getVisibleAdaptersOfType("raster_layer");return c.compositor.getCompositeImageDTO(m,h,{is_intermediate:!t,metadata:f,board_id:p,silent:!0},void 0,!0)});g.isOk()?(i&&i(g.value,h),ve({title:n})):(s1e.error({error:Ds(g.error)},"Failed to save canvas to gallery"),ve({title:s,status:"error"}))},[c.compositor,c.stateApi,i,e,t,l,a,s,n,o])},BO=()=>{const{t:e}=M(),t=u.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ra(t)},$O=()=>{const{t:e}=M(),t=u.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ra(t)},r1e=()=>{const{t:e}=M(),t=z(),n=I(Ko),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const c={referenceImages:[{id:_e("regional_guidance_reference_image"),ipAdapter:{...bt(n),image:Rl(a)}}]};t(Ra({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[n,t,e]);return ra(s)},i1e=()=>{const{t:e}=M(),t=z(),n=I(Ko),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const l={ipAdapter:{...bt(n),image:Rl(a)}};t(U1({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[n,t,e]);return ra(s)},o1e=()=>{const{t:e}=M(),t=z(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Mi(o)],position:{x:a.x,y:a.y}};t($u({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return ra(n)},a1e=()=>{const{t:e}=M(),t=z(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Mi(o)],controlAdapter:bt(Xl),position:{x:a.x,y:a.y}};t(fp({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[t,e]);return ra(n)},l1e=e=>{const{t}=M(),n=z(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(SS({entityIdentifier:e,position:{x:l.x,y:l.y},imageObject:Mi(a),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return ra(s)},VO=e=>{const{t}=M(),n=z(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(xS({entityIdentifier:e,imageDTO:a}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return ra(s)},c1e=(e,t)=>{const{t:n}=M(),s=z(),i=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(l,c)=>{s(CS({entityIdentifier:e,referenceImageId:t,imageDTO:l}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return ra(i)},GO=u.memo(()=>{const{t:e}=M(),t=er(),n=er(),s=er(),i=st(),o=BO(),a=$O(),l=r1e(),c=i1e(),d=o1e(),h=a1e(),f=QA("canvas"),p=QA("bbox");return r.jsx(r.Fragment,{children:r.jsxs(xr,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:[r.jsx(FO,{}),r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(eo,{}),children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.canvasContextMenu.saveToGalleryGroup")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx(eo,{}),isDisabled:i,onClick:o,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),r.jsx(he,{icon:r.jsx(eo,{}),isDisabled:i,onClick:a,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]})]})}),r.jsx(he,{...n.parentMenuItemProps,icon:r.jsx(hs,{}),children:r.jsxs(Yt,{...n.menuProps,children:[r.jsx(Xt,{...n.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.canvasContextMenu.bboxGroup")})}),r.jsxs(It,{...n.menuListProps,children:[r.jsx(he,{icon:r.jsx(hs,{}),isDisabled:i,onClick:c,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),r.jsx(he,{icon:r.jsx(hs,{}),isDisabled:i,onClick:l,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),r.jsx(he,{icon:r.jsx(hs,{}),isDisabled:i,onClick:h,children:e("controlLayers.canvasContextMenu.newControlLayer")}),r.jsx(he,{icon:r.jsx(hs,{}),isDisabled:i,onClick:d,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})}),r.jsx(he,{...s.parentMenuItemProps,icon:r.jsx(an,{}),children:r.jsxs(Yt,{...s.menuProps,children:[r.jsx(Xt,{...s.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.canvasContextMenu.copyToClipboard")})}),r.jsxs(It,{...s.menuListProps,children:[r.jsx(he,{icon:r.jsx(an,{}),isDisabled:i,onClick:f,children:e("controlLayers.canvasContextMenu.copyCanvasToClipboard")}),r.jsx(he,{icon:r.jsx(an,{}),isDisabled:i,onClick:p,children:e("controlLayers.canvasContextMenu.copyBboxToClipboard")})]})]})})]})})});GO.displayName="CanvasContextMenuGlobalMenuItems";const u1e=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:n==="reference_image"?{index:e.referenceImages.entities.findIndex(s=>s.id===t),count:e.referenceImages.entities.length}:{index:-1,count:0},dd=u.memo(()=>{const{t:e}=M(),t=z(),n=Ye(),s=st(),i=u.useMemo(()=>tn(et,h=>{const{index:f,count:p}=u1e(h,n);return{canMoveForwardOne:f<p-1,canMoveBackwardOne:f>0,canMoveToFront:f<p-1,canMoveToBack:f>0}}),[n]),o=I(i),a=u.useCallback(()=>{t(DZ({entityIdentifier:n}))},[t,n]),l=u.useCallback(()=>{t(RZ({entityIdentifier:n}))},[t,n]),c=u.useCallback(()=>{t(OZ({entityIdentifier:n}))},[t,n]),d=u.useCallback(()=>{t(NZ({entityIdentifier:n}))},[t,n]);return r.jsxs(r.Fragment,{children:[r.jsx(Kr,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:l,isDisabled:!o.canMoveToFront||s,icon:r.jsx(oae,{})}),r.jsx(Kr,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:a,isDisabled:!o.canMoveForwardOne||s,icon:r.jsx(PL,{})}),r.jsx(Kr,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:c,isDisabled:!o.canMoveBackwardOne||s,icon:r.jsx(sae,{})}),r.jsx(Kr,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:d,isDisabled:!o.canMoveToBack||s,icon:r.jsx(iae,{})})]})});dd.displayName="CanvasEntityMenuItemsArrange";const Ri=e=>{const t=u.useMemo(()=>pe(et,s=>{if(!e)return!1;const i=Ga(s,e);return i?i.isLocked:!1}),[e]);return I(t)},ng=u.memo(()=>{const{t:e}=M(),t=Ye(),n=So(t),s=st(),i=Ri(t),o=u.useCallback(()=>{n&&n.cropToBbox()},[n]);return r.jsx(he,{onClick:o,icon:r.jsx(OL,{}),isDisabled:s||i,children:e("controlLayers.cropLayerToBbox")})});ng.displayName="CanvasEntityMenuItemsCropToBbox";const hd=u.memo(({asIcon:e=!1})=>{const{t}=M(),n=z(),s=Ye(),i=st(),o=u.useCallback(()=>{n(OS({entityIdentifier:s}))},[n,s]);return e?r.jsx(Kr,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:o,icon:r.jsx(ei,{}),isDestructive:!0,isDisabled:i}):r.jsx(he,{onClick:o,icon:r.jsx(ei,{}),isDestructive:!0,isDisabled:i,children:t("common.delete")})});hd.displayName="CanvasEntityMenuItemsDelete";const fd=u.memo(()=>{const{t:e}=M(),t=z(),n=Ye(),s=st(),i=u.useCallback(()=>{t(kE({entityIdentifier:n}))},[t,n]);return r.jsx(Kr,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:i,icon:r.jsx(JL,{}),isDisabled:s})});fd.displayName="CanvasEntityMenuItemsDuplicate";const sg=e=>{const t=u.useMemo(()=>e?FZ(e):()=>!1,[e]);return!I(t)},iv=e=>{const t=Et(),n=So(e),s=Lt(),i=st(),o=Ri(e),a=sg(e),l=u.useMemo(()=>!!(!e||!Qx(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!Qx(e))return;const d=t.getAdapter(e);d&&(s.close(),d.filterer.start())},[l,e,t,s]);return{isDisabled:l,start:c}},ek=u.memo(()=>{const{t:e}=M(),t=Ye(),n=iv(t);return r.jsx(he,{onClick:n.start,icon:r.jsx(Rw,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});ek.displayName="CanvasEntityMenuItemsFilter";const d1e=e=>{const t=u.useMemo(()=>tn(et,s=>{const i=BZ(s,e);return i?Ys(i):null}),[e]);return I(t)},rg=u.memo(()=>{const{t:e}=M(),t=Et(),n=st(),s=Ye(),i=d1e(s),o=u.useCallback(()=>{i!==null&&t.compositor.mergeByEntityIdentifiers([i,s],!0)},[t.compositor,s,i]);return r.jsx(he,{onClick:o,icon:r.jsx(XL,{}),isDisabled:n||i===null,children:e("controlLayers.mergeDown")})});rg.displayName="CanvasEntityMenuItemsMergeDown";const zO=()=>{const e=I(Er);return u.useCallback(async n=>{if(!n)return;const s=n.getCanvas(),i=await ey(s),o=new File([i],`layer-${n.id}.png`,{type:"image/png"});wa({file:o,image_category:"user",is_intermediate:!1,board_id:e==="none"?void 0:e})},[e])},ig=u.memo(()=>{const{t:e}=M(),t=Ye(),n=So(t),s=st(),i=zO(),o=u.useCallback(()=>{i(n)},[i,n]);return r.jsx(he,{onClick:o,icon:r.jsx(eo,{}),isDisabled:s,children:e("controlLayers.saveLayerToAssets")})});ig.displayName="CanvasEntityMenuItemsSave";const HO=e=>{const t=Et(),n=So(e),s=Lt(),i=st(),o=Ri(e),a=sg(e),l=u.useMemo(()=>!!(!e||!Jx(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!Jx(e))return;const d=t.getAdapter(e);d&&(s.close(),d.segmentAnything.start())},[l,e,t,s]);return{isDisabled:l,start:c}},tk=u.memo(()=>{const{t:e}=M(),t=Ye(),n=HO(t);return r.jsx(he,{onClick:n.start,icon:r.jsx(sD,{}),isDisabled:n.isDisabled,children:e("controlLayers.selectObject.selectObject")})});tk.displayName="CanvasEntityMenuItemsSelectObject";const nk=e=>{const t=Et(),n=So(e),s=Lt(),i=st(),o=Ri(e),a=sg(e),l=u.useMemo(()=>!!(!e||!Rm(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(async()=>{if(l||!e||!Rm(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform())},[l,e,t,s]),d=u.useCallback(async()=>{if(l||!e||!Rm(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform({silent:!0}),h.transformer.fitToBboxContain(),await h.transformer.applyTransform())},[t,e,s,l]);return{isDisabled:l,start:c,fitToBbox:d}},og=u.memo(()=>{const{t:e}=M(),t=Ye(),n=nk(t);return r.jsxs(r.Fragment,{children:[r.jsx(he,{onClick:n.start,icon:r.jsx(Vp,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),r.jsx(he,{onClick:n.fitToBbox,icon:r.jsx(qa,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});og.displayName="CanvasEntityMenuItemsTransform";const WO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("control_layer"),i=st(),o=Ri(s),a=u.useCallback(()=>{n(_E({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(IE({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(AE({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(qr,{}),isDisabled:o||i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.convertControlLayerTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(he,{onClick:a,icon:r.jsx(qr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")}),r.jsx(he,{onClick:l,icon:r.jsx(qr,{}),isDisabled:o||i,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{onClick:c,icon:r.jsx(qr,{}),isDisabled:o||i,children:e("controlLayers.rasterLayer")})]})]})})});WO.displayName="ControlLayerMenuItemsConvertToSubMenu";const ag=u.memo(()=>{const{t:e}=M(),t=Ye(),n=So(t),s=st(),i=sg(t),o=n1e(),a=u.useCallback(()=>{o(n)},[o,n]);return r.jsx(he,{onClick:a,icon:r.jsx(an,{}),isDisabled:s||i,children:e("common.clipboard")})});ag.displayName="CanvasEntityMenuItemsCopyToClipboard";const UO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("control_layer"),i=st(),o=u.useCallback(()=>{n(_E({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(IE({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(AE({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(an,{}),isDisabled:i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.copyControlLayerTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(ag,{}),r.jsx(he,{onClick:o,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(he,{onClick:a,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(he,{onClick:l,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newRasterLayer")})]})]})})});UO.displayName="ControlLayerMenuItemsCopyToSubMenu";const h1e=e=>pe(et,t=>Pr(t,e,"ControlLayerMenuItemsTransparencyEffect").withTransparencyEffect),qO=u.memo(()=>{const{t:e}=M(),t=z(),n=Ye("control_layer"),s=Ri(n),i=u.useMemo(()=>h1e(n),[n]),o=I(i),a=u.useCallback(()=>{t($Z({entityIdentifier:n}))},[t,n]);return r.jsx(he,{onClick:a,icon:r.jsx(xae,{}),isDisabled:s,children:e(o?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});qO.displayName="ControlLayerMenuItemsTransparencyEffect";const sk=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(od,{children:[r.jsx(dd,{}),r.jsx(fd,{}),r.jsx(hd,{asIcon:!0})]}),r.jsx(vs,{}),r.jsx(og,{}),r.jsx(ek,{}),r.jsx(tk,{}),r.jsx(qO,{}),r.jsx(vs,{}),r.jsx(rg,{}),r.jsx(UO,{}),r.jsx(WO,{}),r.jsx(ng,{}),r.jsx(ig,{})]}));sk.displayName="ControlLayerMenuItems";const KO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("inpaint_mask"),i=st(),o=Ri(s),a=u.useCallback(()=>{n(TE({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(qr,{}),isDisabled:i||o,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.convertInpaintMaskTo")})}),r.jsx(It,{...t.menuListProps,children:r.jsx(he,{onClick:a,icon:r.jsx(qr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")})})]})})});KO.displayName="InpaintMaskMenuItemsConvertToSubMenu";const ZO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("inpaint_mask"),i=st(),o=u.useCallback(()=>{n(TE({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(an,{}),isDisabled:i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.copyInpaintMaskTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(ag,{}),r.jsx(he,{onClick:o,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")})]})]})})});ZO.displayName="InpaintMaskMenuItemsCopyToSubMenu";const rk=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(od,{children:[r.jsx(dd,{}),r.jsx(fd,{}),r.jsx(hd,{asIcon:!0})]}),r.jsx(vs,{}),r.jsx(og,{}),r.jsx(vs,{}),r.jsx(rg,{}),r.jsx(ZO,{}),r.jsx(KO,{}),r.jsx(ng,{}),r.jsx(ig,{})]}));rk.displayName="InpaintMaskMenuItems";const YO=u.memo(()=>{const{t:e}=M(),t=Ye("reference_image"),n=VO(t),s=st();return r.jsx(he,{onClick:n,icon:r.jsx(qa,{}),isDisabled:s,children:e("controlLayers.pullBboxIntoReferenceImage")})});YO.displayName="IPAdapterMenuItemPullBbox";const ik=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(od,{children:[r.jsx(dd,{}),r.jsx(fd,{}),r.jsx(hd,{asIcon:!0})]}),r.jsx(vs,{}),r.jsx(YO,{})]}));ik.displayName="IPAdapterMenuItems";const XO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("raster_layer"),i=st(),o=Ri(s),a=u.useCallback(()=>{n(EE({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(ME({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(PE({entityIdentifier:s,replace:!0,overrides:{controlAdapter:bt(Xl)}}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(qr,{}),isDisabled:i||o,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.convertRasterLayerTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(he,{onClick:a,icon:r.jsx(qr,{}),isDisabled:i||o,children:e("controlLayers.inpaintMask")}),r.jsx(he,{onClick:l,icon:r.jsx(qr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{onClick:c,icon:r.jsx(qr,{}),isDisabled:i||o,children:e("controlLayers.controlLayer")})]})]})})});XO.displayName="RasterLayerMenuItemsConvertToSubMenu";const QO=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("raster_layer"),i=st(),o=u.useCallback(()=>{n(EE({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(ME({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(PE({entityIdentifier:s,overrides:{controlAdapter:bt(Xl)}}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(an,{}),isDisabled:i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.copyRasterLayerTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(ag,{}),r.jsx(he,{onClick:o,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(he,{onClick:a,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(he,{onClick:l,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newControlLayer")})]})]})})});QO.displayName="RasterLayerMenuItemsCopyToSubMenu";const ok=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(od,{children:[r.jsx(dd,{}),r.jsx(fd,{}),r.jsx(hd,{asIcon:!0})]}),r.jsx(vs,{}),r.jsx(og,{}),r.jsx(ek,{}),r.jsx(tk,{}),r.jsx(vs,{}),r.jsx(rg,{}),r.jsx(QO,{}),r.jsx(XO,{}),r.jsx(ng,{}),r.jsx(ig,{})]}));ok.displayName="RasterLayerMenuItems";const JO=u.memo(()=>{const e=Ye("regional_guidance"),{t}=M(),n=st(),s=gL(e),i=mL(e),o=yL(e),a=u.useMemo(()=>vL(e),[e]),l=I(a);return r.jsxs(r.Fragment,{children:[r.jsx(he,{onClick:i,isDisabled:!l.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),r.jsx(he,{onClick:o,isDisabled:!l.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),r.jsx(he,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});JO.displayName="RegionalGuidanceMenuItemsExtra";const eN=u.memo(()=>{const e=Ye("regional_guidance"),{t}=M(),n=z(),s=u.useMemo(()=>pe(et,a=>Pr(a,e,"RegionalGuidanceMenuItemsAutoNegative").autoNegative),[e]),i=I(s),o=u.useCallback(()=>{n(VZ({entityIdentifier:e}))},[n,e]);return r.jsx(he,{icon:r.jsx($ae,{}),onClick:o,children:t(i?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});eN.displayName="RegionalGuidanceMenuItemsAutoNegative";const tN=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("regional_guidance"),i=st(),o=Ri(s),a=u.useCallback(()=>{n(LE({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(qr,{}),isDisabled:o||i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.convertRegionalGuidanceTo")})}),r.jsx(It,{...t.menuListProps,children:r.jsx(he,{onClick:a,icon:r.jsx(qr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")})})]})})});tN.displayName="RegionalGuidanceMenuItemsConvertToSubMenu";const nN=u.memo(()=>{const{t:e}=M(),t=er(),n=z(),s=Ye("regional_guidance"),i=st(),o=u.useCallback(()=>{n(LE({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(an,{}),isDisabled:i,children:r.jsxs(Yt,{...t.menuProps,children:[r.jsx(Xt,{...t.menuButtonProps,children:r.jsx(tr,{label:e("controlLayers.copyRegionalGuidanceTo")})}),r.jsxs(It,{...t.menuListProps,children:[r.jsx(ag,{}),r.jsx(he,{onClick:o,icon:r.jsx(an,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")})]})]})})});nN.displayName="RegionalGuidanceMenuItemsCopyToSubMenu";const ak=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(od,{children:[r.jsx(dd,{}),r.jsx(fd,{}),r.jsx(hd,{asIcon:!0})]}),r.jsx(vs,{}),r.jsx(JO,{}),r.jsx(vs,{}),r.jsx(og,{}),r.jsx(eN,{}),r.jsx(vs,{}),r.jsx(rg,{}),r.jsx(nN,{}),r.jsx(tN,{}),r.jsx(ng,{}),r.jsx(ig,{})]}));ak.displayName="RegionalGuidanceMenuItems";const sN=(e,t=!1)=>{const{t:n}=M();return u.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");case"reference_image":return n(t?"controlLayers.globalReferenceImage_withCount_other":"controlLayers.globalReferenceImage");default:return""}},[e,t,n])},rN=u.memo(()=>{const e=Ye();if(e.type==="raster_layer")return r.jsx(ok,{});if(e.type==="control_layer")return r.jsx(sk,{});if(e.type==="inpaint_mask")return r.jsx(rk,{});if(e.type==="regional_guidance")return r.jsx(ak,{});if(e.type==="reference_image")return r.jsx(ik,{});Ge(!1)});rN.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const iN=u.memo(e=>{const t=Ye(),n=sN(t.type);return r.jsx(xr,{title:n,children:e.children})});iN.displayName="CanvasContextMenuSelectedEntityMenuGroup";const oN=u.memo(()=>{const e=I(_n);return e?r.jsx(ac.Provider,{value:e,children:r.jsx(sa,{entityIdentifier:e,children:r.jsx(iN,{children:r.jsx(rN,{})})})}):null});oN.displayName="CanvasContextMenuSelectedEntityMenuItems";const fC="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",aN=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let i,o;return s>n?(i=e.width,o=i/s):(o=e.height,i=o*s),{width:i,height:o}},lN=(e,t,n,s)=>{const i=e==="fill"?t.width:t.width*s.width/n.width,o=e==="fill"?t.height:t.height*s.height/n.height;return{width:i,height:o}},cN=tn(kr,e=>{const t=e.selection.slice(-1)[0]??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),f1e=Fs("dnd"),Rr=e=>{const t=Symbol(e);return{type:e,key:t}},Or=e=>n=>!!n[e],Nr=(e,t)=>(s,i)=>({[e]:!0,id:i??_e(t),type:t,payload:s}),Jg=Rr("single-image"),wn={...Jg,typeGuard:Or(Jg.key),getData:Nr(Jg.key,Jg.type)},em=Rr("multiple-image"),Qr={...em,typeGuard:Or(em.key),getData:Nr(em.key,em.type)},tm=Rr("single-canvas-entity"),du={...tm,typeGuard:Or(tm.key),getData:Nr(tm.key,tm.type)},nm=Rr("set-global-reference-image"),qf={...nm,typeGuard:Or(nm.key),getData:Nr(nm.key,nm.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i}=t.payload;_L({entityIdentifier:i,imageDTO:s,dispatch:n})}},sm=Rr("set-regional-guidance-reference-image"),Kf={...sm,typeGuard:Or(sm.key),getData:Nr(sm.key,sm.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i,referenceImageId:o}=t.payload;IL({imageDTO:s,entityIdentifier:i,referenceImageId:o,dispatch:n})}},rm=Rr("set-upscale-initial-image"),pC={...rm,typeGuard:Or(rm.key),getData:Nr(rm.key,rm.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;Uoe({imageDTO:n,dispatch:t})}},im=Rr("set-node-image-field-image"),gC={...im,typeGuard:Or(im.key),getData:Nr(im.key,im.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{fieldIdentifier:i}=t.payload;qoe({fieldIdentifier:i,imageDTO:s,dispatch:n})}},om=Rr("add-images-to-image-collection-node-field"),mC={...om,typeGuard:Or(om.key),getData:Nr(om.key,om.type),isValid:({sourceData:e})=>!!(wn.typeGuard(e)||Qr.typeGuard(e)),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{if(!wn.typeGuard(e)&&!Qr.typeGuard(e))return;const{fieldIdentifier:i}=t.payload,o=NS(lt(s()),i.nodeId,i.fieldName);if(!gS(o)){f1e.warn({fieldIdentifier:i},"Attempted to add images to a non-image field collection");return}const a=o.value?[...o.value]:[];wn.typeGuard(e)?a.push({image_name:e.payload.imageDTO.image_name}):a.push(...e.payload.imageDTOs.map(({image_name:l})=>({image_name:l}))),n(e2({...i,value:a}))}},am=Rr("set-comparison-image"),yC={...am,typeGuard:Or(am.key),getData:Nr(am.key,am.type),isValid:({sourceData:e,getState:t})=>{if(!wn.typeGuard(e))return!1;const{firstImage:n,secondImage:s}=cN(t());return!(e.payload.imageDTO.image_name===(n==null?void 0:n.image_name)||e.payload.imageDTO.image_name===(s==null?void 0:s.image_name))},handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;Koe({imageDTO:n,dispatch:t})}},lm=Rr("new-canvas-entity-from-image"),Go={...lm,typeGuard:Or(lm.key),getData:Nr(lm.key,lm.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{type:i}=t.payload,{imageDTO:o}=e.payload;Hr({type:i,imageDTO:o,dispatch:n,getState:s})}},cm=Rr("replace-canvas-entity-objects-with-image"),Zf={...cm,typeGuard:Or(cm.key),getData:Nr(cm.key,cm.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:i}=e.payload,{entityIdentifier:o}=t.payload;Aw({imageDTO:i,entityIdentifier:o,dispatch:n,getState:s})}},um=Rr("add-to-board"),Z0={...um,typeGuard:Or(um.key),getData:Nr(um.key,um.type),isValid:({sourceData:e,targetData:t})=>{if(wn.typeGuard(e)){const n=e.payload.imageDTO.board_id??"none",s=t.payload.boardId;return n!==s}if(Qr.typeGuard(e)){const n=e.payload.boardId,s=t.payload.boardId;return n!==s}return!1},handler:({sourceData:e,targetData:t,dispatch:n})=>{if(wn.typeGuard(e)){const{imageDTO:s}=e.payload,{boardId:i}=t.payload;oI({imageDTOs:[s],boardId:i,dispatch:n})}if(Qr.typeGuard(e)){const{imageDTOs:s}=e.payload,{boardId:i}=t.payload;oI({imageDTOs:s,boardId:i,dispatch:n})}}},dm=Rr("remove-from-board"),Y0={...dm,typeGuard:Or(dm.key),getData:Nr(dm.key,dm.type),isValid:({sourceData:e})=>wn.typeGuard(e)?(e.payload.imageDTO.board_id??"none")!=="none":Qr.typeGuard(e)?e.payload.boardId!=="none":!1,handler:({sourceData:e,dispatch:t})=>{if(wn.typeGuard(e)){const{imageDTO:n}=e.payload;aI({imageDTOs:[n],dispatch:t})}if(Qr.typeGuard(e)){const{imageDTOs:n}=e.payload;aI({imageDTOs:n,dispatch:t})}}},p1e=[qf,Kf,pC,gC,yC,Go,Zf,Z0,Y0,Z0,Y0,mC],g1e={position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:"auto",'&[data-dnd-state="idle"]':{pointerEvents:"none"}},gs=u.memo(e=>{const{dndTarget:t,dndTargetData:n,label:s,isDisabled:i}=e,[o,a]=u.useState("idle"),l=u.useRef(null),c=z();return u.useEffect(()=>{const d=l.current;if(!d||i)return;const{dispatch:h,getState:f}=yp();return Hn(ju({element:d,canDrop:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragEnter:()=>{a("over")},onDragLeave:()=>{a("potential")},getData:()=>n}),to({canMonitor:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragStart:()=>{a("potential")},onDrop:()=>{a("idle")}}))},[c,i,t,n]),r.jsx(Se,{ref:l,sx:g1e,"data-dnd-state":o,children:r.jsx(Rf,{dndState:o,label:s})})});gs.displayName="DndDropTarget";const m1e=Go.getData({type:"raster_layer"}),y1e=Go.getData({type:"control_layer"}),v1e=Go.getData({type:"regional_guidance_with_reference_image"}),b1e=Go.getData({type:"reference_image"}),uN=u.memo(()=>{const{t:e}=M(),t=Lt(),n=st();return t.isOpen?null:r.jsx(r.Fragment,{children:r.jsxs(Xr,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[r.jsx(Dt,{position:"relative",children:r.jsx(gs,{dndTarget:Go,dndTargetData:m1e,label:e("controlLayers.canvasContextMenu.newRasterLayer"),isDisabled:n})}),r.jsx(Dt,{position:"relative",children:r.jsx(gs,{dndTarget:Go,dndTargetData:y1e,label:e("controlLayers.canvasContextMenu.newControlLayer"),isDisabled:n})}),r.jsx(Dt,{position:"relative",children:r.jsx(gs,{dndTarget:Go,dndTargetData:v1e,label:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),isDisabled:n})}),r.jsx(Dt,{position:"relative",children:r.jsx(gs,{dndTarget:Go,dndTargetData:b1e,label:e("controlLayers.canvasContextMenu.newGlobalReferenceImage"),isDisabled:n})})]})})});uN.displayName="CanvasDropArea";const lk=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Sp),s=u.useCallback(()=>{t(GZ())},[t]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:e("controlLayers.filter.autoProcess")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});lk.displayName="CanvasAutoProcessSwitch";const ov=u.memo(()=>{const{t:e}=M(),t=z(),n=I(c0),s=u.useCallback(()=>{t(DE())},[t]);return r.jsx(De,{label:e("controlLayers.settings.isolatedLayerPreviewDesc"),children:r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:e("controlLayers.settings.isolatedPreview")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})})});ov.displayName="CanvasOperationIsolatedLayerPreviewSwitch";const dN=$e.enum(["Red (RGBA)","Green (RGBA)","Blue (RGBA)","Alpha (RGBA)","Cyan (CMYK)","Magenta (CMYK)","Yellow (CMYK)","Black (CMYK)","Hue (HSV)","Saturation (HSV)","Value (HSV)","Luminosity (LAB)","A (LAB)","B (LAB)","Y (YCbCr)","Cb (YCbCr)","Cr (YCbCr)"]),x1e=e=>dN.safeParse(e).success,C1e=$e.object({type:$e.literal("adjust_image"),channel:dN,value:$e.number(),scale_values:$e.boolean().optional()}),S1e=$e.object({type:$e.literal("canny_edge_detection"),low_threshold:$e.number().int().gte(0).lte(255),high_threshold:$e.number().int().gte(0).lte(255)}),w1e=$e.object({type:$e.literal("color_map"),tile_size:$e.number().int().gte(1)}),j1e=$e.object({type:$e.literal("content_shuffle"),scale_factor:$e.number().int().gte(1)}),hN=$e.enum(["large","base","small","small_v2"]),k1e=e=>hN.safeParse(e).success,_1e=$e.object({type:$e.literal("depth_anything_depth_estimation"),model_size:hN}),I1e=$e.object({type:$e.literal("hed_edge_detection"),scribble:$e.boolean()}),A1e=$e.object({type:$e.literal("lineart_anime_edge_detection")}),T1e=$e.object({type:$e.literal("lineart_edge_detection"),coarse:$e.boolean()}),E1e=$e.object({type:$e.literal("mediapipe_face_detection"),max_faces:$e.number().int().gte(1),min_confidence:$e.number().gte(0).lte(1)}),M1e=$e.object({type:$e.literal("mlsd_detection"),score_threshold:$e.number().gte(0),distance_threshold:$e.number().gte(0)}),P1e=$e.object({type:$e.literal("normal_map")}),L1e=$e.object({type:$e.literal("pidi_edge_detection"),quantize_edges:$e.boolean(),scribble:$e.boolean()}),D1e=$e.object({type:$e.literal("dw_openpose_detection"),draw_body:$e.boolean(),draw_face:$e.boolean(),draw_hands:$e.boolean()}),R1e=$e.object({type:$e.literal("spandrel_filter"),model:Ei.nullable(),autoScale:$e.boolean(),scale:$e.number().gte(1).lte(16)}),fN=$e.enum(["gaussian","box"]),O1e=e=>fN.safeParse(e).success,N1e=$e.object({type:$e.literal("img_blur"),blur_type:fN,radius:$e.number().gte(0)}),pN=$e.enum(["gaussian","salt_and_pepper"]),F1e=e=>pN.safeParse(e).success,B1e=$e.object({type:$e.literal("img_noise"),noise_type:pN,amount:$e.number().gte(0).lte(1),noise_color:$e.boolean(),size:$e.number().int().gte(1)});$e.discriminatedUnion("type",[C1e,S1e,w1e,j1e,_1e,I1e,A1e,T1e,E1e,M1e,P1e,L1e,D1e,R1e,N1e,B1e]);const $1e=$e.enum(["adjust_image","canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter","img_blur","img_noise"]),gN=e=>$1e.safeParse(e).success,Dn={adjust_image:{type:"adjust_image",buildDefaults:()=>({type:"adjust_image",channel:"Luminosity (LAB)",value:1,scale_values:!1}),buildGraph:({image_name:e},{channel:t,value:n,scale_values:s})=>{const i=new ts(_e("adjust_image_filter"));let o;return s?o=i.addNode({id:_e("img_channel_multiply"),type:"img_channel_multiply",image:{image_name:e},channel:t,scale:n,invert_channel:!1}):(n=Math.min(n,2),o=i.addNode({id:_e("img_channel_offset"),type:"img_channel_offset",image:{image_name:e},channel:t,offset:Math.round(255*(n-1))})),{graph:i,outputNodeId:o.id}}},canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new ts(_e("canny_edge_detection_filter")),i=s.addNode({id:_e("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:i.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new ts(_e("color_map_filter")),s=n.addNode({id:_e("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new ts(_e("content_shuffle_filter")),s=n.addNode({id:_e("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new ts(_e("depth_anything_depth_estimation_filter")),s=n.addNode({id:_e("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new ts(_e("hed_edge_detection_filter")),s=n.addNode({id:_e("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new ts(_e("lineart_anime_edge_detection_filter")),n=t.addNode({id:_e("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new ts(_e("lineart_edge_detection_filter")),s=n.addNode({id:_e("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new ts(_e("mediapipe_face_detection_filter")),i=s.addNode({id:_e("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:i.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new ts(_e("mlsd_detection_filter")),i=s.addNode({id:_e("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:i.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new ts(_e("normal_map_filter")),n=t.addNode({id:_e("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new ts(_e("pidi_edge_detection_filter")),i=s.addNode({id:_e("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:i.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const i=new ts(_e("dw_openpose_detection_filter")),o=i.addNode({id:_e("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:i,outputNodeId:o.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{Ge(t!==null);const i=new ts(_e("spandrel_filter")),o=i.addNode(s?{id:_e("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:_e("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:i,outputNodeId:o.id}},validateConfig:e=>!!e.model},img_blur:{type:"img_blur",buildDefaults:()=>({type:"img_blur",blur_type:"gaussian",radius:8}),buildGraph:({image_name:e},{blur_type:t,radius:n})=>{const s=new ts(_e("img_blur")),i=s.addNode({id:_e("img_blur"),type:"img_blur",image:{image_name:e},blur_type:t,radius:n});return{graph:s,outputNodeId:i.id}}},img_noise:{type:"img_noise",buildDefaults:()=>({type:"img_noise",noise_type:"gaussian",amount:.3,noise_color:!0,size:1}),buildGraph:({image_name:e},{noise_type:t,amount:n,noise_color:s,size:i})=>{const o=new ts(_e("img_noise")),a=o.addNode({id:_e("img_noise"),type:"img_noise",image:{image_name:e},noise_type:t,amount:n,noise_color:s,size:i}),l=o.addNode({id:_e("rand_int"),use_cache:!1,type:"rand_int",low:0,high:2147483647});return o.addEdge(l,"value",a,"seed"),{graph:o,outputNodeId:a.id}}}},V1e={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},mN=e=>{var s;if(!e)return null;const t=(s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor;if(!t)return null;if(gN(t))return Dn[t];const n=V1e[t];return n?Dn[n]:null},Zb=Dn.adjust_image.buildDefaults(),yN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(c=>{x1e(c==null?void 0:c.value)&&e({...t,channel:c.value})},[t,e]),i=u.useCallback(c=>{e({...t,value:c})},[t,e]),o=u.useCallback(c=>{e({...t,scale_values:c.target.checked})},[t,e]),a=u.useMemo(()=>[{label:n("controlLayers.filter.adjust_image.red"),value:"Red (RGBA)"},{label:n("controlLayers.filter.adjust_image.green"),value:"Green (RGBA)"},{label:n("controlLayers.filter.adjust_image.blue"),value:"Blue (RGBA)"},{label:n("controlLayers.filter.adjust_image.alpha"),value:"Alpha (RGBA)"},{label:n("controlLayers.filter.adjust_image.cyan"),value:"Cyan (CMYK)"},{label:n("controlLayers.filter.adjust_image.magenta"),value:"Magenta (CMYK)"},{label:n("controlLayers.filter.adjust_image.yellow"),value:"Yellow (CMYK)"},{label:n("controlLayers.filter.adjust_image.black"),value:"Black (CMYK)"},{label:n("controlLayers.filter.adjust_image.hue"),value:"Hue (HSV)"},{label:n("controlLayers.filter.adjust_image.saturation"),value:"Saturation (HSV)"},{label:n("controlLayers.filter.adjust_image.value"),value:"Value (HSV)"},{label:n("controlLayers.filter.adjust_image.luminosity"),value:"Luminosity (LAB)"},{label:n("controlLayers.filter.adjust_image.a"),value:"A (LAB)"},{label:n("controlLayers.filter.adjust_image.b"),value:"B (LAB)"},{label:n("controlLayers.filter.adjust_image.y"),value:"Y (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cb"),value:"Cb (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cr"),value:"Cr (YCbCr)"}],[n]),l=u.useMemo(()=>a.filter(c=>c.value===t.channel)[0],[a,t.channel]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.channel")}),r.jsx(Fe,{value:l,options:a,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.value_setting")}),r.jsx(Ze,{value:t.value,defaultValue:Zb.value,onChange:i,min:0,max:2,step:.0025,marks:!0}),r.jsx(Ae,{value:t.value,defaultValue:Zb.value,onChange:i,min:0,max:255,step:.0025})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.scale_values")}),r.jsx(at,{defaultChecked:Zb.scale_values,isChecked:t.scale_values,onChange:o})]})]})});yN.displayName="FilterAdjustImage";const JA=Dn.img_blur.buildDefaults(),vN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(l=>{O1e(l==null?void 0:l.value)&&e({...t,blur_type:l.value})},[t,e]),i=u.useCallback(l=>{e({...t,radius:l})},[t,e]),o=u.useMemo(()=>[{label:n("controlLayers.filter.img_blur.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_blur.box_type"),value:"box"}],[n]),a=u.useMemo(()=>o.filter(l=>l.value===t.blur_type)[0],[o,t.blur_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_blur.blur_type")}),r.jsx(Fe,{value:a,options:o,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_blur.blur_radius")}),r.jsx(Ze,{value:t.radius,defaultValue:JA.radius,onChange:i,min:1,max:64,step:.1,marks:!0}),r.jsx(Ae,{value:t.radius,defaultValue:JA.radius,onChange:i,min:1,max:4096,step:.1})]})]})});vN.displayName="FilterBlur";const hm=Dn.canny_edge_detection.buildDefaults(),bN=({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(o=>{e({...t,low_threshold:o})},[e,t]),i=u.useCallback(o=>{e({...t,high_threshold:o})},[e,t]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),r.jsx(Ze,{value:t.low_threshold,onChange:s,defaultValue:hm.low_threshold,min:0,max:255}),r.jsx(Ae,{value:t.low_threshold,onChange:s,defaultValue:hm.low_threshold,min:0,max:255})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),r.jsx(Ze,{value:t.high_threshold,onChange:i,defaultValue:hm.high_threshold,min:0,max:255}),r.jsx(Ae,{value:t.high_threshold,onChange:i,defaultValue:hm.high_threshold,min:0,max:255})]})]})};bN.displayName="FilterCannyEdgeDetection";const eT=Dn.color_map.buildDefaults(),xN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(i=>{e({...t,tile_size:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),r.jsx(Ze,{value:t.tile_size,defaultValue:eT.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),r.jsx(Ae,{value:t.tile_size,defaultValue:eT.tile_size,onChange:s,min:1,max:4096,step:1})]})})});xN.displayName="FilterColorMap";const tT=Dn.content_shuffle.buildDefaults(),CN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(i=>{e({...t,scale_factor:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),r.jsx(Ze,{value:t.scale_factor,defaultValue:tT.scale_factor,onChange:s,min:0,max:4096,marks:!0}),r.jsx(Ae,{value:t.scale_factor,defaultValue:tT.scale_factor,onChange:s,min:0,max:4096})]})})});CN.displayName="FilterContentShuffle";const SN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(a=>{k1e(a==null?void 0:a.value)&&e({...t,model_size:a.value})},[t,e]),i=u.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),o=u.useMemo(()=>i.filter(a=>a.value===t.model_size)[0],[i,t.model_size]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),r.jsx(Fe,{value:o,options:i,onChange:s,isSearchable:!1})]})})});SN.displayName="FilterDepthAnythingDepthEstimation";const Yb=Dn.dw_openpose_detection.buildDefaults(),wN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(a=>{e({...t,draw_body:a.target.checked})},[t,e]),i=u.useCallback(a=>{e({...t,draw_face:a.target.checked})},[t,e]),o=u.useCallback(a=>{e({...t,draw_hands:a.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(A,{sx:{flexDir:"row",gap:6},children:[r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),r.jsx(at,{defaultChecked:Yb.draw_body,isChecked:t.draw_body,onChange:s})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),r.jsx(at,{defaultChecked:Yb.draw_face,isChecked:t.draw_face,onChange:i})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),r.jsx(at,{defaultChecked:Yb.draw_hands,isChecked:t.draw_hands,onChange:o})]})]})})});wN.displayName="FilterDWOpenposeDetection";const jN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(i=>{e({...t,scribble:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),r.jsx(at,{isChecked:t.scribble,onChange:s})]})})});jN.displayName="FilterHEDEdgeDetection";const kN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(i=>{e({...t,coarse:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),r.jsx(at,{isChecked:t.coarse,onChange:s})]})})});kN.displayName="FilterLineartEdgeDetection";const fm=Dn.mediapipe_face_detection.buildDefaults(),_N=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(o=>{e({...t,max_faces:o})},[t,e]),i=u.useCallback(o=>{e({...t,min_confidence:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),r.jsx(Ze,{value:t.max_faces,onChange:s,defaultValue:fm.max_faces,min:1,max:20,marks:!0}),r.jsx(Ae,{value:t.max_faces,onChange:s,defaultValue:fm.max_faces,min:1,max:20})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),r.jsx(Ze,{value:t.min_confidence,onChange:i,defaultValue:fm.min_confidence,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.min_confidence,onChange:i,defaultValue:fm.min_confidence,min:0,max:1,step:.01})]})]})});_N.displayName="FilterMediaPipeFaceDetection";const pm=Dn.mlsd_detection.buildDefaults(),IN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(o=>{e({...t,distance_threshold:o})},[t,e]),i=u.useCallback(o=>{e({...t,score_threshold:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsxs(te,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),r.jsx(Ze,{value:t.score_threshold,onChange:i,defaultValue:pm.score_threshold,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.score_threshold,onChange:i,defaultValue:pm.score_threshold,min:0,max:1,step:.01})]}),r.jsxs(Z,{children:[r.jsxs(te,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),r.jsx(Ze,{value:t.distance_threshold,onChange:s,defaultValue:pm.distance_threshold,min:0,max:100,step:1,marks:!0}),r.jsx(Ae,{value:t.distance_threshold,onChange:s,defaultValue:pm.distance_threshold,min:0,max:1e3,step:1})]})]})});IN.displayName="FilterMLSDDetection";const jh=Dn.img_noise.buildDefaults(),AN=u.memo(({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(d=>{F1e(d==null?void 0:d.value)&&e({...t,noise_type:d.value})},[t,e]),i=u.useCallback(d=>{e({...t,amount:d})},[t,e]),o=u.useCallback(d=>{e({...t,noise_color:d.target.checked})},[t,e]),a=u.useCallback(d=>{e({...t,size:d})},[t,e]),l=u.useMemo(()=>[{label:n("controlLayers.filter.img_noise.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_noise.salt_and_pepper_type"),value:"salt_and_pepper"}],[n]),c=u.useMemo(()=>l.filter(d=>d.value===t.noise_type)[0],[l,t.noise_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_type")}),r.jsx(Fe,{value:c,options:l,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_amount")}),r.jsx(Ze,{value:t.amount,defaultValue:jh.amount,onChange:i,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.amount,defaultValue:jh.amount,onChange:i,min:0,max:1,step:.01})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.size")}),r.jsx(Ze,{value:t.size,defaultValue:jh.size,onChange:a,min:1,max:16,step:1,marks:!0}),r.jsx(Ae,{value:t.size,defaultValue:jh.size,onChange:a,min:1,max:256,step:1})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_color")}),r.jsx(at,{defaultChecked:jh.noise_color,isChecked:t.noise_color,onChange:o})]})]})});AN.displayName="Filternoise";const TN=({onChange:e,config:t})=>{const{t:n}=M(),s=u.useCallback(o=>{e({...t,scribble:o.target.checked})},[t,e]),i=u.useCallback(o=>{e({...t,quantize_edges:o.target.checked})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),r.jsx(at,{isChecked:t.scribble,onChange:s})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),r.jsx(at,{isChecked:t.quantize_edges,onChange:i})]})]})};TN.displayName="FilterPiDiNetEdgeDetection";const Ja=e=>{const{t}=M(),{modelConfigs:n,selectedModel:s,getIsDisabled:i,onChange:o,isLoading:a,optionsFilter:l=()=>!0}=e,c=I(ty),d=u.useMemo(()=>n.filter(l).map(m=>({label:m.name,value:m.key,description:c&&m.description||void 0,isDisabled:i?i(m):!1})),[l,i,n,c]),h=u.useMemo(()=>d.find(m=>s?m.value===s.key:!1),[d,s]),f=u.useCallback(m=>{if(!m){o(null);return}const y=n.find(b=>b.key===m.value);if(!y){o(null);return}o(y)},[n,o]),p=u.useMemo(()=>a?t("common.loading"):d.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[a,d,t]),g=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}},nT=Dn.spandrel_filter.buildDefaults(),EN=({onChange:e,config:t})=>{const{t:n}=M(),[s,{isLoading:i}]=Zp(),o=u.useMemo(()=>{var m;if(!(!s.length||!t.model))return(m=s.find(y=>{var b;return y.key===((b=t.model)==null?void 0:b.key)}))==null?void 0:m.description},[s,t.model]),a=u.useCallback(m=>{e({...t,model:m})},[t,e]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Ja({modelConfigs:s,onChange:a,selectedModel:t.model,isLoading:i}),p=u.useCallback(m=>{e({...t,scale:m})},[e,t]),g=u.useCallback(m=>{e({...t,autoScale:m.target.checked})},[e,t]);return u.useEffect(()=>{const m=l[0];!t.model&&m&&d(m)},[t.model,d,l]),r.jsxs(r.Fragment,{children:[r.jsxs(Z,{w:"full",orientation:"vertical",children:[r.jsxs(A,{w:"full",alignItems:"center",children:[r.jsx(te,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),r.jsx(at,{size:"sm",isChecked:t.autoScale,onChange:g})]}),r.jsx(Zs,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),r.jsxs(Z,{isDisabled:!t.autoScale,children:[r.jsx(te,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),r.jsx(Ze,{value:t.scale,onChange:p,defaultValue:nT.scale,min:1,max:16}),r.jsx(Ae,{value:t.scale,onChange:p,defaultValue:nT.scale,min:1,max:16})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),r.jsx(De,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})]})};EN.displayName="FilterSpandrel";const MN=u.memo(({filterConfig:e,onChange:t})=>{const{t:n}=M();return e.type==="adjust_image"?r.jsx(yN,{config:e,onChange:t}):e.type==="canny_edge_detection"?r.jsx(bN,{config:e,onChange:t}):e.type==="color_map"?r.jsx(xN,{config:e,onChange:t}):e.type==="content_shuffle"?r.jsx(CN,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?r.jsx(SN,{config:e,onChange:t}):e.type==="dw_openpose_detection"?r.jsx(wN,{config:e,onChange:t}):e.type==="hed_edge_detection"?r.jsx(jN,{config:e,onChange:t}):e.type==="lineart_edge_detection"?r.jsx(kN,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?r.jsx(_N,{config:e,onChange:t}):e.type==="mlsd_detection"?r.jsx(IN,{config:e,onChange:t}):e.type==="pidi_edge_detection"?r.jsx(TN,{config:e,onChange:t}):e.type==="img_blur"?r.jsx(vN,{config:e,onChange:t}):e.type==="img_noise"?r.jsx(AN,{config:e,onChange:t}):e.type==="spandrel_filter"?r.jsx(EN,{config:e,onChange:t}):r.jsx(Ot,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});MN.displayName="Filter";const G1e=pe(Ar,e=>e.sd.disabledControlNetProcessors),PN=u.memo(({filterType:e,onChange:t})=>{const{t:n}=M(),s=I(G1e),i=u.useMemo(()=>_i(Dn,(l,c)=>({value:c,label:n(`controlLayers.filter.${c}.label`)})).filter(l=>!gie(s,l.value)),[s,n]),o=u.useCallback(l=>{l&&(Ge(gN(l.value)),t(l.value))},[t]),a=u.useMemo(()=>i.find(l=>l.value===e)??null,[i,e]);return r.jsx(A,{gap:2,children:r.jsxs(Z,{children:[r.jsx(Ve,{feature:"controlNetProcessor",children:r.jsx(te,{m:0,children:n("controlLayers.filter.filterType")})}),r.jsx(Fe,{value:a,options:i,onChange:o,isSearchable:!1,isClearable:!1})]})})});PN.displayName="FilterTypeSelect";const LN=u.memo(({adapter:e})=>{const{t}=M(),n=ce(e.filterer.$filterConfig),s=ce(e.filterer.$isProcessing),i=ce(e.filterer.$hasImageState),o=I(Sp),a=u.useCallback(g=>{e.filterer.$filterConfig.set(g)},[e.filterer.$filterConfig]),l=u.useCallback(g=>{e.filterer.$filterConfig.set(Dn[g].buildDefaults())},[e.filterer.$filterConfig]),c=u.useMemo(()=>{var g,m;return((m=(g=Dn[n.type]).validateConfig)==null?void 0:m.call(g,n))??!0},[n]),d=u.useCallback(()=>{e.filterer.saveAs("inpaint_mask")},[e.filterer]),h=u.useCallback(()=>{e.filterer.saveAs("regional_guidance")},[e.filterer]),f=u.useCallback(()=>{e.filterer.saveAs("raster_layer")},[e.filterer]),p=u.useCallback(()=>{e.filterer.saveAs("control_layer")},[e.filterer]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Rt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(rt,{}),r.jsx(lk,{}),r.jsx(ov,{})]}),r.jsx(PN,{filterType:n.type,onChange:l}),r.jsx(MN,{filterConfig:n,onChange:a}),r.jsxs(Cs,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(ye,{variant:"ghost",onClick:e.filterer.processImmediate,loadingText:t("controlLayers.filter.process"),isDisabled:s||!c||o&&i,children:[t("controlLayers.filter.process"),s&&r.jsx(rr,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(rt,{}),r.jsx(ye,{onClick:e.filterer.reset,isDisabled:s,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),r.jsx(ye,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!c||!i,children:t("controlLayers.filter.apply")}),r.jsxs(Yt,{children:[r.jsx(Xt,{as:ye,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:s||!c||!i,rightIcon:r.jsx(ii,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(It,{children:[r.jsx(he,{isDisabled:s||!c||!i,onClick:d,children:t("controlLayers.newInpaintMask")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:h,children:t("controlLayers.newRegionalGuidance")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:p,children:t("controlLayers.newControlLayer")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:f,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(ye,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});LN.displayName="FilterContentAdvanced";const DN=u.memo(({adapter:e})=>{const{t}=M(),n=ce(e.filterer.$filterConfig),s=ce(e.filterer.$isProcessing),i=ce(e.filterer.$hasImageState),o=u.useMemo(()=>{var l,c;return((c=(l=Dn[n.type]).validateConfig)==null?void 0:c.call(l,n))??!0},[n]),a=u.useCallback(()=>{e.filterer.$simple.set(!1)},[e.filterer.$simple]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Rt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(rt,{})]}),r.jsxs(A,{flexDir:"column",w:"full",gap:2,pb:2,children:[r.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.processingLayerWith",{type:t(`controlLayers.filter.${n.type}.label`)})}),r.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.forMoreControl")})]}),r.jsxs(Cs,{isAttached:!1,size:"sm",w:"full",children:[r.jsx(ye,{variant:"ghost",onClick:a,children:t("controlLayers.filter.advanced")}),r.jsx(rt,{}),r.jsx(ye,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!o||!i,children:t("controlLayers.filter.apply")}),r.jsx(ye,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});DN.displayName="FilterContentSimple";const RN=()=>{const e=Et(),t=ce(e.stateApi.$filteringAdapter);return t?r.jsx(ON,{adapter:t}):null};RN.displayName="Filter";const ON=u.memo(({adapter:e})=>{const t=ce(e.filterer.$simple),n=Os("canvas"),s=ce(e.filterer.$isProcessing),i=u.useRef(null);return ta("canvas",i,{focusOnMount:!0}),Le({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),Le({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),r.jsxs(A,{ref:i,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[t&&r.jsx(DN,{adapter:e}),!t&&r.jsx(LN,{adapter:e})]})});ON.displayName="FilterContent";const ck=u.memo(({label:e,value:t,color:n})=>r.jsxs(r.Fragment,{children:[r.jsx(Dt,{children:r.jsxs(q,{textAlign:"end",children:[e,": "]})}),r.jsx(Dt,{fontWeight:"semibold",children:r.jsx(q,{textAlign:"end",color:n,children:t})})]}));ck.displayName="CanvasHUDItem";const z1e=pe(Hc,e=>e.rect),NN=u.memo(()=>{const{t:e}=M(),t=I(z1e);return r.jsx(ck,{label:e("controlLayers.HUD.bbox"),value:`${t.width}${t.height} px`})});NN.displayName="CanvasHUDItemBbox";const FN=u.memo(()=>{const{t:e}=M(),t=I(RE),n=I(zZ);return t==="none"?null:r.jsx(ck,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}${n.height} px`})});FN.displayName="CanvasHUDItemScaledBbox";const BN=u.memo(()=>r.jsxs(Xr,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[r.jsx(NN,{}),r.jsx(FN,{})]}));BN.displayName="CanvasHUD";class Yh extends Map{constructor(n){super(n);k(this,"subscriptions",new Set);k(this,"lastSnapshot",null);k(this,"set",(n,s)=>(super.set(n,s),this.notifySubscribers(),this));k(this,"delete",n=>{const s=super.delete(n);return this.notifySubscribers(),s});k(this,"clear",()=>{super.clear(),this.notifySubscribers()});k(this,"notifySubscribers",()=>{for(const n of this.subscriptions)n()});k(this,"subscribe",n=>(this.subscriptions.add(n),()=>{this.subscriptions.delete(n)}));k(this,"getSnapshot",()=>{const n=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,n))&&(this.lastSnapshot=n),this.lastSnapshot});k(this,"areSnapshotsEqual",(n,s)=>{if(n.size!==s.size)return!1;for(const[i,o]of n)if(!Object.is(o,s.get(i)))return!1;return!0})}}const wc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,$N=new Set,vC=typeof process=="object"&&process?process:{},VN=(e,t,n,s)=>{typeof vC.emitWarning=="function"?vC.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let X0=globalThis.AbortController,sT=globalThis.AbortSignal;var k3;if(typeof X0>"u"){sT=class{constructor(){k(this,"onabort");k(this,"_onabort",[]);k(this,"reason");k(this,"aborted",!1)}addEventListener(s,i){this._onabort.push(i)}},X0=class{constructor(){k(this,"signal",new sT);t()}abort(s){var i,o;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const a of this.signal._onabort)a(s);(o=(i=this.signal).onabort)==null||o.call(i,s)}}};let e=((k3=vC.env)==null?void 0:k3.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{e&&(e=!1,VN("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const H1e=e=>!$N.has(e),da=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),GN=e=>da(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?Zm:null:null;class Zm extends Array{constructor(t){super(t),this.fill(0)}}var vu;const vl=class vl{constructor(t,n){k(this,"heap");k(this,"length");if(!X(vl,vu))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}static create(t){const n=GN(t);if(!n)return[];Je(vl,vu,!0);const s=new vl(t,n);return Je(vl,vu,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};vu=new WeakMap,Tt(vl,vu,!1);let bC=vl;var _3,I3,ui,cr,di,hi,bu,xu,Gn,fi,Pn,rn,ct,Ts,ur,cs,Zn,pi,Yn,gi,mi,dr,yi,Sa,Es,Pe,xC,_l,Oo,op,hr,zN,Il,Cu,ap,ha,fa,CC,Ym,Xm,sn,SC,Xh,pa,wC;const K_=class K_{constructor(t){Tt(this,Pe);Tt(this,ui);Tt(this,cr);Tt(this,di);Tt(this,hi);Tt(this,bu);Tt(this,xu);k(this,"ttl");k(this,"ttlResolution");k(this,"ttlAutopurge");k(this,"updateAgeOnGet");k(this,"updateAgeOnHas");k(this,"allowStale");k(this,"noDisposeOnSet");k(this,"noUpdateTTL");k(this,"maxEntrySize");k(this,"sizeCalculation");k(this,"noDeleteOnFetchRejection");k(this,"noDeleteOnStaleGet");k(this,"allowStaleOnFetchAbort");k(this,"allowStaleOnFetchRejection");k(this,"ignoreFetchAbort");Tt(this,Gn);Tt(this,fi);Tt(this,Pn);Tt(this,rn);Tt(this,ct);Tt(this,Ts);Tt(this,ur);Tt(this,cs);Tt(this,Zn);Tt(this,pi);Tt(this,Yn);Tt(this,gi);Tt(this,mi);Tt(this,dr);Tt(this,yi);Tt(this,Sa);Tt(this,Es);Tt(this,_l,()=>{});Tt(this,Oo,()=>{});Tt(this,op,()=>{});Tt(this,hr,()=>!1);Tt(this,Il,t=>{});Tt(this,Cu,(t,n,s)=>{});Tt(this,ap,(t,n,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});k(this,_3,"LRUCache");const{max:n=0,ttl:s,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:a,updateAgeOnHas:l,allowStale:c,dispose:d,disposeAfter:h,noDisposeOnSet:f,noUpdateTTL:p,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:y,fetchMethod:b,memoMethod:C,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:x,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:w,ignoreFetchAbort:j}=t;if(n!==0&&!da(n))throw new TypeError("max option must be a nonnegative integer");const P=n?GN(n):Array;if(!P)throw new Error("invalid max value: "+n);if(Je(this,ui,n),Je(this,cr,g),this.maxEntrySize=m||X(this,cr),this.sizeCalculation=y,this.sizeCalculation){if(!X(this,cr)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(C!==void 0&&typeof C!="function")throw new TypeError("memoMethod must be a function if defined");if(Je(this,xu,C),b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(Je(this,bu,b),Je(this,Sa,!!b),Je(this,Pn,new Map),Je(this,rn,new Array(n).fill(void 0)),Je(this,ct,new Array(n).fill(void 0)),Je(this,Ts,new P(n)),Je(this,ur,new P(n)),Je(this,cs,0),Je(this,Zn,0),Je(this,pi,bC.create(n)),Je(this,Gn,0),Je(this,fi,0),typeof d=="function"&&Je(this,di,d),typeof h=="function"?(Je(this,hi,h),Je(this,Yn,[])):(Je(this,hi,void 0),Je(this,Yn,void 0)),Je(this,yi,!!X(this,di)),Je(this,Es,!!X(this,hi)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!w,this.ignoreFetchAbort=!!j,this.maxEntrySize!==0){if(X(this,cr)!==0&&!da(X(this,cr)))throw new TypeError("maxSize must be a positive integer if specified");if(!da(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");He(this,Pe,zN).call(this)}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!x,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!l,this.ttlResolution=da(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=s||0,this.ttl){if(!da(this.ttl))throw new TypeError("ttl must be a positive integer if specified");He(this,Pe,xC).call(this)}if(X(this,ui)===0&&this.ttl===0&&X(this,cr)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!X(this,ui)&&!X(this,cr)){const T="LRU_CACHE_UNBOUNDED";H1e(T)&&($N.add(T),VN("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",T,K_))}}static unsafeExposeInternals(t){return{starts:X(t,mi),ttls:X(t,dr),sizes:X(t,gi),keyMap:X(t,Pn),keyList:X(t,rn),valList:X(t,ct),next:X(t,Ts),prev:X(t,ur),get head(){return X(t,cs)},get tail(){return X(t,Zn)},free:X(t,pi),isBackgroundFetch:n=>{var s;return He(s=t,Pe,sn).call(s,n)},backgroundFetch:(n,s,i,o)=>{var a;return He(a=t,Pe,Xm).call(a,n,s,i,o)},moveToTail:n=>{var s;return He(s=t,Pe,Xh).call(s,n)},indexes:n=>{var s;return He(s=t,Pe,ha).call(s,n)},rindexes:n=>{var s;return He(s=t,Pe,fa).call(s,n)},isStale:n=>{var s;return X(s=t,hr).call(s,n)}}}get max(){return X(this,ui)}get maxSize(){return X(this,cr)}get calculatedSize(){return X(this,fi)}get size(){return X(this,Gn)}get fetchMethod(){return X(this,bu)}get memoMethod(){return X(this,xu)}get dispose(){return X(this,di)}get disposeAfter(){return X(this,hi)}getRemainingTTL(t){return X(this,Pn).has(t)?1/0:0}*entries(){for(const t of He(this,Pe,ha).call(this))X(this,ct)[t]!==void 0&&X(this,rn)[t]!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield[X(this,rn)[t],X(this,ct)[t]])}*rentries(){for(const t of He(this,Pe,fa).call(this))X(this,ct)[t]!==void 0&&X(this,rn)[t]!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield[X(this,rn)[t],X(this,ct)[t]])}*keys(){for(const t of He(this,Pe,ha).call(this)){const n=X(this,rn)[t];n!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield n)}}*rkeys(){for(const t of He(this,Pe,fa).call(this)){const n=X(this,rn)[t];n!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield n)}}*values(){for(const t of He(this,Pe,ha).call(this))X(this,ct)[t]!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield X(this,ct)[t])}*rvalues(){for(const t of He(this,Pe,fa).call(this))X(this,ct)[t]!==void 0&&!He(this,Pe,sn).call(this,X(this,ct)[t])&&(yield X(this,ct)[t])}[(I3=Symbol.iterator,_3=Symbol.toStringTag,I3)](){return this.entries()}find(t,n={}){for(const s of He(this,Pe,ha).call(this)){const i=X(this,ct)[s],o=He(this,Pe,sn).call(this,i)?i.__staleWhileFetching:i;if(o!==void 0&&t(o,X(this,rn)[s],this))return this.get(X(this,rn)[s],n)}}forEach(t,n=this){for(const s of He(this,Pe,ha).call(this)){const i=X(this,ct)[s],o=He(this,Pe,sn).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,X(this,rn)[s],this)}}rforEach(t,n=this){for(const s of He(this,Pe,fa).call(this)){const i=X(this,ct)[s],o=He(this,Pe,sn).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,X(this,rn)[s],this)}}purgeStale(){let t=!1;for(const n of He(this,Pe,fa).call(this,{allowStale:!0}))X(this,hr).call(this,n)&&(He(this,Pe,pa).call(this,X(this,rn)[n],"expire"),t=!0);return t}info(t){const n=X(this,Pn).get(t);if(n===void 0)return;const s=X(this,ct)[n],i=He(this,Pe,sn).call(this,s)?s.__staleWhileFetching:s;if(i===void 0)return;const o={value:i};if(X(this,dr)&&X(this,mi)){const a=X(this,dr)[n],l=X(this,mi)[n];if(a&&l){const c=a-(wc.now()-l);o.ttl=c,o.start=Date.now()}}return X(this,gi)&&(o.size=X(this,gi)[n]),o}dump(){const t=[];for(const n of He(this,Pe,ha).call(this,{allowStale:!0})){const s=X(this,rn)[n],i=X(this,ct)[n],o=He(this,Pe,sn).call(this,i)?i.__staleWhileFetching:i;if(o===void 0||s===void 0)continue;const a={value:o};if(X(this,dr)&&X(this,mi)){a.ttl=X(this,dr)[n];const l=wc.now()-X(this,mi)[n];a.start=Math.floor(Date.now()-l)}X(this,gi)&&(a.size=X(this,gi)[n]),t.unshift([s,a])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const i=Date.now()-s.start;s.start=wc.now()-i}this.set(n,s.value,s)}}set(t,n,s={}){var p,g,m,y,b;if(n===void 0)return this.delete(t),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=s;let{noUpdateTTL:d=this.noUpdateTTL}=s;const h=X(this,ap).call(this,t,n,s.size||0,l);if(this.maxEntrySize&&h>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),He(this,Pe,pa).call(this,t,"set"),this;let f=X(this,Gn)===0?void 0:X(this,Pn).get(t);if(f===void 0)f=X(this,Gn)===0?X(this,Zn):X(this,pi).length!==0?X(this,pi).pop():X(this,Gn)===X(this,ui)?He(this,Pe,Ym).call(this,!1):X(this,Gn),X(this,rn)[f]=t,X(this,ct)[f]=n,X(this,Pn).set(t,f),X(this,Ts)[X(this,Zn)]=f,X(this,ur)[f]=X(this,Zn),Je(this,Zn,f),Dg(this,Gn)._++,X(this,Cu).call(this,f,h,c),c&&(c.set="add"),d=!1;else{He(this,Pe,Xh).call(this,f);const C=X(this,ct)[f];if(n!==C){if(X(this,Sa)&&He(this,Pe,sn).call(this,C)){C.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=C;v!==void 0&&!a&&(X(this,yi)&&((p=X(this,di))==null||p.call(this,v,t,"set")),X(this,Es)&&((g=X(this,Yn))==null||g.push([v,t,"set"])))}else a||(X(this,yi)&&((m=X(this,di))==null||m.call(this,C,t,"set")),X(this,Es)&&((y=X(this,Yn))==null||y.push([C,t,"set"])));if(X(this,Il).call(this,f),X(this,Cu).call(this,f,h,c),X(this,ct)[f]=n,c){c.set="replace";const v=C&&He(this,Pe,sn).call(this,C)?C.__staleWhileFetching:C;v!==void 0&&(c.oldValue=v)}}else c&&(c.set="update")}if(i!==0&&!X(this,dr)&&He(this,Pe,xC).call(this),X(this,dr)&&(d||X(this,op).call(this,f,i,o),c&&X(this,Oo).call(this,c,f)),!a&&X(this,Es)&&X(this,Yn)){const C=X(this,Yn);let v;for(;v=C==null?void 0:C.shift();)(b=X(this,hi))==null||b.call(this,...v)}return this}pop(){var t;try{for(;X(this,Gn);){const n=X(this,ct)[X(this,cs)];if(He(this,Pe,Ym).call(this,!0),He(this,Pe,sn).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(X(this,Es)&&X(this,Yn)){const n=X(this,Yn);let s;for(;s=n==null?void 0:n.shift();)(t=X(this,hi))==null||t.call(this,...s)}}}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=n,o=X(this,Pn).get(t);if(o!==void 0){const a=X(this,ct)[o];if(He(this,Pe,sn).call(this,a)&&a.__staleWhileFetching===void 0)return!1;if(X(this,hr).call(this,o))i&&(i.has="stale",X(this,Oo).call(this,i,o));else return s&&X(this,_l).call(this,o),i&&(i.has="hit",X(this,Oo).call(this,i,o)),!0}else i&&(i.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,i=X(this,Pn).get(t);if(i===void 0||!s&&X(this,hr).call(this,i))return;const o=X(this,ct)[i];return He(this,Pe,sn).call(this,o)?o.__staleWhileFetching:o}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,context:y,forceRefresh:b=!1,status:C,signal:v}=n;if(!X(this,Sa))return C&&(C.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:C});const x={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:a,noDisposeOnSet:l,size:c,sizeCalculation:d,noUpdateTTL:h,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:m,ignoreFetchAbort:g,status:C,signal:v};let S=X(this,Pn).get(t);if(S===void 0){C&&(C.fetch="miss");const w=He(this,Pe,Xm).call(this,t,S,x,y);return w.__returned=w}else{const w=X(this,ct)[S];if(He(this,Pe,sn).call(this,w)){const E=s&&w.__staleWhileFetching!==void 0;return C&&(C.fetch="inflight",E&&(C.returnedStale=!0)),E?w.__staleWhileFetching:w.__returned=w}const j=X(this,hr).call(this,S);if(!b&&!j)return C&&(C.fetch="hit"),He(this,Pe,Xh).call(this,S),i&&X(this,_l).call(this,S),C&&X(this,Oo).call(this,C,S),w;const P=He(this,Pe,Xm).call(this,t,S,x,y),L=P.__staleWhileFetching!==void 0&&s;return C&&(C.fetch=j?"stale":"refresh",L&&j&&(C.returnedStale=!0)),L?P.__staleWhileFetching:P.__returned=P}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=X(this,xu);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:o,...a}=n,l=this.get(t,a);if(!o&&l!==void 0)return l;const c=s(t,l,{options:a,context:i});return this.set(t,c,a),c}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:a}=n,l=X(this,Pn).get(t);if(l!==void 0){const c=X(this,ct)[l],d=He(this,Pe,sn).call(this,c);return a&&X(this,Oo).call(this,a,l),X(this,hr).call(this,l)?(a&&(a.get="stale"),d?(a&&s&&c.__staleWhileFetching!==void 0&&(a.returnedStale=!0),s?c.__staleWhileFetching:void 0):(o||He(this,Pe,pa).call(this,t,"expire"),a&&s&&(a.returnedStale=!0),s?c:void 0)):(a&&(a.get="hit"),d?c.__staleWhileFetching:(He(this,Pe,Xh).call(this,l),i&&X(this,_l).call(this,l),c))}else a&&(a.get="miss")}delete(t){return He(this,Pe,pa).call(this,t,"delete")}clear(){return He(this,Pe,wC).call(this,"delete")}};ui=new WeakMap,cr=new WeakMap,di=new WeakMap,hi=new WeakMap,bu=new WeakMap,xu=new WeakMap,Gn=new WeakMap,fi=new WeakMap,Pn=new WeakMap,rn=new WeakMap,ct=new WeakMap,Ts=new WeakMap,ur=new WeakMap,cs=new WeakMap,Zn=new WeakMap,pi=new WeakMap,Yn=new WeakMap,gi=new WeakMap,mi=new WeakMap,dr=new WeakMap,yi=new WeakMap,Sa=new WeakMap,Es=new WeakMap,Pe=new WeakSet,xC=function(){const t=new Zm(X(this,ui)),n=new Zm(X(this,ui));Je(this,dr,t),Je(this,mi,n),Je(this,op,(o,a,l=wc.now())=>{if(n[o]=a!==0?l:0,t[o]=a,a!==0&&this.ttlAutopurge){const c=setTimeout(()=>{X(this,hr).call(this,o)&&He(this,Pe,pa).call(this,X(this,rn)[o],"expire")},a+1);c.unref&&c.unref()}}),Je(this,_l,o=>{n[o]=t[o]!==0?wc.now():0}),Je(this,Oo,(o,a)=>{if(t[a]){const l=t[a],c=n[a];if(!l||!c)return;o.ttl=l,o.start=c,o.now=s||i();const d=o.now-c;o.remainingTTL=l-d}});let s=0;const i=()=>{const o=wc.now();if(this.ttlResolution>0){s=o;const a=setTimeout(()=>s=0,this.ttlResolution);a.unref&&a.unref()}return o};this.getRemainingTTL=o=>{const a=X(this,Pn).get(o);if(a===void 0)return 0;const l=t[a],c=n[a];if(!l||!c)return 1/0;const d=(s||i())-c;return l-d},Je(this,hr,o=>{const a=n[o],l=t[o];return!!l&&!!a&&(s||i())-a>l})},_l=new WeakMap,Oo=new WeakMap,op=new WeakMap,hr=new WeakMap,zN=function(){const t=new Zm(X(this,ui));Je(this,fi,0),Je(this,gi,t),Je(this,Il,n=>{Je(this,fi,X(this,fi)-t[n]),t[n]=0}),Je(this,ap,(n,s,i,o)=>{if(He(this,Pe,sn).call(this,s))return 0;if(!da(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(s,n),!da(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i}),Je(this,Cu,(n,s,i)=>{if(t[n]=s,X(this,cr)){const o=X(this,cr)-t[n];for(;X(this,fi)>o;)He(this,Pe,Ym).call(this,!0)}Je(this,fi,X(this,fi)+t[n]),i&&(i.entrySize=s,i.totalCalculatedSize=X(this,fi))})},Il=new WeakMap,Cu=new WeakMap,ap=new WeakMap,ha=function*({allowStale:t=this.allowStale}={}){if(X(this,Gn))for(let n=X(this,Zn);!(!He(this,Pe,CC).call(this,n)||((t||!X(this,hr).call(this,n))&&(yield n),n===X(this,cs)));)n=X(this,ur)[n]},fa=function*({allowStale:t=this.allowStale}={}){if(X(this,Gn))for(let n=X(this,cs);!(!He(this,Pe,CC).call(this,n)||((t||!X(this,hr).call(this,n))&&(yield n),n===X(this,Zn)));)n=X(this,Ts)[n]},CC=function(t){return t!==void 0&&X(this,Pn).get(X(this,rn)[t])===t},Ym=function(t){var o,a;const n=X(this,cs),s=X(this,rn)[n],i=X(this,ct)[n];return X(this,Sa)&&He(this,Pe,sn).call(this,i)?i.__abortController.abort(new Error("evicted")):(X(this,yi)||X(this,Es))&&(X(this,yi)&&((o=X(this,di))==null||o.call(this,i,s,"evict")),X(this,Es)&&((a=X(this,Yn))==null||a.push([i,s,"evict"]))),X(this,Il).call(this,n),t&&(X(this,rn)[n]=void 0,X(this,ct)[n]=void 0,X(this,pi).push(n)),X(this,Gn)===1?(Je(this,cs,Je(this,Zn,0)),X(this,pi).length=0):Je(this,cs,X(this,Ts)[n]),X(this,Pn).delete(s),Dg(this,Gn)._--,n},Xm=function(t,n,s,i){const o=n===void 0?void 0:X(this,ct)[n];if(He(this,Pe,sn).call(this,o))return o;const a=new X0,{signal:l}=s;l==null||l.addEventListener("abort",()=>a.abort(l.reason),{signal:a.signal});const c={signal:a.signal,options:s,context:i},d=(y,b=!1)=>{const{aborted:C}=a.signal,v=s.ignoreFetchAbort&&y!==void 0;if(s.status&&(C&&!b?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,v&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),C&&!v&&!b)return f(a.signal.reason);const x=g;return X(this,ct)[n]===g&&(y===void 0?x.__staleWhileFetching?X(this,ct)[n]=x.__staleWhileFetching:He(this,Pe,pa).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,y,c.options))),y},h=y=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=y),f(y)),f=y=>{const{aborted:b}=a.signal,C=b&&s.allowStaleOnFetchAbort,v=C||s.allowStaleOnFetchRejection,x=v||s.noDeleteOnFetchRejection,S=g;if(X(this,ct)[n]===g&&(!x||S.__staleWhileFetching===void 0?He(this,Pe,pa).call(this,t,"fetch"):C||(X(this,ct)[n]=S.__staleWhileFetching)),v)return s.status&&S.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),S.__staleWhileFetching;if(S.__returned===S)throw y},p=(y,b)=>{var v;const C=(v=X(this,bu))==null?void 0:v.call(this,t,o,c);C&&C instanceof Promise&&C.then(x=>y(x===void 0?void 0:x),b),a.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(y(void 0),s.allowStaleOnFetchAbort&&(y=x=>d(x,!0)))})};s.status&&(s.status.fetchDispatched=!0);const g=new Promise(p).then(d,h),m=Object.assign(g,{__abortController:a,__staleWhileFetching:o,__returned:void 0});return n===void 0?(this.set(t,m,{...c.options,status:void 0}),n=X(this,Pn).get(t)):X(this,ct)[n]=m,m},sn=function(t){if(!X(this,Sa))return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof X0},SC=function(t,n){X(this,ur)[n]=t,X(this,Ts)[t]=n},Xh=function(t){t!==X(this,Zn)&&(t===X(this,cs)?Je(this,cs,X(this,Ts)[t]):He(this,Pe,SC).call(this,X(this,ur)[t],X(this,Ts)[t]),He(this,Pe,SC).call(this,X(this,Zn),t),Je(this,Zn,t))},pa=function(t,n){var i,o,a,l;let s=!1;if(X(this,Gn)!==0){const c=X(this,Pn).get(t);if(c!==void 0)if(s=!0,X(this,Gn)===1)He(this,Pe,wC).call(this,n);else{X(this,Il).call(this,c);const d=X(this,ct)[c];if(He(this,Pe,sn).call(this,d)?d.__abortController.abort(new Error("deleted")):(X(this,yi)||X(this,Es))&&(X(this,yi)&&((i=X(this,di))==null||i.call(this,d,t,n)),X(this,Es)&&((o=X(this,Yn))==null||o.push([d,t,n]))),X(this,Pn).delete(t),X(this,rn)[c]=void 0,X(this,ct)[c]=void 0,c===X(this,Zn))Je(this,Zn,X(this,ur)[c]);else if(c===X(this,cs))Je(this,cs,X(this,Ts)[c]);else{const h=X(this,ur)[c];X(this,Ts)[h]=X(this,Ts)[c];const f=X(this,Ts)[c];X(this,ur)[f]=X(this,ur)[c]}Dg(this,Gn)._--,X(this,pi).push(c)}}if(X(this,Es)&&((a=X(this,Yn))!=null&&a.length)){const c=X(this,Yn);let d;for(;d=c==null?void 0:c.shift();)(l=X(this,hi))==null||l.call(this,...d)}return s},wC=function(t){var n,s,i;for(const o of He(this,Pe,fa).call(this,{allowStale:!0})){const a=X(this,ct)[o];if(He(this,Pe,sn).call(this,a))a.__abortController.abort(new Error("deleted"));else{const l=X(this,rn)[o];X(this,yi)&&((n=X(this,di))==null||n.call(this,a,l,t)),X(this,Es)&&((s=X(this,Yn))==null||s.push([a,l,t]))}}if(X(this,Pn).clear(),X(this,ct).fill(void 0),X(this,rn).fill(void 0),X(this,dr)&&X(this,mi)&&(X(this,dr).fill(0),X(this,mi).fill(0)),X(this,gi)&&X(this,gi).fill(0),Je(this,cs,0),Je(this,Zn,0),X(this,pi).length=0,Je(this,fi,0),Je(this,Gn,0),X(this,Es)&&X(this,Yn)){const o=X(this,Yn);let a;for(;a=o==null?void 0:o.shift();)(i=X(this,hi))==null||i.call(this,...a)}};let gl=K_;const W1e={imageNameCacheSize:1e3,imageDataCacheSize:32,transparencyCalculationCacheSize:1e3,canvasElementCacheSize:32,generationModeCacheSize:100};class Q0 extends Bt{constructor(n){super();k(this,"type","cache");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"config",W1e);k(this,"imageNameCache",new gl({max:this.config.imageNameCacheSize}));k(this,"canvasElementCache",new gl({max:this.config.canvasElementCacheSize}));k(this,"imageDataCache",new gl({max:this.config.imageDataCacheSize}));k(this,"transparencyCalculationCache",new gl({max:this.config.imageDataCacheSize}));k(this,"generationModeCache",new gl({max:this.config.generationModeCacheSize}));k(this,"clearAll",()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()});k(this,"destroy",()=>{this.log.debug("Destroying cache module"),this.clearAll()});this.id=_e("cache"),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}}k(Q0,"getWithFallback",async({cache:n,getValue:s,key:i,onHit:o,onMiss:a})=>{let l=n.get(i);return l===void 0?(a==null||a(),l=await s(),n.set(i,l)):o==null||o(l),l});class U1e extends Bt{constructor(n){super();k(this,"type","compositor");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"$isCompositing",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$isUploading",Oe(!1));k(this,"$isBusy",rs([this.$isCompositing,this.$isProcessing,this.$isUploading],(n,s,i)=>n||s||i));k(this,"getVisibleRectOfType",n=>{const s=[];for(const i of this.manager.getAllAdapters())i.state.isEnabled&&(n&&i.state.type!==n||i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect()));return o4(...s)});k(this,"getRectOfAdapters",n=>{const s=[];for(const i of n)i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect());return o4(...s)});k(this,"getVisibleAdaptersOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.getRasterLayersState().entities;break;case"inpaint_mask":s=this.manager.stateApi.getInpaintMasksState().entities;break;case"control_layer":s=this.manager.stateApi.getControlLayersState().entities;break;case"regional_guidance":s=this.manager.stateApi.getRegionsState().entities;break;default:Ge(!1,`Unhandled entity type: ${n}`)}return s.map(o=>Ys(o)).map(this.manager.getAdapter).filter(o=>!!o).filter(o=>!o.$isDisabled.get()&&o.renderer.hasObjects())});k(this,"getCompositeHash",(n,s)=>{const i=[];for(const a of n)i.push(a.getHashableState());return Nl({extra:s,adapterHashes:i})});k(this,"getCompositeCanvas",(n,s,i)=>{const o=n.map(h=>h.entityIdentifier),a=this.getCompositeHash(n,{rect:s}),l=this.manager.cache.canvasElementCache.get(a);if(l)return this.log.debug({entityIdentifiers:o,rect:s},"Using cached composite canvas"),l;this.log.debug({entityIdentifiers:o,rect:s},"Building composite canvas"),this.$isCompositing.set(!0);const c=document.createElement("canvas");c.width=s.width,c.height=s.height;const d=c.getContext("2d");Ge(d!==null,"Canvas 2D context is null"),d.imageSmoothingEnabled=!1,i!=null&&i.globalCompositeOperation&&(d.globalCompositeOperation=i.globalCompositeOperation);for(const h of n){this.log.debug({entityIdentifier:h.entityIdentifier},"Drawing entity to composite canvas");const f=h.getCanvas(s);d.drawImage(f,0,0)}return this.manager.cache.canvasElementCache.set(a,c),this.$isCompositing.set(!1),c});k(this,"getCompositeImageDTO",async(n,s,i,o,a)=>{Ge(s.width>0&&s.height>0,"Unable to rasterize empty rect");const l=this.getCompositeHash(n,{rect:s}),c=a?void 0:this.manager.cache.imageNameCache.get(l);let d=null;if(c){if(d=await ny(c),d)return this.log.debug({rect:s,imageName:c,imageDTO:d},"Using cached composite image"),d;this.log.warn({rect:s,imageName:c},"Cached image name not found, recompositing")}const h=OE(()=>this.getCompositeCanvas(n,s,o));if(h.isErr())throw this.log.error({error:Ds(h.error)},"Failed to get composite canvas"),h.error;this.$isProcessing.set(!0);const f=await Ls(()=>ey(h.value));if(this.$isProcessing.set(!1),f.isErr())throw this.log.error({error:Ds(f.error)},"Failed to convert composite canvas to blob"),f.error;const p=f.value;this.manager._isDebugging&&NE(p,"Composite"),this.$isUploading.set(!0);const g=await Ls(()=>wa({file:new File([p],"canvas-composite.png",{type:"image/png"}),image_category:"general",...i}));if(this.$isUploading.set(!1),g.isErr())throw g.error;return d=g.value,this.manager.cache.imageNameCache.set(l,d.image_name),d});k(this,"mergeByEntityIdentifiers",async(n,s)=>{var h;if(ve({id:"MERGE_LAYERS_TOAST",title:Te("controlLayers.mergingLayers"),withCount:!1}),n.length<=1)return this.log.warn({entityIdentifiers:n},"Cannot merge less than 2 entities"),null;const i=(h=n[0])==null?void 0:h.type;Ge(i,"Cannot merge entities with no type (this should never happen)");const o=this.manager.getAdapters(n);Ge(o.length===n.length,"Failed to get all adapters for entity identifiers");const a=this.getRectOfAdapters(o),l={globalCompositeOperation:i==="control_layer"?"lighter":void 0},c=await Ls(()=>this.getCompositeImageDTO(o,a,{is_intermediate:!0},l));if(c.isErr())return this.log.error({error:Ds(c.error)},"Failed to merge selected entities"),ve({id:"MERGE_LAYERS_TOAST",title:Te("controlLayers.mergeVisibleError"),status:"error",withCount:!1}),null;const d={isSelected:!0,overrides:{objects:[Mi(c.value)],position:{x:Math.floor(a.x),y:Math.floor(a.y)}},mergedEntitiesToDelete:s?n.map(HZ):[]};switch(i){case"raster_layer":this.manager.stateApi.addRasterLayer(d);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(d);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(d);break;case"control_layer":this.manager.stateApi.addControlLayer(d);break;default:Ge(!1,"Unsupported type for merge")}return ve({id:"MERGE_LAYERS_TOAST",title:Te("controlLayers.mergeVisibleOk"),status:"success",withCount:!1}),c.value});k(this,"mergeVisibleOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.runSelector(FS);break;case"inpaint_mask":s=this.manager.stateApi.runSelector($E);break;case"regional_guidance":s=this.manager.stateApi.runSelector(BE);break;case"control_layer":s=this.manager.stateApi.runSelector(FE);break;default:Ge(!1,"Unsupported type for merge")}const i=s.map(Ys);return this.mergeByEntityIdentifiers(i,!1)});k(this,"getTransparency",(n,s,i)=>{const a={entityIdentifiers:n.map(l=>l.entityIdentifier),rect:s};return Q0.getWithFallback({cache:this.manager.cache.transparencyCalculationCache,key:i,getValue:async()=>{const l=this.getCompositeCanvas(n,s),c=await Q0.getWithFallback({cache:this.manager.cache.imageDataCache,key:i,getValue:()=>Promise.resolve(VE(l)),onHit:()=>this.log.trace(a,"Using cached image data"),onMiss:()=>this.log.trace(a,"Calculating image data")});return WZ(c)},onHit:()=>this.log.trace(a,"Using cached transparency"),onMiss:()=>this.log.trace(a,"Calculating transparency")})});k(this,"getGenerationMode",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.compositor.getVisibleAdaptersOfType("raster_layer"),i=this.getCompositeHash(s,{rect:n}),o=this.manager.compositor.getVisibleAdaptersOfType("inpaint_mask"),a=this.getCompositeHash(o,{rect:n}),l=Nl({rect:n,compositeInpaintMaskHash:a,compositeRasterLayerHash:i}),c=this.manager.cache.generationModeCache.get(l);if(c)return this.log.debug({rect:n,cachedGenerationMode:c},"Using cached generation mode"),c;this.log.debug({rect:n},"Calculating generation mode"),this.$isProcessing.set(!0);const d=await Ls(async()=>{const h=await this.getTransparency(s,n,i),f=await this.getTransparency(o,n,a);let p;return h==="FULLY_TRANSPARENT"?p="txt2img":h==="PARTIALLY_TRANSPARENT"?p="outpaint":f==="FULLY_TRANSPARENT"?p="img2img":p="inpaint",this.manager.cache.generationModeCache.set(l,p),p});if(this.$isProcessing.set(!1),d.isErr())throw this.log.error({error:Ds(d.error)},"Failed to calculate generation mode"),d.error;return d.value});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()}));this.id=_e("canvas_compositor"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}}function q1e(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function K1e(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return{r:n,g:s,b:i,a:t}}const qo=e=>{const{r:t,g:n,b:s,a:i}=e;return`rgba(${t}, ${n}, ${s}, ${i})`},Vl=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`};class pf extends Bt{constructor(n,s){super();k(this,"type","object_brush_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:bt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,stroke:qo(o),strokeWidth:a}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class J0 extends Bt{constructor(n,s){super();k(this,"type","object_brush_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:bt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line with pressure");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({data:GE(i,{size:a/2,simulatePressure:!1,last:!0,thinning:1}),fill:qo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class gf extends Bt{constructor(n,s){super();k(this,"type","object_eraser_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:bt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating eraser line renderer module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:n.clip,listening:!1}),line:new Ne.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,strokeWidth:o}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class e1 extends Bt{constructor(n,s){super();k(this,"type","object_eraser_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:bt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line with pressure");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({data:GE(i,{size:o/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting eraser line visibility"),this.konva.group.visible(n)}}const Z1e=new Error("request for lock canceled");var Y1e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class X1e{constructor(t,n=Z1e){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,i)=>{const o={resolve:s,reject:i,weight:t,priority:n},a=HN(this._queue,l=>n<=l.priority);a===-1&&t<=this._value?this._dispatchItem(o):this._queue.splice(a+1,0,o)})}runExclusive(t){return Y1e(this,arguments,void 0,function*(n,s=1,i=0){const[o,a]=yield this.acquire(s,i);try{return yield n(o)}finally{a()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Q1e(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const i=s.findIndex(o=>o.priority<=t);(i===-1?s:s.splice(0,i)).forEach(o=>o.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function Q1e(e,t){const n=HN(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function HN(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var J1e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class uk{constructor(t){this._semaphore=new X1e(1,t)}acquire(){return J1e(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class La extends Bt{constructor(n,s){super();k(this,"type","object_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"imageElement",null);k(this,"isLoading",!1);k(this,"isError",!1);k(this,"mutex",new uk);k(this,"updateImageSource",async n=>{this.log.trace({imageName:n},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(Te("common.loadingImage","Loading Image")));const s=await ny(n);if(s===null){this.onFailedToLoadImage(Te("controlLayers.unableToFindImage","Unable to find image"));return}const i=await Ls(()=>zE(s.image_url));if(i.isErr()){this.onFailedToLoadImage(Te("controlLayers.unableToLoadImage","Unable to load image"));return}this.imageElement=i.value,await this.updateImageElement()});k(this,"onFailedToLoadImage",n=>{var s;this.log({image:this.state.image},n),(s=this.konva.image)==null||s.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(n),this.konva.placeholder.group.visible(!0)});k(this,"updateImageElement",async()=>{const n=await this.mutex.acquire();try{if(this.imageElement){const{width:s,height:i}=this.state.image;this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:s,height:i,visible:!0})):(this.log.trace("Creating new Konva image"),this.konva.image=new Ne.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:s,height:i,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:s,height:i}),this.konva.placeholder.text.setAttrs({width:s,height:i,fontSize:s/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}}finally{n()}});k(this,"update",async(n,s=!1)=>{var i;if(s||this.state!==n){this.log.trace({state:n},"Updating image");const{image:o}=n,{width:a,height:l,image_name:c}=o;return(s||this.state.image.image_name!==c&&!this.isLoading)&&await this.updateImageSource(c),(i=this.konva.image)==null||i.setAttrs({width:a,height:l}),this.state=n,!0}return!1});k(this,"destroy",()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()});k(this,"setVisibility",n=>{this.log.trace({isVisible:n},"Setting image visibility"),this.konva.group.visible(n)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:bt(this.state),konva:{group:ss(this.konva.group),image:this.konva.image?ss(this.konva.image):null}}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module");const{width:i,height:o}=n.image;this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Ne.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Ne.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:i,height:o,listening:!1,perfectDrawEnabled:!1}),text:new Ne.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:i,height:o,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:i/16,fontStyle:"600",text:Te("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=n}}class t1 extends Bt{constructor(n,s){super();k(this,"type","object_rect");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"isFirstRender",!1);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:bt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),rect:new Ne.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=n}update(n,s=!1){if(s||this.state!==n){this.isFirstRender=!1,this.log.trace({state:n},"Updating rect");const{rect:i,color:o}=n;return this.konva.rect.setAttrs({x:i.x,y:i.y,width:i.width,height:i.height,fill:qo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting rect visibility"),this.konva.group.visible(n)}}class av extends Bt{constructor(n){super();k(this,"type","buffer_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"state",null);k(this,"renderer",null);k(this,"konva");k(this,"renderBufferObject",async()=>{let n=!1;if(!this.state)return!1;let s=null;return this.renderer&&this.renderer.id!==this.state.id&&(s=this.renderer,this.renderer=null),this.state.type==="brush_line"?(Ge(this.renderer instanceof pf||!this.renderer),this.renderer||(this.renderer=new pf(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(Ge(this.renderer instanceof J0||!this.renderer),this.renderer||(this.renderer=new J0(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(Ge(this.renderer instanceof gf||!this.renderer),this.renderer||(this.renderer=new gf(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(Ge(this.renderer instanceof e1||!this.renderer),this.renderer||(this.renderer=new e1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="rect"?(Ge(this.renderer instanceof t1||!this.renderer),this.renderer||(this.renderer=new t1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="image"&&(Ge(this.renderer instanceof La||!this.renderer),this.renderer||(this.renderer=new La(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=await this.renderer.update(this.state,!0)),s&&s.destroy(),n});k(this,"hasBuffer",()=>this.state!==null||this.renderer!==null);k(this,"setBuffer",async(n,s=!1)=>(this.log.trace("Setting buffer"),this.state=n,s&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject()));k(this,"clearBuffer",()=>{var n;(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),(n=this.renderer)==null||n.destroy(),this.renderer=null,this.state=null)});k(this,"commitBuffer",n=>{if({...n},!this.state||!this.renderer){this.log.trace("No buffer to commit");return}this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer);{const s=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:s,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:s,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:s,rect:this.state});break}}this.renderer=null,this.state=null});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:bt(this.state),bufferRenderer:((n=this.renderer)==null?void 0:n.repr())??null}});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}}const eye={PROCESS_DEBOUNCE_MS:1e3};class WN extends Bt{constructor(n){super();k(this,"type","canvas_filterer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",eye);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isFiltering",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$filterConfig",Oe(Dn.adjust_image.buildDefaults()));k(this,"$initialFilterConfig",Oe(null));k(this,"$imageState",Oe(null));k(this,"$hasImageState",rs(this.$imageState,n=>n!==null));k(this,"$simple",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"subscribe",()=>{this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcess&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Sp,n=>{n&&this.$isFiltering.get()&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",n=>{const s=this.manager.stateApi.$filteringAdapter.get();if(s){this.log.error(`Already filtering an entity: ${s.id}`);return}this.log.trace("Initializing filter"),this.resetEphemeralState(),this.$isFiltering.set(!0);const i=this.parent.transformer.$pixelRect.get(),o=t2(this.parent.state.position,i);if(this.konva.group.setAttrs(o),this.parent.konva.layer.add(this.konva.group),n)this.$filterConfig.set(n),this.$initialFilterConfig.set(n),this.$simple.set(!0);else{const a=this.createInitialFilterConfig();this.$filterConfig.set(a),this.$initialFilterConfig.set(a),this.$simple.set(!1)}this.subscribe(),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcess&&this.processImmediate()});k(this,"createInitialFilterConfig",()=>{if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const n=Qde(this.parent.state.controlAdapter.model.key,bS),s=this.manager.stateApi.runSelector(n);return(mN(s)??Dn.canny_edge_detection).buildDefaults()}else return Dn.adjust_image.buildDefaults()});k(this,"processImmediate",async()=>{var b;if(!this.$isFiltering.get()){this.log.warn("Cannot process filter when not initialized");return}const n=this.$filterConfig.get(),s=Dn[n.type];if(!(((b=s.validateConfig)==null?void 0:b.call(s,n))??!0)){this.log.error({config:n},"Invalid filter config");return}const o=Nl({config:n});if(o===this.$lastProcessedHash.get()){this.log.trace("Already processed config");return}this.log.trace({config:n},"Processing filter");const a=this.parent.transformer.getRelativeRect(),l=await Ls(()=>this.parent.renderer.rasterize({rect:a,attrs:{filters:[],opacity:1}}));if(l.isErr()){ve({status:"error",title:"Failed to process filter"}),this.log.error({error:Ds(l.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const c=l.value,d=OE(()=>s.buildGraph(c,n));if(d.isErr()){this.log.error({error:Ds(d.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const h=new AbortController;this.abortController=h;const{graph:f,outputNodeId:p}=d.value,g=await Ls(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:f,outputNodeId:p,prepend:!0,signal:h.signal}));if(g.isErr()){this.log.error({error:Ds(g.error)},"Error filtering"),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null;return}this.log.trace({imageDTO:g.value},"Filtered");const m=Mi(g.value);this.$imageState.set(m);const y=this.imageModule;this.imageModule=new La(m,this),await this.imageModule.update(m,!0),this.konva.group.add(this.imageModule.konva.group),this.parent.renderer.hideObjects(),y&&y.destroy(),this.$lastProcessedHash.set(o),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null});k(this,"process",ri(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying"),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.warn("No image state to apply filter to");return}this.log.trace(`Saving as ${n}`);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:Ge(!1)}});k(this,"resetEphemeralState",()=>{this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null);const n=bt(this.$initialFilterConfig.get()??this.createInitialFilterConfig());this.$filterConfig.set(n),this.$imageState.set(null),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1)});k(this,"teardown",()=>{this.unsubscribe(),this.parent.renderer.showObjects(),this.konva.group.remove(),this.resetEphemeralState(),this.$isFiltering.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,config:this.config,imageState:bt(this.$imageState.get()),$isFiltering:this.$isFiltering.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get(),konva:{group:ss(this.konva.group)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.konva={group:new Ne.Group({name:this.KONVA_GROUP_NAME})}}}const tye=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],i=e.data[n*4+1],o=e.data[n*4+2],a=e.data[n*4+3],l=Math.min(s,i,o),c=Math.max(s,i,o);e.data[n*4+3]=Math.min(a,(l+c)/2)}},nye=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>
</svg>
`,sye=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>
</svg>
`,rye=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="12px" height="12px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,iye=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,oye=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`;function aye(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=nye:e==="diagonal"?n+=sye:e==="horizontal"?n+=iye:e==="vertical"?n+=oye:e==="grid"&&(n+=rye),n=n.replaceAll("stroke:black",`stroke:${Vl(t)}`),n}function lye(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin=vp.get()?"use-credentials":"anonymous",n.src=aye(...t),n}class lv extends Bt{constructor(n){super();k(this,"type","object_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"renderers",new Yh);k(this,"konva");k(this,"initialize",async()=>{this.log.debug("Initializing module"),await this.render()});k(this,"render",async()=>{let n=!1;const s=this.parent.state.objects,i=s.map(o=>o.id);for(const o of this.renderers.values())i.includes(o.id)||(this.renderers.delete(o.id),o.destroy(),n=!0);for(const o of s)n=await this.renderObject(o)||n;return this.syncKonvaCache(n),n});k(this,"hideObjects",()=>{this.konva.objectGroup.hide()});k(this,"showObjects",()=>{this.konva.objectGroup.show()});k(this,"adoptObjectRenderer",n=>{this.renderers.set(n.id,n),n.konva.group.moveTo(this.konva.objectGroup)});k(this,"syncKonvaCache",(n=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const s=this.parent.konva.layer.visible(),i=this.konva.objectGroup.isCached();s&&(n||!i)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))});k(this,"updateTransparencyEffect",()=>{if(this.parent.state.type==="control_layer"){const n=this.parent.state.withTransparencyEffect?[tye]:[];this.konva.objectGroup.filters(n)}});k(this,"updateCompositingRectFill",g2(n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect fill");const s=this.parent.state.fill;s.style==="solid"?this.konva.compositing.rect.setAttrs({fill:Vl(s.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),lye(this.konva.compositing.rect,s.style,s.color))},100));k(this,"updateCompositingRectSize",n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect size");const s=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:s,fillPatternScaleY:s})});k(this,"updateCompositingRectPosition",n=>{!n&&!this.hasObjects()||this.parent.konva.layer.visible()&&(!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance"||(this.log.trace("Updating compositing rect position"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()})))});k(this,"updateOpacity",g2(()=>{if(!this.parent.konva.layer.visible())return;this.log.trace("Updating opacity");const n=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(n):this.konva.objectGroup.opacity(n),this.parent.bufferRenderer.konva.group.opacity(n)},100));k(this,"renderObject",async(n,s=!1)=>{let i=!1,o=this.renderers.get(n.id);const a=!o;return n.type==="brush_line"?(Ge(o instanceof pf||!o),o||(o=new pf(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="brush_line_with_pressure"?(Ge(o instanceof J0||!o),o||(o=new J0(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line"?(Ge(o instanceof gf||!o),o||(o=new gf(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line_with_pressure"?(Ge(o instanceof e1||!o),o||(o=new e1(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="rect"?(Ge(o instanceof t1||!o),o||(o=new t1(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="image"&&(Ge(o instanceof La||!o),o||(o=new La(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=await o.update(n,s||a)),i&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),i});k(this,"needsPixelBbox",()=>{let n=!1;for(const s of this.renderers.values()){const i=s instanceof gf,o=s instanceof La,a=s instanceof pf&&s.state.clip;if(i||a||o){n=!0;break}}return n});k(this,"hasObjects",()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer());k(this,"rasterize",async n=>{const s=this.manager.stateApi.$rasterizingAdapter.get();s&&Ge(!1,`Already rasterizing an entity: ${s.id}`);const{rect:i,replaceObjects:o,attrs:a,bg:l,ignoreCache:c}={replaceObjects:!1,ignoreCache:!1,attrs:{},...n};let d=null;const h={rect:i,attrs:a,bg:l},f=this.parent.hash(h),p=this.manager.cache.imageNameCache.get(f);if(p&&!c&&(d=await ny(p),d))return this.log.trace({rect:i,cachedImageName:p,imageDTO:d},"Using cached rasterized image"),d;this.log.trace({rasterizeArgs:h},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);try{const g=await this.getBlob(h);this.manager._isDebugging&&NE(g,"Rasterized entity"),d=await wa({file:new File([g],`${this.id}_rasterized.png`,{type:"image/png"}),image_category:"other",is_intermediate:!0,silent:!0});const m=Mi(d);return o&&(await this.parent.bufferRenderer.setBuffer(m),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:m,position:{x:Math.round(i.x),y:Math.round(i.y)},replaceObjects:o}),this.manager.cache.imageNameCache.set(f,d.image_name),d}catch(g){throw this.log.error({rasterizeArgs:h,error:Ds(g)},"Failed to rasterize entity"),g}finally{this.manager.stateApi.$rasterizingAdapter.set(null)}});k(this,"cloneObjectGroup",(n={})=>{const{attrs:s}=n,i=this.konva.objectGroup.clone();return s&&i.setAttrs(s),i.hasChildren()&&i.cache({pixelRatio:1,imageSmoothingEnabled:!1}),i});k(this,"getCanvas",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=UZ({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"getBlob",async(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i});return await qZ({node:a,rect:s,bg:o})});k(this,"getImageData",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=KZ({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear();for(const n of this.renderers.values())n.destroy();this.renderers.clear()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(n=>n.repr()),konva:{objectGroup:ss(this.konva.objectGroup)}}));if(this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Ne.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const s=new Ne.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Ne.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:s,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{this.konva.compositing&&((s.width!==i.width||s.height!==i.height||s.scale!==i.scale)&&this.updateCompositingRectSize(),(s.x!==i.x||s.y!==i.y)&&this.updateCompositingRectPosition())}))}}const cye={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12};class cv extends Bt{constructor(n){super();k(this,"type","entity_transformer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",cye);k(this,"$nodeRect",Oe(bc()));k(this,"$pixelRect",Oe(bc()));k(this,"$isPendingRectCalculation",Oe(!0));k(this,"subscriptions",new Set);k(this,"$isTransforming",Oe(!1));k(this,"$interactionMode",Oe("off"));k(this,"$isDragEnabled",Oe(!1));k(this,"$isTransformEnabled",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$silentTransform",Oe(!1));k(this,"transformMutex",new uk);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.syncInteractionState()});k(this,"syncCursorStyle",()=>{this.parent.renderer.hasObjects()?this.manager.stage.setCursor("default"):this.manager.stage.setCursor("not-allowed")});k(this,"anchorStyleFunc",n=>{n.hasName("rotater")&&n.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),n.hitFunc(s=>{s.beginPath(),s.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,n.width()+this.config.ANCHOR_HIT_PADDING*2,n.height()+this.config.ANCHOR_HIT_PADDING*2),s.closePath(),s.fillStrokeShape(n)})});k(this,"anchorDragBoundFunc",(n,s)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return s;const i=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getGridSize():1,o=this.manager.stage.getScale(),a=this.manager.stage.getPosition(),l=Gr(s.x/o,i),c=Gr(s.y/o,i),d=a.x%(o*i),h=a.y%(o*i),f=l*o+d,p=c*o+h;return{x:f,y:p}});k(this,"boxBoundFunc",(n,s)=>this.konva.transformer.getActiveAnchor()!=="rotater"?s:this.manager.stateApi.$shiftKey.get()&&Math.abs(s.rotation%(Math.PI/4))>0?n:s);k(this,"snapProxyRectToPixelGrid",()=>{const n=this.konva.proxyRect.x(),s=this.konva.proxyRect.y(),i=Math.round(n),o=Math.round(s),a=this.konva.proxyRect.width(),l=this.konva.proxyRect.height(),c=this.konva.proxyRect.scaleX(),d=this.konva.proxyRect.scaleY(),h=Math.max(Math.abs(Math.round(a*c)),1),f=Math.max(Math.abs(Math.round(l*d)),1),p=h/a*Math.sign(c),g=f/l*Math.sign(d);this.konva.proxyRect.setAttrs({x:i,y:o,scaleX:p,scaleY:g}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxFill",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=n.width/this.konva.proxyRect.width(),i=n.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:n.x,y:n.y,scaleX:s,scaleY:i,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxContain",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.min(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:co(Gr(n.x+d,s),n.x,n.x+n.width),y:co(Gr(n.y+h,s),n.y,n.y+n.height),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxCover",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.max(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:Gr(n.x+d,s),y:Gr(n.y+h,s),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize();this.konva.proxyRect.x(Gr(this.konva.proxyRect.x(),n)),this.konva.proxyRect.y(Gr(this.konva.proxyRect.y(),n));const s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})});k(this,"onDragEnd",()=>{if(this.$isTransforming.get())return;const n=this.$pixelRect.get(),s={x:this.konva.proxyRect.x()-n.x,y:this.konva.proxyRect.y()-n.y};this.log.trace({position:s},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:s})});k(this,"nudgeBy",n=>{const s=this.konva.proxyRect.position(),i=Ji(s,n);this.konva.proxyRect.setAttrs(i),this.syncObjectGroupWithProxyRect(),this.manager.stateApi.moveEntityBy({entityIdentifier:this.parent.entityIdentifier,offset:n}),this.log.trace({offset:n},"Nudged")});k(this,"syncObjectGroupWithProxyRect",()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})});k(this,"update",(n,s)=>{const i=this.manager.stage.unscale(1),o=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:n.x+s.x-o,y:n.y+s.y-o,width:s.width+o*2,height:s.height+o*2,strokeWidth:i}),this.konva.proxyRect.setAttrs({x:n.x+s.x,y:n.y+s.y,width:s.width,height:s.height})});k(this,"syncInteractionState",()=>{var a,l;if(this.log.trace("Syncing interaction state"),this.manager.stagingArea.$isStaging.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if((a=this.parent.segmentAnything)!=null&&a.$isSegmenting.get()){this.parent.konva.layer.listening(!0),this._setInteractionMode("off");return}if((l=this.parent.filterer)!=null&&l.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const n=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||n.width===0||n.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const i=this.manager.tool.$tool.get();if(!this.manager.stateApi.getIsSelected(this.parent.id)){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isLocked.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(!this.$isTransforming.get()&&i==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}if(this.$isTransforming.get()){i==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all"));return}this.parent.konva.layer.listening(!1),this._setInteractionMode("off")});k(this,"syncScale",()=>{const n=this.manager.stage.unscale(1),s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+s*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+s*2,strokeWidth:n}),this.konva.transformer.forceUpdate()});k(this,"startTransform",async n=>{const s=this.manager.stateApi.$transformingAdapter.get();s&&Ge(!1,`Already transforming an entity: ${s.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:i}={silent:!1,...n};this.$silentTransform.set(i),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()});k(this,"applyTransform",async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const n=this.getRelativeRect(),s=await Ls(()=>this.parent.renderer.rasterize({rect:ZZ(n),replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));s.isErr()&&(ve({status:"error",title:"Failed to apply transform"}),this.log.error({error:Ds(s.error)},"Failed to rasterize entity")),this.requestRectCalculation(),this.stopTransform()});k(this,"resetTransform",()=>{this.resetScale(),this.updatePosition(),this.updateBbox()});k(this,"stopTransform",()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()});k(this,"resetScale",()=>{const n={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(n),this.parent.bufferRenderer.konva.group.setAttrs(n),this.konva.outlineRect.setAttrs(n),this.konva.proxyRect.setAttrs(n)});k(this,"updatePosition",n=>{this.log.trace("Updating position");const s=HE(n,"position",this.parent.state.position),i=this.$pixelRect.get(),o={x:s.x+i.x,y:s.y+i.y,offsetX:i.x,offsetY:i.y};this.parent.renderer.konva.objectGroup.setAttrs(o),this.parent.bufferRenderer.konva.group.setAttrs(o),this.update(s,i)});k(this,"_setInteractionMode",n=>{this.$interactionMode.set(n),n==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):n==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):n==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())});k(this,"updateBbox",()=>{const n=this.$nodeRect.get(),s=this.$pixelRect.get();if(this.log.trace({nodeRect:n,pixelRect:s},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(s.width===0||s.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,s);const i={x:this.parent.state.position.x+s.x,y:this.parent.state.position.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(i),this.parent.bufferRenderer.konva.group.setAttrs(i)}});k(this,"calculateRect",ri(()=>{this.log.debug("Calculating bbox");const n=this.parent.getCanvas();if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(bc()),this.$pixelRect.set(bc()),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const s=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...s}),this.$pixelRect.set({...s}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const i=VE(n);this.manager.worker.requestBbox({buffer:i.data.buffer,width:i.width,height:i.height},o=>{if(o){const{minX:a,minY:l,maxX:c,maxY:d}=o;this.$nodeRect.set({...s}),this.$pixelRect.set({x:Math.round(s.x)+a,y:Math.round(s.y)+l,width:c-a,height:d-l})}else this.$nodeRect.set(bc()),this.$pixelRect.set(bc());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:o},"Got bbox from worker"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS));k(this,"requestRectCalculation",async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()});k(this,"getRelativeRect",()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer}));k(this,"_enableTransform",()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])});k(this,"_disableTransform",()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])});k(this,"_enableDrag",()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)});k(this,"_disableDrag",()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)});k(this,"_showBboxOutline",()=>{this.konva.outlineRect.visible(!0)});k(this,"_hideBboxOutline",()=>{this.konva.outlineRect.visible(!1)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:ss(this.konva.transformer),proxyRect:ss(this.konva.proxyRect),outlineRect:ss(this.konva.outlineRect)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Ne.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Ne.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Ne.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.transformer.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.transformer.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.subscriptions.add(()=>{this.konva.transformer.off("transform transformend pointerenter pointerleave"),this.konva.proxyRect.off("dragmove dragend pointerenter pointerleave")}),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{s.scale!==i.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(s=>{this.konva.transformer.rotationSnaps(s?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(_n,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}}const uye={SAM_POINT_RADIUS:8,SAM_POINT_BORDER_WIDTH:2,SAM_POINT_BORDER_COLOR:{r:0,g:0,b:0,a:1},SAM_POINT_FOREGROUND_COLOR:{r:50,g:255,b:0,a:1},SAM_POINT_BACKGROUND_COLOR:{r:255,g:0,b:50,a:1},SAM_POINT_NEUTRAL_COLOR:{r:0,g:225,b:255,a:1},MASK_COLOR:{r:0,g:225,b:255,a:1},PROCESS_DEBOUNCE_MS:1e3},G1=class G1 extends Bt{constructor(n){super();k(this,"type","canvas_segment_anything");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",uye);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isSegmenting",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$pointType",Oe(1));k(this,"$pointTypeString",rs(this.$pointType,n=>Zv[n]));k(this,"$isDraggingPoint",Oe(!1));k(this,"$imageState",Oe(null));k(this,"$hasImageState",rs(this.$imageState,n=>n!==null));k(this,"$points",Oe([]));k(this,"$hasPoints",rs(this.$points,n=>n.length>0));k(this,"$invert",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_CIRCLE_NAME",`${this.type}:circle`);k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"KONVA_POINT_GROUP_NAME",`${this.type}:point_group`);k(this,"KONVA_MASK_GROUP_NAME",`${this.type}:mask_group`);k(this,"KONVA_COMPOSITING_RECT_NAME",`${this.type}:compositing_rect`);k(this,"syncCursorStyle",()=>{this.$isProcessing.get()?this.manager.stage.setCursor("wait"):this.$isSegmenting.get()&&this.manager.stage.setCursor("crosshair")});k(this,"syncPointScales",()=>{const n=this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),s=this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH);for(const i of this.$points.get())i.konva.circle.radius(n),i.konva.circle.strokeWidth(s)});k(this,"getSAMPoints",()=>{const n=[];for(const{id:s,coord:i,label:o}of this.$points.get())n.push({id:s,x:i.x,y:i.y,label:o});return n});k(this,"onStagePointerUp",n=>{if(n.evt.button!==0||this.manager.stage.getIsDragging()||this.$isDraggingPoint.get()||this.$isProcessing.get())return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const i=this.parent.transformer.$pixelRect.get(),o=t2(this.parent.state.position,i),a=Ji(s.relative,o),l=this.createPoint(a,this.$pointType.get()),c=[...this.$points.get(),l];this.$points.set(c)});k(this,"subscribe",()=>{this.manager.stage.konva.stage.on("pointerup",this.onStagePointerUp),this.subscriptions.add(()=>{this.manager.stage.konva.stage.off("pointerup",this.onStagePointerUp)}),this.subscriptions.add(this.$isProcessing.listen(n=>{this.syncCursorStyle(),this.parent.konva.layer.listening(!n)})),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{n.scale!==s.scale&&this.syncPointScales()})),this.subscriptions.add(this.$points.listen(n=>{n.length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$invert.listen(()=>{this.$points.get().length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Sp,n=>{this.$points.get().length!==0&&n&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",()=>{const n=this.manager.stateApi.$segmentingAdapter.get();if(n){this.log.error(`Already segmenting an entity: ${n.id}`);return}this.log.trace("Starting segment anything"),this.resetEphemeralState(),this.$isSegmenting.set(!0);const s=this.parent.transformer.$pixelRect.get(),i=t2(this.parent.state.position,s);this.konva.group.setAttrs(i),this.parent.konva.layer.add(this.konva.group),this.parent.konva.layer.listening(!0),this.subscribe(),this.manager.stateApi.$segmentingAdapter.set(this.parent),this.syncCursorStyle()});k(this,"processImmediate",async()=>{if(!this.$isSegmenting.get()){this.log.warn("Cannot process segmentation when not initialized");return}if(this.$isProcessing.get()){this.log.warn("Already processing");return}const n=this.getSAMPoints();if(n.length===0){this.log.trace("No points to segment");return}const s=this.$invert.get(),i=Nl({points:n,invert:s});if(i===this.$lastProcessedHash.get()){this.log.trace("Already processed points");return}this.$isProcessing.set(!0),this.log.trace({points:n},"Segmenting");const o=this.parent.transformer.getRelativeRect(),a=await Ls(()=>this.parent.renderer.rasterize({rect:o,attrs:{filters:[],opacity:1}}));if(a.isErr()){ve({status:"error",title:"Failed to select object"}),this.log.error({error:Ds(a.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}const l=new AbortController;this.abortController=l;const{graph:c,outputNodeId:d}=G1.buildGraph(a.value,n,s),h=await Ls(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:c,outputNodeId:d,prepend:!0,signal:l.signal}));if(h.isErr()){this.log.error({error:Ds(h.error)},"Error segmenting"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:h.value},"Segmented");const f=Mi(h.value);this.$imageState.set(f),this.imageModule&&this.imageModule.destroy(),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.imageModule=new La(f,this),await this.imageModule.update(f,!0),this.konva.compositingRect.setAttrs({width:f.image.width,height:f.image.height,visible:!0}),this.konva.maskGroup.add(this.imageModule.konva.group),this.konva.compositingRect.moveToTop(),this.konva.maskGroup.cache(),this.konva.maskTween=new Ne.Tween({node:this.konva.maskGroup,duration:1,opacity:.4,yoyo:!0,repeat:1/0,easing:Ne.Easings.EaseOut}),this.konva.maskTween.play(),this.$lastProcessedHash.set(i),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null});k(this,"process",ri(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.error("No image state to apply");return}this.log.trace("Applying");const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.error("No image state to save as");return}this.log.trace(`Saving as ${n}`),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:Ge(!1)}});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"teardown",()=>{this.unsubscribe(),this.konva.group.remove(),this.resetEphemeralState(),this.$isSegmenting.set(!1),this.manager.stateApi.$segmentingAdapter.set(null)});k(this,"resetEphemeralState",()=>{var n;(n=this.abortController)==null||n.abort(),this.abortController=null;for(const s of this.$points.get())s.konva.circle.destroy();this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.$points.set([]),this.$imageState.set(null),this.$pointType.set(1),this.$invert.set(!1),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1),this.konva.compositingRect.visible(!1),this.konva.maskGroup.clearCache()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,points:this.$points.get().map(({id:s,konva:i,label:o})=>({id:s,label:o,circle:ss(i.circle)})),imageState:bt(this.$imageState.get()),imageModule:((n=this.imageModule)==null?void 0:n.repr())??null,config:bt(this.config),$isSegmenting:this.$isSegmenting.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$pointType:this.$pointType.get(),$pointTypeString:this.$pointTypeString.get(),$isDraggingPoint:this.$isDraggingPoint.get(),konva:{group:ss(this.konva.group),compositingRect:ss(this.konva.compositingRect),maskGroup:ss(this.konva.maskGroup),pointGroup:ss(this.konva.pointGroup)}}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:this.KONVA_GROUP_NAME}),pointGroup:new Ne.Group({name:this.KONVA_POINT_GROUP_NAME}),maskGroup:new Ne.Group({name:this.KONVA_MASK_GROUP_NAME,opacity:.6}),compositingRect:new Ne.Rect({name:this.KONVA_COMPOSITING_RECT_NAME,fill:qo(this.config.MASK_COLOR),globalCompositeOperation:"source-atop",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1,visible:!1}),maskTween:null},this.konva.group.add(this.konva.maskGroup),this.konva.group.add(this.konva.pointGroup),this.konva.maskGroup.add(this.konva.compositingRect)}createPoint(n,s){const i=_e("sam_point"),o=a4(n),a=new Ne.Circle({name:this.KONVA_CIRCLE_NAME,x:o.x,y:o.y,radius:this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),fill:qo(this.getSAMPointColor(s)),stroke:qo(this.config.SAM_POINT_BORDER_COLOR),strokeWidth:this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH),draggable:!0,perfectDrawEnabled:!0,opacity:.6,dragDistance:3});return a.on("pointerup",l=>{if(this.$isDraggingPoint.get()||l.evt.button!==0)return;l.cancelBubble=!0,a.destroy();const c=this.$points.get().filter(d=>d.id!==i);c.length===0?this.resetEphemeralState():this.$points.set(c)}),a.on("dragstart",()=>{this.$isDraggingPoint.set(!0)}),a.on("dragend",()=>{const l=a4(a.position());this.log.trace({...l,label:Zv[s]},"Moved SAM point"),this.$isDraggingPoint.set(!1);const c=this.$points.get().map(d=>d.id===i?{...d,coord:l}:d);this.$points.set(c)}),this.konva.pointGroup.add(a),this.log.trace({...o,label:Zv[s]},"Created SAM point"),{id:i,coord:o,label:s,konva:{circle:a}}}getSAMPointColor(n){return n===0?this.config.SAM_POINT_NEUTRAL_COLOR:n===1?this.config.SAM_POINT_FOREGROUND_COLOR:this.config.SAM_POINT_BACKGROUND_COLOR}};k(G1,"buildGraph",({image_name:n},s,i)=>{const o=new ts(_e("canvas_segment_anything")),a=o.addNode({id:_e("segment_anything"),type:"segment_anything",model:"segment-anything-huge",image:{image_name:n},point_lists:[{points:s.map(({x:c,y:d,label:h})=>({x:c,y:d,label:h}))}],mask_filter:"largest"}),l=o.addNode({id:_e("apply_tensor_mask_to_image"),type:"apply_tensor_mask_to_image",image:{image_name:n},invert:i});return o.addEdge(a,"mask",l,"mask"),{graph:o,outputNodeId:l.id}});let n1=G1;class dye extends Fl{constructor(n,s){super(n,s,"control_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.withTransparencyEffect!==s.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())});k(this,"syncTransparencyEffect",()=>{this.renderer.updateTransparencyEffect()});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","controlAdapter","withTransparencyEffect","isLocked"];return Ol(this.state,n)});this.renderer=new lv(this),this.bufferRenderer=new av(this),this.transformer=new cv(this),this.filterer=new WN(this),this.segmentAnything=new n1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class hye extends Fl{constructor(n,s){super(n,s,"inpaint_mask_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked"];return Ol(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new lv(this),this.bufferRenderer=new av(this),this.transformer=new cv(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class fye extends Fl{constructor(n,s){super(n,s,"raster_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity())});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","isLocked"];return Ol(this.state,n)});this.renderer=new lv(this),this.bufferRenderer=new av(this),this.transformer=new cv(this),this.filterer=new WN(this),this.segmentAnything=new n1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class pye extends Fl{constructor(n,s){super(n,s,"regional_guidance_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked","autoNegative","positivePrompt","negativePrompt","referenceImages"];return Ol(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new lv(this),this.bufferRenderer=new av(this),this.transformer=new cv(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class gye extends Bt{constructor(n){super();k(this,"type","entity_renderer");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"subscriptions",new Set);k(this,"initialize",()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(l4)),this.createNewControlLayers(this.manager.stateApi.runSelector(c4)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(d4)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(u4)),this.arrangeEntities(this.manager.stateApi.runSelector(et),null)});k(this,"createNewRasterLayers",n=>{for(const s of n)this.manager.adapters.rasterLayers.has(s.id)||this.manager.createAdapter(Ys(s)).initialize()});k(this,"createNewControlLayers",n=>{for(const s of n)this.manager.adapters.controlLayers.has(s.id)||this.manager.createAdapter(Ys(s)).initialize()});k(this,"createNewRegionalGuidance",n=>{for(const s of n)this.manager.adapters.regionMasks.has(s.id)||this.manager.createAdapter(Ys(s)).initialize()});k(this,"createNewInpaintMasks",n=>{for(const s of n)this.manager.adapters.inpaintMasks.has(s.id)||this.manager.createAdapter(Ys(s)).initialize()});k(this,"arrangeEntities",(n,s)=>{var i,o,a,l,c,d;if(!s||n.rasterLayers.entities!==s.rasterLayers.entities||n.controlLayers.entities!==s.controlLayers.entities||n.regionalGuidance.entities!==s.regionalGuidance.entities||n.inpaintMasks.entities!==s.inpaintMasks.entities||((i=n.selectedEntityIdentifier)==null?void 0:i.id)!==((o=s.selectedEntityIdentifier)==null?void 0:o.id)){this.log.trace("Arranging entities");let h=0;this.manager.background.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRasterLayersState().entities)(a=this.manager.adapters.rasterLayers.get(f))==null||a.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getControlLayersState().entities)(l=this.manager.adapters.controlLayers.get(f))==null||l.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRegionsState().entities)(c=this.manager.adapters.regionMasks.get(f))==null||c.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getInpaintMasksState().entities)(d=this.manager.adapters.inpaintMasks.get(f))==null||d.konva.layer.zIndex(h++);this.manager.konva.previewLayer.zIndex(h++)}});k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});this.id=_e("canvas_renderer"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(l4,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(c4,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(u4,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(d4,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(et,this.arrangeEntities))}}const mye=e=>!!e.image;class yye extends Bt{constructor(n){super();k(this,"type","progress_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"konva");k(this,"$isLoading",Oe(!1));k(this,"$isError",Oe(!1));k(this,"imageElement",null);k(this,"subscriptions",new Set);k(this,"$lastProgressEvent",Oe(null));k(this,"$hasActiveGeneration",Oe(!1));k(this,"mutex",new uk);k(this,"setSocketEventListeners",()=>{const n=o=>{o.destination==="canvas"&&mye(o)&&this.$hasActiveGeneration.get()&&this.$lastProgressEvent.set(o)},s=o=>{o.destination==="canvas"&&(o.status==="failed"||o.status==="canceled")&&(this.$lastProgressEvent.set(null),this.$hasActiveGeneration.set(!1))},i=()=>{this.$lastProgressEvent.set(null)};return this.manager.socket.on("invocation_progress",n),this.manager.socket.on("queue_item_status_changed",s),this.manager.socket.on("connect",i),this.manager.socket.on("connect_error",i),this.manager.socket.on("disconnect",i),()=>{this.manager.socket.off("invocation_progress",n),this.manager.socket.off("queue_item_status_changed",s),this.manager.socket.off("connect",i),this.manager.socket.off("connect_error",i),this.manager.socket.off("disconnect",i)}});k(this,"getNodes",()=>[this.konva.group]);k(this,"render",async()=>{var d;const n=await this.mutex.acquire(),s=this.$lastProgressEvent.get(),i=this.manager.stateApi.runSelector(n2);if(!s||!i){this.konva.group.visible(!1),(d=this.konva.image)==null||d.destroy(),this.konva.image=null,this.imageElement=null,this.$isLoading.set(!1),this.$isError.set(!1),n();return}this.$isLoading.set(!0);const{x:o,y:a,width:l,height:c}=this.manager.stateApi.getBbox().rect;try{this.imageElement=await zE(s.image.dataURL),this.konva.image?this.konva.image.setAttrs({image:this.imageElement,x:o,y:a,width:l,height:c}):(this.konva.image=new Ne.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,x:o,y:a,width:l,height:c,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.group.visible(this.manager.stagingArea.$shouldShowStagedImage.get())}catch{this.$isError.set(!0)}finally{this.$isLoading.set(!1),n()}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$lastProgressEvent:Do(this.$lastProgressEvent.get()),$hasActiveGeneration:this.$hasActiveGeneration.get(),$isError:this.$isError.get(),$isLoading:this.$isLoading.get()}));this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating progress image module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),image:null},this.subscriptions.add(this.manager.stagingArea.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(n2,this.render)),this.subscriptions.add(this.setSocketEventListeners()),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(YZ,({data:s})=>{s&&(s.in_progress>0||s.pending>0)?this.$hasActiveGeneration.set(!0):this.$hasActiveGeneration.set(!1)})),this.subscriptions.add(this.$lastProgressEvent.listen(this.render))}}const vye={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999};class bye extends Bt{constructor(n,s){super();k(this,"type","stage");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"container");k(this,"konva");k(this,"config",vye);k(this,"$stageAttrs",Oe({x:0,y:0,width:0,height:0,scale:0}));k(this,"subscriptions",new Set);k(this,"resizeObserver",null);k(this,"setContainer",n=>{this.container=n,this.konva.stage.container(n),this.setResizeObserver()});k(this,"setResizeObserver",()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)});k(this,"initialize",()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))});k(this,"fitStageToContainer",()=>{this.log.trace("Fitting stage to container");const n=this.konva.stage.container().offsetWidth,s=this.konva.stage.container().offsetHeight;if(n===0||s===0)return;const i=this.konva.stage.width()===0||this.konva.stage.height()===0;this.konva.stage.width(n),this.konva.stage.height(s),this.syncStageAttrs(),i&&this.fitLayersToStage()});k(this,"fitBboxToStage",()=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n)});k(this,"fitLayersToStage",()=>{const n=this.manager.compositor.getVisibleRectOfType();n.width===0||n.height===0?this.fitBboxToStage():(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n))});k(this,"fitRect",n=>{const{width:s,height:i}=this.getSize();if(s===0||i===0)return;const o=20,a=s-o*2,l=i-o*2,c=this.constrainScale(Math.min(Math.min(a/n.width,l/n.height),1)),d=Math.floor(-n.x*c+o+(a-n.width*c)/2),h=Math.floor(-n.y*c+o+(l-n.height*c)/2);this.konva.stage.setAttrs({x:d,y:h,scaleX:c,scaleY:c}),this.syncStageAttrs({x:d,y:h,scale:c})});k(this,"getCenter",(n=!1)=>{const s=this.getScale(),{x:i,y:o}=this.getPosition(),{width:a,height:l}=this.getSize(),c={x:(a/2-i)/s,y:(l/2-o)/s};return n?this.konva.stage.getAbsoluteTransform().point(c):c});k(this,"constrainScale",n=>co(Math.round(n*100)/100,this.config.MIN_SCALE,this.config.MAX_SCALE));k(this,"setScale",(n,s=this.getCenter(!0))=>{this.log.trace("Setting scale");const i=this.constrainScale(n),{x:o,y:a}=this.getPosition(),l=this.getScale(),c=(s.x-o)/l,d=(s.y-a)/l,h=Math.floor(s.x-c*i),f=Math.floor(s.y-d*i);this.konva.stage.setAttrs({x:h,y:f,scaleX:i,scaleY:i}),this.syncStageAttrs()});k(this,"onStageMouseWheel",n=>{if(n.evt.preventDefault(),n.evt.ctrlKey||n.evt.metaKey)return;const s=this.konva.stage.getPointerPosition();if(s){const i=n.evt.ctrlKey?-n.evt.deltaY:n.evt.deltaY,o=this.manager.stage.getScale()*this.config.SCALE_FACTOR**i;this.manager.stage.setScale(o,s)}});k(this,"onStagePointerDown",n=>{n.evt.button===1&&this.startDragging()});k(this,"startDragging",()=>{this.setIsDraggable(!0),this.getIsDragging()||this.konva.stage.startDrag(),this.manager.tool.render()});k(this,"stopDragging",()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.getIsDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()});k(this,"onStageDragMove",n=>{n.target===this.konva.stage&&this.syncStageAttrs()});k(this,"onStageDragEnd",n=>{n.target===this.konva.stage&&this.stopDragging()});k(this,"getScale",()=>this.konva.stage.scaleX());k(this,"getPosition",()=>this.konva.stage.position());k(this,"unscale",n=>n/this.getScale());k(this,"setCursor",n=>{this.container.style.cursor!==n&&(this.container.style.cursor=n)});k(this,"syncStageAttrs",n=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...n})});k(this,"setIsDraggable",n=>{this.konva.stage.draggable(n)});k(this,"getIsDragging",()=>this.konva.stage.isDragging());k(this,"addLayer",n=>{this.konva.stage.add(n)});k(this,"getScaledStageRect",(n=!0)=>{const{x:s,y:i}=this.getPosition(),{width:o,height:a}=this.getSize(),l=this.getScale();return{x:n?Math.floor(-s/l):-s/l,y:n?Math.floor(-i/l):-i/l,width:n?Math.ceil(o/l):o/l,height:n?Math.ceil(a/l):a/l}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:ss(this.konva.stage)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()});this.id=_e("stage"),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=n,this.konva={stage:new Ne.Stage({id:_e("konva_stage"),container:n})}}getSize(){return this.konva.stage.size()}}class xye extends Bt{constructor(n){super();k(this,"type","staging_area");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"image");k(this,"selectedImage");k(this,"$shouldShowStagedImage",Oe(!0));k(this,"$isStaging",Oe(!1));k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.$isStaging.set(this.manager.stateApi.runSelector(On))});k(this,"render",async()=>{var a,l;this.log.trace("Rendering staging area");const n=this.manager.stateApi.runSelector(s2),{x:s,y:i}=this.manager.stateApi.getBbox().rect,o=this.$shouldShowStagedImage.get();if(this.selectedImage=n.stagedImages[n.selectedStagedImageIndex]??null,this.konva.group.position({x:s,y:i}),this.selectedImage){const{imageDTO:c}=this.selectedImage,d=Rl(c),h=(a=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:a.session_id,f=()=>{var g;const p=(g=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:g.session_id;h===p&&this.manager.progressImage.$lastProgressEvent.set(null)};this.image?this.image.isLoading||(this.image.state.image.image_name!==d.image_name?(await this.image.update({...this.image.state,image:d},!0),f()):this.image.isError&&f()):(this.image=new La({id:"staging-area-image",type:"image",image:d},this),await this.image.update(this.image.state,!0),this.konva.group.add(this.image.konva.group),f()),this.image.konva.group.visible(o)}else(l=this.image)==null||l.destroy(),this.image=null});k(this,"getNodes",()=>[this.konva.group]);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const n of this.getNodes())n.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,selectedImage:this.selectedImage,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get(),image:((n=this.image)==null?void 0:n.repr())??null}});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1})},this.image=null,this.selectedImage=null,this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(s2,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(On,(s,i)=>{this.$isStaging.set(s),s&&!i&&this.$shouldShowStagedImage.set(!0)}))}}const Cye=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Sye=["top-left","top-right","bottom-left","bottom-right"],wye=[];class jye extends Bt{constructor(n){super();k(this,"type","bbox");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"$aspectRatioBuffer",Oe(1));k(this,"syncCursorStyle",UE);k(this,"initialize",()=>{this.log.debug("Initializing module");const{width:n,height:s}=this.manager.stateApi.runSelector(Hc).rect;this.$aspectRatioBuffer.set(n/s),this.render()});k(this,"render",()=>{const n=this.manager.tool.$tool.get(),{x:s,y:i,width:o,height:a}=this.manager.stateApi.runSelector(Hc).rect;this.konva.group.listening(n==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:s,y:i,width:o,height:a,scaleX:1,scaleY:1,listening:n==="bbox"}),this.syncOverlay(),this.konva.transformer.setAttrs({listening:n==="bbox",enabledAnchors:n==="bbox"?Cye:wye})});k(this,"syncOverlay",()=>{const n=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(n),!n)return;const s=this.manager.stage.$stageAttrs.get();this.konva.overlayRect.setAttrs({x:-s.x/s.scale,y:-s.y/s.scale,width:s.width/s.scale,height:s.height/s.scale})});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize(),s=this.manager.stateApi.getBbox(),i={...s.rect,x:Gr(this.konva.proxyRect.x(),n),y:Gr(this.konva.proxyRect.y(),n)};this.konva.proxyRect.setAttrs(i),(s.rect.x!==i.x||s.rect.y!==i.y)&&this.manager.stateApi.setGenerationBbox(i)});k(this,"onTransform",()=>{const n=this.konva.transformer.getActiveAnchor();if(!n)return;const s=this.manager.stateApi.$altKey.get(),i=this.manager.stateApi.$ctrlKey.get(),o=this.manager.stateApi.$metaKey.get(),a=this.manager.stateApi.$shiftKey.get();let l=i||o?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(l=l*2);let c=this.konva.proxyRect.x(),d=this.konva.proxyRect.y(),h=Rg(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),l),f=Rg(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),l);if(a&&Sye.includes(n)&&!s){let g=Math.sqrt(h*f*this.$aspectRatioBuffer.get()),m=g/this.$aspectRatioBuffer.get();g=Rg(g,l),m=Rg(m,l),n==="top-left"&&(c=c-(g-h),d=d-(m-f)),n==="top-right"&&(d=d-(m-f)),n==="bottom-left"&&(c=c-(g-h)),h=g,f=m}const p={x:Math.round(c),y:Math.round(d),width:h,height:f};this.konva.proxyRect.setAttrs({...p,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(p),a||this.$aspectRatioBuffer.set(p.width/p.height)});k(this,"onTransformEnd",()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())});k(this,"anchorStyleFunc",n=>{(n.hasName("top-center")||n.hasName("bottom-center"))&&(n.height(8),n.offsetY(4),n.width(30),n.offsetX(15)),(n.hasName("middle-left")||n.hasName("middle-right"))&&(n.height(30),n.offsetY(15),n.width(8),n.offsetX(4))});k(this,"fitToLayers",()=>{const n=this.manager.compositor.getVisibleRectOfType();if(n.height===0||n.width===0)return;const s=this.manager.stateApi.getBboxGridSize(),i=XZ(n,s);this.manager.stateApi.setGenerationBbox(i)});k(this,"anchorDragBoundFunc",(n,s)=>{const i=this.konva.transformer.getStage();Ge(i,"Stage must exist");const a=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*i.scaleX(),l=i.getAbsolutePosition(),c=l.x%a,d=l.y%a;return{x:Gr(s.x,a)+c,y:Gr(s.y,a)+d}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:ss(this.konva.group),proxyRect:ss(this.konva.proxyRect),transformer:ss(this.konva.transformer)}}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),proxyRect:new Ne.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Ne.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:s=>{const i=this.manager.stage.getScaledStageRect(),o=this.manager.stateApi.runSelector(Hc).rect;s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(i.x+i.width,i.y),s.lineTo(i.x+i.width,i.y+i.height),s.lineTo(i.x,i.y+i.height),s.closePath(),s.moveTo(o.x,o.y),s.lineTo(o.x,o.y+o.height),s.lineTo(o.x+o.width,o.y+o.height),s.lineTo(o.x+o.width,o.y),s.closePath()}}),overlayRect:new Ne.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Ne.Transformer({listening:!1,name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.subscriptions.add(()=>{this.konva.proxyRect.off("dragmove pointerenter pointerleave"),this.konva.transformer.off("transform transformend")}),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.parent.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Hc,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(WE,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render))}}const kye={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class _ye extends Bt{constructor(n){super();k(this,"type","brush_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",kye);k(this,"hideFillTimeoutId",null);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get(),i=this.parent.$lastPointerType.get();if(i!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const o=this.manager.stateApi.getSettings(),a=this.manager.stateApi.getBrushPreviewColor(),l=No(n.relative,o.brushWidth),c=o.brushWidth/2;this.konva.fillCircle.setAttrs({x:l.x,y:l.y,radius:c,fill:qo(a),visible:!s&&i==="mouse"});const d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c,outerRadius:c+d}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c+d,outerRadius:c+h}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=Ji(s.relative,o.state.position),c=No(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:_e("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:_e("brush_line"),type:"brush_line",points:[c.x,c.y],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();const a=this.manager.stateApi.getSettings(),l=Ji(s.relative,o.state.position),c=No(l,a.brushWidth);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const d=qE(o.state.objects,"brush_line_with_pressure");let h,f=!1;n.evt.shiftKey&&d?(f=!0,h=[d.x,d.y,d.pressure,c.x,c.y,n.evt.pressure]):h=[c.x,c.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:_e("brush_line_with_pressure"),type:"brush_line_with_pressure",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:f?null:this.parent.getClip(o.state)})}else{const d=KE(o.state.objects,"brush_line");let h,f=!1;n.evt.shiftKey&&d?(f=!0,h=[d.x,d.y,c.x,c.y]):h=[c.x,c.y],await o.bufferRenderer.setBuffer({id:_e("brush_line"),type:"brush_line",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:f?null:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="brush_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="brush_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="brush_line"&&o.type!=="brush_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=ZE(o.points),c=a.brushWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!YE(s.relative,l,c))return;const d=Ji(s.relative,i.state.position),h=No(d,a.brushWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="brush_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Ne.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Ne.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ne.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}}const Iye={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)",TEXT_COLOR:"rgba(255,255,255,1)",TEXT_BG_COLOR:"rgba(0,0,0,0.8)",TEXT_BG_HEIGHT:62,TEXT_BG_WIDTH:62,TEXT_BG_CORNER_RADIUS:7,TEXT_PADDING:8,TEXT_FONT_SIZE:12,TEXT_BG_X_OFFSET:7};class Aye extends Bt{constructor(n){super();k(this,"type","color_picker_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",Iye);k(this,"$colorUnderCursor",Oe(XE));k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="colorPicker"){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}this.setVisibility(!0);const{x:s,y:i}=n.relative,o=this.manager.stateApi.getSettings(),a=this.$colorUnderCursor.get(),l=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),c=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.ringCandidateColor.setAttrs({x:s,y:i,fill:Vl(a),innerRadius:l,outerRadius:c}),this.konva.ringCurrentColor.setAttrs({x:s,y:i,fill:Vl(o.color),innerRadius:l,outerRadius:c}),this.konva.ringInnerBorder.setAttrs({x:s,y:i,innerRadius:c,outerRadius:c+d}),this.konva.ringOuterBorder.setAttrs({x:s,y:i,innerRadius:c+d,outerRadius:c+h});const f=this.manager.stage.unscale(this.config.TEXT_BG_WIDTH),p=this.manager.stage.unscale(this.config.TEXT_BG_HEIGHT);this.konva.rgbaTextBackground.setAttrs({width:f,height:p,cornerRadius:this.manager.stage.unscale(this.config.TEXT_BG_CORNER_RADIUS)}),this.konva.rgbaText.setAttrs({padding:this.manager.stage.unscale(this.config.TEXT_PADDING),fontSize:this.manager.stage.unscale(this.config.TEXT_FONT_SIZE),text:`R: ${a.r}
G: ${a.g}
B: ${a.b}
A: ${a.a}`}),this.konva.rgbaTextGroup.setAttrs({x:s+this.manager.stage.unscale(this.config.RING_OUTER_RADIUS+this.config.TEXT_BG_X_OFFSET),y:i-p/2});const g=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),m=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),y=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),b=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:b,points:[s,i-g,s,i-m]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:y,points:[s,i-g,s,i-m]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:b,points:[s+m,i,s+g,i]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:y,points:[s+m,i,s+g,i]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:b,points:[s,i+m,s,i+g]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:y,points:[s,i+m,s,i+g]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:b,points:[s-m,i,s-g,i]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:y,points:[s-m,i,s-g,i]})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerUp",n=>{const s=this.$colorUnderCursor.get(),i=this.manager.stateApi.getSettings();this.manager.stateApi.setColor({...i.color,...s})});k(this,"onStagePointerMove",n=>{this.syncColorUnderCursor()});k(this,"syncColorUnderCursor",kL(()=>{const n=this.parent.$cursorPos.get();if(!n)return;this.manager.background.konva.layer.visible(!1);const s=QZ(this.manager.stage.konva.stage,n.absolute);this.manager.background.konva.layer.visible(!0),s&&this.$colorUnderCursor.set(s)}));k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$colorUnderCursor:this.$colorUnderCursor.get()}));k(this,"destroy",()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Ne.Arc({listening:!1,name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),rgbaTextGroup:new Ne.Group({listening:!1,name:`${this.type}:color_picker_text_group`}),rgbaText:new Ne.Text({listening:!1,name:`${this.type}:color_picker_text`,fill:this.config.TEXT_COLOR,fontFamily:"monospace",align:"left",fontStyle:"bold",verticalAlign:"middle"}),rgbaTextBackground:new Ne.Rect({listening:!1,name:`${this.type}:color_picker_text_background`,fill:this.config.TEXT_BG_COLOR})},this.konva.rgbaTextGroup.add(this.konva.rgbaTextBackground,this.konva.rgbaText),this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner,this.konva.rgbaTextGroup)}}const Tye={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class Eye extends Bt{constructor(n){super();k(this,"type","eraser_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",Tye);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0);const o=this.manager.stateApi.getSettings(),a=No(n.relative,o.eraserWidth),l=o.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:a.x,y:a.y,radius:l});const c=this.manager.stage.unscale(1),d=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l,outerRadius:l+c}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l+c,outerRadius:l+d})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=Ji(s.relative,o.state.position),c=No(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:_e("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:_e("eraser_line"),type:"eraser_line",points:[c.x,c.y],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;const a=this.manager.stateApi.getSettings(),l=Ji(s.relative,o.state.position);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const c=qE(o.state.objects,"eraser_line_with_pressure"),d=No(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,c.pressure,d.x,d.y,n.evt.pressure]:h=[d.x,d.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:_e("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}else{const c=KE(o.state.objects,"eraser_line"),d=No(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,d.x,d.y]:h=[d.x,d.y],await o.bufferRenderer.setBuffer({id:_e("eraser_line"),type:"eraser_line",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="eraser_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="eraser_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="eraser_line"&&o.type!=="eraser_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=ZE(o.points),c=a.eraserWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!YE(s.relative,l,c))return;const d=Ji(s.relative,i.state.position),h=No(d,a.eraserWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="eraser_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Ne.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Ne.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ne.Ring({listening:!1,name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}}const Mye={NUDGE_PX:1};class Pye extends Bt{constructor(n){super();k(this,"type","move_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",Mye);k(this,"nudgeOffsets");k(this,"syncCursorStyle",()=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n?n.transformer.syncCursorStyle():this.manager.stage.setCursor("not-allowed")});k(this,"nudge",n=>{if(Sy.get()!=="canvas")return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s||s.$isDisabled.get()||s.$isEmpty.get()||s.$isLocked.get()||s.$isEntityTypeHidden.get())return;const i=this.manager.$isBusy.get(),o=this.parent.$tool.get()==="move",a=this.manager.stateApi.$transformingAdapter.get()===s;if(i){if(!a)return}else if(!o)return;const l=this.nudgeOffsets[n];s.transformer.nudgeBy(l)});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.nudgeOffsets={ArrowLeft:{x:-this.config.NUDGE_PX,y:0},ArrowRight:{x:this.config.NUDGE_PX,y:0},ArrowUp:{x:0,y:-this.config.NUDGE_PX},ArrowDown:{x:0,y:this.config.NUDGE_PX}}}isNudgeKey(n){return this.nudgeOffsets[n]!==void 0}}class Lye extends Bt{constructor(n){super();k(this,"type","rect_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("crosshair")});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=Ji(s.relative,o.state.position);await o.bufferRenderer.setBuffer({id:_e("rect"),type:"rect",rect:{x:Math.round(a.x),y:Math.round(a.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()})});k(this,"onStagePointerUp",n=>{var i;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&(((i=s.bufferRenderer.state)==null?void 0:i.type)==="rect"&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="rect")return;const a=Ji(s.relative,i.state.position),l=JZ(a);o.rect.width=Math.round(l.x-o.rect.x),o.rect.height=Math.round(l.y-o.rect.y),await i.bufferRenderer.setBuffer(o)});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}class Dye extends Bt{constructor(n){super();k(this,"type","view_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor(this.manager.stage.getIsDragging()?"grabbing":"grab")});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}Ne.dragButtons=[0];const Rye="Escape",rT=" ",iT="Alt",Oye={BRUSH_SPACING_TARGET_SCALE:.1};class Nye extends Bt{constructor(n){super();k(this,"type","tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",Oye);k(this,"tools");k(this,"$tool",Oe("brush"));k(this,"$toolBuffer",Oe(null));k(this,"$isPrimaryPointerDown",Oe(!1));k(this,"$cursorPos",Oe(null));k(this,"$lastPointerType",Oe(null));k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()});k(this,"syncCursorStyle",()=>{const n=this.manager.stage,s=this.$tool.get(),i=this.manager.stateApi.$segmentingAdapter.get(),o=this.manager.stateApi.$transformingAdapter.get(),a=this.manager.stateApi.getSelectedEntityAdapter();this.manager.stage.getIsDragging()?this.tools.view.syncCursorStyle():s==="view"?this.tools.view.syncCursorStyle():i?i.segmentAnything.syncCursorStyle():o?o.transformer.syncCursorStyle():this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?n.setCursor("not-allowed"):s==="bbox"?this.tools.bbox.syncCursorStyle():s==="colorPicker"?this.tools.colorPicker.syncCursorStyle():a&&r2(a.entityIdentifier.type)?a.$isDisabled.get()||a.$isEntityTypeHidden.get()||a.$isLocked.get()?n.setCursor("not-allowed"):s==="brush"?this.tools.brush.syncCursorStyle():s==="eraser"?this.tools.eraser.syncCursorStyle():s==="move"?this.tools.move.syncCursorStyle():s==="rect"&&this.tools.rect.syncCursorStyle():(this.manager.stateApi.getRenderedEntityCount(),n.setCursor("not-allowed"))});k(this,"render",()=>{this.syncCursorStyle(),this.tools.brush.render(),this.tools.eraser.render(),this.tools.colorPicker.render(),this.tools.bbox.render()});k(this,"syncCursorPositions",()=>{const n=this.konva.stage.getRelativePointerPosition(),s=this.konva.stage.getPointerPosition();!n||!s||this.$cursorPos.set({relative:n,absolute:s})});k(this,"getClip",n=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:i,y:o,width:a,height:l}=this.manager.stateApi.getBbox().rect;return{x:i-n.position.x,y:o-n.position.y,width:a,height:l}}else{const{x:i,y:o}=this.manager.stage.getPosition(),a=this.manager.stage.getScale(),{width:l,height:c}=this.manager.stage.getSize();return{x:-i/a-n.position.x,y:-o/a-n.position.y,width:l/a,height:c/a}}});k(this,"setEventListeners",()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)}));k(this,"getCanDraw",()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get()||this.manager.stage.getIsDragging())return!1;const n=this.manager.stateApi.getSelectedEntityAdapter();return!(!n||n.$isDisabled.get()||n.$isEntityTypeHidden.get()||n.$isLocked.get())});k(this,"onStagePointerEnter",async n=>{var s;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const i=this.$tool.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(((s=o==null?void 0:o.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&(o!=null&&o.bufferRenderer.hasBuffer())){o.bufferRenderer.commitBuffer();return}i==="brush"?await this.tools.brush.onStagePointerEnter(n):i==="eraser"&&await this.tools.eraser.onStagePointerEnter(n)}finally{this.render()}});k(this,"onStagePointerDown",async n=>{if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.$isPrimaryPointerDown.set(eY(n)),this.syncCursorPositions();const s=this.$tool.get();s==="brush"?await this.tools.brush.onStagePointerDown(n):s==="eraser"?await this.tools.eraser.onStagePointerDown(n):s==="rect"&&await this.tools.rect.onStagePointerDown(n)}finally{this.render()}});k(this,"onStagePointerUp",n=>{if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType);const s=this.$tool.get();if(s==="colorPicker"&&this.tools.colorPicker.onStagePointerUp(n),!this.getCanDraw())return;s==="brush"?this.tools.brush.onStagePointerUp(n):s==="eraser"?this.tools.eraser.onStagePointerUp(n):s==="rect"&&this.tools.rect.onStagePointerUp(n)}finally{this.render()}});k(this,"onStagePointerMove",async n=>{var s;if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType),this.syncCursorPositions();const i=this.$tool.get();if(i==="colorPicker"&&this.tools.colorPicker.onStagePointerMove(n),!this.getCanDraw())return;i==="brush"?await this.tools.brush.onStagePointerMove(n):i==="eraser"?await this.tools.eraser.onStagePointerMove(n):i==="rect"?await this.tools.rect.onStagePointerMove(n):(s=this.manager.stateApi.getSelectedEntityAdapter())==null||s.bufferRenderer.clearBuffer()}finally{this.render()}});k(this,"onStagePointerLeave",n=>{var s;if(n.target===this.manager.stage.container)try{if(this.$lastPointerType.set(n.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const i=this.manager.stateApi.getSelectedEntityAdapter();i&&((s=i.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onStageMouseWheel",n=>{if(n.target!==this.konva.stage||!this.getCanDraw()||(n.evt.preventDefault(),!n.evt.ctrlKey&&!n.evt.metaKey))return;const s=this.manager.stateApi.getSettings(),i=this.$tool.get();let o=n.evt.deltaY;s.invertScrollForToolWidth&&(o=-o),i==="brush"?this.manager.stateApi.setBrushWidth(h4(s.brushWidth,o)):i==="eraser"&&this.manager.stateApi.setEraserWidth(h4(s.eraserWidth,o)),this.render()});k(this,"onWindowPointerUp",n=>{try{this.$isPrimaryPointerDown.set(!1);const s=this.manager.stateApi.getSelectedEntityAdapter();s&&s.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&s.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onWindowBlur",()=>{this.revertToolBuffer()});k(this,"onKeyDown",n=>{var s;if(!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)&&(this.tools.move.isNudgeKey(n.key)&&this.tools.move.nudge(n.key),!n.repeat)){if(n.key===Rye){n.preventDefault();const i=this.manager.stateApi.getSelectedEntityAdapter();i&&!((s=i.filterer)!=null&&s.$isFiltering.get())&&!i.transformer.$isTransforming.get()&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.clearBuffer();return}if(n.key===rT){n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}n.key===iT&&(n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}});k(this,"onKeyUp",n=>{if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===rT){n.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(n.key===iT){n.preventDefault(),this.revertToolBuffer();return}}});k(this,"revertToolBuffer",()=>{const n=this.$toolBuffer.get();n&&(this.$tool.set(n),this.$toolBuffer.set(null))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isPrimaryPointerDown:this.$isPrimaryPointerDown.get(),$cursorPos:this.$cursorPos.get(),$lastPointerType:this.$lastPointerType.get(),tools:{brush:this.tools.brush.repr(),eraser:this.tools.eraser.repr(),colorPicker:this.tools.colorPicker.repr(),rect:this.tools.rect.repr(),bbox:this.tools.bbox.repr(),view:this.tools.view.repr(),move:this.tools.move.repr()}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.tools={brush:new _ye(this),eraser:new Eye(this),rect:new Lye(this),colorPicker:new Aye(this),bbox:new jye(this),view:new Dye(this),move:new Pye(this)},this.konva={stage:this.manager.stage.konva.stage,group:new Ne.Group({name:`${this.type}:group`,listening:!0})},this.konva.group.add(this.tools.brush.konva.group),this.konva.group.add(this.tools.eraser.konva.group),this.konva.group.add(this.tools.colorPicker.konva.group),this.konva.group.add(this.tools.bbox.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ha,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(et,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isPrimaryPointerDown.set(!1),this.render()}));const s=this.setEventListeners();this.subscriptions.add(s)}}class Fye extends Bt{constructor(n){super();k(this,"type","worker");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"worker",new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"}));k(this,"tasks",new Map);k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())}));k(this,"destroy",()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=s=>{const{type:i,data:o}=s.data;if(i==="log")o.ctx?this.log[o.level](o.ctx,o.message):this.log[o.level](o.message);else if(i==="extents"){const a=this.tasks.get(o.id);if(!a)return;a.onComplete(o.extents),this.tasks.delete(o.id)}},this.worker.onerror=s=>{this.log.error({message:s.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(n,s){const i=_e("bbox_calculation"),o={type:"get_bbox",data:{...n,id:i}};this.tasks.set(i,{task:o,onComplete:s}),this.worker.postMessage(o,[n.buffer])}}const pd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",Bye={GRID_LINE_COLOR_COARSE:f4(27),GRID_LINE_COLOR_FINE:f4(18),CHECKERBOARD_PATTERN_DATAURL:pd},z1=class z1 extends Bt{constructor(n){super();k(this,"type","background");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",Bye);k(this,"checkboardPattern",new Image);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src=vp.get()?"use-credentials":"anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()});k(this,"render",()=>{if(!this.manager.stateApi.runSelector(h0)){this.konva.linesGroup.visible(!1);const S=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:S,fillPatternScaleY:S});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const s=this.manager.stage.getScale(),{x:i,y:o}=this.manager.stage.getPosition(),{width:a,height:l}=this.manager.stage.getSize(),c=z1.getGridSpacing(s),d={x1:0,y1:0,x2:a,y2:l},h={x:Math.ceil(i/s/c)*c,y:Math.ceil(o/s/c)*c},f={x1:-h.x,y1:-h.y,x2:a/s-h.x+c,y2:l/s-h.y+c},p={x1:Math.min(d.x1,f.x1),y1:Math.min(d.y1,f.y1),x2:Math.max(d.x2,f.x2),y2:Math.max(d.y2,f.y2)},g=p.x2-p.x1,m=p.y2-p.y1,y=Math.round(g/c)+1,b=Math.round(m/c)+1,C=1/s;let v=0,x=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let S=0;S<y;S++){v=p.x1+S*c;const w=new Ne.Line({x:v,y:p.y1,points:[0,0,0,m],stroke:v%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}for(let S=0;S<b;S++){x=p.y1+S*c;const w=new Ne.Line({x:p.x1,y:x,points:[0,0,g,0],stroke:x%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.layer.destroy()});this.id=_e(this.type),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ne.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Ne.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Ne.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(h0,this.render))}};k(z1,"getGridSpacing",n=>n>=2?8:n>=1&&n<2?16:n>=.5&&n<1?32:n>=.25&&n<.5?64:n>=.125&&n<.25?128:256);let jC=z1;class dk extends Error{constructor(n,s,i){super(s);k(this,"type");k(this,"traceback");this.name="QueueError",this.type=n,this.traceback=i,Error.captureStackTrace&&Error.captureStackTrace(this,dk)}toString(){return`${this.name} [${this.type}]: ${this.message}
Traceback:
${this.traceback}`}}class $ye extends Bt{constructor(n,s){super();k(this,"type","state_api");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"store");k(this,"runSelector",n=>n(this.store.getState()));k(this,"createStoreSubscription",(n,s)=>tY(this.store,n,s));k(this,"addStoreListener",n=>this.store.dispatch(nY(n)));k(this,"getCanvasState",()=>this.runSelector(et));k(this,"resetEntity",n=>{this.store.dispatch(QE(n))});k(this,"setEntityPosition",n=>{this.store.dispatch(sY(n))});k(this,"moveEntityBy",n=>{this.store.dispatch(rY(n))});k(this,"addBrushLine",n=>{this.store.dispatch(iY(n))});k(this,"addEraserLine",n=>{this.store.dispatch(oY(n))});k(this,"addRect",n=>{this.store.dispatch(aY(n))});k(this,"addRasterLayer",n=>{this.store.dispatch($u(n))});k(this,"addControlLayer",n=>{this.store.dispatch(fp(n))});k(this,"addInpaintMask",n=>{this.store.dispatch(W1(n))});k(this,"addRegionalGuidance",n=>{this.store.dispatch(Ra(n))});k(this,"rasterizeEntity",n=>{this.store.dispatch(SS(n))});k(this,"setGenerationBbox",n=>{this.store.dispatch(Gh(n))});k(this,"setBrushWidth",n=>{this.store.dispatch(JE(n))});k(this,"setEraserWidth",n=>{this.store.dispatch(eM(n))});k(this,"setColor",n=>this.store.dispatch(i2(n)));k(this,"runGraphAndReturnImageOutput",n=>{const{graph:s,outputNodeId:i,destination:o,prepend:a,timeout:l,signal:c}=n;if(!s.hasNode(i))throw new Error(`Graph does not contain node with id: ${i}`);const d=_e(s.id),h={prepend:a,batch:{graph:s.getGraph(),origin:d,destination:o,runs:1}};let f=!1,p=null;const g=()=>{p!==null&&(window.clearTimeout(p),p=null)};let m=()=>{this.log.warn("cancelGraph called before cancelGraph is set")};return new Promise((b,C)=>{const v=async j=>{if(j.origin!==d||j.invocation_source_id!==i)return;g(),w();const{result:P}=j;if(P.type!=="image_output"){C(new Error(`Graph output node did not return an image output, got: ${P}`));return}const T=await Ls(()=>fY(P.image.image_name));if(T.isErr()){C(T.error);return}f=!0,b(T.value)},x=j=>{if(j.origin===d&&!(j.status==="pending"||j.status==="in_progress")){if(j.status==="completed"){this.log.warn("Queue item completed without output node completion event");return}if(g(),w(),j.status==="failed"){const{error_type:P,error_message:T,error_traceback:L}=j;C(P&&T&&L?new dk(P,T,L):new Error("Queue item failed, but no error details were provided"))}else C(new Error("Graph canceled"))}};this.store.dispatch(Wc.endpoints.enqueueBatch.initiate(h,{...H1,track:!1})).unwrap().then(j=>{const P=j.batch.batch_id;Ge(P,"Enqueue result is missing batch_id"),m=()=>{this.store.dispatch(Wc.endpoints.cancelByBatchIds.initiate({batch_ids:[P]},{track:!1}))}}).catch(j=>{C(j)}),this.manager.socket.on("invocation_complete",v),this.manager.socket.on("queue_item_status_changed",x);const w=()=>{this.manager.socket.off("invocation_complete",v),this.manager.socket.off("queue_item_status_changed",x)};l&&(p=window.setTimeout(()=>{f||(this.log.trace("Graph canceled by timeout"),w(),m(),C(new Error("Graph timed out")))},l)),c&&c.addEventListener("abort",()=>{f||(this.log.trace("Graph canceled by signal"),g(),w(),m(),C(new Error("Graph canceled")))})})});k(this,"getBbox",()=>this.runSelector(Hc));k(this,"getSettings",()=>this.runSelector(Ha));k(this,"getGridSize",()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:1);k(this,"getRegionsState",()=>this.getCanvasState().regionalGuidance);k(this,"getRasterLayersState",()=>this.getCanvasState().rasterLayers);k(this,"getControlLayersState",()=>this.getCanvasState().controlLayers);k(this,"getInpaintMasksState",()=>this.getCanvasState().inpaintMasks);k(this,"getStagingArea",()=>this.runSelector(s2));k(this,"getBboxGridSize",()=>this.runSelector(wp));k(this,"getIsSelected",n=>{var s;return((s=this.getCanvasState().selectedEntityIdentifier)==null?void 0:s.id)===n});k(this,"getRenderedEntityCount",()=>{const n=lY(this.getCanvasState());let s=0;for(const i of n)i.isEnabled&&s++;return s});k(this,"getSelectedEntityAdapter",()=>{const n=this.getCanvasState();return!n.selectedEntityIdentifier||!cY(n.selectedEntityIdentifier)?null:this.manager.getAdapter(n.selectedEntityIdentifier)});k(this,"getCurrentColor",()=>{let n=this.getSettings().color;const s=this.getSelectedEntityAdapter();return s&&(s.state.type==="regional_guidance"||s.state.type==="inpaint_mask")&&(n=XE),n});k(this,"getBrushPreviewColor",()=>{const n=this.getSelectedEntityAdapter();return(n==null?void 0:n.state.type)==="regional_guidance"||(n==null?void 0:n.state.type)==="inpaint_mask"?{...n.state.fill.color,a:.5}:this.getSettings().color});k(this,"$filteringAdapter",Oe(null));k(this,"$isFiltering",rs(this.$filteringAdapter,n=>!!n));k(this,"$transformingAdapter",Oe(null));k(this,"$isTransforming",rs(this.$transformingAdapter,n=>!!n));k(this,"$rasterizingAdapter",Oe(null));k(this,"$isRasterizing",rs(this.$rasterizingAdapter,n=>!!n));k(this,"$segmentingAdapter",Oe(null));k(this,"$isSegmenting",rs(this.$segmentingAdapter,n=>!!n));k(this,"$spaceKey",Oe(!1));k(this,"$altKey",uY);k(this,"$ctrlKey",dY);k(this,"$metaKey",hY);k(this,"$shiftKey",BS);k(this,"repr",()=>{var n,s,i,o;return{id:this.id,type:this.type,path:this.path,$filteringAdapter:((n=this.$filteringAdapter.get())==null?void 0:n.entityIdentifier)??null,$isFiltering:this.$isFiltering.get(),$transformingAdapter:((s=this.$transformingAdapter.get())==null?void 0:s.entityIdentifier)??null,$isTransforming:this.$isTransforming.get(),$rasterizingAdapter:((i=this.$rasterizingAdapter.get())==null?void 0:i.entityIdentifier)??null,$isRasterizing:this.$isRasterizing.get(),$segmentingAdapter:((o=this.$segmentingAdapter.get())==null?void 0:o.entityIdentifier)??null,$isSegmenting:this.$isSegmenting.get()}});this.id=_e(this.type),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=n}}class Vye extends Bt{constructor(n,s,i){super();k(this,"type","manager");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"store");k(this,"socket");k(this,"adapters",{rasterLayers:new Yh,controlLayers:new Yh,regionMasks:new Yh,inpaintMasks:new Yh});k(this,"stateApi");k(this,"background");k(this,"stage");k(this,"worker");k(this,"cache");k(this,"entityRenderer");k(this,"compositor");k(this,"tool");k(this,"stagingArea");k(this,"progressImage");k(this,"konva");k(this,"_isDebugging",!1);k(this,"$isBusy");k(this,"getAdapter",n=>{let s;switch(n.type){case"raster_layer":s=this.adapters.rasterLayers.get(n.id);break;case"control_layer":s=this.adapters.controlLayers.get(n.id);break;case"regional_guidance":s=this.adapters.regionMasks.get(n.id);break;case"inpaint_mask":s=this.adapters.inpaintMasks.get(n.id);break;default:return null}return s||null});k(this,"deleteAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.delete(n.id);case"control_layer":return this.adapters.controlLayers.delete(n.id);case"regional_guidance":return this.adapters.regionMasks.delete(n.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(n.id);default:return!1}});k(this,"getAdapters",n=>{const s=[];for(const i of n){const o=this.getAdapter(i);o&&s.push(o)}return s});k(this,"getAllAdapters",()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()]);k(this,"createAdapter",n=>{if(nE(n)){const s=new fye(n,this);return this.adapters.rasterLayers.set(s.id,s),s}else if(pY(n)){const s=new dye(n,this);return this.adapters.controlLayers.set(s.id,s),s}else if(gY(n)){const s=new pye(n,this);return this.adapters.regionMasks.set(s.id,s),s}else if(mY(n)){const s=new hye(n,this);return this.adapters.inpaintMasks.set(s.id,s),s}else Ge(!1,"Unhandled entity type")});k(this,"getAllModules",()=>[this.stagingArea,this.tool,this.progressImage,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage]);k(this,"initialize",()=>{var n;this.log.debug("Initializing");for(const s of this.getAllModules())(n=s.initialize)==null||n.call(s);o2.set(this)});k(this,"destroy",()=>{this.log.debug("Destroying module");for(const n of this.getAllAdapters())n.destroy();for(const n of this.getAllModules())n.destroy();o2.set(null)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(n=>n.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(n=>n.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(n=>n.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(n=>n.repr()),stateApi:this.stateApi.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),progressImage:this.progressImage.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr()}));k(this,"getLoggingContext",()=>({path:this.path}));k(this,"buildPath",n=>n.parent.path.concat(n.id));k(this,"buildLogger",n=>this.log.child(s=>({...s,context:{...s.context,...n.getLoggingContext()}})));this.id=_e(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=Fs("canvas").child(o=>({...o,context:{...this.getLoggingContext(),...o.context}})),this.log.debug("Creating canvas manager module"),this.store=s,this.socket=i,this.stateApi=new $ye(this.store,this),this.stage=new bye(n,this),this.worker=new Fye(this),this.cache=new Q0(this),this.entityRenderer=new gye(this),this.compositor=new U1e(this),this.stagingArea=new xye(this),this.$isBusy=rs([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stateApi.$isSegmenting,this.stagingArea.$isStaging,this.compositor.$isBusy],(o,a,l,c,d,h)=>o||a||l||c||d||h),this.background=new jC(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Ne.Layer({listening:!0,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new Nye(this),this.progressImage=new yye(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.progressImage.konva.group),this.konva.previewLayer.add(this.tool.konva.group)}enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function Gye(e){const t=oT(e),[n,s]=u.useState(t),{defaultDpr:i,maxDpr:o,round:a}=e||{};return u.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const c=()=>s(oT({defaultDpr:i,maxDpr:o,round:a})),d=window.matchMedia(`screen and (resolution: ${n}dppx)`);return d.addEventListener?d.addEventListener("change",c):d.addListener(c),()=>{d.removeEventListener?d.removeEventListener("change",c):d.removeListener(c)}},[n,i,o,a]),n}function oT(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},o=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(o):o),n)}const Xb=Fs("canvas");Ne.showWarnings=!1;const zye=()=>{kt("useKonvaPixelRatioWatcher");const e=Gye({round:!1});u.useLayoutEffect(()=>{Ne.pixelRatio=e},[e])},Hye=()=>{kt("useInvokeCanvas"),zye();const e=jn(),t=ce(tM),[n,s]=u.useState(null);return u.useLayoutEffect(()=>{if(Xb.debug("Initializing renderer"),!n)return Xb.debug("No stage container, skipping initialization"),()=>{};if(!t)return Xb.debug("Socket not connected, skipping initialization"),()=>{};const i=o2.get();if(i){i.stage.setContainer(n);return}new Vye(n,e,t).initialize()},[n,t,e]),s},UN=u.memo(()=>{const e=Hye();return r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});UN.displayName="InvokeCanvasComponent";const qN=u.memo(({adapter:e})=>{const{t}=M(),n=ce(e.segmentAnything.$invert),s=u.useCallback(()=>{e.segmentAnything.$invert.set(!e.segmentAnything.$invert.get())},[e.segmentAnything.$invert]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("controlLayers.selectObject.invertSelection")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});qN.displayName="SelectObjectInvert";const KN=u.memo(({adapter:e})=>{const{t}=M(),n=ce(e.segmentAnything.$pointTypeString),s=u.useCallback(i=>{const o=yY.parse(i),a=vY[o];e.segmentAnything.$pointType.set(a)},[e.segmentAnything.$pointType]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("controlLayers.selectObject.pointType")}),r.jsx(bY,{value:n,onChange:s,w:"full",size:"md",children:r.jsxs(A,{alignItems:"center",w:"full",gap:4,fontWeight:"semibold",color:"base.300",children:[r.jsx(p4,{value:"foreground",children:r.jsx(q,{children:t("controlLayers.selectObject.include")})}),r.jsx(p4,{value:"background",children:r.jsx(q,{children:t("controlLayers.selectObject.exclude")})})]})})]})});KN.displayName="SelectObject";const ZN=u.memo(({adapter:e})=>{const{t}=M(),n=u.useRef(null);ta("canvas",n,{focusOnMount:!0});const s=Os("canvas"),i=ce(e.segmentAnything.$isProcessing),o=ce(e.segmentAnything.$hasPoints),a=ce(e.segmentAnything.$hasImageState),l=I(Sp),c=u.useCallback(()=>{e.segmentAnything.saveAs("inpaint_mask")},[e.segmentAnything]),d=u.useCallback(()=>{e.segmentAnything.saveAs("regional_guidance")},[e.segmentAnything]),h=u.useCallback(()=>{e.segmentAnything.saveAs("raster_layer")},[e.segmentAnything]),f=u.useCallback(()=>{e.segmentAnything.saveAs("control_layer")},[e.segmentAnything]);return Le({id:"applySegmentAnything",category:"canvas",callback:e.segmentAnything.apply,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),Le({id:"cancelSegmentAnything",category:"canvas",callback:e.segmentAnything.cancel,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),r.jsxs(A,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(A,{w:"full",gap:4,alignItems:"center",children:[r.jsxs(A,{gap:2,children:[r.jsx(Rt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.selectObject.selectObject")}),r.jsx(De,{label:r.jsx(XN,{}),children:r.jsx(A,{alignItems:"center",children:r.jsx(dt,{as:td,color:"base.500"})})})]}),r.jsx(rt,{}),r.jsx(lk,{}),r.jsx(ov,{})]}),r.jsxs(A,{w:"full",justifyContent:"space-between",py:2,children:[r.jsx(KN,{adapter:e}),r.jsx(qN,{adapter:e})]}),r.jsxs(Cs,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(ye,{onClick:e.segmentAnything.processImmediate,loadingText:t("controlLayers.selectObject.process"),variant:"ghost",isDisabled:i||!o||l&&a,children:[t("controlLayers.selectObject.process"),i&&r.jsx(rr,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(rt,{}),r.jsx(ye,{onClick:e.segmentAnything.reset,isDisabled:i||!o,loadingText:t("controlLayers.selectObject.reset"),variant:"ghost",children:t("controlLayers.selectObject.reset")}),r.jsx(ye,{onClick:e.segmentAnything.apply,loadingText:t("controlLayers.selectObject.apply"),variant:"ghost",isDisabled:i||!a,children:t("controlLayers.selectObject.apply")}),r.jsxs(Yt,{children:[r.jsx(Xt,{as:ye,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:i||!a,rightIcon:r.jsx(ii,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(It,{children:[r.jsx(he,{isDisabled:i||!a,onClick:c,children:t("controlLayers.newInpaintMask")}),r.jsx(he,{isDisabled:i||!a,onClick:d,children:t("controlLayers.newRegionalGuidance")}),r.jsx(he,{isDisabled:i||!a,onClick:f,children:t("controlLayers.newControlLayer")}),r.jsx(he,{isDisabled:i||!a,onClick:h,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(ye,{onClick:e.segmentAnything.cancel,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.selectObject.cancel")})]})]})});ZN.displayName="SegmentAnythingContent";const YN=u.memo(()=>{const e=Et(),t=ce(e.stateApi.$segmentingAdapter);return t?r.jsx(ZN,{adapter:t}):null});YN.displayName="SelectObject";const aT=e=>r.jsx(q,{as:"span",fontWeight:"semibold",children:e.children}),XN=u.memo(()=>{const{t:e}=M();return r.jsxs(A,{gap:3,flexDir:"column",children:[r.jsx(q,{children:r.jsx(Jt,{i18nKey:"controlLayers.selectObject.help1",components:{Bold:r.jsx(aT,{})}})}),r.jsx(q,{children:r.jsx(Jt,{i18nKey:"controlLayers.selectObject.help2",components:{Bold:r.jsx(aT,{})}})}),r.jsx(q,{children:r.jsx(Jt,{i18nKey:"controlLayers.selectObject.help3"})}),r.jsxs(Pi,{children:[r.jsx(Vt,{children:e("controlLayers.selectObject.clickToAdd")}),r.jsx(Vt,{children:e("controlLayers.selectObject.dragToMove")}),r.jsx(Vt,{children:e("controlLayers.selectObject.clickToRemove")})]})]})});XN.displayName="SelectObjectHelpTooltipContent";const Wye={destination:"canvas"},Uye=()=>{xY(Wye)},QN=u.memo(e=>(Uye(),I(On)?e.children:null));QN.displayName="StagingAreaIsStagingGate";const JN=u.memo(()=>{const e=z(),t=Et(),n=I(pp),s=I(sy),i=I(_n),o=I(jp),a=ce(t.stagingArea.$shouldShowStagedImage),l=Os("canvas"),{t:c}=M(),d=u.useCallback(()=>{if(!s)return;const{x:h,y:f}=n,{imageDTO:p,offsetX:g,offsetY:m}=s,y=Mi(p),b={position:{x:h+g,y:f+m},objects:[y]};e($u({overrides:b,isSelected:(i==null?void 0:i.type)==="raster_layer"})),e($S())},[n,e,i==null?void 0:i.type,s]);return Ii(["enter"],d,{preventDefault:!0,enabled:l&&a&&o>1},[l,a,o]),r.jsx(oe,{tooltip:`${c("common.accept")} (Enter)`,"aria-label":`${c("common.accept")} (Enter)`,icon:r.jsx(Bp,{}),onClick:d,colorScheme:"invokeBlue",isDisabled:!s})});JN.displayName="StagingAreaToolbarAcceptButton";const eF=u.memo(()=>{const e=z(),{t}=M(),n=u.useCallback(()=>{e($S())},[e]);return r.jsx(oe,{tooltip:`${t("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":t("controlLayers.stagingArea.discardAll"),icon:r.jsx(ei,{}),onClick:n,colorScheme:"error",fontSize:16})});eF.displayName="StagingAreaToolbarDiscardAllButton";const tF=u.memo(()=>{const e=z(),t=I(nM),n=I(sy),s=I(jp),{t:i}=M(),o=u.useCallback(()=>{n&&e(s===1?$S():CY({index:t}))},[n,s,e,t]);return r.jsx(oe,{tooltip:i("controlLayers.stagingArea.discard"),"aria-label":i("controlLayers.stagingArea.discard"),icon:r.jsx(Nt,{}),onClick:o,colorScheme:"invokeBlue",fontSize:16,isDisabled:!n})});tF.displayName="StagingAreaToolbarDiscardSelectedButton";const nF=u.memo(()=>{const e=I(nM),t=I(jp),n=u.useMemo(()=>t>0?`${(e??0)+1} of ${t}`:"0 of 0",[t,e]);return r.jsx(ye,{colorScheme:"base",pointerEvents:"none",minW:28,children:n})});nF.displayName="StagingAreaToolbarImageCountButton";const sF=u.memo(()=>{const e=z(),t=Et(),n=I(jp),s=ce(t.stagingArea.$shouldShowStagedImage),i=Os("canvas"),{t:o}=M(),a=u.useCallback(()=>{e(SY())},[e]);return Ii(["right"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${o("controlLayers.stagingArea.next")} (Right)`,icon:r.jsx(aae,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});sF.displayName="StagingAreaToolbarNextButton";const rF=u.memo(()=>{const e=z(),t=Et(),n=I(jp),s=ce(t.stagingArea.$shouldShowStagedImage),i=Os("canvas"),{t:o}=M(),a=u.useCallback(()=>{e(wY())},[e]);return Ii(["left"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${o("controlLayers.stagingArea.previous")} (Left)`,icon:r.jsx(rae,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});rF.displayName="StagingAreaToolbarPrevButton";const gm={image_category:"general",is_intermediate:!0,silent:!0},iF=u.memo(()=>{const{t:e}=M(),t=I(sy),n=jn(),s=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await zh(t.imageDTO),h=await wa({file:d,...gm});Hr({imageDTO:h,type:"raster_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),i=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await zh(t.imageDTO),h=await wa({file:d,...gm});Hr({imageDTO:h,type:"control_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),o=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await zh(t.imageDTO),h=await wa({file:d,...gm});Hr({imageDTO:h,type:"inpaint_mask",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),a=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await zh(t.imageDTO),h=await wa({file:d,...gm});Hr({imageDTO:h,type:"regional_guidance",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ve({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]);return r.jsxs(Yt,{children:[r.jsx(Xt,{as:oe,"aria-label":e("controlLayers.newLayerFromImage"),tooltip:e("controlLayers.newLayerFromImage"),icon:r.jsx(NL,{}),colorScheme:"invokeBlue",isDisabled:!t}),r.jsxs(It,{children:[r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:o,isDisabled:!t,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:a,isDisabled:!t,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:i,isDisabled:!t,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(hs,{}),onClickCapture:s,isDisabled:!t,children:e("controlLayers.rasterLayer")})]})]})});iF.displayName="StagingAreaToolbarSaveAsMenu";const lT="SAVE_STAGING_AREA_IMAGE_TO_GALLERY",oF=u.memo(()=>{const e=I(Er),t=I(sy),{t:n}=M(),s=u.useCallback(async()=>{if(!t)return;(await Ls(async()=>{const o=await zh(t.imageDTO);await wa({file:o,image_category:"general",is_intermediate:!1,board_id:e==="none"?void 0:e,silent:!0})})).isOk()?ve({id:lT,title:n("controlLayers.savedToGalleryOk"),status:"success"}):ve({id:lT,title:n("controlLayers.savedToGalleryError"),status:"error"})},[e,t,n]);return r.jsx(oe,{tooltip:n("controlLayers.stagingArea.saveToGallery"),"aria-label":n("controlLayers.stagingArea.saveToGallery"),icon:r.jsx(eo,{}),onClick:s,colorScheme:"invokeBlue",isDisabled:!t})});oF.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const aF=u.memo(()=>{const e=Et(),t=ce(e.stagingArea.$shouldShowStagedImage),{t:n}=M(),s=u.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!t)},[e.stagingArea.$shouldShowStagedImage,t]);return r.jsx(oe,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?r.jsx($p,{}):r.jsx(wae,{}),onClick:s,colorScheme:"invokeBlue"})});aF.displayName="StagingAreaToolbarToggleShowResultsButton";const lF=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Cs,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(rF,{}),r.jsx(nF,{}),r.jsx(sF,{})]}),r.jsxs(Cs,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(JN,{}),r.jsx(aF,{}),r.jsx(oF,{}),r.jsx(iF,{}),r.jsx(tF,{}),r.jsx(eF,{})]})]}));lF.displayName="StagingAreaToolbar";const cF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(WE),s=u.useCallback(()=>{t(jY())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});cF.displayName="CanvasSettingsBboxOverlaySwitch";const uF=u.memo(()=>{const{t:e}=M(),t=Et(),n=u.useCallback(()=>{t.cache.clearAll()},[t]);return r.jsx(ye,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});uF.displayName="CanvasSettingsClearCachesButton";const dF=u.memo(()=>{const{t:e}=M(),t=z(),n=u.useCallback(()=>{t(kY())},[t]);return r.jsx(ye,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});dF.displayName="CanvasSettingsClearHistoryButton";const qye=pe(Ha,e=>e.clipToBbox),hF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(qye),s=u.useCallback(i=>t(_Y(i.target.checked)),[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.clipToBbox")}),r.jsx(kn,{isChecked:n,onChange:s})]})});hF.displayName="CanvasSettingsClipToBboxCheckbox";const fF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(h0),s=u.useCallback(()=>{t(IY())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});fF.displayName="CanvasSettingsDynamicGridSwitch";const pF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(AY),s=u.useCallback(()=>{t(TY())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),r.jsx(kn,{isChecked:n,onChange:s})]})});pF.displayName="CanvasSettingsSnapToGrid";const Kye=pe(Ha,e=>e.invertScrollForToolWidth),gF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Kye),s=u.useCallback(i=>{t(EY(i.target.checked))},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),r.jsx(kn,{isChecked:n,onChange:s})]})});gF.displayName="CanvasSettingsInvertScrollCheckbox";const mF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(c0),s=u.useCallback(()=>{t(DE())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedLayerPreview")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});mF.displayName="CanvasSettingsIsolatedLayerPreviewSwitch";const yF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Yx),s=u.useCallback(()=>{t(MY())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});yF.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const vF=u.memo(()=>{const{t:e}=M(),t=Et(),n=u.useCallback(()=>{t.logDebugInfo()},[t]);return r.jsx(ye,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});vF.displayName="CanvasSettingsLogDebugInfoButton";const bF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(PY),s=u.useCallback(()=>{t(LY())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),r.jsx(kn,{isChecked:n,onChange:s})]})});bF.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const xF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(jE),s=u.useCallback(()=>t(DY()),[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),r.jsx(kn,{isChecked:n,onChange:s})]})});xF.displayName="CanvasSettingsPreserveMaskCheckbox";const CF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(RY),s=u.useCallback(()=>{t(OY())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),r.jsx(kn,{isChecked:n,onChange:s})]})});CF.displayName="CanvasSettingsPressureSensitivityCheckbox";const SF=u.memo(()=>{const{t:e}=M(),t=Et(),n=u.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return r.jsx(ye,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});SF.displayName="CanvasSettingsRecalculateRectsButton";const Zye=pe(Ha,e=>e.showHUD),wF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Zye),s=u.useCallback(()=>{t(NY())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});wF.displayName="CanvasSettingsShowHUDSwitch";const jF=u.memo(()=>{const{t:e}=M(),t=z(),n=I(n2),s=u.useCallback(()=>{t(FY())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})});jF.displayName="CanvasSettingsShowProgressOnCanvas";const kF=u.memo(()=>{const{t:e}=M();return r.jsxs(Fn,{isLazy:!0,children:[r.jsx(Un,{children:r.jsx(oe,{"aria-label":e("common.settingsLabel"),icon:r.jsx(nd,{}),variant:"link",alignSelf:"stretch"})}),r.jsxs(Bn,{children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsxs(A,{direction:"column",gap:2,children:[r.jsx(gF,{}),r.jsx(xF,{}),r.jsx(hF,{}),r.jsx(bF,{}),r.jsx(pF,{}),r.jsx(CF,{}),r.jsx(jF,{}),r.jsx(yF,{}),r.jsx(mF,{}),r.jsx(fF,{}),r.jsx(cF,{}),r.jsx(wF,{}),r.jsx(Yye,{})]})})]})]})});kF.displayName="CanvasSettingsPopover";const Yye=()=>Wa()?r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsx(uF,{}),r.jsx(SF,{}),r.jsx(vF,{}),r.jsx(dF,{})]}):null,_F=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],Xye=_F,Qye=_F.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function el(){return(el=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function lg(e,t){if(e==null)return{};var n,s,i={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(n=o[s])>=0||(i[n]=e[n]);return i}function Yf(e){var t=u.useRef(e),n=u.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var Mu=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},mf=function(e){return"touches"in e},kC=function(e){return e&&e.ownerDocument.defaultView||self},cT=function(e,t,n){var s=e.getBoundingClientRect(),i=mf(t)?function(o,a){for(var l=0;l<o.length;l++)if(o[l].identifier===a)return o[l];return o[0]}(t.touches,n):t;return{left:Mu((i.pageX-(s.left+kC(e).pageXOffset))/s.width),top:Mu((i.pageY-(s.top+kC(e).pageYOffset))/s.height)}},uT=function(e){!mf(e)&&e.preventDefault()},hk=me.memo(function(e){var t=e.onMove,n=e.onKey,s=lg(e,["onMove","onKey"]),i=u.useRef(null),o=Yf(t),a=Yf(n),l=u.useRef(null),c=u.useRef(!1),d=u.useMemo(function(){var g=function(b){uT(b),(mf(b)?b.touches.length>0:b.buttons>0)&&i.current?o(cT(i.current,b,l.current)):y(!1)},m=function(){return y(!1)};function y(b){var C=c.current,v=kC(i.current),x=b?v.addEventListener:v.removeEventListener;x(C?"touchmove":"mousemove",g),x(C?"touchend":"mouseup",m)}return[function(b){var C=b.nativeEvent,v=i.current;if(v&&(uT(C),!function(S,w){return w&&!mf(S)}(C,c.current)&&v)){if(mf(C)){c.current=!0;var x=C.changedTouches||[];x.length&&(l.current=x[0].identifier)}v.focus(),o(cT(v,C,l.current)),y(!0)}},function(b){var C=b.which||b.keyCode;C<37||C>40||(b.preventDefault(),a({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},y]},[a,o]),h=d[0],f=d[1],p=d[2];return u.useEffect(function(){return p},[p]),me.createElement("div",el({},s,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:i,onKeyDown:f,tabIndex:0,role:"slider"}))}),cg=function(e){return e.filter(Boolean).join(" ")},fk=function(e){var t=e.color,n=e.left,s=e.top,i=s===void 0?.5:s,o=cg(["react-colorful__pointer",e.className]);return me.createElement("div",{className:o,style:{top:100*i+"%",left:100*n+"%"}},me.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Rs=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},IF=function(e){var t=e.s,n=e.v,s=e.a,i=(200-t)*n/100;return{h:Rs(e.h),s:Rs(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:Rs(i/2),a:Rs(s,2)}},_C=function(e){var t=IF(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},Qb=function(e){var t=IF(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},AF=function(e){var t=e.h,n=e.s,s=e.v,i=e.a;t=t/360*6,n/=100,s/=100;var o=Math.floor(t),a=s*(1-n),l=s*(1-(t-o)*n),c=s*(1-(1-t+o)*n),d=o%6;return{r:Rs(255*[s,l,a,a,c,s][d]),g:Rs(255*[c,s,s,l,a,a][d]),b:Rs(255*[a,a,c,s,s,l][d]),a:Rs(i,2)}},TF=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,o=Math.max(t,n,s),a=o-Math.min(t,n,s),l=a?o===t?(n-s)/a:o===n?2+(s-t)/a:4+(t-n)/a:0;return{h:Rs(60*(l<0?l+6:l)),s:Rs(o?a/o*100:0),v:Rs(o/255*100),a:i}},EF=me.memo(function(e){var t=e.hue,n=e.onChange,s=cg(["react-colorful__hue",e.className]);return me.createElement("div",{className:s},me.createElement(hk,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:Mu(t+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Rs(t),"aria-valuemax":"360","aria-valuemin":"0"},me.createElement(fk,{className:"react-colorful__hue-pointer",left:t/360,color:_C({h:t,s:100,v:100,a:1})})))}),MF=me.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:_C({h:t.h,s:100,v:100,a:1})};return me.createElement("div",{className:"react-colorful__saturation",style:s},me.createElement(hk,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:Mu(t.s+100*i.left,0,100),v:Mu(t.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Rs(t.s)+"%, Brightness "+Rs(t.v)+"%"},me.createElement(fk,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:_C(t)})))}),pk=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function PF(e,t,n){var s=Yf(n),i=u.useState(function(){return e.toHsva(t)}),o=i[0],a=i[1],l=u.useRef({color:t,hsva:o});u.useEffect(function(){if(!e.equal(t,l.current.color)){var d=e.toHsva(t);l.current={hsva:d,color:t},a(d)}},[t,e]),u.useEffect(function(){var d;pk(o,l.current.hsva)||e.equal(d=e.fromHsva(o),l.current.color)||(l.current={hsva:o,color:d},s(d))},[o,e,s]);var c=u.useCallback(function(d){a(function(h){return Object.assign({},h,d)})},[]);return[o,c]}var Jye=typeof window<"u"?u.useLayoutEffect:u.useEffect,eve=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},dT=new Map,LF=function(e){Jye(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!dT.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,dT.set(t,n);var s=eve();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},tve=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=lg(e,["className","colorModel","color","onChange"]),l=u.useRef(null);LF(l);var c=PF(n,i,o),d=c[0],h=c[1],f=cg(["react-colorful",t]);return me.createElement("div",el({},a,{ref:l,className:f}),me.createElement(MF,{hsva:d,onChange:h}),me.createElement(EF,{hue:d.h,onChange:h,className:"react-colorful__last-control"}))},nve=function(e){var t=e.className,n=e.hsva,s=e.onChange,i={backgroundImage:"linear-gradient(90deg, "+Qb(Object.assign({},n,{a:0}))+", "+Qb(Object.assign({},n,{a:1}))+")"},o=cg(["react-colorful__alpha",t]),a=Rs(100*n.a);return me.createElement("div",{className:o},me.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),me.createElement(hk,{onMove:function(l){s({a:l.left})},onKey:function(l){s({a:Mu(n.a+l.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},me.createElement(fk,{className:"react-colorful__alpha-pointer",left:n.a,color:Qb(n)})))},sve=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=lg(e,["className","colorModel","color","onChange"]),l=u.useRef(null);LF(l);var c=PF(n,i,o),d=c[0],h=c[1],f=cg(["react-colorful",t]);return me.createElement("div",el({},a,{ref:l,className:f}),me.createElement(MF,{hsva:d,onChange:h}),me.createElement(EF,{hue:d.h,onChange:h}),me.createElement(nve,{hsva:d,onChange:h,className:"react-colorful__last-control"}))},rve={defaultColor:{r:0,g:0,b:0,a:1},toHsva:TF,fromHsva:AF,equal:pk},DF=function(e){return me.createElement(sve,el({},e,{colorModel:rve}))},ive={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return TF({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=AF(e)).r,g:t.g,b:t.b};var t},equal:pk},ove=function(e){return me.createElement(tve,el({},e,{colorModel:ive}))},ave=/^#?([0-9A-F]{3,8})$/i,lve=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,i=e.onBlur,o=e.escape,a=e.validate,l=e.format,c=e.process,d=lg(e,["color","onChange","onBlur","escape","validate","format","process"]),h=u.useState(function(){return o(n)}),f=h[0],p=h[1],g=Yf(s),m=Yf(i),y=u.useCallback(function(C){var v=o(C.target.value);p(v),a(v)&&g(c?c(v):v)},[o,c,a,g]),b=u.useCallback(function(C){a(C.target.value)||p(o(n)),m(C)},[n,o,a,m]);return u.useEffect(function(){p(o(n))},[n,o]),me.createElement("input",el({},d,{value:l?l(f):f,spellCheck:"false",onChange:y,onBlur:b}))},hT=function(e){return"#"+e},cve=function(e){var t=e.prefixed,n=e.alpha,s=lg(e,["prefixed","alpha"]),i=u.useCallback(function(a){return a.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),o=u.useCallback(function(a){return function(l,c){var d=ave.exec(l),h=d?d[1].length:0;return h===3||h===6||!!c&&h===4||!!c&&h===8}(a,n)},[n]);return me.createElement(lve,el({},s,{escape:i,format:t?hT:void 0,process:hT,validate:o}))};const Jb={width:6,height:6,borderColor:"base.100"},uve={".react-colorful__hue-pointer":Jb,".react-colorful__saturation-pointer":Jb,".react-colorful__alpha-pointer":Jb,gap:4,flexDir:"column"},dve={width:"100%"},mm="3.5rem",hve=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=M(),a=u.useCallback(h=>n({...t,r:h}),[t,n]),l=u.useCallback(h=>n({...t,g:h}),[t,n]),c=u.useCallback(h=>n({...t,b:h}),[t,n]),d=u.useCallback(h=>n({...t,a:h}),[t,n]);return r.jsxs(A,{sx:uve,children:[r.jsx(DF,{color:t,onChange:n,style:dve}),s&&r.jsxs(A,{gap:2,children:[r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.red")[0]}),r.jsx(Ae,{value:t.r,onChange:a,min:0,max:255,step:1,w:mm,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.green")[0]}),r.jsx(Ae,{value:t.g,onChange:l,min:0,max:255,step:1,w:mm,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.blue")[0]}),r.jsx(Ae,{value:t.b,onChange:c,min:0,max:255,step:1,w:mm,defaultValue:255})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.alpha")[0]}),r.jsx(Ae,{value:t.a,onChange:d,step:.1,min:0,max:1,w:mm,defaultValue:1})]})]}),i&&r.jsx(A,{gap:2,justifyContent:"space-between",children:Xye.map((h,f)=>r.jsx(fve,{color:h,onChange:n},f))})]})},RF=u.memo(hve),fve=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(Se,{role:"button",onClick:n,h:8,w:8,bg:qo(e),borderRadius:"base"})},pve=pe(Ha,e=>e.color),OF=u.memo(()=>{const{t:e}=M(),t=I(pve),n=z(),s=u.useCallback(o=>{n(i2(o))},[n]),i=Lt();return Le({id:"setFillToWhite",category:"canvas",callback:()=>n(i2({r:255,g:255,b:255,a:1})),options:{preventDefault:!0,enabled:!i.isOpen},dependencies:[n,i.isOpen]}),r.jsxs(Fn,{isLazy:!0,children:[r.jsx(Un,{children:r.jsx(A,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,w:8,h:8,children:r.jsx(De,{label:e("controlLayers.fill.fillColor"),children:r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Se,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:qo(t)})})})})}),r.jsxs(Bn,{children:[r.jsx(Li,{}),r.jsx(qn,{minH:64,children:r.jsx(RF,{color:t,onChange:s,withNumberInput:!0,withSwatches:!0})})]})]})});OF.displayName="ToolFillColorPicker";const ia=e=>{const t=Et();return ce(rs(t.tool.$tool,s=>s===e))},lc=e=>{const t=Et();return u.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},gve=pe(Ha,e=>e.brushWidth),mve=e=>`${e} px`;function NF(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function eu(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function yve(e){return`${String(NF(e))} px`}const vve=[eu(1),eu(50),eu(200),eu(600)],bve=eu(50),FF=u.memo(()=>{const e=z(),{t}=M(),n=Lt(),s=ia("brush"),i=I(gve),[o,a]=u.useState(i),l=u.useCallback(m=>{e(JE(co(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(NF(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Le({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Le({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(Fn,{children:[r.jsxs(Z,{w:"min-content",gap:2,children:[r.jsx(te,{m:0,children:t("controlLayers.width")}),r.jsx(kp,{children:r.jsxs(ry,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:mve,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(iy,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(Un,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(ii,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(Bn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsx(Ze,{min:0,max:100,value:eu(o),onChange:h,defaultValue:bve,marks:vve,formatValue:yve,alwaysShowMarks:!0})})]})]})});FF.displayName="ToolBrushWidth";const xve=pe(Ha,e=>e.eraserWidth),Cve=e=>`${e} px`;function BF(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function tu(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function Sve(e){return`${String(BF(e))} px`}const wve=[tu(1),tu(50),tu(200),tu(600)],jve=tu(50),$F=u.memo(()=>{const e=z(),{t}=M(),n=Lt(),s=ia("eraser"),i=I(xve),[o,a]=u.useState(i),l=u.useCallback(m=>{e(eM(co(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(BF(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Le({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Le({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(Fn,{children:[r.jsxs(Z,{w:"min-content",gap:2,children:[r.jsx(te,{m:0,children:t("controlLayers.width")}),r.jsx(kp,{children:r.jsxs(ry,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:Cve,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(iy,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(Un,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(ii,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(Bn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsx(Ze,{min:0,max:100,value:tu(o),onChange:h,defaultValue:jve,marks:wve,formatValue:Sve,alwaysShowMarks:!0})})]})]})});$F.displayName="ToolEraserWidth";const VF=u.memo(()=>{const e=Et(),t=ce(e.tool.$tool);return t==="brush"?r.jsx(FF,{}):t==="eraser"?r.jsx($F,{}):null});VF.displayName="ToolSettings";const GF=u.memo(()=>{const{t:e}=M(),t=Et(),n=st(),s=u.useCallback(()=>{t.tool.tools.bbox.fitToLayers()},[t.tool.tools.bbox]);return r.jsx(oe,{onClick:s,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:r.jsx(Fae,{}),isDisabled:n})});GF.displayName="CanvasToolbarFitBboxToLayersButton";const gk=u.memo(()=>{const{t:e}=M(),t=z(),{newGallerySessionWithDialog:n}=uD(),{newCanvasSessionWithDialog:s}=dD(),i=u.useCallback(()=>{t(BY())},[t]),o=u.useCallback(()=>{t($Y())},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(he,{icon:r.jsx(Lf,{}),onClick:n,children:e("controlLayers.newGallerySession")}),r.jsx(he,{icon:r.jsx(Lf,{}),onClick:s,children:e("controlLayers.newCanvasSession")}),r.jsx(he,{icon:r.jsx(b0,{}),onClick:i,children:e("controlLayers.resetCanvasLayers")}),r.jsx(he,{icon:r.jsx(b0,{}),onClick:o,children:e("controlLayers.resetGenerationSettings")})]})});gk.displayName="SessionMenuItems";const zF=u.memo(()=>{const{t:e}=M();return r.jsxs(Yt,{placement:"bottom-end",children:[r.jsx(Xt,{as:oe,"aria-label":e("controlLayers.newSession"),icon:r.jsx(Lf,{}),variant:"link",alignSelf:"stretch"}),r.jsx(It,{children:r.jsx(gk,{})})]})});zF.displayName="CanvasToolbarNewSessionMenuButton";const HF=u.memo(()=>{const{t:e}=M(),t=z(),n=st(),s=I(sM),i=u.useCallback(()=>{t(rM())},[t]);return r.jsx(oe,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:i,icon:r.jsx(nae,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});HF.displayName="CanvasToolbarRedoButton";const WF=u.memo(()=>{const{t:e}=M(),t=Et(),n=Os("canvas"),s=Lt();return Le({id:"fitLayersToCanvas",category:"canvas",callback:t.stage.fitLayersToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Le({id:"fitBboxToCanvas",category:"canvas",callback:t.stage.fitBboxToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Le({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Le({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Le({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Le({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),r.jsx(oe,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:t.stage.fitLayersToStage,icon:r.jsx(Ay,{}),variant:"link",alignSelf:"stretch"})});WF.displayName="CanvasToolbarResetViewButton";const UF=u.memo(()=>{const{t:e}=M(),t=Wa(),n=st(),s=BO(),i=$O();return r.jsx(oe,{variant:"link",alignSelf:"stretch",onClick:t?i:s,icon:r.jsx(eo,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});UF.displayName="CanvasToolbarSaveToGalleryButton";function kve(e){return isNaN(Number(e))?"":`${_p(Number(e),2).toLocaleString()}%`}function qF(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function ml(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function _ve(e){return String(qF(e))}const IC=[ml(10),ml(50),ml(100),ml(500),ml(2e3)],Ive=ml(100),Ave=IC.slice(1,IC.length-1),KF=u.memo(()=>{const e=Et(),t=ce(rs(e.stage.$stageAttrs,c=>c.scale)),[n,s]=u.useState(t*100),i=u.useCallback(c=>{let d=c;BS.get()||(d=iM(c,Ave,2));const h=qF(d);e.stage.setScale(h/100)},[e]),o=u.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),a=u.useCallback((c,d)=>{s(d)},[]),l=u.useCallback(c=>{c.key==="Enter"&&o()},[o]);return u.useEffect(()=>{s(t*100)},[t]),r.jsxs(A,{alignItems:"center",children:[r.jsx(Tve,{}),r.jsxs(Fn,{children:[r.jsx(kp,{children:r.jsxs(ry,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:a,onBlur:o,w:"76px",format:kve,defaultValue:100,onKeyDown:l,clampValueOnBlur:!1,children:[r.jsx(iy,{paddingInlineEnd:7,title:"",_focusVisible:{zIndex:0}}),r.jsx(Un,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(ii,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),r.jsxs(Bn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsx(Ze,{min:0,max:100,value:ml(n),onChange:i,defaultValue:Ive,marks:IC,formatValue:_ve,alwaysShowMarks:!0})})]})]}),r.jsx(Eve,{})]})});KF.displayName="CanvasToolbarScale";const ZF=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],Tve=()=>{const e=Et(),t=ce(rs(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=ZF.slice().reverse().find(i=>i<t)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(s,e.stage.config.MIN_SCALE))},[e.stage,t]);return r.jsx(oe,{onClick:n,icon:r.jsx(WL,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})},Eve=()=>{const e=Et(),t=ce(rs(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=ZF.find(i=>i>t)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(s,e.stage.config.MAX_SCALE))},[e.stage,t]);return r.jsx(oe,{onClick:n,icon:r.jsx(UL,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})},YF=u.memo(()=>{const{t:e}=M(),t=z(),n=st(),s=I(oM),i=u.useCallback(()=>{t(aM())},[t]);return r.jsx(oe,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:i,icon:r.jsx(Di,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});YF.displayName="CanvasToolbarUndoButton";function XF(){kt(XF.name);const e=z(),t=I(_n),n=st(),s=I(Pf),i=I(En),o=Lt(),a=u.useCallback(()=>{t!==null&&e(OS({entityIdentifier:t}))},[e,t]),l=u.useMemo(()=>t!==null&&!n&&s==="layers"&&i==="canvas",[t,n,s,i]);Le({id:"deleteSelected",category:"canvas",callback:a,options:{enabled:l&&!o.isOpen},dependencies:[l,a,o.isOpen]})}const Mve=()=>{const e=z(),[t,n]=u.useState(null),[s,i]=u.useState(null),o=I(_n),a=I(VY),l=Lt();u.useEffect(()=>{(s==null?void 0:s.id)!==(o==null?void 0:o.id)&&(n(s),i(o))},[s,o]);const c=u.useCallback(()=>{a?(s==null?void 0:s.id)!==a.id?(n(s),i(a),e(iu({entityIdentifier:a}))):t&&(i(t),e(iu({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),i(t),e(iu({entityIdentifier:t})))},[a,s,e,t]);Le({id:"quickSwitch",category:"canvas",callback:c,options:{enabled:!l.isOpen},dependencies:[c,l.isOpen]})},Pve=()=>{kt("useCanvasFilterHotkey");const e=I(_n),t=iv(e);Le({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})};function QF(){kt(QF.name);const e=z(),t=I(_n),n=st(),s=So(t),i=Ri(t),o=Lt(),a=u.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(QE({entityIdentifier:t})))},[s,e,t]),l=u.useMemo(()=>t!==null&&a2(t),[t]);Le({id:"resetSelected",category:"canvas",callback:a,options:{enabled:l&&!n&&!i&&!o.isOpen},dependencies:[l,n,i,a,o.isOpen]})}const Lve=()=>{kt("useCanvasTransformHotkey");const e=I(_n),t=nk(e);Le({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},Dve=()=>{kt("useCanvasUndoRedo");const e=VS(),t=st(),n=Lt(),s=I(oM),i=u.useCallback(()=>{e(aM())},[e]);Le({id:"undo",category:"canvas",callback:i,options:{enabled:s&&!t&&!n.isOpen,preventDefault:!0},dependencies:[s,t,i,n.isOpen]});const o=I(sM),a=u.useCallback(()=>{e(rM())},[e]);Le({id:"redo",category:"canvas",callback:a,options:{enabled:o&&!t&&!n.isOpen,preventDefault:!0},dependencies:[o,a,t,n.isOpen]})},Rve=tn(et,e=>{const t=e.selectedEntityIdentifier,n=lM(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i+1)%n.length]??null}return s?Ys(s):null}),Ove=tn(et,e=>{const t=e.selectedEntityIdentifier,n=lM(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i-1+n.length)%n.length]??null}return s?Ys(s):null}),Nve=()=>{kt("useNextPrevEntityHotkeys");const e=z(),t=I(Rve),n=I(Ove),s=u.useCallback(()=>{t&&e(iu({entityIdentifier:t}))},[e,t]),i=u.useCallback(()=>{n&&e(iu({entityIdentifier:n}))},[e,n]);Ii([""],i,{preventDefault:!0,ignoreModifiers:!0},[i]),Le({category:"canvas",id:"prevEntity",callback:i,options:{preventDefault:!0},dependencies:[i]}),Ii([""],s,{preventDefault:!0,ignoreModifiers:!0},[s]),Le({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},JF=u.memo(()=>(QF(),XF(),Dve(),Mve(),Nve(),Lve(),Pve(),r.jsxs(A,{w:"full",gap:2,alignItems:"center",children:[r.jsx(OF,{}),r.jsx(VF,{}),r.jsx(rt,{}),r.jsxs(A,{alignItems:"center",h:"full",children:[r.jsx(KF,{}),r.jsx(WF,{}),r.jsx(GF,{})]}),r.jsx(Pt,{orientation:"vertical"}),r.jsxs(A,{alignItems:"center",h:"full",children:[r.jsx(UF,{}),r.jsx(YF,{}),r.jsx(HF,{}),r.jsx(zF,{}),r.jsx(kF,{})]})]})));JF.displayName="CanvasToolbar";const Fve=$e.enum(["fill","contain","cover"]),eB=u.memo(({adapter:e})=>{const{t}=M(),[n,s]=u.useState("contain"),i=ce(e.transformer.$isProcessing),o=u.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}Ge(!1)},[e.transformer,n]),a=u.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),l=u.useMemo(()=>a.find(d=>d.value===n)??null,[a,n]),c=u.useCallback(d=>{d&&s(Fve.parse(d.value))},[]);return r.jsxs(A,{gap:4,w:"full",children:[r.jsxs(Z,{maxW:64,children:[r.jsx(te,{m:0,children:t("controlLayers.transform.fitMode")}),r.jsx(Fe,{options:a,value:l,onChange:c,isSearchable:!1,isClearable:!1})]}),r.jsx(ye,{size:"sm",onClick:o,isDisabled:i,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});eB.displayName="TransformFitToBboxButtons";const tB=u.memo(({adapter:e})=>{const{t}=M(),n=u.useRef(null);ta("canvas",n,{focusOnMount:!0});const s=Os("canvas"),i=ce(e.transformer.$isProcessing),o=ce(e.transformer.$silentTransform);return Le({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),Le({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),o?null:r.jsxs(A,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Rt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),r.jsx(rt,{}),r.jsx(ov,{})]}),r.jsx(eB,{adapter:e}),r.jsxs(Cs,{isAttached:!1,size:"sm",w:"full",alignItems:"center",children:[i&&r.jsx(rr,{ms:3,boxSize:5,color:"base.600"}),r.jsx(rt,{}),r.jsx(ye,{onClick:e.transformer.resetTransform,isDisabled:i,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),r.jsx(ye,{onClick:e.transformer.applyTransform,isDisabled:i,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),r.jsx(ye,{onClick:e.transformer.stopTransform,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});tB.displayName="TransformContent";const Bve=()=>{const e=Et(),t=ce(e.stateApi.$transformingAdapter);return t?r.jsx(tB,{adapter:t}):null},nB=u.memo(()=>{const{t:e}=M(),t=z(),n=I(cM),s=I(GS),i=u.useCallback(()=>{t(Yv("slider"))},[t]),o=u.useCallback(()=>{t(Yv("side-by-side"))},[t]),a=u.useCallback(()=>{t(Yv("hover"))},[t]),l=u.useCallback(()=>{t(GY())},[t]);Le({id:"swapImages",category:"viewer",callback:l,dependencies:[l]});const c=u.useCallback(()=>{t(zY(s==="contain"?"fill":"contain"))},[t,s]),d=u.useCallback(()=>{t(gp(null))},[t]);Ii("esc",d,[d]);const h=u.useCallback(()=>{t(HY())},[t]);return Le({id:"nextComparisonMode",category:"viewer",callback:h,dependencies:[h]}),r.jsxs(A,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(A,{flex:1,justifyContent:"center",children:r.jsxs(A,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(oe,{icon:r.jsx(uae,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:l,variant:"link",alignSelf:"stretch"}),n!=="side-by-side"&&r.jsx(oe,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:c,colorScheme:s==="fill"?"invokeBlue":"base",variant:"link",alignSelf:"stretch",icon:r.jsx(Ay,{})})]})}),r.jsx(A,{flex:1,justifyContent:"center",children:r.jsxs(Cs,{variant:"outline",alignItems:"center",children:[r.jsx(ye,{flexShrink:0,onClick:i,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),r.jsx(ye,{flexShrink:0,onClick:o,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),r.jsx(ye,{flexShrink:0,onClick:a,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),r.jsx(A,{flex:1,justifyContent:"center",children:r.jsxs(A,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[r.jsx(De,{label:r.jsx($ve,{}),children:r.jsx(A,{alignItems:"center",children:r.jsx(dt,{boxSize:6,color:"base.300",as:ole,lineHeight:0})})}),r.jsx(ye,{variant:"link",alignSelf:"stretch",px:2,"aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:d,children:e("gallery.exitCompare")})]})})]})});nB.displayName="CompareToolbar";const $ve=()=>r.jsxs(Pi,{children:[r.jsx(Vt,{children:r.jsx(Jt,{i18nKey:"gallery.compareHelp1",components:{Kbd:r.jsx(Hh,{})}})}),r.jsx(Vt,{children:r.jsx(Jt,{i18nKey:"gallery.compareHelp2",components:{Kbd:r.jsx(Hh,{})}})}),r.jsx(Vt,{children:r.jsx(Jt,{i18nKey:"gallery.compareHelp3",components:{Kbd:r.jsx(Hh,{})}})}),r.jsx(Vt,{children:r.jsx(Jt,{i18nKey:"gallery.compareHelp4",components:{Kbd:r.jsx(Hh,{})}})})]}),Vve=()=>{const{t:e}=M(),t=ce(uM),[n,s]=u.useState(null);return u.useEffect(()=>{if(!t){s(null);return}if(t&&!t.startsWith("Loading model")){s(null);return}const i=setTimeout(()=>{s(`${e("common.loadingModel")}...`)},5e3);return()=>clearTimeout(i)},[t,e]),n},sB=u.memo(()=>{const{t:e}=M(),t=ce(uM);return t?r.jsxs(zu,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hu,{}),r.jsx(X1,{children:e("common.generating")}),r.jsx(J1,{children:t})]}):null});sB.displayName="CanvasAlertsInvocationProgressContentLocal";const rB=u.memo(()=>{const e=Vve();return e?r.jsxs(zu,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hu,{}),r.jsx(J1,{children:e})]}):null});rB.displayName="CanvasAlertsInvocationProgressContentCommercial";const mk=u.memo(()=>{const e=I(dM);return I(hM)?e?r.jsx(sB,{}):null:r.jsx(rB,{})});mk.displayName="CanvasAlertsInvocationProgress";function Gve(){return{x:0,y:0}}function iB(e){var t=e.render,n=e.nativeSetDragImage,s=e.getOffset,i=s===void 0?Gve:s,o=document.createElement("div");Object.assign(o.style,{position:"fixed",top:0,left:0,zIndex:TD,pointerEvents:"none"}),document.body.append(o);var a=t({container:o});queueMicrotask(function(){var d=i({container:o});if(sd()){var h=o.getBoundingClientRect();if(h.width===0)return;o.style.left="-".concat(h.width-1e-4,"px")}n==null||n(o,d.x,d.y)});function l(){c(),a==null||a(),document.body.removeChild(o)}var c=to({onDragStart:l,onDrop:l})}const s1=32;function oB({element:e,input:t}){return({container:n})=>{const s=e.getBoundingClientRect(),i=n.getBoundingClientRect();let o=t.clientX-s.x,a=t.clientY-s.y;return(a>i.height||o>i.width)&&(o=i.width/2,a=i.height/2),{x:o,y:a}}}function aB(e,t){e.animate([{backgroundColor:t},{}],{duration:700,easing:"cubic-bezier(0.25, 0.1, 0.25, 1.0)",iterations:1})}const gd=e=>{if(!navigator.userAgent.includes("Firefox"))return UE;const t=new AbortController;return e.addEventListener("mouseover",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","false")},{signal:t.signal}),e.addEventListener("mouseout",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","true")},{signal:t.signal}),()=>{e.setAttribute("draggable","true"),t.abort()}},zve=Qo("img"),lB=u.memo(({imageDTO:e})=>r.jsx(A,{w:s1,h:s1,children:r.jsx(zve,{margin:"auto",maxW:"full",maxH:"full",objectFit:"contain",borderRadius:"base",src:e.thumbnail_url})}));lB.displayName="DndDragPreviewSingleImage";const cB=e=>nc.createPortal(r.jsx(lB,{imageDTO:e.imageDTO}),e.container),uB=({singleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;iB({render({container:a}){return n({type:"single-image",container:a,imageDTO:e.payload.imageDTO}),()=>n(null)},nativeSetDragImage:s,getOffset:oB({element:i.element,input:o.current.input})})},Hve={objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base",cursor:"grab","&[data-is-dragging=true]":{opacity:.3}},tl=u.memo(({imageDTO:e,asThumbnail:t,...n})=>{const s=jn(),[i,o]=u.useState(!1),[a,l]=u.useState(null),[c,d]=u.useState(null);return u.useEffect(()=>{if(a)return Hn(gd(a),rd({element:a,getInitialData:()=>wn.getData({imageDTO:e},e.image_name),onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)},onGenerateDragPreview:h=>{wn.typeGuard(h.source.data)&&uB({singleImageDndData:h.source.data,onGenerateDragPreviewArgs:h,setDragPreviewState:d})}}))},[e,a,s]),zR(e,a),r.jsxs(r.Fragment,{children:[r.jsx(dn,{role:"button",ref:l,src:t?e.thumbnail_url:e.image_url,fallbackSrc:t?void 0:e.thumbnail_url,w:e.width,sx:Hve,"data-is-dragging":i,...n}),(c==null?void 0:c.type)==="single-image"?cB(c):null]})});tl.displayName="DndImage";const dB=e=>{const t=I(WY),[n]=Ju(e!=null&&e.has_workflow?e.image_name:null,t);return UY(n??ws)};var ex={},kh={},tx={},fT;function yk(){return fT||(fT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))}(tx)),tx}var nx={},pT;function vk(){return pT||(pT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))}(nx)),nx}var sx={},gT;function bk(){return gT||(gT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))}(sx)),sx}var mT;function xk(){if(mT)return kh;mT=1,Object.defineProperty(kh,"__esModule",{value:!0}),kh.FracturedJsonOptions=void 0;const e=yk(),t=vk(),n=bk();let s=class{constructor(){this.JsonEolStyle=e.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=n.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=t.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}};return kh.FracturedJsonOptions=s,kh}var _h={},yT;function md(){if(yT)return _h;yT=1,Object.defineProperty(_h,"__esModule",{value:!0}),_h.FracturedJsonError=void 0;let e=class extends Error{constructor(n,s){const i=s?`${n} at idx=${s.Index}, row=${s.Row}, col=${s.Column}`:n;super(i),this.InputPosition=s}};return _h.FracturedJsonError=e,_h}var Ih={},Ah={},vT;function Wve(){if(vT)return Ah;vT=1,Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.StringJoinBuffer=void 0;let e=class{constructor(n){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=n}Add(...n){return this._lineBuff.push(...n),this}EndLine(n){return this.AddLineToWriter(n),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(n){if(this._lineBuff.length===0&&n.length===0)return;let s=this._lineBuff.join("");this._trimTrailingWhitespace&&(s=s.trimEnd()),this._docBuff.push(s+n),this._lineBuff=[]}};return Ah.StringJoinBuffer=e,Ah}var Th={},rx={},bT;function Ck(){return bT||(bT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))}(rx)),rx}var ix={},xT;function yd(){return xT||(xT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))}(ix)),ix}var CT;function Uve(){if(CT)return Th;CT=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.PaddedFormattingTokens=void 0;const e=Ck(),t=yk(),n=yd();let s=class{constructor(o,a){this._arrStart=[],this._arrStart[e.BracketPaddingType.Empty]="[",this._arrStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"[ ":"[",this._arrStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[e.BracketPaddingType.Empty]="]",this._arrEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" ]":"]",this._arrEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[e.BracketPaddingType.Empty]="{",this._objStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"{ ":"{",this._objStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[e.BracketPaddingType.Empty]="}",this._objEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" }":"}",this._objEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" }":"}",this._comma=o.CommaPadding?", ":",",this._colon=o.ColonPadding?": ":":",this._comment=o.CommentPadding?" ":"",this._eol=o.JsonEolStyle===t.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(a),this._arrEndLen=this._arrEnd.map(a),this._objStartLen=this._objStart.map(a),this._objEndLen=this._objEnd.map(a),this._indentStrings=["",o.UseTabToIndent?"	":" ".repeat(o.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=a(this._comma),this._colonLen=a(this._colon),this._commentLen=a(this._comment),this._literalNullLen=a("null"),this._literalTrueLen=a("true"),this._literalFalseLen=a("false"),this._prefixStringLen=a(o.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(o){return this._arrStart[o]}ArrEnd(o){return this._arrEnd[o]}ObjStart(o){return this._objStart[o]}ObjEnd(o){return this._objEnd[o]}Start(o,a){return o===n.JsonItemType.Array?this.ArrStart(a):this.ObjStart(a)}End(o,a){return o===n.JsonItemType.Array?this.ArrEnd(a):this.ObjEnd(a)}ArrStartLen(o){return this._arrStartLen[o]}ArrEndLen(o){return this._arrEndLen[o]}ObjStartLen(o){return this._objStartLen[o]}ObjEndLen(o){return this._objEndLen[o]}StartLen(o,a){return o===n.JsonItemType.Array?this.ArrStartLen(a):this.ObjStartLen(a)}EndLen(o,a){return o===n.JsonItemType.Array?this.ArrEndLen(a):this.ObjEndLen(a)}Indent(o){if(o>=this._indentStrings.length)for(let a=this._indentStrings.length;a<=o;++a)this._indentStrings.push(this._indentStrings[a-1]+this._indentStrings[1]);return this._indentStrings[o]}Spaces(o){if(o>=this._spaceStrings.length)for(let a=this._spaceStrings.length;a<=o;++a)this._spaceStrings.push(" ".repeat(a));return this._spaceStrings[o]}};return Th.PaddedFormattingTokens=s,Th}var Eh={},ST;function qve(){if(ST)return Eh;ST=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.TableTemplate=void 0;const e=yd(),t=Ck(),n=bk();let s=class Oc{constructor(o,a){this.LocationInParent=void 0,this.Type=e.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=t.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=o,this._numberListAlignment=a,this.AllowNumberNormalization=a===n.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(o){for(const a of o.Children)this.MeasureRowSegment(a);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(o){for(let a=this.GetTemplateComplexity();a>=0;--a){if(this.TotalLength<=o)return!0;this.PruneAndRecompute(a-1)}return!1}FormatNumber(o,a){const l=this._numberListAlignment===n.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?n.NumberListAlignment.Left:this._numberListAlignment;switch(l){case n.NumberListAlignment.Left:o.Add(a.Value,this._pads.Spaces(this.SimpleValueLength-a.ValueLength));return;case n.NumberListAlignment.Right:o.Add(this._pads.Spaces(this.SimpleValueLength-a.ValueLength),a.Value);return}let c,d,h,f;if(l===n.NumberListAlignment.Normalize){if(a.Type===e.JsonItemType.Null){o.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-a.ValueLength),a.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}c=this._maxDigBeforeDecNorm,d=this._maxDigAfterDecNorm,h=Number(a.Value).toFixed(d),f=h.length}else c=this._maxDigBeforeDecRaw,d=this._maxDigAfterDecRaw,h=a.Value,f=a.ValueLength;let p,g;const m=h.search(Oc._dotOrE);m>0?(p=c-m,g=this.CompositeValueLength-p-f):(p=c-f,g=this.CompositeValueLength-c),o.Add(this._pads.Spaces(p),h,this._pads.Spaces(g))}MeasureRowSegment(o){if(!(o.Type===e.JsonItemType.BlankLine||o.Type===e.JsonItemType.BlockComment||o.Type===e.JsonItemType.LineComment)&&(o.Type===e.JsonItemType.False||o.Type===e.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.True||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.True,this.IsNumberList=!1):o.Type===e.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.Number||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.Number):o.Type===e.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===o.Type||this.Type===e.JsonItemType.Null),this.Type===e.JsonItemType.Null&&(this.Type=o.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!o.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,o.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,o.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,o.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,o.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,o.PostfixCommentLength),o.Complexity>=2&&(this.PadType=t.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(o.Type===e.JsonItemType.Array)for(let a=0;a<o.Children.length;++a)this.Children.length<=a&&this.Children.push(new Oc(this._pads,this._numberListAlignment)),this.Children[a].MeasureRowSegment(o.Children[a]);else if(o.Type===e.JsonItemType.Object){if(this.ContainsDuplicateKeys(o.Children)){this.IsRowDataCompatible=!1;return}for(const a of o.Children){let l=this.Children.find(c=>c.LocationInParent===a.Name);l||(l=new Oc(this._pads,this._numberListAlignment),l.LocationInParent=a.Name,this.Children.push(l)),l.MeasureRowSegment(a)}}else if(o.Type===e.JsonItemType.Number&&this.IsNumberList){const l=Number(o.Value),c=l.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(l)&&l!==1/0&&l!==-1/0&&c.length<=15&&c.indexOf("e")<0&&(l!==0||Oc._trulyZeroValString.test(o.Value)));const d=c.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,d>=0?d:c.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,d>=0?c.length-d-1:0);const h=o.Value.search(Oc._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,h>=0?h:o.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,h>=0?o.ValueLength-h-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(o){(o<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const a of this.Children)a.PruneAndRecompute(o-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const a=this.Children.map(l=>l.TotalLength).reduce((l,c)=>l+c);this.CompositeValueLength=a+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const o=this.Children.map(a=>a.GetTemplateComplexity());return 1+Math.max(...o)}ContainsDuplicateKeys(o){const a=o.map(l=>l.Name);return a.some((l,c)=>a.indexOf(l)!==c)}GetNumberFieldWidth(){if(this._numberListAlignment===n.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const o=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+o+this._maxDigAfterDecNorm}else if(this._numberListAlignment===n.NumberListAlignment.Decimal){const o=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+o+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return Eh.TableTemplate=s,s._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),s._dotOrE=new RegExp("[.eE]"),Eh}var Mh={},Ph={},wT;function Kve(){if(wT)return Ph;wT=1,Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.TokenEnumerator=void 0;const e=md();let t=class{constructor(s){this._generator=s}get Current(){if(!this._current)throw new e.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const s=this._generator.next();return this._current=s.value,!s.done}};return Ph.TokenEnumerator=t,Ph}var Lh={},jT;function hB(){if(jT)return Lh;jT=1,Object.defineProperty(Lh,"__esModule",{value:!0}),Lh.JsonItem=void 0;const e=yd();let t=class{constructor(){this.Type=e.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return Lh.JsonItem=t,Lh}var ox={},kT;function fB(){return kT||(kT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))}(ox)),ox}var Dh={},Rh={},_T;function Zve(){if(_T)return Rh;_T=1,Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.ScannerState=void 0;const e=md();let t=class{constructor(i){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=i}Advance(i){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!i)}NewLine(){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(i,o=!1){const a=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:i,Text:o?a.trimEnd():a,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(i,o){return{Type:i,Text:o,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(i){throw new e.FracturedJsonError(i,this.CurrentPosition)}};Rh.ScannerState=t;const n=2e9;return Rh}var IT;function Yve(){if(IT)return Dh;IT=1,Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.TokenGenerator=void 0;const e=Zve(),t=fB();function*n(B){const U=new e.ScannerState(B);for(;;){if(U.AtEnd())return;const ie=U.Current();switch(ie){case c:case f:case h:U.Advance(!0);break;case d:U.NonWhitespaceSinceLastNewline||(yield U.MakeToken(t.TokenType.BlankLine,`
`)),U.NewLine(),U.SetTokenStart();break;case b:yield s(U,"{",t.TokenType.BeginObject);break;case C:yield s(U,"}",t.TokenType.EndObject);break;case v:yield s(U,"[",t.TokenType.BeginArray);break;case x:yield s(U,"]",t.TokenType.EndArray);break;case S:yield s(U,":",t.TokenType.Colon);break;case w:yield s(U,",",t.TokenType.Comma);break;case se:yield i(U,"true",t.TokenType.True);break;case $:yield i(U,"false",t.TokenType.False);break;case ee:yield i(U,"null",t.TokenType.Null);break;case p:yield o(U);break;case y:yield a(U);break;case P:yield l(U);break;default:H(ie)||U.Throw("Unexpected character"),yield l(U);break}}}Dh.TokenGenerator=n;function s(B,U,ie){B.SetTokenStart();const de=B.MakeToken(ie,U);return B.Advance(!1),de}function i(B,U,ie){B.SetTokenStart();for(let be=1;be<U.length;++be)B.AtEnd()&&B.Throw("Unexpected end of input while processing keyword"),B.Advance(!1),B.Current()!==U.charCodeAt(be)&&B.Throw("Unexpected keyword");const de=B.MakeToken(ie,U);return B.Advance(!1),de}function o(B){B.SetTokenStart(),B.AtEnd()&&B.Throw("Unexpected end of input while processing comment"),B.Advance(!1);let U=!1;B.Current()===g?U=!0:B.Current()!==p&&B.Throw("Bad character for start of comment"),B.Advance(!1);let ie=!1;for(;;){if(B.AtEnd())if(U)B.Throw("Unexpected end of input while processing comment");else return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);const de=B.Current();if(de===d){if(B.NewLine(),!U)return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);continue}if(B.Advance(!1),de===p&&ie)return B.MakeTokenFromBuffer(t.TokenType.BlockComment);ie=de===g}}function a(B){B.SetTokenStart(),B.Advance(!1);let U=!1,ie=0;for(;;){B.AtEnd()&&B.Throw("Unexpected end of input while processing string");const de=B.Current();if(ie>0){V(de)||B.Throw("Bad unicode escape in string"),ie-=1,B.Advance(!1);continue}if(U){Y(de)||B.Throw("Bad escaped character in string"),de===ne&&(ie=4),U=!1,B.Advance(!1);continue}if(W(de)&&B.Throw("Control characters are not allowed in strings"),B.Advance(!1),de===y)return B.MakeTokenFromBuffer(t.TokenType.String);de===m&&(U=!0)}}function l(B){B.SetTokenStart();let U=J.Beginning;for(;;){const ie=B.Current();let de=N.ValidAndConsumed;switch(U){case J.Beginning:ie===P?U=J.PastLeadingSign:ie===L?U=J.PastWhole:H(ie)?U=J.PastFirstDigitOfWhole:de=N.InvalidatesToken;break;case J.PastLeadingSign:H(ie)?ie===L?U=J.PastWhole:U=J.PastFirstDigitOfWhole:de=N.InvalidatesToken;break;case J.PastFirstDigitOfWhole:ie===T?U=J.PastDecimalPoint:ie===R||ie===D?U=J.PastE:H(ie)||(de=N.StartOfNewToken);break;case J.PastWhole:ie===T?U=J.PastDecimalPoint:ie===R||ie===D?U=J.PastE:de=N.StartOfNewToken;break;case J.PastDecimalPoint:H(ie)?U=J.PastFirstDigitOfFractional:de=N.InvalidatesToken;break;case J.PastFirstDigitOfFractional:ie===R||ie===D?U=J.PastE:H(ie)||(de=N.StartOfNewToken);break;case J.PastE:ie===j||ie===P?U=J.PastExpSign:H(ie)?U=J.PastFirstDigitOfExponent:de=N.InvalidatesToken;break;case J.PastExpSign:H(ie)?U=J.PastFirstDigitOfExponent:de=N.InvalidatesToken;break;case J.PastFirstDigitOfExponent:H(ie)||(de=N.StartOfNewToken);break}if(de===N.InvalidatesToken&&B.Throw("Bad character while processing number"),de===N.StartOfNewToken)return B.MakeTokenFromBuffer(t.TokenType.Number);if(!B.AtEnd()){B.Advance(!1);continue}switch(U){case J.PastFirstDigitOfWhole:case J.PastWhole:case J.PastFirstDigitOfFractional:case J.PastFirstDigitOfExponent:return B.MakeTokenFromBuffer(t.TokenType.Number);default:B.Throw("Unexpected end of input while processing number");break}}}const c=32,d=10,h=13,f=9,p=47,g=42,m=92,y=34,b=123,C=125,v=91,x=93,S=58,w=44,j=43,P=45,T=46,L=48,E=57,O=97,F=65,_=98,R=101,D=69,$=102,G=70,ee=110,Q=114,se=116,ne=117;function H(B){return B>=L&&B<=E}function V(B){return B>=L&&B<=E||B>=O&&B<=$||B>=F&&B<=G}function Y(B){switch(B){case y:case m:case p:case _:case $:case ee:case Q:case se:case ne:return!0;default:return!1}}function W(B){return B>=0&&B<=31||B===127||B>=128&&B<=159}var J;(function(B){B[B.Beginning=0]="Beginning",B[B.PastLeadingSign=1]="PastLeadingSign",B[B.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",B[B.PastWhole=3]="PastWhole",B[B.PastDecimalPoint=4]="PastDecimalPoint",B[B.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",B[B.PastE=6]="PastE",B[B.PastExpSign=7]="PastExpSign",B[B.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(J||(J={}));var N;return function(B){B[B.InvalidatesToken=0]="InvalidatesToken",B[B.ValidAndConsumed=1]="ValidAndConsumed",B[B.StartOfNewToken=2]="StartOfNewToken"}(N||(N={})),Dh}var AT;function Xve(){if(AT)return Mh;AT=1,Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.Parser=void 0;const e=xk(),t=Kve(),n=hB(),s=yd(),i=fB(),o=md(),a=vk(),l=Yve();let c=class Nc{constructor(){this.Options=new e.FracturedJsonOptions}ParseTopLevel(p,g){const m=new t.TokenEnumerator((0,l.TokenGenerator)(p));return this.ParseTopLevelFromEnum(m,g)}ParseTopLevelFromEnum(p,g){const m=[];let y=!1;for(;;){if(!p.MoveNext())return m;const b=this.ParseItem(p),C=b.Type===s.JsonItemType.BlockComment||b.Type===s.JsonItemType.LineComment;if(b.Type===s.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&m.push(b);else if(C){if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",b.InputPosition);this.Options.CommentPolicy===a.CommentPolicy.Preserve&&m.push(b)}else{if(g&&y)throw new o.FracturedJsonError("Unexpected start of second top level element",b.InputPosition);m.push(b),y=!0}}}ParseItem(p){switch(p.Current.Type){case i.TokenType.BeginArray:return this.ParseArray(p);case i.TokenType.BeginObject:return this.ParseObject(p);default:return this.ParseSimple(p.Current)}}ParseSimple(p){const g=new n.JsonItem;return g.Type=Nc.ItemTypeFromTokenType(p),g.Value=p.Text,g.InputPosition=p.InputPosition,g.Complexity=0,g}ParseArray(p){if(p.Current.Type!==i.TokenType.BeginArray)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition;let m,y=-1,b;const C=[];let v=d.EmptyCollection,x=!1,S=0;for(;!x;){const j=Nc.GetNextTokenOrThrow(p,g);switch(b&&((b==null?void 0:b.InputPosition.Row)!==j.InputPosition.Row||j.Type===i.TokenType.EndArray)&&(m?(m.PostfixComment=b.Value,m.IsPostCommentLineStyle=b.Type===s.JsonItemType.LineComment):C.push(b),b=void 0),m&&y!==j.InputPosition.Row&&(m=void 0),j.Type){case i.TokenType.EndArray:if(v===d.CommaSeen&&!this.Options.AllowTrailingCommas)throw new o.FracturedJsonError("Array may not end with a comma with current options",j.InputPosition);x=!0;break;case i.TokenType.Comma:if(v!==d.ElementSeen)throw new o.FracturedJsonError("Unexpected comma in array",j.InputPosition);v=d.CommaSeen;break;case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(j));break;case i.TokenType.BlockComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);b&&(C.push(b),b=void 0);const T=this.ParseSimple(j);if(Nc.IsMultilineComment(T)){C.push(T);break}if(m&&v===d.ElementSeen){m.PostfixComment=T.Value,m.IsPostCommentLineStyle=!1,m=void 0;break}b=T;break;case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);if(b){C.push(b),C.push(this.ParseSimple(j)),b=void 0;break}if(m){m.PostfixComment=j.Text,m.IsPostCommentLineStyle=!0,m=void 0;break}C.push(this.ParseSimple(j));break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.String:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(v===d.ElementSeen)throw new o.FracturedJsonError("Comma missing while processing array",j.InputPosition);const L=this.ParseItem(p);v=d.ElementSeen,S=Math.max(S,L.Complexity+1),b&&(L.PrefixComment=b.Value,b=void 0),C.push(L),m=L,y=p.Current.InputPosition.Row;break;default:throw new o.FracturedJsonError("Unexpected token in array",j.InputPosition)}}const w=new n.JsonItem;return w.Type=s.JsonItemType.Array,w.InputPosition=g,w.Complexity=S,w.Children=C,w}ParseObject(p){if(p.Current.Type!==i.TokenType.BeginObject)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition,m=[];let y,b,C=-1,v=[],x=[],S,w=!1,j=h.BeforePropName,P=0,T=!1;for(;!T;){const E=Nc.GetNextTokenOrThrow(p,g),O=C!==E.InputPosition.Row,F=E.Type===i.TokenType.EndObject,_=E.Type===i.TokenType.String&&j===h.AfterComma,R=S&&(E.Type===i.TokenType.BlockComment||E.Type===i.TokenType.LineComment);if(y&&b&&(O||F||_||R)){let $;_&&w&&!O&&($=S,S=void 0),Nc.AttachObjectValuePieces(m,y,b,C,v,x,S),P=Math.max(P,b.Complexity+1),y=void 0,b=void 0,v=[],x=[],S=void 0,$&&v.push($)}switch(E.Type){case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||j===h.AfterPropName||j===h.AfterColon)break;m.push(...v),v=[],m.push(this.ParseSimple(E));break;case i.TokenType.BlockComment:case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",E.InputPosition);j===h.BeforePropName||!y?v.push(this.ParseSimple(E)):j===h.AfterPropName||j===h.AfterColon?x.push(E):(S=this.ParseSimple(E),w=j===h.AfterComma);break;case i.TokenType.EndObject:if(j===h.AfterPropName||j===h.AfterColon)throw new o.FracturedJsonError("Unexpected end of object",E.InputPosition);T=!0;break;case i.TokenType.String:if(j===h.BeforePropName||j===h.AfterComma)y=E,j=h.AfterPropName;else if(j===h.AfterColon)b=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;else throw new o.FracturedJsonError("Unexpected string found while processing object",E.InputPosition);break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(j!==h.AfterColon)throw new o.FracturedJsonError("Unexpected element while processing object",E.InputPosition);b=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;break;case i.TokenType.Colon:if(j!==h.AfterPropName)throw new o.FracturedJsonError("Unexpected colon while processing object",E.InputPosition);j=h.AfterColon;break;case i.TokenType.Comma:if(j!==h.AfterPropValue)throw new o.FracturedJsonError("Unexpected comma while processing object",E.InputPosition);j=h.AfterComma;break;default:throw new o.FracturedJsonError("Unexpected token while processing object",E.InputPosition)}}if(!this.Options.AllowTrailingCommas&&j===h.AfterComma)throw new o.FracturedJsonError("Object may not end with comma with current options",p.Current.InputPosition);const L=new n.JsonItem;return L.Type=s.JsonItemType.Object,L.InputPosition=g,L.Complexity=P,L.Children=m,L}static ItemTypeFromTokenType(p){switch(p.Type){case i.TokenType.False:return s.JsonItemType.False;case i.TokenType.True:return s.JsonItemType.True;case i.TokenType.Null:return s.JsonItemType.Null;case i.TokenType.Number:return s.JsonItemType.Number;case i.TokenType.String:return s.JsonItemType.String;case i.TokenType.BlankLine:return s.JsonItemType.BlankLine;case i.TokenType.BlockComment:return s.JsonItemType.BlockComment;case i.TokenType.LineComment:return s.JsonItemType.LineComment;default:throw new o.FracturedJsonError("Unexpected Token",p.InputPosition)}}static GetNextTokenOrThrow(p,g){if(!p.MoveNext())throw new o.FracturedJsonError("Unexpected end of input while processing array or object starting",g);return p.Current}static IsMultilineComment(p){return p.Type===s.JsonItemType.BlockComment&&p.Value.includes(`
`)}static AttachObjectValuePieces(p,g,m,y,b,C,v){if(m.Name=g.Text,C.length>0){let x="";for(let S=0;S<C.length;++S)x+=C[S].Text,(S<C.length-1||C[S].Type===i.TokenType.LineComment)&&(x+=`
`);m.MiddleComment=x}if(b.length>0){const x=b.pop();x.Type===s.JsonItemType.BlockComment&&x.InputPosition.Row===m.InputPosition.Row?(m.PrefixComment=x.Value,p.push(...b)):(p.push(...b),p.push(x))}p.push(m),v&&(!this.IsMultilineComment(v)&&v.InputPosition.Row===y?(m.PostfixComment=v.Value,m.IsPostCommentLineStyle=v.Type===s.JsonItemType.LineComment):p.push(v))}};Mh.Parser=c;var d;(function(f){f[f.EmptyCollection=0]="EmptyCollection",f[f.ElementSeen=1]="ElementSeen",f[f.CommaSeen=2]="CommaSeen"})(d||(d={}));var h;return function(f){f[f.BeforePropName=0]="BeforePropName",f[f.AfterPropName=1]="AfterPropName",f[f.AfterColon=2]="AfterColon",f[f.AfterPropValue=3]="AfterPropValue",f[f.AfterComma=4]="AfterComma"}(h||(h={})),Mh}var Oh={},TT;function Qve(){if(TT)return Oh;TT=1,Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.ConvertDataToDom=void 0;const e=hB(),t=yd(),n=md();function s(i,o,a=100){var l;if(a<=0)throw new n.FracturedJsonError("Depth limit exceeded - possible circular reference");const c=typeof i;switch(c){case"function":case"symbol":case"undefined":return}if(i&&i.toJSON){const h=JSON.parse(JSON.stringify(i));return s(h,o,a-1)}const d=new e.JsonItem;if(d.Name=o?JSON.stringify(o):"",i===null)d.Type=t.JsonItemType.Null,d.Value="null";else if(Array.isArray(i)){d.Type=t.JsonItemType.Array,d.Children=i.map(h=>{var f;return(f=s(h,void 0,a-1))!==null&&f!==void 0?f:s(null,void 0,a-1)}),d.Children=[];for(let h=0;h<i.length;++h)d.Children[h]=(l=s(i[h],void 0,a-1))!==null&&l!==void 0?l:s(null,void 0,a-1)}else if(c==="object"){d.Type=t.JsonItemType.Object;for(const h of Object.entries(i)){const f=s(h[1],h[0],a-1);f&&d.Children.push(f)}}else{switch(c){case"string":d.Type=t.JsonItemType.String;break;case"number":case"bigint":d.Type=t.JsonItemType.Number;break;case"boolean":d.Type=i?t.JsonItemType.True:t.JsonItemType.False;break}d.Value=JSON.stringify(i)}if(d.Children.length>0){const h=d.Children.map(f=>f.Complexity).reduce((f,p)=>Math.max(f,p));d.Complexity=h+1}return d}return Oh.ConvertDataToDom=s,Oh}var ET;function Jve(){if(ET)return Ih;ET=1,Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.Formatter=void 0;const e=xk(),t=Wve(),n=Uve(),s=yd(),i=Ck(),o=qve(),a=md(),l=Xve(),c=Qve();let d=class Is{constructor(){this.Options=new e.FracturedJsonOptions,this.StringLengthFunc=Is.StringLengthByCharCount,this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new n.PaddedFormattingTokens(new e.FracturedJsonOptions,Is.StringLengthByCharCount)}static StringLengthByCharCount(f){return f.length}Reformat(f,p=0){const g=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),m=new l.Parser;m.Options=this.Options;const y=m.ParseTopLevel(f,!0);return this.FormatTopLevel(y,p,g),g.Flush(),g.AsString()}Serialize(f,p=0,g=100){const m=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),y=(0,c.ConvertDataToDom)(f,void 0,g);if(y)return this.FormatTopLevel([y],p,m),m.Flush(),m.AsString()}Minify(f){const p=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),g=new l.Parser;g.Options=this.Options;const m=g.ParseTopLevel(f,!0);return this.MinifyTopLevel(m,p),p.Flush(),p.AsString()}FormatTopLevel(f,p,g){this._buffer=g,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const m of f)this.ComputeItemLengths(m),this.FormatItem(m,p,!1);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(f,p){this._buffer=p,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let g=!0;for(const m of f)g=this.MinifyItem(m,g);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(f){const p=`
`;for(const g of f.Children)this.ComputeItemLengths(g);switch(f.Type){case s.JsonItemType.Null:f.ValueLength=this._pads.LiteralNullLen;break;case s.JsonItemType.True:f.ValueLength=this._pads.LiteralTrueLen;break;case s.JsonItemType.False:f.ValueLength=this._pads.LiteralFalseLen;break;default:f.ValueLength=this.StringLengthFunc(f.Value);break}if(f.NameLength=this.StringLengthFunc(f.Name),f.PrefixCommentLength=this.StringLengthFunc(f.PrefixComment),f.MiddleCommentLength=this.StringLengthFunc(f.MiddleComment),f.PostfixCommentLength=this.StringLengthFunc(f.PostfixComment),f.RequiresMultipleLines=Is.IsCommentOrBlankLine(f.Type)||f.Children.some(g=>g.RequiresMultipleLines||g.IsPostCommentLineStyle)||f.PrefixComment.indexOf(p)>=0||f.MiddleComment.indexOf(p)>=0||f.PostfixComment.indexOf(p)>=0||f.Value.indexOf(p)>=0,f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){const g=Is.GetPaddingType(f);f.ValueLength=this._pads.StartLen(f.Type,g)+this._pads.EndLen(f.Type,g)+f.Children.map(m=>m.MinimumTotalLength).reduce((m,y)=>m+y,0)+Math.max(0,this._pads.CommaLen*(f.Children.length-1))}f.MinimumTotalLength=(f.PrefixCommentLength>0?f.PrefixCommentLength+this._pads.CommentLen:0)+(f.NameLength>0?f.NameLength+this._pads.ColonLen:0)+(f.MiddleCommentLength>0?f.MiddleCommentLength+this._pads.CommentLen:0)+f.ValueLength+(f.PostfixCommentLength>0?f.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(f,p,g){switch(f.Type){case s.JsonItemType.Array:case s.JsonItemType.Object:this.FormatContainer(f,p,g);break;case s.JsonItemType.BlankLine:this.FormatBlankLine();break;case s.JsonItemType.BlockComment:case s.JsonItemType.LineComment:this.FormatStandaloneComment(f,p);break;default:f.RequiresMultipleLines?this.FormatSplitKeyValue(f,p,g):this.FormatInlineElement(f,p,g);break}}FormatContainer(f,p,g){p>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(f,p,g)||this.FormatContainerCompactMultiline(f,p,g))||p>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(f,p,g)||this.FormatContainerExpanded(f,p,g)}FormatContainerInline(f,p,g){if(f.RequiresMultipleLines)return!1;const m=f.MinimumTotalLength+(g?this._pads.CommaLen:0);return f.Complexity>this.Options.MaxInlineComplexity||m>this.AvailableLineSpace(p)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(f,p,g){if(f.Type!==s.JsonItemType.Array||f.Complexity>this.Options.MaxCompactArrayComplexity||f.RequiresMultipleLines)return!1;const m=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);m.MeasureTableRoot(f);const y=this.AvailableLineSpace(p+1);let b=this._pads.CommaLen;if(m.IsRowDataCompatible?b+=m.TotalLength:b+=f.Children.map(S=>S.MinimumTotalLength).reduce((S,w)=>S+w,0)/f.Children.length,b*this.Options.MinCompactArrayRowItems>y)return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty));const v=this.AvailableLineSpace(C+1);let x=-1;for(let S=0;S<f.Children.length;++S){const w=f.Children[S],j=S<f.Children.length-1,P=(j?this._pads.CommaLen:0)+(m.IsRowDataCompatible?m.TotalLength:w.MinimumTotalLength);x<P&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C+1)),x=v),m.IsRowDataCompatible?this.InlineTableRowSegment(m,w,j,!1):this.InlineElement(w,j),x-=P}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerTable(f,p,g){if(f.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const m=this.AvailableLineSpace(p+1)-this._pads.CommaLen;if(f.Children.filter(x=>!Is.IsCommentOrBlankLine(x.Type)).some(x=>x.MinimumTotalLength>m))return!1;const b=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);if(b.MeasureTableRoot(f),!b.IsRowDataCompatible||!b.TryToFit(m))return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const v=Is.IndexOfLastElement(f.Children);for(let x=0;x<f.Children.length;++x){const S=f.Children[x];if(S.Type===s.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(S.Type===s.JsonItemType.LineComment||S.Type===s.JsonItemType.BlockComment){this.FormatStandaloneComment(S,C+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C+1)),this.InlineTableRowSegment(b,S,x<v,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerExpanded(f,p,g){const m=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const y=Is.IndexOfLastElement(f.Children);for(let b=0;b<f.Children.length;++b)this.FormatItem(f.Children[b],m+1,b<y);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(m),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g)}FormatStandaloneComment(f,p){const g=Is.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p),m).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(f,p,g){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(f,p,g){this.StandardFormatStart(f,p),this._buffer.Add(f.Value),this.StandardFormatEnd(f,g)}StandardFormatStart(f,p){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength===0)return p;if(f.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(f.MiddleComment,this._pads.Comment),p;const g=Is.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1),m).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1)),p+1}StandardFormatEnd(f,p){p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(f,p){if(f.RequiresMultipleLines)throw new a.FracturedJsonError("Logic error - trying to inline invalid element");f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(f.MiddleComment,this._pads.Comment),this.InlineElementRaw(f),p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(f){if(f.Type===s.JsonItemType.Array){const p=Is.GetPaddingType(f);this._buffer.Add(this._pads.ArrStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ArrEnd(p))}else if(f.Type===s.JsonItemType.Object){const p=Is.GetPaddingType(f);this._buffer.Add(this._pads.ObjStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ObjEnd(p))}else this._buffer.Add(f.Value)}InlineTableRowSegment(f,p,g,m){f.PrefixCommentLength>0&&this._buffer.Add(p.PrefixComment,this._pads.Spaces(f.PrefixCommentLength-p.PrefixCommentLength),this._pads.Comment),f.NameLength>0&&this._buffer.Add(p.Name,this._pads.Spaces(f.NameLength-p.NameLength),this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(p.MiddleComment,this._pads.Spaces(f.MiddleCommentLength-p.MiddleCommentLength),this._pads.Comment),f.Children.length>0&&p.Type!==s.JsonItemType.Null?f.Type===s.JsonItemType.Array?this.InlineTableRawArray(f,p):this.InlineTableRawObject(f,p):f.IsNumberList?f.FormatNumber(this._buffer,p):(this.InlineElementRaw(p),this._buffer.Add(this._pads.Spaces(f.CompositeValueLength-p.ValueLength)));const y=p.IsPostCommentLineStyle||p.PostfixCommentLength===0;y&&(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma)),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,p.PostfixComment,this._pads.Spaces(f.PostfixCommentLength-p.PostfixCommentLength)),y||(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(f,p){this._buffer.Add(this._pads.ArrStart(f.PadType));for(let g=0;g<f.Children.length;++g){const m=g===f.Children.length-1,y=g===p.Children.length-1,b=g>=p.Children.length,C=f.Children[g];b?(this._buffer.Add(this._pads.Spaces(C.TotalLength)),m||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(C,p.Children[g],!y,!1),y&&!m&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(f.PadType))}InlineTableRawObject(f,p){function g(b){return p.Children.find(C=>C.Name===b.LocationInParent)}const m=f.Children.map(b=>({tt:b,ji:g(b)}));let y=m.length-1;for(;y>=0&&!m[y].ji;)y-=1;this._buffer.Add(this._pads.ObjStart(f.PadType));for(let b=0;b<m.length;++b){const C=m[b].tt,v=m[b].ji,x=b===y,S=b===m.length-1;v?(this.InlineTableRowSegment(C,v,!x,!1),x&&!S&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(C.TotalLength)),S||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(f.PadType))}AvailableLineSpace(f){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*f)}MinifyItem(f,p){const g=`
`;if(this._buffer.Add(f.PrefixComment),f.Name.length>0&&this._buffer.Add(f.Name,":"),f.MiddleComment.indexOf(g)>=0){const m=Is.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);for(const y of m)this._buffer.Add(y,g)}else this._buffer.Add(f.MiddleComment);if(f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){let m;f.Type===s.JsonItemType.Array?(this._buffer.Add("["),m="]"):(this._buffer.Add("{"),m="}");let y=!1,b=!1;for(const C of f.Children)Is.IsCommentOrBlankLine(C.Type)||(y&&this._buffer.Add(","),y=!0),b=this.MinifyItem(C,b);this._buffer.Add(m)}else{if(f.Type===s.JsonItemType.BlankLine)return p||this._buffer.Add(g),this._buffer.Add(g),!0;if(f.Type===s.JsonItemType.LineComment)return p||this._buffer.Add(g),this._buffer.Add(f.Value,g),!0;if(f.Type===s.JsonItemType.BlockComment){if(p||this._buffer.Add(g),f.Value.indexOf(g)>=0){const m=Is.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const y of m)this._buffer.Add(y,g);return!0}return this._buffer.Add(f.Value,g),!0}else this._buffer.Add(f.Value)}return this._buffer.Add(f.PostfixComment),f.PostfixComment.length>0&&f.IsPostCommentLineStyle?(this._buffer.Add(g),!0):!1}static GetPaddingType(f){return f.Children.length===0?i.BracketPaddingType.Empty:f.Complexity>=2?i.BracketPaddingType.Complex:i.BracketPaddingType.Simple}static NormalizeMultilineComment(f,p){const m=f.replace(/\r/g,"").split(`
`).filter(y=>y.length>0);for(let y=1;y<m.length;++y){const b=m[y];let C=0;for(;C<b.length&&C<p&&/\s/.test(b[C]);)C+=1;m[y]=b.substring(C)}return m}static IndexOfLastElement(f){for(let p=f.length-1;p>=0;--p)if(!this.IsCommentOrBlankLine(f[p].Type))return p;return-1}static IsCommentOrBlankLine(f){return f===s.JsonItemType.BlankLine||f===s.JsonItemType.BlockComment||f===s.JsonItemType.LineComment}};return Ih.Formatter=d,Ih}var MT;function ebe(){return MT||(MT=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=xk();Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=vk();Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=yk();Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var i=bk();Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return i.NumberListAlignment}});var o=md();Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return o.FracturedJsonError}});var a=Jve();Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return a.Formatter}})}(ex)),ex}var tbe=ebe();const nbe=new tbe.Formatter,sbe=Co("scroll","scroll").options,rbe=e=>{const{label:t,data:n,fileName:s,withDownload:i=!0,withCopy:o=!0,extraCopyActions:a,...l}=e,c=u.useMemo(()=>(Tf(n)?n:nbe.Serialize(n))??"",[n]),d=Wa(),h=na(),f=u.useCallback(()=>{h.writeText(c)},[h,c]),p=u.useCallback(()=>{const m=new Blob([c]),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download=`${s||t}.json`,document.body.appendChild(y),y.click(),y.remove()},[c,t,s]),{t:g}=M();return r.jsxs(A,{bg:"base.800",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",...l,children:[r.jsx(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:2,fontSize:"sm",children:r.jsx(Ns,{defer:!0,style:ibe,options:sbe,children:r.jsx("pre",{children:c})})}),r.jsxs(A,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[i&&r.jsx(De,{label:`${g("gallery.download")} ${t} JSON`,children:r.jsx(oe,{"aria-label":`${g("gallery.download")} ${t} JSON`,icon:r.jsx(ed,{size:16}),variant:"ghost",opacity:.7,onClick:p})}),o&&r.jsx(De,{label:`${g("gallery.copy")} ${t} JSON`,children:r.jsx(oe,{"aria-label":`${g("gallery.copy")} ${t} JSON`,icon:r.jsx(an,{size:16}),variant:"ghost",opacity:.7,onClick:f})}),d&&(a==null?void 0:a.map(({label:m,getData:y})=>r.jsx(obe,{label:m,getData:y,data:n},m)))]})]})},Yo=u.memo(rbe),ibe={height:"100%",width:"100%"},obe=({label:e,data:t,getData:n})=>{const{t:s}=M(),i=na(),o=u.useCallback(()=>{i.writeText(JSON.stringify(n(t),null,2))},[i,t,n]);return r.jsx(De,{label:`${s("gallery.copy")} ${e} JSON`,children:r.jsx(oe,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:r.jsx(an,{size:16}),variant:"ghost",opacity:.7,onClick:o})})},abe=({image:e})=>{const{t}=M(),{currentData:n}=dB(e),s=u.useMemo(()=>{if(n!=null&&n.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?r.jsx(Yo,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):r.jsx(Ot,{label:t("nodes.noGraph")})},lbe=u.memo(abe),cbe=()=>{const{t:e}=M();return r.jsx(q,{children:e("common.loading")})},ube=()=>{const{t:e}=M();return r.jsx(q,{children:e("metadata.parsingFailed")})},pB=(e,t)=>{const[n,s]=u.useState(xc),[i,o]=u.useState(null);u.useEffect(()=>{(()=>{t.parse(e).then(p=>{s(p)}).catch(()=>{s(dl)})})()},[t,e]);const a=u.useMemo(()=>n===xc||n===dl,[n]),l=u.useMemo(()=>t.getLabel(),[t]);u.useEffect(()=>{(()=>{if(n===xc){o(null);return}if(n===dl){o(null);return}t.renderValue(n).then(p=>{o(p)}).catch(()=>{})})()},[t,n]);const c=u.useMemo(()=>n===xc?r.jsx(cbe,{}):n===dl?r.jsx(ube,{}):r.jsx(q,{children:i}),[i,n]),d=u.useCallback(()=>{if(!t.recall||n===xc||n===dl)return null;t.recall(n,!0).catch(()=>{})},[t,n]),h=u.useMemo(()=>n===xc||n===dl?null:n,[n]);return{label:l,isDisabled:a,value:n,renderedValue:c,onRecall:d,valueOrNull:h}},gB=u.memo(({label:e,...t})=>{const{t:n}=M();return r.jsx(De,{label:n("metadata.recallParameter",{label:e}),children:r.jsx(oe,{"aria-label":n("metadata.recallParameter",{label:e}),icon:r.jsx(ML,{}),size:"xs",variant:"ghost",...t})})});gB.displayName="RecallButton";const Sk=u.memo(({label:e,onRecall:t,isDisabled:n,renderedValue:s,direction:i="row"})=>r.jsxs(A,{gap:2,children:[t&&r.jsx(gB,{label:e,onClick:t,isDisabled:n}),r.jsxs(A,{direction:i,fontSize:"sm",children:[r.jsxs(q,{fontWeight:"semibold",whiteSpace:"pre-wrap",pr:2,children:[e,":"]}),s]})]}));Sk.displayName="MetadataItemView";const dbe=Ip(({metadata:e,handlers:t,direction:n="row"})=>{const{label:s,isDisabled:i,value:o,renderedValue:a,onRecall:l}=pB(e,t);return o===dl||t.getIsVisible&&!qY(o)&&!t.getIsVisible(o)?null:r.jsx(Sk,{label:s,onRecall:l,isDisabled:i,renderedValue:a,direction:n})}),$t=Ip(dbe);$t.displayName="MetadataItem";const hbe=({metadata:e})=>{const[t,n]=u.useState([]);u.useEffect(()=>{(async()=>{try{const o=await pt.loras.parse(e);n(o)}catch{n([])}})()},[e]);const s=u.useMemo(()=>pt.loras.getLabel(),[]);return r.jsx(r.Fragment,{children:t.map(i=>r.jsx(fbe,{label:s,lora:i,handlers:pt.loras},i.model.key))})},fbe=({label:e,lora:t,handlers:n})=>{const s=u.useCallback(()=>{n.recallItem&&n.recallItem(t,!0).catch(()=>{})},[n,t]),[i,o]=u.useState(null);return u.useEffect(()=>{(async()=>{if(!n.renderItemValue){o(null);return}const l=await n.renderItemValue(t);o(l)})()},[n,t]),r.jsx(Sk,{label:e,isDisabled:!1,onRecall:s,renderedValue:i})},pbe=e=>{const t=I(En),{metadata:n}=e;return!n||Object.keys(n).length===0?null:r.jsxs(A,{flexDir:"column",pl:8,children:[r.jsx($t,{metadata:n,handlers:pt.generationMode}),r.jsx($t,{metadata:n,handlers:pt.positivePrompt,direction:"column"}),r.jsx($t,{metadata:n,handlers:pt.negativePrompt,direction:"column"}),r.jsx($t,{metadata:n,handlers:pt.sdxlPositiveStylePrompt,direction:"column"}),r.jsx($t,{metadata:n,handlers:pt.sdxlNegativeStylePrompt,direction:"column"}),r.jsx($t,{metadata:n,handlers:pt.model}),r.jsx($t,{metadata:n,handlers:pt.vae}),r.jsx($t,{metadata:n,handlers:pt.width}),r.jsx($t,{metadata:n,handlers:pt.height}),r.jsx($t,{metadata:n,handlers:pt.seed}),r.jsx($t,{metadata:n,handlers:pt.steps}),r.jsx($t,{metadata:n,handlers:pt.scheduler}),r.jsx($t,{metadata:n,handlers:pt.cfgScale}),r.jsx($t,{metadata:n,handlers:pt.cfgRescaleMultiplier}),r.jsx($t,{metadata:n,handlers:pt.guidance}),t!=="canvas"&&r.jsx($t,{metadata:n,handlers:pt.strength}),r.jsx($t,{metadata:n,handlers:pt.seamlessX}),r.jsx($t,{metadata:n,handlers:pt.seamlessY}),r.jsx($t,{metadata:n,handlers:pt.hrfEnabled}),r.jsx($t,{metadata:n,handlers:pt.hrfMethod}),r.jsx($t,{metadata:n,handlers:pt.hrfStrength}),r.jsx($t,{metadata:n,handlers:pt.refinerCFGScale}),r.jsx($t,{metadata:n,handlers:pt.refinerModel}),r.jsx($t,{metadata:n,handlers:pt.refinerNegativeAestheticScore}),r.jsx($t,{metadata:n,handlers:pt.refinerPositiveAestheticScore}),r.jsx($t,{metadata:n,handlers:pt.refinerScheduler}),r.jsx($t,{metadata:n,handlers:pt.refinerStart}),r.jsx($t,{metadata:n,handlers:pt.refinerSteps}),r.jsx(hbe,{metadata:n})]})},gbe=u.memo(pbe),mbe=({image:e})=>{const{t}=M(),{currentData:n}=dB(e),s=u.useMemo(()=>{if(n!=null&&n.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?r.jsx(Yo,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):r.jsx(Ot,{label:t("nodes.noWorkflow")})},ybe=u.memo(mbe),vbe=({image:e})=>{const{t}=M(),{metadata:n}=eL(e.image_name),s=pB(n,pt.createdBy);return r.jsxs(A,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[r.jsx(Js,{href:e.image_url,label:e.image_name}),s.valueOrNull&&r.jsxs(q,{children:[t("metadata.createdBy"),": ",s.valueOrNull]}),r.jsxs(ec,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(tc,{children:[r.jsx(Sn,{children:t("metadata.recallParameters")}),r.jsx(Sn,{children:t("metadata.metadata")}),r.jsx(Sn,{children:t("metadata.imageDetails")}),r.jsx(Sn,{children:t("metadata.workflow")}),r.jsx(Sn,{children:t("nodes.graph")})]}),r.jsxs(Vu,{children:[r.jsx(Ln,{children:n?r.jsx($n,{children:r.jsx(gbe,{metadata:n})}):r.jsx(Ot,{label:t("metadata.noRecallParameters")})}),r.jsx(Ln,{children:n?r.jsx(Yo,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):r.jsx(Ot,{label:t("metadata.noMetaData")})}),r.jsx(Ln,{children:e?r.jsx(Yo,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):r.jsx(Ot,{label:t("metadata.noImageDetails")})}),r.jsx(Ln,{children:r.jsx(ybe,{image:e})}),r.jsx(Ln,{children:r.jsx(lbe,{image:e})})]})]})]})},bbe=u.memo(vbe),wk=()=>{const e=I(Uu),t=sc(e);return{imageDTOs:u.useMemo(()=>{var s;return((s=t.data)==null?void 0:s.items)??xs},[t.data]),queryResult:t}},AC="gallery-grid",mB=u.memo(({imageDTOs:e})=>{const{t}=M();return r.jsxs(A,{w:s1,h:s1,alignItems:"center",justifyContent:"center",flexDir:"column",bg:"base.900",borderRadius:"base",children:[r.jsx(Rt,{children:e.length}),r.jsx(Rt,{size:"sm",children:t("parameters.images")})]})});mB.displayName="DndDragPreviewMultipleImage";const xbe=e=>nc.createPortal(r.jsx(mB,{imageDTOs:e.imageDTOs}),e.container),Cbe=({multipleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;iB({render({container:a}){return n({type:"multiple-image",container:a,imageDTOs:e.payload.imageDTOs}),()=>n(null)},nativeSetDragImage:s,getOffset:oB({element:i.element,input:o.current.input})})},Sbe={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},Xo=u.memo(e=>{const{onClick:t,tooltip:n,icon:s,...i}=e;return r.jsx(oe,{onClick:t,"aria-label":n,icon:s,variant:"link",sx:Sbe,"data-testid":n,...i})});Xo.displayName="DndImageIcon";const yB=u.memo(({imageDTO:e})=>{const t=Wa(),{t:n}=M(),s=z(),i=u.useCallback(o=>{o.stopPropagation(),e&&s(up([e]))},[s,e]);return t?r.jsx(Xo,{onClick:i,icon:r.jsx(Ry,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});yB.displayName="GalleryImageDeleteIconButton";const vB=u.memo(({imageDTO:e})=>{const t=Lt(),{t:n}=M(),s=u.useCallback(()=>{t.openImageInViewer(e)},[e,t]);return r.jsx(Xo,{onClick:s,icon:r.jsx(Ay,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});vB.displayName="GalleryImageOpenInViewerIconButton";const bB=u.memo(({imageDTO:e})=>r.jsx(q,{className:"gallery-image-size-badge",position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",pointerEvents:"none",children:`${e.width}x${e.height}`}));bB.displayName="GalleryImageSizeBadge";const xB=u.memo(({imageDTO:e})=>{const t=ce(AS),[n]=TS(),[s]=ES(),i=u.useCallback(()=>{e.starred?s({imageDTOs:[e]}):n({imageDTOs:[e]})},[n,s,e]);return t?r.jsx(Xo,{onClick:i,icon:e.starred?t.on.icon:t.off.icon,tooltip:e.starred?t.on.text:t.off.text,position:"absolute",top:2,insetInlineEnd:2}):r.jsx(Xo,{onClick:i,icon:e.starred?r.jsx(Ow,{}):r.jsx(Pw,{}),tooltip:e.starred?"Unstar":"Star",position:"absolute",top:2,insetInlineEnd:2})});xB.displayName="GalleryImageStarIconButton";const CB=u.memo(({imageDTO:e,isHovered:t})=>{const n=I(KY);return r.jsxs(r.Fragment,{children:[(t||n)&&r.jsx(bB,{imageDTO:e}),(t||e.starred)&&r.jsx(xB,{imageDTO:e}),t&&r.jsx(yB,{imageDTO:e}),t&&r.jsx(vB,{imageDTO:e})]})});CB.displayName="GalleryImageHoverIcons";const SB=e=>`gallery-image-${e}`,wB=u.memo(({width:e,height:t})=>r.jsx(IS,{w:`${e}px`,h:"auto",objectFit:"contain",aspectRatio:`${e}/${t}`}));wB.displayName="SizedSkeletonLoader";const jk="gallery-image-container",wbe={containerType:"inline-size",w:"full",h:"full",".gallery-image-size-badge":{"@container (max-width: 80px)":{"&":{display:"none"}}},"&[data-is-dragging=true]":{opacity:.3},".gallery-image":{touchAction:"none",userSelect:"none",webkitUserSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1","::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},"&[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover::before":{boxShadow:"inset 0px 0px 0px 1px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}}},jB=u.memo(({imageDTO:e})=>{const t=jn(),[n,s]=u.useState(!1),[i,o]=u.useState(null),[a,l]=u.useState(null),c=u.useId(),d=u.useMemo(()=>pe(kr,S=>{var w;return((w=S.imageToCompare)==null?void 0:w.image_name)===e.image_name}),[e.image_name]),h=I(d),f=u.useMemo(()=>pe(kr,S=>{for(const w of S.selection)if(w.image_name===e.image_name)return!0;return!1}),[e.image_name]),p=I(f);u.useEffect(()=>{if(a)return Hn(gd(a),rd({element:a,getInitialData:()=>{const{gallery:S}=t.getState();return S.selection.length>1&&S.selection.find(({image_name:w})=>w===e.image_name)!==void 0?Qr.getData({imageDTOs:S.selection,boardId:S.selectedBoardId}):wn.getData({imageDTO:e},e.image_name)},onDragStart:({source:S})=>{if(wn.typeGuard(S.data)){s(!0);return}},onGenerateDragPreview:S=>{Qr.typeGuard(S.source.data)?Cbe({multipleImageDndData:S.source.data,onGenerateDragPreviewArgs:S,setDragPreviewState:o}):wn.typeGuard(S.source.data)&&uB({singleImageDndData:S.source.data,onGenerateDragPreviewArgs:S,setDragPreviewState:o})}}),to({onDragStart:({source:S})=>{Qr.typeGuard(S.data)&&S.data.payload.imageDTOs.includes(e)&&s(!0)},onDrop:()=>{s(!1)}}))},[e,a,t,c]);const[g,m]=u.useState(!1),y=u.useCallback(()=>{m(!0)},[]),b=u.useCallback(()=>{m(!1)},[]),C=u.useCallback(S=>{t.dispatch(ZY({imageDTO:e,shiftKey:S.shiftKey,ctrlKey:S.ctrlKey,metaKey:S.metaKey,altKey:S.altKey}))},[e,t]),v=u.useCallback(()=>{_S.set(!0),t.dispatch(gp(null))},[t]),x=u.useMemo(()=>SB(e.image_name),[e.image_name]);return zR(e,a),r.jsxs(r.Fragment,{children:[r.jsx(Se,{className:jk,sx:wbe,"data-testid":x,"data-is-dragging":n,children:r.jsxs(A,{role:"button",className:"gallery-image",onMouseOver:y,onMouseOut:b,onClick:C,onDoubleClick:v,"data-selected":p,"data-selected-for-compare":h,children:[r.jsx(dn,{ref:l,src:e.thumbnail_url,fallback:r.jsx(wB,{width:e.width,height:e.height}),w:e.width,objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base"}),r.jsx(CB,{imageDTO:e,isHovered:g})]})}),(i==null?void 0:i.type)==="multiple-image"?xbe(i):null,(i==null?void 0:i.type)==="single-image"?cB(i):null]})});jB.displayName="GalleryImage";const jbe=Oe({}),kbe=(e,t)=>e.top>=t.top&&e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right,_be=(e,t)=>e>(t.endIndex-t.startIndex)/2+t.startIndex?"end":"start",r1=()=>{const e=document.querySelector(`.${jk}`),t=document.querySelector(`.${AC}`);if(!e||!t)return 0;const n=t.parentElement;if(!n)return 0;const s=e.getBoundingClientRect(),i=n.getBoundingClientRect(),o=window.getComputedStyle(t),a=parseFloat(o.gap);if(!s.width||!s.height||!i.width||!i.height)return 0;let l=0,c=0;for(;c+s.width<=i.width+1;)l++,c+=s.width,c+a<=i.width&&(c+=a);return l},Ibe=(e,t)=>{var d,h,f;const n=jbe.get(),s=(d=n.virtuosoRangeRef)==null?void 0:d.current,i=(h=n.rootRef)==null?void 0:h.current,o=(f=n.virtuosoRef)==null?void 0:f.current;if(!s||!o||!i)return;const a=document.querySelector(`[data-testid="${SB(e)}"]`),l=a==null?void 0:a.getBoundingClientRect(),c=i.getBoundingClientRect();(!l||!kbe(l,c))&&o.scrollToIndex({index:t,align:_be(t,s)})},Abe=(e,t)=>{const n=co(t-1,0,e.length-1),s=e[n];return{index:n,image:s}},Tbe=(e,t)=>{const n=co(t+1,0,e.length-1),s=e[n];return{index:n,image:s}},Ebe=(e,t)=>{const n=r1(),i=t<n?t:co(t-n,0,e.length-1),o=e[i];return{index:i,image:o}},Mbe=(e,t)=>{const n=r1(),i=t<e.length-n?co(t+n,0,e.length-1):t,o=e[i];return{index:i,image:o}},Pbe={left:Abe,right:Tbe,up:Ebe,down:Mbe},kB=()=>{const e=z(),t=YY(),n=u.useMemo(()=>pe(dp,XY,(S,w)=>t?w??S:S),[t]),s=I(n),{imageDTOs:i}=wk(),o=u.useMemo(()=>i.length,[i.length]),a=u.useMemo(()=>i.length===0||!s?0:i.findIndex(S=>S.image_name===s.image_name),[i,s]),l=u.useCallback((S,w)=>{const{index:j,image:P}=Pbe[S](i,a);!P||j===a||(e(w?gp(P):fM(P)),Ibe(P.image_name,j))},[i,a,e]),c=u.useMemo(()=>a===0,[a]),d=u.useMemo(()=>a===o-1,[a,o]),h=u.useMemo(()=>a<r1(),[a]),f=u.useMemo(()=>a>=o-r1(),[a,o]),p=u.useMemo(()=>a===0,[a]),g=u.useMemo(()=>a===o-1,[a,o]),m=u.useCallback(S=>{l("left",S)},[l]),y=u.useCallback(S=>{l("right",S)},[l]),b=u.useCallback(S=>{l("up",S)},[l]),C=u.useCallback(S=>{l("down",S)},[l]),v=u.useCallback(()=>{y()},[y]),x=u.useCallback(()=>{m()},[m]);return{handleLeftImage:m,handleRightImage:y,handleUpImage:b,handleDownImage:C,isOnFirstImage:c,isOnLastImage:d,isOnFirstRow:h,isOnLastRow:f,nextImage:v,prevImage:x,isOnFirstImageOfView:p,isOnLastImageOfView:g}},Qh=(e,t)=>{const n=t-e+1;return Array.from({length:n},(s,i)=>i+e)},nu="ellipsis",Lbe=(e,t,n)=>{const s=Math.min(2*n+5,t),i=1,o=t,a=Math.max(e-n,i),l=Math.min(e+n,o),c=a>i+1,d=l<o-1,h=s-2;if(!c&&d)return[...Qh(1,h),nu,o];if(c&&!d){const p=Qh(o-h+1,o);return[i,nu,...p]}if(c&&d){const p=Qh(a,l);return[i,nu,...p,nu,o]}return Qh(i,o)},Dbe=pe(kr,e=>e.offset),Rbe=pe(kr,e=>e.limit),uv=()=>{const e=z(),t=I(Dbe),n=I(Rbe),s=I(Uu),{count:i,total:o}=sc(s,{selectFromResult:({data:b})=>({count:(b==null?void 0:b.items.length)??0,total:(b==null?void 0:b.total)??0})}),a=u.useMemo(()=>Math.ceil(t/(n||0)),[t,n]),l=u.useMemo(()=>Math.ceil(o/(n||0)),[o,n]),c=u.useMemo(()=>i?a+1<l:!1,[i,a,l]),d=u.useMemo(()=>i?t>0:!1,[i,t]),h=u.useCallback(b=>{e(pM(b))},[e]),f=u.useMemo(()=>g2(h,500),[h]),p=u.useCallback(b=>{f({offset:t+(n||0),withHotkey:b})},[f,t,n]),g=u.useCallback(b=>{f({offset:Math.max(t-(n||0),0),withHotkey:b})},[f,t,n]),m=u.useCallback(b=>{f({offset:b*(n||0)})},[f,n]);u.useEffect(()=>{l&&a+1>l&&f({offset:(l-1)*(n||0)})},[a,l,f,n]);const y=u.useMemo(()=>l>7?Lbe(a+1,l,1):Qh(1,l),[a,l]);return{goPrev:g,goNext:p,isPrevEnabled:d,isNextEnabled:c,pageButtons:y,goToPage:m,currentPage:a,total:o,pages:l}},Obe=({inset:e=8})=>{const{t}=M(),{prevImage:n,nextImage:s,isOnFirstImageOfView:i,isOnLastImageOfView:o}=kB(),{isFetching:a}=wk().queryResult,{isNextEnabled:l,goNext:c,isPrevEnabled:d,goPrev:h}=uv(),f=u.useMemo(()=>!!(!i||d),[i,d]),p=u.useCallback(()=>{i?d&&!a&&h("arrow"):n()},[h,a,i,d,n]),g=u.useMemo(()=>!!(!o||l),[l,o]),m=u.useCallback(()=>{o?l&&!a&&c("arrow"):s()},[c,a,l,o,s]);return r.jsxs(Se,{pos:"relative",h:"full",w:"full",children:[f&&r.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:r.jsx(Tw,{size:64}),variant:"unstyled",onClick:p,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),g&&r.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:r.jsx(Ty,{size:64}),variant:"unstyled",onClick:m,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},_B=u.memo(Obe),IB=u.memo(e=>r.jsx(dt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));IB.displayName="InvokeLogoIcon";const AB=Symbol("LOADING"),Nbe=()=>{const{data:e,isLoading:t}=Zl({include_archived:!0}),{data:n,isLoading:s}=sc({board_id:"none",offset:0,limit:0,is_intermediate:!1});return u.useMemo(()=>t||s?AB:e&&e.length>0&&e.filter(a=>a.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},TB=u.memo(()=>{const e=Nbe(),[t,{data:n}]=Ky(),s=I(hM),i=en("starterModels"),{t:o}=M(),a=u.useMemo(()=>i&&n&&t.length===0,[t.length,n,i]);return e===AB?r.jsx(Fbe,{}):e?r.jsx(Ot,{icon:wu,label:o("gallery.noImageSelected")}):r.jsxs(A,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",maxW:"600px",children:[r.jsx(IB,{w:32,h:32}),r.jsxs(A,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",children:[s?r.jsx(Bbe,{}):r.jsx($be,{}),a&&r.jsx(Gbe,{}),r.jsx(Pt,{}),r.jsx(Vbe,{}),s&&r.jsx(zbe,{})]})]})});TB.displayName="NoContentForViewer";const Fbe=()=>r.jsx(A,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:r.jsx(rr,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}),kk=e=>r.jsx(ye,{as:oy,variant:"unstyled",isExternal:!0,display:"inline-flex",alignItems:"center",rightIcon:r.jsx(Iy,{}),color:"base.50",mt:-1,...e}),PT=e=>r.jsx(ye,{variant:"link",size:"md",onClick:e.onClick,color:"base.50",children:e.children}),EB=r.jsx(q,{as:"span",color:"base.50",fontSize:"md"}),Bbe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Jt,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:EB}})}),$be=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Jt,{i18nKey:"newUserExperience.toGetStarted",components:{StrongComponent:EB}})}),Vbe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Jt,{i18nKey:"newUserExperience.gettingStartedSeries",components:{LinkComponent:r.jsx(kk,{href:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO"})}})}),Gbe=()=>{const e=z(),t=u.useCallback(()=>{e(Kt("models")),$l.set(3)},[e]),n=u.useCallback(()=>{e(Kt("models")),$l.set(0)},[e]);return r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Jt,{i18nKey:"newUserExperience.noModelsInstalled",components:{DownloadStarterModelsButton:r.jsx(PT,{onClick:t}),ImportModelsButton:r.jsx(PT,{onClick:n})}})})},zbe=()=>r.jsxs(zu,{status:"warning",borderRadius:"base",fontSize:"md",shadow:"md",w:"fit-content",children:[r.jsx(Hu,{}),r.jsx(J1,{children:r.jsx(Jt,{i18nKey:"newUserExperience.lowVRAMMode",components:{LinkComponent:r.jsx(kk,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}})})]}),Hbe=pe(K1,e=>e.shouldAntialiasProgressImage),Wbe=()=>{const e=ce(QY),t=ce(gM),n=I(Hbe),s=u.useMemo(()=>({imageRendering:n?"auto":"pixelated"}),[n]);return!e||t?null:r.jsx(dn,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",position:"absolute",borderRadius:"base",sx:s})},Ube=u.memo(Wbe),qbe=()=>{const e=I(XP),t=I(JY),{currentData:n}=Ua(t??ws),[s,i]=u.useState(!1),o=u.useRef(0),a=u.useCallback(()=>{i(!0),window.clearTimeout(o.current)},[]),l=u.useCallback(()=>{o.current=window.setTimeout(()=>{i(!1)},500)},[]);return r.jsxs(A,{onMouseOver:a,onMouseOut:l,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[r.jsx(MB,{imageDTO:n}),r.jsxs(A,{flexDir:"column",gap:2,position:"absolute",top:0,insetInlineStart:0,pointerEvents:"none",alignItems:"flex-start",children:[r.jsx(t1e,{}),r.jsx(mk,{})]}),e&&n&&r.jsx(Se,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:r.jsx(bbe,{image:n})}),r.jsx(OO,{children:s&&n&&r.jsx(Se,{as:Jj.div,initial:Zbe,animate:Ybe,exit:Xbe,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:r.jsx(_B,{})},"nextPrevButtons")})]})},Kbe=u.memo(qbe),MB=u.memo(({imageDTO:e})=>{const t=ce(eX),n=ce(gM),s=I(pw);return t&&!n&&s?r.jsx(Ube,{}):e?r.jsx(A,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsx(tl,{imageDTO:e})}):r.jsx(TB,{})});MB.displayName="ImageContent";const Zbe={opacity:0},Ybe={opacity:1,transition:{duration:.07}},Xbe={opacity:0,transition:{duration:.07}},PB=e=>{e.preventDefault()},Gl=u.memo(({type:e,...t})=>{const{t:n}=M();return r.jsx(q,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:fC,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});Gl.displayName="ImageComparisonLabel";const LB=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(GS),i=u.useRef(null),o=Q1(!1),a=u.useMemo(()=>aN(n,e),[n,e]),l=u.useMemo(()=>lN(s,a,e,t),[s,a,e,t]);return r.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(A,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Se,{ref:i,position:"relative",id:"image-comparison-hover-image-container",w:a.width,h:a.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(dn,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:a.width,h:a.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),r.jsx(Gl,{type:"first",opacity:o.isTrue?0:1}),r.jsxs(Se,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:o.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[r.jsx(Se,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:pd,backgroundRepeat:"repeat"}),r.jsx(dn,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:l.width,h:l.height,maxW:a.width,maxH:a.height,objectFit:s,objectPosition:"top left"}),r.jsx(Gl,{type:"second",opacity:o.isTrue?1:0})]}),r.jsx(Se,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:o.setTrue,onMouseOut:o.setFalse,onContextMenu:PB,userSelect:"none"})]})})})});LB.displayName="ImageComparisonHover";const{createElement:Pu,createContext:Qbe,forwardRef:DB,useCallback:zs,useContext:RB,useEffect:Pl,useImperativeHandle:OB,useLayoutEffect:Jbe,useMemo:exe,useRef:qs,useState:hu}=zS,LT=zS[`useId${Math.random()}`.slice(0,5)],txe=Jbe,dv=Qbe(null);dv.displayName="PanelGroupContext";const Ll=txe,nxe=typeof LT=="function"?LT:()=>null;let sxe=0;function _k(e=null){const t=nxe(),n=qs(e||t||null);return n.current===null&&(n.current=""+sxe++),e??n.current}function NB({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:i,forwardedRef:o,id:a,maxSize:l,minSize:c,onCollapse:d,onExpand:h,onResize:f,order:p,style:g,tagName:m="div",...y}){const b=RB(dv);if(b===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:C,expandPanel:v,getPanelSize:x,getPanelStyle:S,groupId:w,isPanelCollapsed:j,reevaluatePanelConstraints:P,registerPanel:T,resizePanel:L,unregisterPanel:E}=b,O=_k(a),F=qs({callbacks:{onCollapse:d,onExpand:h,onResize:f},constraints:{collapsedSize:n,collapsible:s,defaultSize:i,maxSize:l,minSize:c},id:O,idIsFromProps:a!==void 0,order:p});qs({didLogMissingDefaultSizeWarning:!1}),Ll(()=>{const{callbacks:R,constraints:D}=F.current,$={...D};F.current.id=O,F.current.idIsFromProps=a!==void 0,F.current.order=p,R.onCollapse=d,R.onExpand=h,R.onResize=f,D.collapsedSize=n,D.collapsible=s,D.defaultSize=i,D.maxSize=l,D.minSize=c,($.collapsedSize!==D.collapsedSize||$.collapsible!==D.collapsible||$.maxSize!==D.maxSize||$.minSize!==D.minSize)&&P(F.current,$)}),Ll(()=>{const R=F.current;return T(R),()=>{E(R)}},[p,O,T,E]),OB(o,()=>({collapse:()=>{C(F.current)},expand:R=>{v(F.current,R)},getId(){return O},getSize(){return x(F.current)},isCollapsed(){return j(F.current)},isExpanded(){return!j(F.current)},resize:R=>{L(F.current,R)}}),[C,v,x,j,O,L]);const _=S(F.current,i);return Pu(m,{...y,children:e,className:t,id:a,style:{..._,...g},"data-panel":"","data-panel-collapsible":s||void 0,"data-panel-group-id":w,"data-panel-id":O,"data-panel-size":parseFloat(""+_.flexGrow).toFixed(1)})}const io=DB((e,t)=>Pu(NB,{...e,forwardedRef:t}));NB.displayName="Panel";io.displayName="forwardRef(Panel)";let TC=null,wl=null;function rxe(e,t){if(t){const n=(t&GB)!==0,s=(t&zB)!==0,i=(t&HB)!==0,o=(t&WB)!==0;if(n)return i?"se-resize":o?"ne-resize":"e-resize";if(s)return i?"sw-resize":o?"nw-resize":"w-resize";if(i)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function ixe(){wl!==null&&(document.head.removeChild(wl),TC=null,wl=null)}function ax(e,t){const n=rxe(e,t);TC!==n&&(TC=n,wl===null&&(wl=document.createElement("style"),document.head.appendChild(wl)),wl.innerHTML=`*{cursor: ${n}!important;}`)}function FB(e){return e.type==="keydown"}function BB(e){return e.type.startsWith("pointer")}function $B(e){return e.type.startsWith("mouse")}function hv(e){if(BB(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if($B(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function oxe(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function axe(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function lxe(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:OT(e),b:OT(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;yt(s,"Stacking order can only be calculated for elements with a common ancestor");const i={a:RT(DT(n.a)),b:RT(DT(n.b))};if(i.a===i.b){const o=s.childNodes,a={a:n.a.at(-1),b:n.b.at(-1)};let l=o.length;for(;l--;){const c=o[l];if(c===a.a)return 1;if(c===a.b)return-1}}return Math.sign(i.a-i.b)}const cxe=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function uxe(e){var t;const n=getComputedStyle((t=VB(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function dxe(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||uxe(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||cxe.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function DT(e){let t=e.length;for(;t--;){const n=e[t];if(yt(n,"Missing node"),dxe(n))return n}return null}function RT(e){return e&&Number(getComputedStyle(e).zIndex)||0}function OT(e){const t=[];for(;e;)t.push(e),e=VB(e);return t}function VB(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const GB=1,zB=2,HB=4,WB=8,hxe=oxe()==="coarse";let wi=[],fu=!1,xa=new Map,fv=new Map;const Xf=new Set;function fxe(e,t,n,s,i){var o;const{ownerDocument:a}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:i},c=(o=xa.get(a))!==null&&o!==void 0?o:0;return xa.set(a,c+1),Xf.add(l),i1(),function(){var h;fv.delete(e),Xf.delete(l);const f=(h=xa.get(a))!==null&&h!==void 0?h:1;if(xa.set(a,f-1),i1(),f===1&&xa.delete(a),wi.includes(l)){const p=wi.indexOf(l);p>=0&&wi.splice(p,1),Ak(),i("up",!0,null)}}}function NT(e){const{target:t}=e,{x:n,y:s}=hv(e);fu=!0,Ik({target:t,x:n,y:s}),i1(),wi.length>0&&(o1("down",e),e.preventDefault(),e.stopPropagation())}function Nh(e){const{x:t,y:n}=hv(e);if(fu&&e.buttons===0&&(fu=!1,o1("up",e)),!fu){const{target:s}=e;Ik({target:s,x:t,y:n})}o1("move",e),Ak(),wi.length>0&&e.preventDefault()}function jc(e){const{target:t}=e,{x:n,y:s}=hv(e);fv.clear(),fu=!1,wi.length>0&&e.preventDefault(),o1("up",e),Ik({target:t,x:n,y:s}),Ak(),i1()}function Ik({target:e,x:t,y:n}){wi.splice(0);let s=null;e instanceof HTMLElement&&(s=e),Xf.forEach(i=>{const{element:o,hitAreaMargins:a}=i,l=o.getBoundingClientRect(),{bottom:c,left:d,right:h,top:f}=l,p=hxe?a.coarse:a.fine;if(t>=d-p&&t<=h+p&&n>=f-p&&n<=c+p){if(s!==null&&document.contains(s)&&o!==s&&!o.contains(s)&&!s.contains(o)&&lxe(s,o)>0){let m=s,y=!1;for(;m&&!m.contains(o);){if(axe(m.getBoundingClientRect(),l)){y=!0;break}m=m.parentElement}if(y)return}wi.push(i)}})}function lx(e,t){fv.set(e,t)}function Ak(){let e=!1,t=!1;wi.forEach(s=>{const{direction:i}=s;i==="horizontal"?e=!0:t=!0});let n=0;fv.forEach(s=>{n|=s}),e&&t?ax("intersection",n):e?ax("horizontal",n):t?ax("vertical",n):ixe()}function i1(){xa.forEach((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",jc),n.removeEventListener("pointerdown",NT),n.removeEventListener("pointerleave",Nh),n.removeEventListener("pointermove",Nh)}),window.removeEventListener("pointerup",jc),window.removeEventListener("pointercancel",jc),Xf.size>0&&(fu?(wi.length>0&&xa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",jc),n.addEventListener("pointerleave",Nh),n.addEventListener("pointermove",Nh))}),window.addEventListener("pointerup",jc),window.addEventListener("pointercancel",jc)):xa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",NT,{capture:!0}),n.addEventListener("pointermove",Nh))}))}function o1(e,t){Xf.forEach(n=>{const{setResizeHandlerState:s}=n,i=wi.includes(n);s(e,i,t)})}function pxe(){const[e,t]=hu(0);return zs(()=>t(n=>n+1),[])}function yt(e,t){if(!e)throw console.error(t),Error(t)}const Tk=10;function zl(e,t,n=Tk){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Bo(e,t,n=Tk){return zl(e,t,n)===0}function pr(e,t,n){return zl(e,t,n)===0}function gxe(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],o=t[s];if(!pr(i,o,n))return!1}return!0}function su({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];yt(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:i=0,collapsible:o,maxSize:a=100,minSize:l=0}=s;if(zl(n,l)<0)if(o){const c=(i+l)/2;zl(n,c)<0?n=i:n=l}else n=l;return n=Math.min(a,n),n=parseFloat(n.toFixed(Tk)),n}function Jh({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:i,trigger:o}){if(pr(e,0))return t;const a=[...t],[l,c]=s;yt(l!=null,"Invalid first pivot index"),yt(c!=null,"Invalid second pivot index");let d=0;if(o==="keyboard"){{const f=e<0?c:l,p=n[f];yt(p,`Panel constraints not found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const b=t[f];if(yt(b!=null,`Previous layout not found for panel index ${f}`),pr(b,g)){const C=y-b;zl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}{const f=e<0?l:c,p=n[f];yt(p,`No panel constraints found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const b=t[f];if(yt(b!=null,`Previous layout not found for panel index ${f}`),pr(b,y)){const C=b-g;zl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}}{const f=e<0?1:-1;let p=e<0?c:l,g=0;for(;;){const y=t[p];yt(y!=null,`Previous layout not found for panel index ${p}`);const C=su({panelConstraints:n,panelIndex:p,size:100})-y;if(g+=C,p+=f,p<0||p>=n.length)break}const m=Math.min(Math.abs(e),Math.abs(g));e=e<0?0-m:m}{let p=e<0?l:c;for(;p>=0&&p<n.length;){const g=Math.abs(e)-Math.abs(d),m=t[p];yt(m!=null,`Previous layout not found for panel index ${p}`);const y=m-g,b=su({panelConstraints:n,panelIndex:p,size:y});if(!pr(m,b)&&(d+=m-b,a[p]=b,d.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?p--:p++}}if(gxe(i,a))return i;{const f=e<0?c:l,p=t[f];yt(p!=null,`Previous layout not found for panel index ${f}`);const g=p+d,m=su({panelConstraints:n,panelIndex:f,size:g});if(a[f]=m,!pr(m,g)){let y=g-m,C=e<0?c:l;for(;C>=0&&C<n.length;){const v=a[C];yt(v!=null,`Previous layout not found for panel index ${C}`);const x=v+y,S=su({panelConstraints:n,panelIndex:C,size:x});if(pr(v,S)||(y-=S-v,a[C]=S),pr(y,0))break;e>0?C--:C++}}}const h=a.reduce((f,p)=>p+f,0);return pr(h,100)?a:i}function mxe({layout:e,panelsArray:t,pivotIndices:n}){let s=0,i=100,o=0,a=0;const l=n[0];yt(l!=null,"No pivot index found"),t.forEach((f,p)=>{const{constraints:g}=f,{maxSize:m=100,minSize:y=0}=g;p===l?(s=y,i=m):(o+=y,a+=m)});const c=Math.min(i,100-o),d=Math.max(s,100-a),h=e[l];return{valueMax:c,valueMin:d,valueNow:h}}function Hl(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function UB(e,t,n=document){const i=Hl(e,n).findIndex(o=>o.getAttribute("data-panel-resize-handle-id")===t);return i??null}function qB(e,t,n){const s=UB(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function pv(e,t=document){var n;if(t instanceof HTMLElement&&(t==null||(n=t.dataset)===null||n===void 0?void 0:n.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function gv(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function yxe(e,t,n,s=document){var i,o,a,l;const c=gv(t,s),d=Hl(e,s),h=c?d.indexOf(c):-1,f=(i=(o=n[h])===null||o===void 0?void 0:o.id)!==null&&i!==void 0?i:null,p=(a=(l=n[h+1])===null||l===void 0?void 0:l.id)!==null&&a!==void 0?a:null;return[f,p]}function vxe({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:i,panelGroupElement:o,setLayout:a}){qs({didWarnAboutMissingResizeHandle:!1}),Ll(()=>{if(!o)return;const l=Hl(n,o);for(let c=0;c<i.length-1;c++){const{valueMax:d,valueMin:h,valueNow:f}=mxe({layout:s,panelsArray:i,pivotIndices:[c,c+1]}),p=l[c];if(p!=null){const g=i[c];yt(g,`No panel data found for index "${c}"`),p.setAttribute("aria-controls",g.id),p.setAttribute("aria-valuemax",""+Math.round(d)),p.setAttribute("aria-valuemin",""+Math.round(h)),p.setAttribute("aria-valuenow",f!=null?""+Math.round(f):"")}}return()=>{l.forEach((c,d)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,i,o]),Pl(()=>{if(!o)return;const l=t.current;yt(l,"Eager values not found");const{panelDataArray:c}=l,d=pv(n,o);yt(d!=null,`No group found for id "${n}"`);const h=Hl(n,o);yt(h,`No resize handles found for group id "${n}"`);const f=h.map(p=>{const g=p.getAttribute("data-panel-resize-handle-id");yt(g,"Resize handle element has no handle id attribute");const[m,y]=yxe(n,g,c,o);if(m==null||y==null)return()=>{};const b=C=>{if(!C.defaultPrevented)switch(C.key){case"Enter":{C.preventDefault();const v=c.findIndex(x=>x.id===m);if(v>=0){const x=c[v];yt(x,`No panel data found for index ${v}`);const S=s[v],{collapsedSize:w=0,collapsible:j,minSize:P=0}=x.constraints;if(S!=null&&j){const T=Jh({delta:pr(S,w)?P-w:w-S,initialLayout:s,panelConstraints:c.map(L=>L.constraints),pivotIndices:qB(n,g,o),prevLayout:s,trigger:"keyboard"});s!==T&&a(T)}}break}}};return p.addEventListener("keydown",b),()=>{p.removeEventListener("keydown",b)}});return()=>{f.forEach(p=>p())}},[o,e,t,n,s,i,a])}function FT(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function KB(e,t){const n=e==="horizontal",{x:s,y:i}=hv(t);return n?s:i}function bxe(e,t,n,s,i){const o=n==="horizontal",a=gv(t,i);yt(a,`No resize handle element found for id "${t}"`);const l=a.getAttribute("data-panel-group-id");yt(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const d=KB(n,e),h=pv(l,i);yt(h,`No group element found for id "${l}"`);const f=h.getBoundingClientRect(),p=o?f.width:f.height;return(d-c)/p*100}function xxe(e,t,n,s,i,o){if(FB(e)){const a=n==="horizontal";let l=0;e.shiftKey?l=100:i!=null?l=i:l=10;let c=0;switch(e.key){case"ArrowDown":c=a?0:l;break;case"ArrowLeft":c=a?-l:0;break;case"ArrowRight":c=a?l:0;break;case"ArrowUp":c=a?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:bxe(e,t,n,s,o)}function Cxe({panelDataArray:e}){const t=Array(e.length),n=e.map(o=>o.constraints);let s=0,i=100;for(let o=0;o<e.length;o++){const a=n[o];yt(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;l!=null&&(s++,t[o]=l,i-=l)}for(let o=0;o<e.length;o++){const a=n[o];yt(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;if(l!=null)continue;const c=e.length-s,d=i/c;s++,t[o]=d,i-=d}return t}function kc(e,t,n){t.forEach((s,i)=>{const o=e[i];yt(o,`Panel data not found for index ${i}`);const{callbacks:a,constraints:l,id:c}=o,{collapsedSize:d=0,collapsible:h}=l,f=n[c];if(f==null||s!==f){n[c]=s;const{onCollapse:p,onExpand:g,onResize:m}=a;m&&m(s,f),h&&(p||g)&&(g&&(f==null||Bo(f,d))&&!Bo(s,d)&&g(),p&&(f==null||!Bo(f,d))&&Bo(s,d)&&p())}})}function ym(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function Sxe({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:i,precision:o=3}){const a=n[i];let l;return a==null?l=e!=null?e.toPrecision(o):"1":s.length===1?l="1":l=a.toPrecision(o),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function wxe(e,t=10){let n=null;return(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}function BT(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function ZB(e){return`react-resizable-panels:${e}`}function YB(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:i,order:o}=t;return i?s:o?`${o}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function XB(e,t){try{const n=ZB(e),s=t.getItem(n);if(s){const i=JSON.parse(s);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function jxe(e,t,n){var s,i;const o=(s=XB(e,n))!==null&&s!==void 0?s:{},a=YB(t);return(i=o[a])!==null&&i!==void 0?i:null}function kxe(e,t,n,s,i){var o;const a=ZB(e),l=YB(t),c=(o=XB(e,i))!==null&&o!==void 0?o:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{i.setItem(a,JSON.stringify(c))}catch(d){console.error(d)}}function $T({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((o,a)=>o+a,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(o=>`${o}%`).join(", ")}`);if(!pr(s,100)&&n.length>0)for(let o=0;o<t.length;o++){const a=n[o];yt(a!=null,`No layout data found for index ${o}`);const l=100/s*a;n[o]=l}let i=0;for(let o=0;o<t.length;o++){const a=n[o];yt(a!=null,`No layout data found for index ${o}`);const l=su({panelConstraints:t,panelIndex:o,size:a});a!=l&&(i+=a-l,n[o]=l)}if(!pr(i,0))for(let o=0;o<t.length;o++){const a=n[o];yt(a!=null,`No layout data found for index ${o}`);const l=a+i,c=su({panelConstraints:t,panelIndex:o,size:l});if(a!==c&&(i-=c-a,n[o]=c,pr(i,0)))break}return n}const _xe=100,ef={getItem:e=>(BT(ef),ef.getItem(e)),setItem:(e,t)=>{BT(ef),ef.setItem(e,t)}},VT={};function QB({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:i,id:o=null,onLayout:a=null,keyboardResizeBy:l=null,storage:c=ef,style:d,tagName:h="div",...f}){const p=_k(o),g=qs(null),[m,y]=hu(null),[b,C]=hu([]),v=pxe(),x=qs({}),S=qs(new Map),w=qs(0),j=qs({autoSaveId:e,direction:s,dragState:m,id:p,keyboardResizeBy:l,onLayout:a,storage:c}),P=qs({layout:b,panelDataArray:[],panelDataArrayChanged:!1});qs({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),OB(i,()=>({getId:()=>j.current.id,getLayout:()=>{const{layout:V}=P.current;return V},setLayout:V=>{const{onLayout:Y}=j.current,{layout:W,panelDataArray:J}=P.current,N=$T({layout:V,panelConstraints:J.map(B=>B.constraints)});FT(W,N)||(C(N),P.current.layout=N,Y&&Y(N),kc(J,N,x.current))}}),[]),Ll(()=>{j.current.autoSaveId=e,j.current.direction=s,j.current.dragState=m,j.current.id=p,j.current.onLayout=a,j.current.storage=c}),vxe({committedValuesRef:j,eagerValuesRef:P,groupId:p,layout:b,panelDataArray:P.current.panelDataArray,setLayout:C,panelGroupElement:g.current}),Pl(()=>{const{panelDataArray:V}=P.current;if(e){if(b.length===0||b.length!==V.length)return;let Y=VT[e];Y==null&&(Y=wxe(kxe,_xe),VT[e]=Y);const W=[...V],J=new Map(S.current);Y(e,W,J,b,c)}},[e,b,c]),Pl(()=>{});const T=zs(V=>{const{onLayout:Y}=j.current,{layout:W,panelDataArray:J}=P.current;if(V.constraints.collapsible){const N=J.map(de=>de.constraints),{collapsedSize:B=0,panelSize:U,pivotIndices:ie}=ul(J,V,W);if(yt(U!=null,`Panel size not found for panel "${V.id}"`),!Bo(U,B)){S.current.set(V.id,U);const be=Fc(J,V)===J.length-1?U-B:B-U,Ee=Jh({delta:be,initialLayout:W,panelConstraints:N,pivotIndices:ie,prevLayout:W,trigger:"imperative-api"});ym(W,Ee)||(C(Ee),P.current.layout=Ee,Y&&Y(Ee),kc(J,Ee,x.current))}}},[]),L=zs((V,Y)=>{const{onLayout:W}=j.current,{layout:J,panelDataArray:N}=P.current;if(V.constraints.collapsible){const B=N.map(je=>je.constraints),{collapsedSize:U=0,panelSize:ie=0,minSize:de=0,pivotIndices:be}=ul(N,V,J),Ee=Y??de;if(Bo(ie,U)){const je=S.current.get(V.id),Be=je!=null&&je>=Ee?je:Ee,Re=Fc(N,V)===N.length-1?ie-Be:Be-ie,K=Jh({delta:Re,initialLayout:J,panelConstraints:B,pivotIndices:be,prevLayout:J,trigger:"imperative-api"});ym(J,K)||(C(K),P.current.layout=K,W&&W(K),kc(N,K,x.current))}}},[]),E=zs(V=>{const{layout:Y,panelDataArray:W}=P.current,{panelSize:J}=ul(W,V,Y);return yt(J!=null,`Panel size not found for panel "${V.id}"`),J},[]),O=zs((V,Y)=>{const{panelDataArray:W}=P.current,J=Fc(W,V);return Sxe({defaultSize:Y,dragState:m,layout:b,panelData:W,panelIndex:J})},[m,b]),F=zs(V=>{const{layout:Y,panelDataArray:W}=P.current,{collapsedSize:J=0,collapsible:N,panelSize:B}=ul(W,V,Y);return yt(B!=null,`Panel size not found for panel "${V.id}"`),N===!0&&Bo(B,J)},[]),_=zs(V=>{const{layout:Y,panelDataArray:W}=P.current,{collapsedSize:J=0,collapsible:N,panelSize:B}=ul(W,V,Y);return yt(B!=null,`Panel size not found for panel "${V.id}"`),!N||zl(B,J)>0},[]),R=zs(V=>{const{panelDataArray:Y}=P.current;Y.push(V),Y.sort((W,J)=>{const N=W.order,B=J.order;return N==null&&B==null?0:N==null?-1:B==null?1:N-B}),P.current.panelDataArrayChanged=!0,v()},[v]);Ll(()=>{if(P.current.panelDataArrayChanged){P.current.panelDataArrayChanged=!1;const{autoSaveId:V,onLayout:Y,storage:W}=j.current,{layout:J,panelDataArray:N}=P.current;let B=null;if(V){const ie=jxe(V,N,W);ie&&(S.current=new Map(Object.entries(ie.expandToSizes)),B=ie.layout)}B==null&&(B=Cxe({panelDataArray:N}));const U=$T({layout:B,panelConstraints:N.map(ie=>ie.constraints)});FT(J,U)||(C(U),P.current.layout=U,Y&&Y(U),kc(N,U,x.current))}}),Ll(()=>{const V=P.current;return()=>{V.layout=[]}},[]);const D=zs(V=>function(W){W.preventDefault();const J=g.current;if(!J)return()=>null;const{direction:N,dragState:B,id:U,keyboardResizeBy:ie,onLayout:de}=j.current,{layout:be,panelDataArray:Ee}=P.current,{initialLayout:je}=B??{},Be=qB(U,V,J);let Xe=xxe(W,V,N,B,ie,J);const Re=N==="horizontal";document.dir==="rtl"&&Re&&(Xe=-Xe);const K=Ee.map(xe=>xe.constraints),re=Jh({delta:Xe,initialLayout:je??be,panelConstraints:K,pivotIndices:Be,prevLayout:be,trigger:FB(W)?"keyboard":"mouse-or-touch"}),ae=!ym(be,re);(BB(W)||$B(W))&&w.current!=Xe&&(w.current=Xe,!ae&&Xe!==0?Re?lx(V,Xe<0?GB:zB):lx(V,Xe<0?HB:WB):lx(V,0)),ae&&(C(re),P.current.layout=re,de&&de(re),kc(Ee,re,x.current))},[]),$=zs((V,Y)=>{const{onLayout:W}=j.current,{layout:J,panelDataArray:N}=P.current,B=N.map(je=>je.constraints),{panelSize:U,pivotIndices:ie}=ul(N,V,J);yt(U!=null,`Panel size not found for panel "${V.id}"`);const be=Fc(N,V)===N.length-1?U-Y:Y-U,Ee=Jh({delta:be,initialLayout:J,panelConstraints:B,pivotIndices:ie,prevLayout:J,trigger:"imperative-api"});ym(J,Ee)||(C(Ee),P.current.layout=Ee,W&&W(Ee),kc(N,Ee,x.current))},[]),G=zs((V,Y)=>{const{layout:W,panelDataArray:J}=P.current,{collapsedSize:N=0,collapsible:B}=Y,{collapsedSize:U=0,collapsible:ie,maxSize:de=100,minSize:be=0}=V.constraints,{panelSize:Ee}=ul(J,V,W);Ee!=null&&(B&&ie&&Bo(Ee,N)?Bo(N,U)||$(V,U):Ee<be?$(V,be):Ee>de&&$(V,de))},[$]),ee=zs((V,Y)=>{const{direction:W}=j.current,{layout:J}=P.current;if(!g.current)return;const N=gv(V,g.current);yt(N,`Drag handle element not found for id "${V}"`);const B=KB(W,Y);y({dragHandleId:V,dragHandleRect:N.getBoundingClientRect(),initialCursorPosition:B,initialLayout:J})},[]),Q=zs(()=>{y(null)},[]),se=zs(V=>{const{panelDataArray:Y}=P.current,W=Fc(Y,V);W>=0&&(Y.splice(W,1),delete x.current[V.id],P.current.panelDataArrayChanged=!0,v())},[v]),ne=exe(()=>({collapsePanel:T,direction:s,dragState:m,expandPanel:L,getPanelSize:E,getPanelStyle:O,groupId:p,isPanelCollapsed:F,isPanelExpanded:_,reevaluatePanelConstraints:G,registerPanel:R,registerResizeHandle:D,resizePanel:$,startDragging:ee,stopDragging:Q,unregisterPanel:se,panelGroupElement:g.current}),[T,m,s,L,E,O,p,F,_,G,R,D,$,ee,Q,se]),H={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return Pu(dv.Provider,{value:ne},Pu(h,{...f,children:t,className:n,id:o,ref:g,style:{...H,...d},"data-panel-group":"","data-panel-group-direction":s,"data-panel-group-id":p}))}const ug=DB((e,t)=>Pu(QB,{...e,forwardedRef:t}));QB.displayName="PanelGroup";ug.displayName="forwardRef(PanelGroup)";function Fc(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function ul(e,t,n){const s=Fc(e,t),o=s===e.length-1?[s-1,s]:[s,s+1],a=n[s];return{...t.constraints,panelSize:a,pivotIndices:o}}function Ixe({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){Pl(()=>{if(e||n==null||s==null)return;const i=gv(t,s);if(i==null)return;const o=a=>{if(!a.defaultPrevented)switch(a.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{a.preventDefault(),n(a);break}case"F6":{a.preventDefault();const l=i.getAttribute("data-panel-group-id");yt(l,`No group element found for id "${l}"`);const c=Hl(l,s),d=UB(l,t,s);yt(d!==null,`No resize element found for id "${t}"`);const h=a.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[h].focus();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[s,e,t,n])}function JB({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:i,onBlur:o,onDragging:a,onFocus:l,style:c={},tabIndex:d=0,tagName:h="div",...f}){var p,g;const m=qs(null),y=qs({onDragging:a});Pl(()=>{y.current.onDragging=a});const b=RB(dv);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:C,groupId:v,registerResizeHandle:x,startDragging:S,stopDragging:w,panelGroupElement:j}=b,P=_k(i),[T,L]=hu("inactive"),[E,O]=hu(!1),[F,_]=hu(null),R=qs({state:T});Ll(()=>{R.current.state=T}),Pl(()=>{if(n)_(null);else{const ee=x(P);_(()=>ee)}},[n,P,x]);const D=(p=s==null?void 0:s.coarse)!==null&&p!==void 0?p:15,$=(g=s==null?void 0:s.fine)!==null&&g!==void 0?g:5;return Pl(()=>{if(n||F==null)return;const ee=m.current;return yt(ee,"Element ref not attached"),fxe(P,ee,C,{coarse:D,fine:$},(se,ne,H)=>{if(ne)switch(se){case"down":{L("drag"),yt(H,'Expected event to be defined for "down" action'),S(P,H);const{onDragging:V}=y.current;V&&V(!0);break}case"move":{const{state:V}=R.current;V!=="drag"&&L("hover"),yt(H,'Expected event to be defined for "move" action'),F(H);break}case"up":{L("hover"),w();const{onDragging:V}=y.current;V&&V(!1);break}}else L("inactive")})},[D,C,n,$,x,P,F,S,w]),Ixe({disabled:n,handleId:P,resizeHandler:F,panelGroupElement:j}),Pu(h,{...f,children:e,className:t,id:i,onBlur:()=>{O(!1),o==null||o()},onFocus:()=>{O(!0),l==null||l()},ref:m,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...c},tabIndex:d,"data-panel-group-direction":C,"data-panel-group-id":v,"data-resize-handle":"","data-resize-handle-active":T==="drag"?"pointer":E?"keyboard":void 0,"data-resize-handle-state":T,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":P})}JB.displayName="PanelResizeHandle";const e$=Qo(JB),t$={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"},".resize-handle-dots":{color:"base.400"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"},".resize-handle-dots":{color:"base.300"}},".resize-handle-dots":{pointerEvents:"none",position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%) scale(0.75)",background:"base.900",color:"base.500"}},Axe={...t$,'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"fast",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},Ek=u.memo(e=>r.jsx(e$,{...e,sx:Axe,children:r.jsxs(A,{className:"resize-handle-dots",clipPath:"inset(0px 2px 2px 0px)",px:1,children:[r.jsx(dt,{as:dI,me:-.5}),r.jsx(dt,{as:dI,ms:-.5})]})}));Ek.displayName="HorizontalResizeHandle";const Txe={...t$,'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}}},a1=u.memo(e=>r.jsx(e$,{...e,sx:Txe,children:r.jsxs(A,{flexDir:"column",className:"resize-handle-dots",clipPath:"inset(2px 0px 0px 2px)",py:1,children:[r.jsx(dt,{as:uI,mb:-.5}),r.jsx(dt,{as:uI,mt:-.5})]})}));a1.displayName="VerticalResizeHandle";const n$=u.memo(({firstImage:e,secondImage:t})=>{const n=u.useRef(null),s=u.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return r.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(ug,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[r.jsx(io,{minSize:20,children:r.jsx(A,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(A,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[r.jsx(dn,{id:"image-comparison-side-by-side-first-image",w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Gl,{type:"first"})]})})}),r.jsx(a1,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),r.jsx(io,{minSize:20,children:r.jsx(A,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(A,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:t.width/t.height,children:[r.jsx(dn,{id:"image-comparison-side-by-side-first-image",w:t.width,h:t.height,maxW:"full",maxH:"full",src:t.image_url,fallbackSrc:t.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Gl,{type:"second"})]})})})]})})})});n$.displayName="ImageComparisonSideBySide";const s$="50%",Mk=2,Exe=`${Mk}px`,mv=20,Mxe=`${mv}px`,Pxe=`${mv/2-Mk/2}px`,Lxe=`calc(${s$} - ${mv/2}px)`,r$=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(GS),[i,o]=u.useState(Lxe),[a,l]=u.useState(s$),c=u.useRef(null),d=u.useRef(null),h=u.useRef(null),f=u.useRef(0),p=u.useMemo(()=>aN(n,e),[n,e]),g=u.useMemo(()=>lN(s,p,e,t),[s,p,e,t]),m=u.useCallback(v=>{if(!c.current||!d.current)return;f.current=performance.now();const{x,width:S}=d.current.getBoundingClientRect(),w=(v-x)*100/S,j=Mk*100/S,P=Math.min(100-j,Math.max(0,w));l(`${P}%`),o(`calc(${P}% - ${mv/2}px)`)},[]),y=u.useCallback(v=>{h.current===null&&performance.now()>f.current+1e3/60&&(h.current=window.requestAnimationFrame(()=>{m(v.clientX),h.current=null}))},[m]),b=u.useCallback(()=>{window.removeEventListener("mousemove",y)},[y]),C=u.useCallback(v=>{m(v.clientX),window.addEventListener("mouseup",b,{once:!0}),window.addEventListener("mousemove",y)},[y,b,m]);return u.useEffect(()=>()=>{h.current!==null&&cancelAnimationFrame(h.current)},[]),r.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(A,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Se,{ref:d,position:"relative",id:"image-comparison-image-container",w:p.width,h:p.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(Se,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:pd,backgroundRepeat:"repeat"}),r.jsx(dn,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:g.width,h:g.height,maxW:p.width,maxH:p.height,objectFit:s,objectPosition:"top left"}),r.jsx(Gl,{type:"second"}),r.jsxs(Se,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:a,overflow:"hidden",children:[r.jsx(dn,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:p.width,h:p.height,objectFit:"cover",objectPosition:"top left"}),r.jsx(Gl,{type:"first"})]}),r.jsxs(A,{id:"image-comparison-handle",ref:c,position:"absolute",top:0,bottom:0,left:i,w:Mxe,cursor:"ew-resize",filter:fC,opacity:.8,color:"base.50",children:[r.jsx(Se,{id:"image-comparison-handle-divider",w:Exe,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:Pxe}),r.jsxs(A,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:fC,children:[r.jsx(dt,{as:Tw}),r.jsx(dt,{as:Ty})]})]}),r.jsx(Se,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:C,onContextMenu:PB,userSelect:"none",cursor:"ew-resize"})]})})})});r$.displayName="ImageComparisonSlider";const i$=u.memo(({containerDims:e})=>{const{t}=M(),n=I(cM),{firstImage:s,secondImage:i}=I(cN);if(!s||!i)return r.jsx(Ot,{label:t("gallery.selectAnImageToCompare"),icon:GL});if(n==="slider")return r.jsx(r$,{containerDims:e,firstImage:s,secondImage:i});if(n==="side-by-side")return r.jsx(n$,{containerDims:e,firstImage:s,secondImage:i});if(n==="hover")return r.jsx(LB,{containerDims:e,firstImage:s,secondImage:i})});i$.displayName="ImageComparison";const o$=u.memo(()=>{const{t:e}=M(),t=u.useMemo(()=>yC.getData(),[]);return r.jsx(gs,{dndTarget:yC,dndTargetData:t,label:e("gallery.selectForCompare")})});o$.displayName="ImageComparisonDroppable";const a$=u.memo(()=>{const e=z(),t=I(XP),n=I(dp),{t:s}=M(),i=u.useCallback(()=>e(tX(!t)),[e,t]);return Le({id:"toggleMetadata",category:"viewer",callback:i,options:{enabled:!!n},dependencies:[n,t]}),r.jsx(oe,{icon:r.jsx(td,{}),tooltip:`${s("parameters.info")} (I)`,"aria-label":`${s("parameters.info")} (I)`,onClick:i,isDisabled:!n,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-metadata-button"})});a$.displayName="ToggleMetadataViewerButton";const l$=u.memo(()=>{const e=z(),t=I(pw),{t:n}=M(),s=u.useCallback(()=>{e(mM(!t))},[e,t]);return r.jsx(oe,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:r.jsx(Aae,{}),onClick:s,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});l$.displayName="ToggleProgressButton";const c$=u.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=M(),i=ce(Wn),o=I(PS),a=`${s("gallery.deleteImage",{count:o})} (Del)`;return r.jsx(oe,{onClick:t,icon:r.jsx(ei,{}),tooltip:a,"aria-label":a,isDisabled:n||!i,colorScheme:"error",variant:"link",alignSelf:"stretch"})});c$.displayName="DeleteImageButton";const Dxe=()=>{const{t:e}=M(),[t,{isLoading:n}]=Zp(),s=I(yM),i=z(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(nX(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Ja({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:e("upscaling.postProcessingModel")}),r.jsx(De,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},Rxe=u.memo(Dxe),Oxe=()=>{const[e,{isLoading:t}]=mS(H1),[n,{isLoading:s}]=vM({fixedCacheKey:"resumeProcessor"}),[i,{isLoading:o}]=bM({fixedCacheKey:"pauseProcessor"}),[a,{isLoading:l}]=hS({fixedCacheKey:"cancelQueueItem"}),[c,{isLoading:d}]=O3({fixedCacheKey:"clearQueue"}),[h,{isLoading:f}]=xM({fixedCacheKey:"pruneQueue"});return t||s||o||l||d||f},u$=u.memo(e=>{const{imageDTO:t}=e,n=z(),s=I(yM),i=Oxe(),{t:o}=M(),{isOpen:a,onOpen:l,onClose:c}=ir(),d=u.useCallback(()=>{c(),t&&n(P3({imageDTO:t}))},[n,t,c]);return r.jsxs(Fn,{isOpen:a,onClose:c,isLazy:!0,children:[r.jsx(Un,{children:r.jsx(oe,{tooltip:o("parameters.postProcessing"),onClick:l,icon:r.jsx(Vp,{}),"aria-label":o("parameters.postProcessing"),variant:"link",alignSelf:"stretch"})}),r.jsx(Bn,{children:r.jsx(qn,{w:96,children:r.jsxs(A,{flexDirection:"column",gap:4,children:[r.jsx(Rxe,{}),!s&&r.jsx(Nxe,{}),r.jsx(ye,{size:"sm",isDisabled:!t||i||!s,onClick:d,children:o("parameters.processImage")})]})})})]})});u$.displayName="PostProcessingPopover";const Nxe=()=>{const e=z(),t=u.useCallback(()=>{e(Kt("models")),$l.set(3)},[e]);return r.jsx(A,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:r.jsx(q,{children:r.jsx(Jt,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:r.jsx(ye,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:t})}})})})},Fxe=()=>{const e=I(dp),{currentData:t}=Ua((e==null?void 0:e.image_name)??ws);return t?r.jsx(d$,{imageDTO:t}):null},Bxe=u.memo(Fxe),d$=u.memo(({imageDTO:e})=>{const{t}=M(),n=ce(cp),s=gw(e),i=I(On),o=en("upscaling");return r.jsxs(r.Fragment,{children:[r.jsxs(Yt,{isLazy:!0,children:[r.jsx(Xt,{as:oe,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,variant:"link",alignSelf:"stretch",icon:r.jsx(Dw,{})}),r.jsx(It,{children:e&&r.jsx(GR,{imageDTO:e})})]}),r.jsx(Pt,{orientation:"vertical",h:8,mx:2}),r.jsx(oe,{icon:r.jsx(Ey,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!s.hasWorkflow||!n,variant:"link",alignSelf:"stretch",onClick:s.loadWorkflow}),r.jsx(oe,{icon:r.jsx(b0,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.remix}),r.jsx(oe,{icon:r.jsx(ZL,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!s.hasPrompts,variant:"link",alignSelf:"stretch",onClick:s.recallPrompts}),r.jsx(oe,{icon:r.jsx(qL,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!s.hasSeed,variant:"link",alignSelf:"stretch",onClick:s.recallSeed}),r.jsx(oe,{icon:r.jsx(Bae,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,variant:"link",alignSelf:"stretch",onClick:s.recallSize,isDisabled:i}),r.jsx(oe,{icon:r.jsx(LL,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.recallAll}),o&&r.jsx(u$,{imageDTO:e}),r.jsx(Pt,{orientation:"vertical",h:8,mx:2}),r.jsx(c$,{onClick:s.delete})]})});d$.displayName="CurrentImageButtonsContent";const h$=u.memo(({closeButton:e})=>r.jsxs(A,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(A,{flex:1,justifyContent:"center",children:r.jsxs(A,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(l$,{}),r.jsx(a$,{})]})}),r.jsx(A,{flex:1,justifyContent:"center",alignItems:"center",children:r.jsx(Bxe,{})}),r.jsx(A,{flex:1,justifyContent:"center",children:r.jsx(A,{marginInlineStart:"auto",alignItems:"center",children:e})})]}));h$.displayName="ViewerToolbar";var $xe=function(){},f$=typeof window<"u",Vxe=f$?u.useLayoutEffect:u.useEffect,p$={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function Gxe(){var e=u.useState(null),t=e[0],n=e[1],s=u.useState(p$),i=s[0],o=s[1],a=u.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var c=l[0].contentRect,d=c.x,h=c.y,f=c.width,p=c.height,g=c.top,m=c.left,y=c.bottom,b=c.right;o({x:d,y:h,width:f,height:p,top:g,left:m,bottom:y,right:b})}})},[]);return Vxe(function(){if(t)return a.observe(t),function(){a.disconnect()}},[t]),[n,i]}const g$=f$&&typeof window.ResizeObserver<"u"?Gxe:function(){return[$xe,p$]},zxe={focusOnMount:!0},yv=u.memo(({closeButton:e})=>{kt("ImageViewer");const t=I(sX),[n,s]=g$(),i=u.useRef(null);return ta("viewer",i,zxe),r.jsxs(A,{ref:i,tabIndex:-1,layerStyle:"first",borderRadius:"base",position:"absolute",flexDirection:"column",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[t&&r.jsx(nB,{}),!t&&r.jsx(h$,{closeButton:e}),r.jsxs(Se,{ref:n,w:"full",h:"full",p:2,children:[!t&&r.jsx(Kbe,{}),t&&r.jsx(i$,{containerDims:s})]}),r.jsx(o$,{})]})});yv.displayName="ImageViewer";const m$=u.memo(()=>Lt().isOpen?r.jsx(yv,{closeButton:r.jsx(Pk,{})}):null);m$.displayName="GatedImageViewer";const Pk=u.memo(()=>{const{t:e}=M(),t=Lt();return kt("ImageViewerCloseButton"),Ii("esc",t.close),r.jsx(oe,{tooltip:e("gallery.closeViewer"),"aria-label":e("gallery.closeViewer"),icon:r.jsx(Nt,{}),variant:"link",alignSelf:"stretch",onClick:t.close})});Pk.displayName="ImageViewerCloseButton";const Hxe=u.memo(()=>Lt().isOpen?r.jsx(Pk,{}):null);Hxe.displayName="GatedImageViewerCloseButton";const GT=()=>r.jsx(bi,{children:r.jsxs(It,{children:[r.jsx(oN,{}),r.jsx(GO,{})]})}),y$=u.memo(()=>{const e=u.useRef(null),t=I(h0),n=I(rX),s=u.useCallback(()=>r.jsx(GT,{}),[]);return ta("canvas",e),r.jsxs(A,{tabIndex:-1,ref:e,borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[r.jsx(bi,{children:r.jsx(JF,{})}),r.jsx(ay,{renderMenu:s,withLongPress:!1,children:i=>r.jsxs(A,{ref:i,position:"relative",w:"full",h:"full",bg:t?"base.850":"base.900",borderRadius:"base",overflow:"hidden",children:[r.jsx(UN,{}),r.jsxs(bi,{children:[r.jsxs(A,{position:"absolute",flexDir:"column",top:1,insetInlineStart:1,pointerEvents:"none",gap:2,alignItems:"flex-start",children:[n&&r.jsx(BN,{}),r.jsx(i9,{}),r.jsx(Y7,{}),r.jsx(J0e,{}),r.jsx(mk,{})]}),r.jsx(A,{position:"absolute",top:1,insetInlineEnd:1,children:r.jsxs(Yt,{children:[r.jsx(Xt,{as:oe,icon:r.jsx(Xae,{}),colorScheme:"base"}),r.jsx(GT,{})]})})]})]})}),r.jsx(A,{position:"absolute",bottom:4,gap:2,align:"center",justify:"center",children:r.jsx(bi,{children:r.jsx(QN,{children:r.jsx(lF,{})})})}),r.jsx(A,{position:"absolute",bottom:4,children:r.jsxs(bi,{children:[r.jsx(RN,{}),r.jsx(Bve,{}),r.jsx(YN,{})]})}),r.jsx(bi,{children:r.jsx(uN,{})}),r.jsx(m$,{})]})});y$.displayName="CanvasMainPanelContent";const v$=u.memo(()=>{const{t:e}=M(),t=Cw(),n=Sw(),s=xw(),i=bw(),o=ww(),a=pL(),l=I(ji),c=I(Jl);return r.jsx(A,{w:"full",h:"full",justifyContent:"center",gap:4,children:r.jsxs(A,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[r.jsxs(A,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Rt,{size:"xs",children:e("controlLayers.global")}),r.jsx(Ve,{feature:"globalReferenceImage",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:o,isDisabled:c,children:e("controlLayers.globalReferenceImage")})})]}),r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(Rt,{size:"xs",children:e("controlLayers.regional")}),r.jsx(Ve,{feature:"inpainting",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:t,children:e("controlLayers.inpaintMask")})}),r.jsx(Ve,{feature:"regionalGuidance",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:n,isDisabled:c,children:e("controlLayers.regionalGuidance")})}),r.jsx(Ve,{feature:"regionalReferenceImage",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:a,isDisabled:l||c,children:e("controlLayers.regionalReferenceImage")})})]}),r.jsxs(A,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Rt,{size:"xs",children:e("controlLayers.layer_other")}),r.jsx(Ve,{feature:"controlNet",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:i,isDisabled:c,children:e("controlLayers.controlLayer")})}),r.jsx(Ve,{feature:"rasterLayer",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Gt,{}),onClick:s,children:e("controlLayers.rasterLayer")})})]})]})})});v$.displayName="CanvasAddEntityButtons";function zT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function HT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zT(Object(n),!0).forEach(function(s){Ci(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zT(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Wxe={top:function(t,n){return Math.abs(n.y-t.top)},right:function(t,n){return Math.abs(t.right-n.x)},bottom:function(t,n){return Math.abs(t.bottom-n.y)},left:function(t,n){return Math.abs(n.x-t.left)}},b$=Symbol("closestEdge");function Uxe(e,t){var n,s,i=t.element,o=t.input,a=t.allowedEdges,l={x:o.clientX,y:o.clientY},c=i.getBoundingClientRect(),d=a.map(function(f){return{edge:f,value:Wxe[f](c,l)}}),h=(n=(s=d.sort(function(f,p){return f.value-p.value})[0])===null||s===void 0?void 0:s.edge)!==null&&n!==void 0?n:null;return HT(HT({},e),{},Ci({},b$,h))}function EC(e){var t;return(t=e[b$])!==null&&t!==void 0?t:null}function qxe(e){var t=e.list,n=e.startIndex,s=e.finishIndex;if(n===-1||s===-1)return t;var i=Array.from(t),o=i.splice(n,1),a=Fw(o,1),l=a[0];return i.splice(s,0,l),i}function MC(e){var t=e.startIndex,n=e.closestEdgeOfTarget,s=e.indexOfTarget,i=e.axis;if(t===-1||s===-1||t===s)return t;if(n==null)return s;var o=i==="vertical"&&n==="bottom"||i==="horizontal"&&n==="right",a=t<s;return a?o?s:s-1:o?s+1:s}function x$(e){var t=e.list,n=e.startIndex,s=e.closestEdgeOfTarget,i=e.indexOfTarget,o=e.axis;return qxe({list:t,startIndex:n,finishIndex:MC({closestEdgeOfTarget:s,startIndex:n,indexOfTarget:i,axis:o})})}const oo=e=>`var(--invoke-colors-${e.split(".").join("-")})`,vv={overflow:"visible"},C$=u.memo(({type:e})=>{const{t}=M(),n=st(),s=Cw(),i=Sw(),o=xw(),a=bw(),l=ww(),c=u.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":i();break;case"raster_layer":o();break;case"control_layer":a();break;case"reference_image":l();break}},[a,l,s,o,i,e]),d=u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer");case"reference_image":return t("controlLayers.addGlobalReferenceImage")}},[e,t]);return r.jsx(oe,{size:"sm","aria-label":d,tooltip:d,variant:"link",icon:r.jsx(hs,{}),onClick:c,alignSelf:"stretch",isDisabled:n})});C$.displayName="CanvasEntityAddOfTypeButton";const Kxe=e=>{const t=u.useMemo(()=>{switch(e){case"control_layer":return pe(FE,s=>s.length);case"raster_layer":return pe(FS,s=>s.length);case"inpaint_mask":return pe($E,s=>s.length);case"regional_guidance":return pe(BE,s=>s.length);case"reference_image":return pe(iX,s=>s.length);default:Ge(!1,"Invalid entity type")}},[e]);return I(t)},S$=u.memo(({type:e})=>{const{t}=M(),n=Et(),s=st(),i=Kxe(e),o=u.useCallback(()=>{n.compositor.mergeVisibleOfType(e)},[n.compositor,e]);return r.jsx(oe,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:r.jsx(Wae,{}),onClick:o,alignSelf:"stretch",isDisabled:i<=1||s})});S$.displayName="CanvasEntityMergeVisibleButton";const w$=u.memo(({type:e})=>{const{t}=M(),n=z(),s=xj(e),i=sN(e,!0),o=u.useCallback(a=>{a.stopPropagation(),n(oX({type:e}))},[n,e]);return r.jsx(oe,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),variant:"link",icon:s?r.jsx(Sae,{}):r.jsx($p,{}),onClick:o,alignSelf:"stretch"})});w$.displayName="CanvasEntityTypeIsHiddenToggle";const Zxe=e=>u.useMemo(()=>{switch(e){case"control_layer":return"controlNet";case"inpaint_mask":return"inpainting";case"raster_layer":return"rasterLayer";case"regional_guidance":return"regionalGuidanceAndReferenceImage";case"reference_image":return"globalReferenceImage";default:return}},[e]),Yxe=e=>{const t=u.useMemo(()=>pe(et,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;case"reference_image":return s.referenceImages.entities.length;default:return 0}}),[e]);return I(t)},Xxe=e=>{const{t}=M(),n=xj(e),s=Yxe(e);return u.useMemo(()=>{const o=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:o});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:o});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:o});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:o});case"reference_image":return t("controlLayers.globalReferenceImages_withCount",{count:s,context:o});default:return""}},[e,t,s,n])},vd=u.memo(({isSelected:e,type:t,children:n,entityIdentifiers:s})=>{const i=Xxe(t),o=Zxe(t),a=Q1(!0),l=z();return u.useEffect(()=>to({canMonitor({source:c}){return!(!du.typeGuard(c.data)||c.data.payload.entityIdentifier.type!==t)},onDrop({location:c,source:d}){const h=c.current.dropTargets[0];if(!h)return;const f=d.data,p=h.data;if(!du.typeGuard(f)||!du.typeGuard(p))return;const g=s.findIndex(v=>v.id===f.payload.entityIdentifier.id),m=s.findIndex(v=>v.id===p.payload.entityIdentifier.id);if(m<0||g<0||g===m)return;const y=EC(p);let b=0;if(y==="bottom"?b=1:y==="top"&&(b=-1),g===m+b)return;nc.flushSync(()=>{l(aX({type:t,entityIdentifiers:x$({list:s,startIndex:g,indexOfTarget:m,closestEdgeOfTarget:y,axis:"vertical"})}))});const C=document.querySelector(`[data-entity-id="${f.payload.entityIdentifier.id}"]`);C instanceof HTMLElement&&aB(C,oo("base.700"))}}),[l,s,t]),r.jsxs(A,{flexDir:"column",w:"full",children:[r.jsxs(A,{w:"full",children:[r.jsxs(A,{flexGrow:1,as:ye,onClick:a.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[r.jsx(dt,{boxSize:4,as:ii,transform:a.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),o?r.jsx(Ve,{feature:o,children:r.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i})}):r.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i}),r.jsx(rt,{})]}),r2(t)&&r.jsx(S$,{type:t}),r2(t)&&r.jsx(w$,{type:t}),r.jsx(C$,{type:t})]}),r.jsx(rc,{in:a.isTrue,style:vv,children:r.jsx(A,{flexDir:"column",gap:2,pt:2,children:n})})]})});vd.displayName="CanvasEntityGroupList";const vm={type:"idle"},Qxe=(e,t)=>{const[n,s]=u.useState(vm),[i,o]=u.useState(!1);return u.useEffect(()=>{const a=e.current;if(a)return Hn(gd(a),rd({element:a,getInitialData(){return du.getData({entityIdentifier:t})},onDragStart(){s({type:"is-dragging"}),o(!0)},onDrop(){s(vm),o(!1)}}),ju({element:a,canDrop({source:l}){return!(!du.typeGuard(l.data)||l.data.payload.entityIdentifier.type!==t.type)},getData({input:l}){const c=du.getData({entityIdentifier:t});return Uxe(c,{element:a,input:l,allowedEdges:["top","bottom"]})},getIsSticky(){return!0},onDragEnter({self:l}){const c=EC(l.data);s({type:"is-dragging-over",closestEdge:c})},onDrag({self:l}){const c=EC(l.data);s(d=>d.type==="is-dragging-over"&&d.closestEdge===c?d:{type:"is-dragging-over",closestEdge:c})},onDragLeave(){s(vm)},onDrop(){s(vm)}}))},[t,e]),[n,i]},j$=e=>{const t=u.useMemo(()=>pe(_n,s=>(s==null?void 0:s.id)===e.id),[e.id]);return I(t)},l1={thickness:2,backgroundColor:"red"},Jxe={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:l1.backgroundColor},e2e={horizontal:{height:`${l1.thickness}px`,left:2,right:2},vertical:{width:`${l1.thickness}px`,top:2,bottom:2}},t2e={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},n2e={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function s2e({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${l1.thickness}px))`,s=t2e[e];return r.jsx(Se,{sx:{...Jxe,...e2e[s],...n2e[e],"--local-line-offset":n}})}const r2e=({dndState:e,gap:t})=>e.type!=="is-dragging-over"||!e.closestEdge?null:r.jsx(s2e,{edge:e.closestEdge,gap:t||"var(--invoke-space-2)"}),i2e={position:"relative",flexDir:"column",w:"full",bg:"base.850",borderRadius:"base","&[data-selected=true]":{bg:"base.800"},"&[data-is-dragging=true]":{opacity:.3},transitionProperty:"common"},bd=u.memo(e=>{const t=z(),n=Ye(),s=j$(n),i=u.useCallback(()=>{s||t(iu({entityIdentifier:n}))},[t,n,s]),o=u.useRef(null),[a,l]=Qxe(o,n);return r.jsxs(Se,{position:"relative",children:[r.jsx(A,{"data-entity-id":n.id,"data-selected":s,"data-is-dragging":l,ref:o,onClick:i,sx:i2e,children:e.children}),r.jsx(r2e,{dndState:a})]})});bd.displayName="CanvasEntityContainer";const xd=u.memo(({children:e,...t})=>{const n=Ye(),s=u.useCallback(()=>{if(n.type==="regional_guidance")return r.jsx(It,{children:r.jsx(ak,{})});if(n.type==="inpaint_mask")return r.jsx(It,{children:r.jsx(rk,{})});if(n.type==="raster_layer")return r.jsx(It,{children:r.jsx(ok,{})});if(n.type==="control_layer")return r.jsx(It,{children:r.jsx(sk,{})});if(n.type==="reference_image")return r.jsx(It,{children:r.jsx(ik,{})});Ge(!1,"Unhandled entity type")},[n]);return r.jsx(ay,{renderMenu:s,children:i=>r.jsx(A,{ref:i,gap:2,alignItems:"center",p:2,...t,children:e})})});xd.displayName="CanvasEntityHeader";const k$=u.memo(()=>{const{t:e}=M(),t=Ye(),n=z(),s=st(),i=u.useCallback(()=>{n(OS({entityIdentifier:t}))},[n,t]);return r.jsx(oe,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:r.jsx(Ry,{}),onClick:i,colorScheme:"error",isDisabled:s})});k$.displayName="CanvasEntityDeleteButton";const _$=e=>{const t=u.useMemo(()=>pe(et,s=>{const i=Ga(s,e);return i?i.isEnabled:!1}),[e]);return I(t)},I$=u.memo(()=>{const{t:e}=M(),t=Ye(),n=_$(t),s=st(),i=z(),o=u.useCallback(()=>{i(lX({entityIdentifier:t}))},[i,t]);return r.jsx(oe,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(Zae,{}):r.jsx(gae,{}),onClick:o,isDisabled:s})});I$.displayName="CanvasEntityEnabledToggle";const o2e=(e,t)=>pe(et,Ap,(n,s)=>{const i=Pr(n,e,"CanvasEntityHeaderWarnings");let o=[];const a=i.type;return a==="control_layer"?o=Z3(i,s):a==="regional_guidance"?o=X3(i,s):a==="inpaint_mask"?o=J3():a==="raster_layer"?o=Q3():a==="reference_image"?o=Y3(i,s):Ge(!1,"Unexpected entity type"),o.length===0?xs:o.map(l=>t(l)).map(Pc)}),A$=u.memo(()=>{const e=Ye(),{t}=M(),n=_$(e),s=u.useMemo(()=>o2e(e,t),[e,t]),i=I(s);return i.length===0?null:r.jsx(oe,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:r.jsx(T$,{warnings:i}),icon:r.jsx(zp,{}),colorScheme:"warning",isDisabled:!n})});A$.displayName="CanvasEntityHeaderWarnings";const T$=u.memo(e=>{const{t}=M();return r.jsxs(A,{flexDir:"column",children:[r.jsxs(q,{children:[t("controlLayers.warnings.problemsFound"),":"]}),r.jsx(Pi,{children:e.warnings.map((n,s)=>r.jsx(Vt,{children:n},s))})]})});T$.displayName="TooltipContent";const a2e=e=>{const t=u.useMemo(()=>pe(et,s=>{var i;return((i=s.bookmarkedEntityIdentifier)==null?void 0:i.id)===e.id}),[e]);return I(t)},E$=u.memo(()=>{const{t:e}=M(),t=Ye(),n=a2e(t),s=z(),i=u.useCallback(()=>{s(n?g4({entityIdentifier:null}):g4({entityIdentifier:t}))},[s,t,n]);return r.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(Kae,{}):r.jsx(dae,{}),onClick:i})});E$.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const M$=u.memo(()=>{const{t:e}=M(),t=Ye(),n=Ri(t),s=st(),i=z(),o=u.useCallback(()=>{i(cX({entityIdentifier:t}))},[i,t]);return r.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(eD,{}):r.jsx(zL,{}),onClick:o,isDisabled:s})});M$.displayName="CanvasEntityIsLockedToggle";const Cd=u.memo(()=>{const e=Ye();return r.jsxs(A,{alignSelf:"stretch",children:[r.jsx(A$,{}),r.jsx(E$,{}),e.type!=="reference_image"&&r.jsx(M$,{}),r.jsx(I$,{}),r.jsx(k$,{})]})});Cd.displayName="CanvasEntityHeaderCommonActions";const P$=Qo.canvas,l2e=36,WT=`${l2e}px`,dg=u.memo(()=>{const e=Ye(),t=Cfe(e),n=u.useMemo(()=>pe(et,d=>{const h=Ga(d,e);return h&&(h.type==="inpaint_mask"||h.type==="regional_guidance")?Vl(h.fill.color):null}),[e]),s=uX(n),i=u.useRef(null),o=ce(t.transformer.$pixelRect),a=ce(t.transformer.$nodeRect),l=ce(t.$canvasCache),c=u.useMemo(()=>ri(()=>{if(!i.current)return;const d=i.current.getContext("2d");if(!d)return;const h=t.transformer.$pixelRect.get(),f=t.transformer.$nodeRect.get(),p=t.$canvasCache.get();if(!p||p.width===0||p.height===0){d.clearRect(0,0,i.current.width,i.current.height);return}d.clearRect(0,0,i.current.width,i.current.height),i.current.width=h.width,i.current.height=h.height;const g=h.x-f.x,m=h.y-f.y,y=h.width,b=h.height,C=0,v=0,x=h.width,S=h.height;d.drawImage(p,g,m,y,b,C,v,x,S),s&&(d.fillStyle=s,d.globalCompositeOperation="source-in",d.fillRect(0,0,h.width,h.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return u.useEffect(c,[c,l,a,o]),r.jsx(De,{label:r.jsx(c2e,{canvasRef:i}),p:2,closeOnScroll:!0,children:r.jsxs(A,{position:"relative",alignItems:"center",justifyContent:"center",w:WT,h:WT,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:pd,bgSize:"5px"}),r.jsx(P$,{position:"relative",ref:i,objectFit:"contain",maxW:"full",maxH:"full"})]})})});dg.displayName="CanvasEntityPreviewImage";const c2e=({canvasRef:e})=>{const t=u.useRef(null);return u.useEffect(()=>{if(!t.current||!e.current)return;const n=t.current.getContext("2d");n&&(t.current.width=e.current.width,t.current.height=e.current.height,n.clearRect(0,0,t.current.width,t.current.height),n.drawImage(e.current,0,0))},[e]),r.jsxs(A,{position:"relative",alignItems:"center",justifyContent:"center",w:150,h:150,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:pd,bgSize:"8px"}),r.jsx(P$,{position:"relative",ref:t,objectFit:"contain",maxW:"full",maxH:"full"})]})},bv=u.memo(({children:e})=>r.jsx(A,{flexDir:"column",gap:2,px:2,pb:2,children:e}));bv.displayName="CanvasEntitySettingsWrapper";const oa=({value:e,defaultValue:t,onChange:n,onStartEditing:s,inputRef:i})=>{const[o,a]=u.useState(!1),[l,c]=u.useState(e),d=u.useCallback(()=>{var y;const m=l.trim()||t;c(m),m!==e&&n(m),a(!1),(y=i==null?void 0:i.current)==null||y.setSelectionRange(0,0)},[l,t,e,i,n]),h=u.useCallback(g=>{c(g.target.value)},[]),f=u.useCallback(g=>{g.key==="Enter"&&!g.shiftKey?d():g.key==="Escape"&&(c(e),n(e),a(!1))},[n,d,e]),p=u.useCallback(()=>{a(!0),s==null||s()},[s]);return u.useEffect(()=>{c(e)},[e]),u.useEffect(()=>{var g,m;o&&((g=i==null?void 0:i.current)==null||g.focus(),(m=i==null?void 0:i.current)==null||m.select())},[i,o]),{isEditing:o,startEditing:p,value:l,inputProps:{value:l,onChange:h,onKeyDown:f,onBlur:d}}},L$=u.memo(e=>{const t=Ye(),n=j$(t),s=s9(t);return r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});L$.displayName="CanvasEntityTitle";const Sd=u.memo(()=>{const e=z(),t=Ye(),n=u.useRef(null),s=t9(t),i=n9(t.type),o=u.useCallback(l=>{e(dX({entityIdentifier:t,name:l}))},[e,t]),a=oa({value:s||i,defaultValue:i,onChange:o,inputRef:n});return a.isEditing?r.jsx(jt,{ref:n,...a.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}}):r.jsx(L$,{cursor:"text",onDoubleClick:a.startEditing})});Sd.displayName="CanvasEntityTitleEdit";const u2e=e=>pe(et,t=>Pr(t,e,"ControlLayerBadgesContent").withTransparencyEffect),D$=u.memo(()=>{const e=Ye("control_layer"),{t}=M(),n=u.useMemo(()=>u2e(e),[e]);return I(n)?r.jsx(is,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")}):null});D$.displayName="ControlLayerBadgesContent";const R$=u.memo(()=>{const e=Ye("control_layer");return r.jsx(sa,{entityIdentifier:e,children:r.jsx(D$,{})})});R$.displayName="ControlLayerBadges";const cx=Fs("gallery"),cc=({onUpload:e,isDisabled:t,allowMultiple:n})=>{const s=I(Er),[i,o]=rE(),a=I(kS),{t:l}=M(),c=u.useCallback(async g=>{if(n){const m=await lE(g.map((y,b)=>({file:y,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!1,isFirstUploadOfBatch:b===0})));e&&e(m)}else{if(g.length>1){cx.warn("Multiple files dropped but only one allowed");return}if(g.length===0){cx.warn("No files dropped");return}const m=g[0];Ge(m!==void 0);const y=await i({file:m,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!0}).unwrap();e&&e(y)}},[n,s,e,i]),d=u.useCallback(g=>{if(g.length>0){const m=g.map(b=>({errors:b.errors.map(({message:C})=>C),file:b.file.path}));cx.error({errors:m},"Invalid upload");const y=a===void 0?l("toast.uploadFailedInvalidUploadDesc"):l("toast.uploadFailedInvalidUploadDesc_withCount",{count:a});ve({id:"UPLOAD_FAILED",title:l("toast.uploadFailed"),description:y,status:"error"});return}},[a,l]),{getRootProps:h,getInputProps:f,open:p}=Ya({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,onDropRejected:d,disabled:t,noDrag:!0,multiple:n&&(a===void 0||a>1),maxFiles:a});return{getUploadButtonProps:h,getUploadInputProps:f,openUploader:p,request:o}},O$={"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid",borderWidth:1}},Lk=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=cc({isDisabled:e,allowMultiple:!1,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:O$,"data-error":n,icon:r.jsx(Gp,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},d2e=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=cc({isDisabled:e,allowMultiple:!0,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:O$,"data-error":n,icon:r.jsx(Gp,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},h2e=e=>`${Math.round(e*100)}%`,f2e=["Begin Step %","End Step %"],xv=u.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(()=>{t([0,1])},[t]);return r.jsxs(Z,{orientation:"horizontal",pe:2,children:[r.jsx(Ve,{feature:"controlNetBeginEnd",children:r.jsx(te,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),r.jsx(hX,{"aria-label":f2e,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:h2e,marks:!0,withThumbTooltip:!0})]})});xv.displayName="BeginEndStepPct";const p2e=e=>e.toFixed(2),g2e=[0,1,2],m2e=pe(Ar,e=>e.sd.ca.weight),Cv=u.memo(({weight:e,onChange:t})=>{const{t:n}=M(),s=I(m2e);return r.jsxs(Z,{orientation:"horizontal",children:[r.jsx(Ve,{feature:"controlNetWeight",children:r.jsx(te,{m:0,children:n("controlLayers.weight")})}),r.jsx(Ze,{value:e,onChange:t,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,marks:g2e,formatValue:p2e}),r.jsx(Ae,{value:e,onChange:t,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,maxW:20,defaultValue:s.initial})]})});Cv.displayName="Weight";const N$=u.memo(({controlMode:e,onChange:t})=>{const{t:n}=M(),s=u.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),i=u.useCallback(a=>{Ge(fX(a==null?void 0:a.value)),t(a.value)},[t]),o=u.useMemo(()=>s.filter(a=>a.value===e)[0],[s,e]);return e?r.jsxs(Z,{children:[r.jsx(Ve,{feature:"controlNetControlMode",children:r.jsx(te,{m:0,children:n("controlLayers.controlMode.controlMode")})}),r.jsx(Fe,{value:o,options:s,onChange:i,isClearable:!1,isSearchable:!1})]}):null});N$.displayName="ControlLayerControlAdapterControlMode";const y2e=e=>e.base.toUpperCase(),v2e=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,b2e=pe(Bu,e=>{var t;return((t=e.model)==null?void 0:t.base)??"sdxl"}),hn=e=>{const{t}=M(),n=I(b2e),s=I(ty),{modelConfigs:i,selectedModel:o,getIsDisabled:a,onChange:l,isLoading:c,groupByType:d=!1}=e,h=u.useMemo(()=>{if(!i)return[];const y=K3(i,d?v2e:y2e),b=pX(y,(C,v,x)=>(C.push({label:x,options:v.map(S=>({label:S.name,value:S.key,description:s&&S.description||void 0,isDisabled:a?a(S):!1}))}),C),[]);return b.sort(C=>{var v,x;return(x=(v=C.label)==null?void 0:v.split("/")[0])!=null&&x.toLowerCase().includes(n)?-1:1}),b},[i,d,a,n,s]),f=u.useMemo(()=>h.flatMap(y=>y.options).find(y=>o?y.value===o.key:!1)??null,[h,o]),p=u.useCallback(y=>{if(!y){l(null);return}const b=i.find(C=>C.key===y.value);if(!b){l(null);return}l(b)},[i,l]),g=u.useMemo(()=>c?t("common.loading"):h.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[c,h,t]),m=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}},F$=u.memo(({modelKey:e,onChange:t})=>{const{t:n}=M(),s=I(Yl),[i,{isLoading:o}]=Yde(),a=u.useMemo(()=>i.find(g=>g.key===e),[i,e]),l=u.useCallback(g=>{g&&t(g)},[t]),c=u.useCallback(g=>{const m=s===g.base;return!!!s||!m},[s]),{options:d,value:h,onChange:f,noOptionsMessage:p}=hn({modelConfigs:i,onChange:l,selectedModel:a,getIsDisabled:c,isLoading:o,groupByType:!0});return r.jsx(De,{label:a==null?void 0:a.description,children:r.jsx(Z,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:r.jsx(Fe,{options:d,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:f,noOptionsMessage:p})})})});F$.displayName="ControlLayerControlAdapterModel";const x2e=e=>pe(et,t=>Pr(t,e,"ControlLayerControlAdapter").controlAdapter),B$=u.memo(()=>{var C;const{t:e}=M(),{dispatch:t,getState:n}=jn(),s=Ye("control_layer"),i=u.useMemo(()=>x2e(s),[s]),o=I(i),a=iv(s),l=I(ji),c=xfe("control_layer"),d=u.useCallback(v=>{t(gX({entityIdentifier:s,beginEndStepPct:v}))},[t,s]),h=u.useCallback(v=>{t(mX({entityIdentifier:s,controlMode:v}))},[t,s]),f=u.useCallback(v=>{t(yX({entityIdentifier:s,weight:v}))},[t,s]),p=u.useCallback(v=>{t(vX({entityIdentifier:s,modelConfig:v}));const x=c.filterer.$isFiltering.get(),S=c.filterer.$simple.get();if(x&&!S)return;const w=mN(v);if(!w){x&&c.filterer.cancel();return}const j=w.buildDefaults();x?(c.filterer.$filterConfig.set(j),c.filterer.process()):c.filterer.start(j)},[c.filterer,t,s]),g=l1e(s),m=st(),y=u.useMemo(()=>({onUpload:v=>{Aw({entityIdentifier:s,imageDTO:v,dispatch:t,getState:n})},allowMultiple:!1}),[t,s,n]),b=cc(y);return r.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",children:[r.jsxs(A,{w:"full",gap:2,children:[r.jsx(F$,{modelKey:((C=o.model)==null?void 0:C.key)??null,onChange:p}),r.jsx(oe,{onClick:a.start,isDisabled:a.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(Rw,{})}),r.jsx(oe,{onClick:g,isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:r.jsx(qa,{})}),r.jsx(oe,{isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:r.jsx(Gp,{}),...b.getUploadButtonProps()}),r.jsx("input",{...b.getUploadInputProps()})]}),r.jsx(Cv,{weight:o.weight,onChange:f}),o.type!=="control_lora"&&r.jsx(xv,{beginEndStepPct:o.beginEndStepPct,onChange:d}),o.type==="controlnet"&&!l&&r.jsx(N$,{controlMode:o.controlMode,onChange:h})]})});B$.displayName="ControlLayerControlAdapter";const $$=u.memo(()=>{const e=Ye("control_layer"),{dispatch:t,getState:n}=jn(),s=st(),i=u.useCallback(l=>{Aw({imageDTO:l,entityIdentifier:e,dispatch:t,getState:n})},[t,e,n]),o=cc({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{t(Cr("gallery"))},[t]);return r.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Jt,{i18nKey:"controlLayers.controlLayerEmptyState",components:{UploadButton:r.jsx(ye,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}})}),r.jsx("input",{...o.getUploadInputProps()})]})});$$.displayName="ControlLayerSettingsEmptyState";const V$=u.memo(()=>{const e=Ye();return sg(e)?r.jsx($$,{}):r.jsx(B$,{})});V$.displayName="ControlLayerSettings";const G$=u.memo(({id:e})=>{const{t}=M(),n=st(),s=u.useMemo(()=>({id:e,type:"control_layer"}),[e]),i=u.useMemo(()=>Zf.getData({entityIdentifier:s},s.id),[s]);return r.jsx(ac.Provider,{value:s,children:r.jsx(Q7,{children:r.jsx(sa,{entityIdentifier:s,children:r.jsxs(bd,{children:[r.jsxs(xd,{children:[r.jsx(dg,{}),r.jsx(Sd,{}),r.jsx(rt,{}),r.jsx(R$,{}),r.jsx(Cd,{})]}),r.jsx(bv,{children:r.jsx(V$,{})}),r.jsx(gs,{dndTarget:Zf,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});G$.displayName="ControlLayer";const C2e=tn(et,e=>e.controlLayers.entities.map(Ys).toReversed()),S2e=pe(_n,e=>(e==null?void 0:e.type)==="control_layer"),z$=u.memo(()=>{const e=I(S2e),t=I(C2e);if(t.length===0)return null;if(t.length>0)return r.jsx(vd,{type:"control_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(G$,{id:n.id},n.id))})});z$.displayName="ControlLayerEntityList";const H$=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return r.jsx(ac.Provider,{value:t,children:r.jsx(J7,{children:r.jsx(sa,{entityIdentifier:t,children:r.jsx(bd,{children:r.jsxs(xd,{children:[r.jsx(dg,{}),r.jsx(Sd,{}),r.jsx(rt,{}),r.jsx(Cd,{})]})})})})})});H$.displayName="InpaintMask";const w2e=tn(et,e=>e.inpaintMasks.entities.map(Ys).toReversed()),j2e=pe(_n,e=>(e==null?void 0:e.type)==="inpaint_mask"),W$=u.memo(()=>{const e=I(j2e),t=I(w2e);if(t.length===0)return null;if(t.length>0)return r.jsx(vd,{type:"inpaint_mask",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(H$,{id:n.id},n.id))})});W$.displayName="InpaintMaskList";const Dk=u.memo(({method:e,onChange:t})=>{const{t:n}=M(),s=I(ty),i=u.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full",description:s?n("controlLayers.ipAdapterMethod.fullDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.style"),value:"style",description:s?n("controlLayers.ipAdapterMethod.styleDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition",description:s?n("controlLayers.ipAdapterMethod.compositionDesc"):void 0}],[n,s]),o=u.useCallback(l=>{Ge(bX(l==null?void 0:l.value)),t(l.value)},[t]),a=u.useMemo(()=>i.find(l=>l.value===e),[i,e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"ipAdapterMethod",children:r.jsx(te,{children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})});Dk.displayName="IPAdapterMethod";const U$=u.memo(()=>{const{t:e}=M(),t=Ye("reference_image"),n=z(),s=st(),i=u.useCallback(d=>{_L({imageDTO:d,entityIdentifier:t,dispatch:n})},[n,t]),o=cc({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{n(Cr("gallery"))},[n]),l=u.useMemo(()=>qf.getData({entityIdentifier:t}),[t]),c=u.useMemo(()=>({UploadButton:r.jsx(ye,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,a,o]);return r.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Jt,{i18nKey:"controlLayers.referenceImageEmptyState",components:c})}),r.jsx("input",{...o.getUploadInputProps()}),r.jsx(gs,{dndTarget:qf,dndTargetData:l,label:e("controlLayers.useImage"),isDisabled:s})]})});U$.displayName="IPAdapterSettingsEmptyState";const Rk=u.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:i}=M(),o=ce(Wn),{currentData:a,isError:l}=Ua((e==null?void 0:e.image_name)??ws),c=u.useCallback(()=>{t(null)},[t]);u.useEffect(()=>{o&&l&&c()},[c,l,o]);const d=u.useCallback(h=>{t(h)},[t]);return r.jsxs(A,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!a&&!(e!=null&&e.image_name),children:[!a&&r.jsx(Lk,{w:"full",h:"full",isError:!a&&!(e!=null&&e.image_name),onUpload:d,fontSize:36}),a&&r.jsxs(r.Fragment,{children:[r.jsx(tl,{imageDTO:a}),r.jsx(A,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:r.jsx(Xo,{onClick:c,icon:r.jsx(Di,{size:16}),tooltip:i("common.reset")})})]}),r.jsx(gs,{dndTarget:n,dndTargetData:s,label:i("gallery.drop")})]})});Rk.displayName="IPAdapterImagePreview";const PC="ViT-L",UT=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"},{label:PC,value:PC}],Ok=u.memo(({modelKey:e,onChangeModel:t,clipVisionModel:n,onChangeCLIPVisionModel:s})=>{const{t:i}=M(),o=I(Yl),[a,{isLoading:l}]=gj(),c=u.useMemo(()=>a.find(x=>x.key===e),[a,e]),d=u.useCallback(x=>{x&&t(x)},[t]),h=u.useCallback(x=>{Ge(xX(x==null?void 0:x.value)),s(x.value)},[s]),f=I(ji),p=u.useCallback(x=>{const S=o===x.base;return!!!o||!S},[o]),{options:g,value:m,onChange:y,noOptionsMessage:b}=hn({modelConfigs:a,onChange:d,selectedModel:c,getIsDisabled:p,isLoading:l}),C=u.useMemo(()=>UT.map(x=>({...x,isDisabled:f&&x.value!==PC})),[f]),v=u.useMemo(()=>UT.find(x=>x.value===n),[n]);return r.jsxs(A,{gap:2,children:[r.jsx(De,{label:c==null?void 0:c.description,children:r.jsx(Z,{isInvalid:!m||o!==(c==null?void 0:c.base),w:"full",children:r.jsx(Fe,{options:g,placeholder:i("common.placeholderSelectAModel"),value:m,onChange:y,noOptionsMessage:b})})}),(c==null?void 0:c.format)==="checkpoint"&&r.jsx(Z,{isInvalid:!m||o!==(c==null?void 0:c.base),width:"max-content",minWidth:28,children:r.jsx(Fe,{options:C,placeholder:i("common.placeholderSelectAModel"),value:v,onChange:h})})]})});Ok.displayName="IPAdapterModel";const k2e=e=>pe(et,t=>Pr(t,e,"IPAdapterSettings").ipAdapter),q$=u.memo(()=>{var y,b;const{t:e}=M(),t=z(),n=Ye("reference_image"),s=u.useMemo(()=>k2e(n),[n]),i=I(s),o=u.useCallback(C=>{t(CX({entityIdentifier:n,beginEndStepPct:C}))},[t,n]),a=u.useCallback(C=>{t(SX({entityIdentifier:n,weight:C}))},[t,n]),l=u.useCallback(C=>{t(wX({entityIdentifier:n,method:C}))},[t,n]),c=u.useCallback(C=>{t(jX({entityIdentifier:n,modelConfig:C}))},[t,n]),d=u.useCallback(C=>{t(kX({entityIdentifier:n,clipVisionModel:C}))},[t,n]),h=u.useCallback(C=>{t(xS({entityIdentifier:n,imageDTO:C}))},[t,n]),f=u.useMemo(()=>{var C;return qf.getData({entityIdentifier:n},(C=i.image)==null?void 0:C.image_name)},[n,(y=i.image)==null?void 0:y.image_name]),p=VO(n),g=st(),m=I(ji);return r.jsx(bv,{children:r.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(A,{gap:2,alignItems:"center",w:"full",children:[r.jsx(Se,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:r.jsx(Ok,{modelKey:((b=i.model)==null?void 0:b.key)??null,onChangeModel:c,clipVisionModel:i.clipVisionModel,onChangeCLIPVisionModel:d})}),r.jsx(oe,{onClick:p,isDisabled:g,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(qa,{})})]}),r.jsxs(A,{gap:2,w:"full",alignItems:"center",children:[r.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[!m&&r.jsx(Dk,{method:i.method,onChange:l}),r.jsx(Cv,{weight:i.weight,onChange:a}),r.jsx(xv,{beginEndStepPct:i.beginEndStepPct,onChange:o})]}),r.jsx(A,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:r.jsx(Rk,{image:i.image,onChangeImage:h,dndTarget:qf,dndTargetData:f})})]})]})})});q$.displayName="IPAdapterSettingsContent";const _2e=e=>pe(et,t=>{const n=Ga(t,e);return!!n&&n.ipAdapter.image!==null}),K$=u.memo(()=>{const e=Ye("reference_image"),t=u.useMemo(()=>_2e(e),[e]);return I(t)?r.jsx(q$,{}):r.jsx(U$,{})});K$.displayName="IPAdapterSettings";const Z$=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"reference_image"}),[e]);return r.jsx(ac.Provider,{value:t,children:r.jsx(sa,{entityIdentifier:t,children:r.jsxs(bd,{children:[r.jsxs(xd,{ps:4,py:5,children:[r.jsx(Sd,{}),r.jsx(rt,{}),r.jsx(Cd,{})]}),r.jsx(K$,{})]})})})});Z$.displayName="IPAdapter";const I2e=tn(et,e=>e.referenceImages.entities.map(Ys).toReversed()),A2e=pe(_n,e=>(e==null?void 0:e.type)==="reference_image"),Y$=u.memo(()=>{const e=I(A2e),t=I(I2e);if(t.length===0)return null;if(t.length>0)return r.jsx(vd,{type:"reference_image",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(Z$,{id:n.id},n.id))})});Y$.displayName="IPAdapterList";const X$=u.memo(({id:e})=>{const{t}=M(),n=st(),s=u.useMemo(()=>({id:e,type:"raster_layer"}),[e]),i=u.useMemo(()=>Zf.getData({entityIdentifier:s},s.id),[s]);return r.jsx(ac.Provider,{value:s,children:r.jsx(X7,{children:r.jsx(sa,{entityIdentifier:s,children:r.jsxs(bd,{children:[r.jsxs(xd,{children:[r.jsx(dg,{}),r.jsx(Sd,{}),r.jsx(rt,{}),r.jsx(Cd,{})]}),r.jsx(gs,{dndTarget:Zf,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});X$.displayName="RasterLayer";const T2e=tn(et,e=>e.rasterLayers.entities.map(Ys).toReversed()),E2e=pe(_n,e=>(e==null?void 0:e.type)==="raster_layer"),Q$=u.memo(()=>{const e=I(E2e),t=I(T2e);if(t.length===0)return null;if(t.length>0)return r.jsx(vd,{type:"raster_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(X$,{id:n.id},n.id))})});Q$.displayName="RasterLayerEntityList";const J$=u.memo(()=>{const e=Ye("regional_guidance"),{t}=M(),n=u.useMemo(()=>pe(et,i=>Pr(i,e,"RegionalGuidanceBadges").autoNegative),[e]),s=I(n);return r.jsx(r.Fragment,{children:s&&r.jsx(is,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});J$.displayName="RegionalGuidanceBadges";const M2e=()=>{const e=Ye("regional_guidance"),{t}=M(),n=gL(e),s=mL(e),i=yL(e),o=u.useMemo(()=>vL(e),[e]),a=I(o);return r.jsxs(A,{w:"full",p:2,justifyContent:"space-between",children:[r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Gt,{}),onClick:s,isDisabled:!a.canAddPositivePrompt,children:t("controlLayers.prompt")}),r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Gt,{}),onClick:i,isDisabled:!a.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Gt,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},eV=u.memo(({referenceImageId:e})=>{const{t}=M(),n=Ye("regional_guidance"),s=z(),i=st(),o=u.useCallback(h=>{IL({imageDTO:h,entityIdentifier:n,referenceImageId:e,dispatch:s})},[s,n,e]),a=cc({onUpload:o,allowMultiple:!1}),l=u.useCallback(()=>{s(Cr("gallery"))},[s]),c=u.useCallback(()=>{s(CM({entityIdentifier:n,referenceImageId:e}))},[s,n,e]),d=u.useMemo(()=>Kf.getData({entityIdentifier:n,referenceImageId:e}),[n,e]);return r.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(q,{fontWeight:"semibold",color:"base.400",children:t("controlLayers.referenceImage")}),r.jsx(rt,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Nt,{}),tooltip:t("controlLayers.deleteReferenceImage"),"aria-label":t("controlLayers.deleteReferenceImage"),onClick:c,colorScheme:"error"})]}),r.jsx(A,{alignItems:"center",gap:2,p:4,children:r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Jt,{i18nKey:"controlLayers.referenceImageEmptyState",components:{UploadButton:r.jsx(ye,{isDisabled:i,size:"sm",variant:"link",color:"base.300",...a.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:l,isDisabled:i,size:"sm",variant:"link",color:"base.300"})}})})}),r.jsx("input",{...a.getUploadInputProps()}),r.jsx(gs,{dndTarget:Kf,dndTargetData:d,label:t("controlLayers.useImage"),isDisabled:i})]})});eV.displayName="RegionalGuidanceIPAdapterSettingsEmptyState";const tV=u.memo(({referenceImageId:e})=>{var b,C;const t=Ye("regional_guidance"),{t:n}=M(),s=z(),i=u.useCallback(()=>{s(CM({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),o=u.useMemo(()=>pe(et,v=>{const x=SM(v,t,e);return Ge(x,`Regional Guidance IP Adapter with id ${e} not found`),x.ipAdapter}),[t,e]),a=I(o),l=u.useCallback(v=>{s(_X({entityIdentifier:t,referenceImageId:e,beginEndStepPct:v}))},[s,t,e]),c=u.useCallback(v=>{s(IX({entityIdentifier:t,referenceImageId:e,weight:v}))},[s,t,e]),d=u.useCallback(v=>{s(AX({entityIdentifier:t,referenceImageId:e,method:v}))},[s,t,e]),h=u.useCallback(v=>{s(TX({entityIdentifier:t,referenceImageId:e,modelConfig:v}))},[s,t,e]),f=u.useCallback(v=>{s(EX({entityIdentifier:t,referenceImageId:e,clipVisionModel:v}))},[s,t,e]),p=u.useCallback(v=>{s(CS({entityIdentifier:t,referenceImageId:e,imageDTO:v}))},[s,t,e]),g=u.useMemo(()=>{var v;return Kf.getData({entityIdentifier:t,referenceImageId:e},(v=a.image)==null?void 0:v.image_name)},[t,(b=a.image)==null?void 0:b.image_name,e]),m=c1e(t,e),y=st();return r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(q,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),r.jsx(rt,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Nt,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:i,colorScheme:"error"})]}),r.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(A,{gap:2,alignItems:"center",w:"full",children:[r.jsx(Se,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:r.jsx(Ok,{modelKey:((C=a.model)==null?void 0:C.key)??null,onChangeModel:h,clipVisionModel:a.clipVisionModel,onChangeCLIPVisionModel:f})}),r.jsx(oe,{onClick:m,isDisabled:y,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(qa,{})})]}),r.jsxs(A,{gap:2,w:"full",children:[r.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[r.jsx(Dk,{method:a.method,onChange:d}),r.jsx(Cv,{weight:a.weight,onChange:c}),r.jsx(xv,{beginEndStepPct:a.beginEndStepPct,onChange:l})]}),r.jsx(A,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:r.jsx(Rk,{image:a.image,onChangeImage:p,dndTarget:Kf,dndTargetData:g})})]})]})]})});tV.displayName="RegionalGuidanceIPAdapterSettingsContent";const P2e=(e,t)=>pe(et,n=>{const s=SM(n,e,t);return!!s&&s.ipAdapter.image!==null}),nV=u.memo(({referenceImageId:e})=>{const t=Ye("regional_guidance"),n=u.useMemo(()=>P2e(t,e),[t,e]);return I(n)?r.jsx(tV,{referenceImageId:e}):r.jsx(eV,{referenceImageId:e})});nV.displayName="RegionalGuidanceIPAdapterSettings";const sV=u.memo(()=>{const e=Ye("regional_guidance"),t=u.useMemo(()=>tn(et,s=>{const i=Pr(s,e,"RegionalGuidanceIPAdapters").referenceImages.map(({id:o})=>o);return i.length===0?xs:i}),[e]),n=I(t);return n.length===0?null:r.jsx(r.Fragment,{children:n.map((s,i)=>r.jsxs(u.Fragment,{children:[i>0&&r.jsx(Pt,{}),r.jsx(nV,{referenceImageId:s})]},s))})});sV.displayName="RegionalGuidanceLayerIPAdapterList";const Nk=u.memo(({onDelete:e,...t})=>{const{t:n}=M();return r.jsx(oe,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:r.jsx(Nt,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});Nk.displayName="RegionalGuidanceDeletePromptButton";const uc=u.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=M();return r.jsx(De,{label:s("prompt.addPromptTrigger"),children:r.jsx(oe,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:r.jsx(yae,{}),onClick:t})})});uc.displayName="AddPromptTriggerButton";const L2e=()=>Te("prompt.noMatchingTriggers"),rV=u.memo(({onSelect:e,onClose:t})=>{const{t:n}=M(),s=I(Ap),i=I(MX),{data:o,isLoading:a}=Tp((s==null?void 0:s.key)??ws),[l,{isLoading:c}]=Yy(),[d,{isLoading:h}]=k7(),f=u.useCallback(g=>{if(!g){e("");return}e(g.value)},[e]),p=u.useMemo(()=>{var m;const g=[];if(d){const y=d.filter(b=>b.base===(o==null?void 0:o.base)).map(b=>({label:b.name,value:`<${b.name}>`}));y.length>0&&g.push({label:n("prompt.compatibleEmbeddings"),options:y})}if(l){const y=l.filter(b=>_i(i,C=>C.model.key).includes(b.key)).map(b=>b.trigger_phrases?b.trigger_phrases.map(C=>({label:C,value:C})):[]).flatMap(b=>b);y.length>0&&g.push({label:n("modelManager.loraTriggerPhrases"),options:PX(y)})}return o&&d0(o)&&((m=o.trigger_phrases)!=null&&m.length)&&g.push({label:n("modelManager.mainModelTriggerPhrases"),options:o.trigger_phrases.map(y=>({label:y,value:y}))}),g},[d,l,o,n,i]);return r.jsx(Z,{children:r.jsx(Fe,{placeholder:n(c||h||a?"common.loading":"prompt.addPromptTrigger"),defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:p,noOptionsMessage:L2e,onChange:f,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:D2e})})});rV.displayName="PromptTriggerSelect";const D2e={w:"full"},dc=u.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:i,children:o}=e;return r.jsxs(Fn,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[r.jsx(kp,{children:o}),r.jsx(Bn,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:r.jsx(qn,{p:0,width:`calc(${i}px - 0.25rem)`,children:r.jsx(rV,{onClose:s,onSelect:t})})})]})});dc.displayName="PromptPopover";const wd=({prompt:e,textareaRef:t,onChange:n})=>{const{isOpen:s,onClose:i,onOpen:o}=ir(),a=u.useCallback(p=>{n(p.target.value)},[n]),l=u.useCallback(p=>{if(!t.current)return;const g=t.current.selectionStart;if(qe(g))return;let m=e.slice(0,g);m+=`${p}`;const y=m.length;m+=e.slice(g),nc.flushSync(()=>{n(m)}),t.current.selectionStart=y,t.current.selectionEnd=y},[t,n,e]),c=u.useCallback(()=>{var p;(p=t.current)==null||p.focus()},[t]),d=u.useCallback(()=>{i(),c()},[c,i]),h=u.useCallback(p=>{l(p),d()},[d,l]),f=u.useCallback(p=>{p.key==="<"&&(o(),p.preventDefault())},[o]);return{onChange:a,isOpen:s,onClose:i,onOpen:o,onSelect:h,onKeyDown:f,onFocus:c}},R2e={outline:"none"},iV=u.memo(()=>{var m;const e=Ye("regional_guidance"),t=u.useMemo(()=>pe(et,y=>Pr(y,e,"RegionalGuidanceNegativePrompt").negativePrompt??""),[e]),n=I(t),s=z(),i=u.useRef(null),{t:o}=M(),a=u.useCallback(y=>{s(Zx({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s(Zx({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=wd({prompt:n,textareaRef:i,onChange:a});return r.jsx(dc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(Qn,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.negativePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,fontSize:"sm",zIndex:"0 !important",_focusVisible:R2e}),r.jsxs(A,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(Nk,{onDelete:l}),r.jsx(uc,{isOpen:d,onOpen:f})]})]})})});iV.displayName="RegionalGuidanceNegativePrompt";const O2e={outline:"none"},oV=u.memo(()=>{var m;const e=Ye("regional_guidance"),t=u.useMemo(()=>pe(et,y=>Pr(y,e,"RegionalGuidancePositivePrompt").positivePrompt??""),[e]),n=I(t),s=z(),i=u.useRef(null),{t:o}=M(),a=u.useCallback(y=>{s(Kx({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s(Kx({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=wd({prompt:n,textareaRef:i,onChange:a});return r.jsx(dc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(Qn,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.positivePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",_focusVisible:O2e}),r.jsxs(A,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(Nk,{onDelete:l}),r.jsx(uc,{isOpen:d,onOpen:f})]})]})})});oV.displayName="RegionalGuidancePositivePrompt";const N2e=e=>tn(et,t=>{const n=Pr(t,e,"RegionalGuidanceSettings");return{hasPositivePrompt:n.positivePrompt!==null,hasNegativePrompt:n.negativePrompt!==null,hasIPAdapters:n.referenceImages.length>0}}),aV=u.memo(()=>{const e=Ye("regional_guidance"),t=u.useMemo(()=>N2e(e),[e]),n=I(t);return r.jsxs(bv,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&r.jsx(M2e,{}),n.hasPositivePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(oV,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&r.jsx(Pt,{})]}),n.hasNegativePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(iV,{}),n.hasIPAdapters&&r.jsx(Pt,{})]}),n.hasIPAdapters&&r.jsx(sV,{})]})});aV.displayName="RegionalGuidanceSettings";const lV=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return r.jsx(ac.Provider,{value:t,children:r.jsx(e9,{children:r.jsx(sa,{entityIdentifier:t,children:r.jsxs(bd,{children:[r.jsxs(xd,{children:[r.jsx(dg,{}),r.jsx(Sd,{}),r.jsx(rt,{}),r.jsx(J$,{}),r.jsx(Cd,{})]}),r.jsx(aV,{})]})})})})});lV.displayName="RegionalGuidance";const F2e=tn(et,e=>e.regionalGuidance.entities.map(Ys).toReversed()),B2e=pe(_n,e=>(e==null?void 0:e.type)==="regional_guidance"),cV=u.memo(()=>{const e=I(B2e),t=I(F2e);if(t.length===0)return null;if(t.length>0)return r.jsx(vd,{type:"regional_guidance",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(lV,{id:n.id},n.id))})});cV.displayName="RegionalGuidanceEntityList";const uV=u.memo(()=>r.jsx($n,{children:r.jsxs(A,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[r.jsx(Y$,{}),r.jsx(W$,{}),r.jsx(cV,{}),r.jsx(z$,{}),r.jsx(Q$,{})]})}));uV.displayName="CanvasEntityList";const dV=u.memo(()=>{const{t:e}=M(),t=st(),n=ww(),s=Cw(),i=Sw(),o=pL(),a=xw(),l=bw(),c=I(ji),d=I(Jl);return r.jsxs(Yt,{children:[r.jsx(Xt,{as:oe,minW:8,variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:r.jsx(Gt,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),r.jsxs(It,{children:[r.jsx(xr,{title:e("controlLayers.global"),children:r.jsx(he,{icon:r.jsx(Gt,{}),onClick:n,isDisabled:d,children:e("controlLayers.globalReferenceImage")})}),r.jsxs(xr,{title:e("controlLayers.regional"),children:[r.jsx(he,{icon:r.jsx(Gt,{}),onClick:s,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(Gt,{}),onClick:i,isDisabled:d,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(Gt,{}),onClick:o,isDisabled:c||d,children:e("controlLayers.regionalReferenceImage")})]}),r.jsxs(xr,{title:e("controlLayers.layer_other"),children:[r.jsx(he,{icon:r.jsx(Gt,{}),onClick:l,isDisabled:d,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(Gt,{}),onClick:a,children:e("controlLayers.rasterLayer")})]})]})]})});dV.displayName="EntityListGlobalActionBarAddLayerMenu";const hV=u.memo(()=>{const{t:e}=M(),t=z(),n=st(),s=I(_n),i=u.useCallback(()=>{s&&t(kE({entityIdentifier:s}))},[t,s]);return r.jsx(oe,{onClick:i,isDisabled:!s||n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:r.jsx(JL,{})})});hV.displayName="EntityListSelectedEntityActionBarDuplicateButton";const ux={width:6,height:6,borderColor:"base.100"},$2e={".react-colorful__hue-pointer":ux,".react-colorful__saturation-pointer":ux,".react-colorful__alpha-pointer":ux,gap:4,flexDir:"column"},V2e={width:"100%"},dx="3.5rem",G2e=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=M(),a=u.useCallback(d=>n({...t,r:d}),[t,n]),l=u.useCallback(d=>n({...t,g:d}),[t,n]),c=u.useCallback(d=>n({...t,b:d}),[t,n]);return r.jsxs(A,{sx:$2e,children:[r.jsx(ove,{color:t,onChange:n,style:V2e}),s&&r.jsxs(A,{gap:4,children:[r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.red")[0]}),r.jsx(Ae,{flexGrow:1,value:t.r,onChange:a,min:0,max:255,step:1,w:dx,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.green")[0]}),r.jsx(Ae,{flexGrow:1,value:t.g,onChange:l,min:0,max:255,step:1,w:dx,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.blue")[0]}),r.jsx(Ae,{flexGrow:1,value:t.b,onChange:c,min:0,max:255,step:1,w:dx,defaultValue:255})]})]}),i&&r.jsx(A,{gap:2,justifyContent:"space-between",children:Qye.map((d,h)=>r.jsx(H2e,{color:d,onChange:n},h))})]})},z2e=u.memo(G2e),H2e=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(Se,{role:"button",onClick:n,h:8,w:8,bg:Vl(e),borderRadius:"base"})},fV=u.memo(({style:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(a=>{LX(a==null?void 0:a.value)&&t(a.value)},[t]),i=u.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),o=u.useMemo(()=>i.find(a=>a.value===e),[i,e]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.fill.fillStyle")}),r.jsx(Fe,{value:o,options:i,onChange:s,isSearchable:!1})]})});fV.displayName="MaskFillStyle";const pV=u.memo(()=>{const{t:e}=M(),t=z(),n=I(_n),s=I(DX),i=u.useCallback(a=>{n&&a2(n)&&t(RX({entityIdentifier:n,color:a}))},[t,n]),o=u.useCallback(a=>{n&&a2(n)&&t(OX({entityIdentifier:n,style:a}))},[t,n]);return!n||!s?null:r.jsxs(Fn,{isLazy:!0,children:[r.jsx(Un,{children:r.jsx(A,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:r.jsx(De,{label:e("controlLayers.maskFill"),children:r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Se,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Vl(s.color)})})})})}),r.jsx(Bn,{children:r.jsx(qn,{minH:64,children:r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsx(z2e,{color:s.color,onChange:i,withNumberInput:!0,withSwatches:!0}),r.jsx(fV,{style:s.style,onChange:o})]})})})]})});pV.displayName="EntityListSelectedEntityActionBarFill";const gV=u.memo(()=>{const{t:e}=M(),t=I(_n),n=iv(t);return!t||!Qx(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(Rw,{})})});gV.displayName="EntityListSelectedEntityActionBarFilterButton";function W2e(e){return isNaN(Number(e))?"":`${_p(Number(e),2).toLocaleString()}%`}function U2e(e){return e/100}function Bc(e){return e*100}function q2e(e){return String(e)}const LC=[Bc(0),Bc(.25),Bc(.5),Bc(.75),Bc(1)],K2e=Bc(1),Z2e=LC.slice(1,LC.length-1),Y2e=pe(et,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=Ga(e,t);return!n||!NX(n)?1:n.opacity}),mV=u.memo(()=>{const{t:e}=M(),t=z(),n=I(_n),s=I(Y2e),[i,o]=u.useState(s*100),a=u.useCallback(h=>{if(!n)return;let f=h;BS.get()||(f=iM(h,Z2e,2));const p=U2e(f);t(m4({entityIdentifier:n,opacity:p}))},[t,n]),l=u.useCallback(()=>{if(n){if(isNaN(Number(i))){o(100);return}t(m4({entityIdentifier:n,opacity:co(i/100,0,1)}))}},[t,i,n]),c=u.useCallback((h,f)=>{o(f)},[]),d=u.useCallback(h=>{h.key==="Enter"&&l()},[l]);return u.useEffect(()=>{o((s??1)*100)},[s]),r.jsxs(Fn,{children:[r.jsxs(Z,{w:"min-content",gap:2,isDisabled:n===null||n.type==="reference_image",children:[r.jsx(te,{m:0,children:e("controlLayers.opacity")}),r.jsx(kp,{children:r.jsxs(ry,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:i,onChange:c,onBlur:l,w:"76px",format:W2e,defaultValue:1,onKeyDown:d,clampValueOnBlur:!1,variant:"outline",children:[r.jsx(iy,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),r.jsx(Un,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(ii,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null||n.type==="reference_image"})})]})})]}),r.jsxs(Bn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsx(Ze,{min:0,max:100,value:i,onChange:a,defaultValue:K2e,marks:LC,formatValue:q2e,alwaysShowMarks:!0,isDisabled:n===null||n.type==="reference_image"})})]})]})});mV.displayName="EntityListSelectedEntityActionBarOpacity";const yV=u.memo(()=>{const{t:e}=M(),t=I(_n),n=HO(t);return!t||!Jx(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.selectObject.selectObject"),tooltip:e("controlLayers.selectObject.selectObject"),icon:r.jsx(sD,{})})});yV.displayName="EntityListSelectedEntityActionBarSelectObjectButton";const vV=u.memo(()=>{const{t:e}=M(),t=I(_n),n=nk(t);return!t||!Rm(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:r.jsx(Vp,{})})});vV.displayName="EntityListSelectedEntityActionBarTransformButton";const bV=u.memo(()=>{const{t:e}=M(),t=st(),n=I(_n),s=So(n),i=zO(),o=u.useCallback(()=>{i(s)},[i,s]);return!n||!FX(n)?null:r.jsx(oe,{onClick:o,isDisabled:!n||t,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:r.jsx(eo,{})})});bV.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const xV=u.memo(()=>r.jsxs(A,{w:"full",gap:2,alignItems:"center",ps:1,children:[r.jsx(mV,{}),r.jsx(rt,{}),r.jsx(pV,{}),r.jsxs(A,{h:"full",children:[r.jsx(yV,{}),r.jsx(gV,{}),r.jsx(vV,{}),r.jsx(bV,{}),r.jsx(hV,{}),r.jsx(dV,{})]})]}));xV.displayName="EntityListSelectedEntityActionBar";const X2e=({amplitude:e,stroke:t,strokeWidth:n,width:s,height:i,segments:o=5})=>{const a=()=>{if(e===0)return`M0,${i/2} L${s},${i/2}`;const l=Math.min(i/2,e),c=s/o;let d=`M0,${i/2}`;for(let h=1;h<=o;h++){const f=h*c,p=i/2+(h%2===0?l:-l);d+=` Q${f-c/2},${p} ${f},${i/2}`}return d};return r.jsx("svg",{width:s,height:i,viewBox:`0 0 ${s} ${i}`,xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:a(),fill:"none",stroke:t,strokeWidth:n})})},Q2e=pe(FS,e=>e.length>0),CV=u.memo(()=>{const e=I(BX),t=z(),n=I(Q2e),s=u.useCallback(l=>{t($X(l))},[t]),i=I(VX),{t:o}=M(),[a]=HS("colors",["invokeBlue.300"]);return r.jsxs(Z,{isDisabled:!n,p:1,justifyContent:"space-between",h:8,children:[r.jsxs(A,{gap:3,alignItems:"center",children:[r.jsx(Ve,{feature:"paramDenoisingStrength",children:r.jsx(te,{mr:0,children:`${o("parameters.denoisingStrength")}`})}),n&&r.jsx(X2e,{amplitude:e*10,stroke:a,strokeWidth:1,width:40,height:14})]}),n?r.jsxs(r.Fragment,{children:[r.jsx(Ze,{step:i.coarseStep,fineStep:i.fineStep,min:i.sliderMin,max:i.sliderMax,defaultValue:i.initial,onChange:s,value:e}),r.jsx(Ae,{step:i.coarseStep,fineStep:i.fineStep,min:i.numberInputMin,max:i.numberInputMax,defaultValue:i.initial,onChange:s,value:e,variant:"outline"})]}):r.jsx(A,{alignItems:"center",children:r.jsx(is,{opacity:"0.6",children:o("parameters.disabledNoRasterContent")})})]})});CV.displayName="ParamDenoisingStrength";const SV=u.memo(()=>{const e=I(GX),t=u.useRef(null);return ta("layers",t),r.jsxs(A,{ref:t,flexDir:"column",gap:2,w:"full",h:"full",children:[r.jsx(xV,{}),r.jsx(Pt,{py:0}),r.jsx(CV,{}),r.jsx(Pt,{py:0}),!e&&r.jsx(v$,{}),e&&r.jsx(uV,{})]})});SV.displayName="CanvasLayersPanelContent";const wV=u.memo(()=>{const e=ce(zX),t=ce(RS);return e&&t?r.jsx(oy,{fontSize:"md",fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",href:t,children:e}):null});wV.displayName="GalleryHeader";const pu=Symbol("NO_SIZE"),DC=e=>{const t=u.useRef(null),[n,s]=u.useState(1),[i,o]=u.useState(1),a=u.useCallback(()=>{if(!(t!=null&&t.current))return;const C=hx(e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection),v=hx(e.defaultSizePx??e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection);if(C===pu||v===pu)return;s(C),v>C?o(v):o(C);const x=t.current.getSize();!t.current.isCollapsed()&&x<C&&C>0&&t.current.resize(C)},[e.defaultSizePx,e.imperativePanelGroupRef,e.minSizePx,e.panelGroupDirection]);u.useLayoutEffect(()=>{if(!e.imperativePanelGroupRef.current)return;const C=e.imperativePanelGroupRef.current.getId(),v=pv(C),x=Hl(C);if(!v)return;const S=new ResizeObserver(a);return S.observe(v),x.forEach(w=>S.observe(w)),a(),()=>{S.disconnect()}},[e.imperativePanelGroupRef,a]);const[l,c]=u.useState(()=>{var C;return!!((C=t.current)!=null&&C.isCollapsed())}),d=u.useCallback(()=>{var C;c(!0),(C=e.onCollapse)==null||C.call(e,!0)},[e]),h=u.useCallback(()=>{var C;c(!1),(C=e.onCollapse)==null||C.call(e,!1)},[e]),f=u.useCallback(()=>{var C,v,x;(C=t.current)!=null&&C.isCollapsed()?(v=t.current)==null||v.expand():(x=t.current)==null||x.collapse()},[]),p=u.useCallback(()=>{var C;(C=t.current)==null||C.expand()},[]),g=u.useCallback(()=>{var C;(C=t.current)==null||C.collapse()},[]),m=u.useCallback(C=>{var x;const v=hx(C,e.imperativePanelGroupRef,e.panelGroupDirection);v!==pu&&((x=t.current)==null||x.resize(v))},[e]),y=u.useCallback(()=>{var C;(C=t.current)==null||C.resize(n)},[n]),b=u.useCallback(()=>{var C,v;if(Math.abs((((C=t.current)==null?void 0:C.getSize())??0)-i)<.01){g();return}(v=t.current)==null||v.resize(i)},[i,g]);return{isCollapsed:l,reset:y,toggle:f,expand:p,collapse:g,resize:m,panelProps:{id:e.id,defaultSize:i,onCollapse:d,onExpand:h,ref:t,minSize:n},resizeHandleProps:{onDoubleClick:b}}},hx=(e,t,n)=>{if(!t.current)return pu;const s=t.current.getId(),i=pv(s);if(!i)return pu;let o=n==="horizontal"?i.offsetWidth:i.offsetHeight;return o?(Hl(s).forEach(a=>{o-=n==="horizontal"?a.offsetWidth:a.offsetHeight}),Math.max(Math.min(e/o*100,100),1)):pu},Fk=pe(Ar,e=>e.allowPrivateBoards),J2e=({isPrivateBoard:e})=>{const{t}=M(),n=z(),s=I(Fk),[i,{isLoading:o}]=HX(),a=u.useMemo(()=>t(s?e?"boards.addPrivateBoard":"boards.addSharedBoard":"boards.addBoard"),[s,e,t]),l=u.useCallback(async()=>{try{const c=await i({board_name:t("boards.myBoard"),is_private:e}).unwrap();n(Ef({boardId:c.board_id})),n(f0(""))}catch{}},[t,i,e,n]);return r.jsx(oe,{icon:r.jsx(Gt,{}),isLoading:o,tooltip:a,"aria-label":a,onClick:l,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},eCe=u.memo(J2e),Bk=u.memo(()=>{const{t:e}=M();return r.jsx(is,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});Bk.displayName="AutoAddBadge";const tCe=({board:e,children:t})=>{const{t:n}=M(),s=z(),i=I(qu),o=u.useMemo(()=>pe(Er,C=>e.board_id===C),[e.board_id]),[a]=wM(),l=I(o),c=Hp(e.board_id),d=en("bulkDownload"),[h]=MS(),f=u.useCallback(()=>{s(Ep(e.board_id))},[e.board_id,s]),p=u.useCallback(()=>{h({image_names:[],board_id:e.board_id})},[e.board_id,h]),g=u.useCallback(async()=>{try{await a({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{ve({status:"error",title:"Unable to archive board"})}},[e.board_id,a]),m=u.useCallback(()=>{a({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,a]),y=u.useCallback(()=>{qh.set(e)},[e]),b=u.useCallback(()=>r.jsx(It,{visibility:"visible",children:r.jsxs(xr,{title:c,children:[!i&&r.jsx(he,{icon:r.jsx(Gt,{}),isDisabled:l,onClick:f,children:n(l?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),d&&r.jsx(he,{icon:r.jsx(FL,{}),onClickCapture:p,children:n("boards.downloadBoard")}),e.archived&&r.jsx(he,{icon:r.jsx(EL,{}),onClick:m,children:n("boards.unarchiveBoard")}),!e.archived&&r.jsx(he,{icon:r.jsx(qae,{}),onClick:g,children:n("boards.archiveBoard")}),r.jsx(he,{color:"error.300",icon:r.jsx(ei,{}),onClick:y,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[c,i,l,f,n,d,p,e.archived,m,g,y]);return r.jsx(ay,{renderMenu:b,children:t})},nCe=u.memo(tCe),jV=u.memo(({board:e,isSelected:t})=>{const{t:n}=M(),s=Q1(!1),i=u.useRef(null),[o,a]=wM(),l=u.useCallback(async d=>{(await Ls(()=>o({board_id:e.board_id,changes:{board_name:d}}).unwrap())).isErr()&&ve({status:"error",title:n("boards.updateBoardError")})},[e.board_id,n,o]),c=oa({value:e.board_name,defaultValue:e.board_name,onChange:l,inputRef:i,onStartEditing:s.setTrue});return c.isEditing?r.jsx(jt,{ref:i,...c.inputProps,variant:"outline",isDisabled:a.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):r.jsxs(A,{alignItems:"center",gap:3,onMouseOver:s.setTrue,onMouseOut:s.setFalse,children:[r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:c.startEditing,cursor:"text",children:c.value}),s.isTrue&&r.jsx(oe,{"aria-label":"edit name",icon:r.jsx(My,{}),size:"sm",variant:"ghost",onClick:c.startEditing})]})});jV.displayName="CanvasEntityTitleEdit";const kV=({board:e})=>{const{t}=M(),{imagesTotal:n}=jM((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({imagesTotal:(o==null?void 0:o.total)??0})}),{assetsTotal:s}=WX((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({assetsTotal:(o==null?void 0:o.total)??0})}),{currentData:i}=Ua((e==null?void 0:e.cover_image_name)??ws);return r.jsxs(A,{flexDir:"column",alignItems:"center",gap:1,children:[i&&r.jsx(dn,{src:i.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),r.jsxs(A,{flexDir:"column",alignItems:"center",children:[r.jsxs(q,{noOfLines:1,children:[t("boards.imagesWithCount",{count:n}),", ",t("boards.assetsWithCount",{count:s})]}),(e==null?void 0:e.archived)&&r.jsxs(q,{children:["(",t("boards.archived"),")"]})]})]})},sCe={bg:"base.850"},rCe=({board:e,isSelected:t})=>{const n=z(),{t:s}=M(),i=I(Er),o=I(qu),a=I(WS),l=u.useCallback(()=>{a!==e.board_id&&n(Ef({boardId:e.board_id})),o&&i!==e.board_id&&n(Ep(e.board_id))},[a,e.board_id,o,i,n]),c=u.useMemo(()=>Z0.getData({boardId:e.board_id}),[e.board_id]);return r.jsxs(Se,{position:"relative",w:"full",h:12,children:[r.jsx(nCe,{board:e,children:d=>r.jsx(De,{label:r.jsx(kV,{board:e}),openDelay:1e3,placement:"left",closeOnScroll:!0,p:2,children:r.jsxs(A,{ref:d,onClick:l,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:sCe,w:"full",h:"full",children:[r.jsx(oCe,{board:e}),r.jsx(A,{w:"full",children:r.jsx(jV,{board:e,isSelected:t})}),i===e.board_id&&r.jsx(Bk,{}),e.archived&&r.jsx(dt,{as:EL,fill:"base.300"}),r.jsx(q,{variant:"subtext",children:e.image_count})]})})}),r.jsx(gs,{dndTarget:Z0,dndTargetData:c,label:s("gallery.move")})]})},iCe=u.memo(rCe),oCe=({board:e})=>{const{currentData:t}=Ua(e.cover_image_name??ws);return t?r.jsx(dn,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):r.jsx(A,{w:10,h:10,justifyContent:"center",alignItems:"center",children:r.jsx(dt,{boxSize:10,as:ile,opacity:.7,color:"base.500"})})},aCe=pe(Er,e=>e==="none"),lCe=({children:e})=>{const{t}=M(),n=z(),s=I(qu),i=I(aCe),o=en("bulkDownload"),[a]=MS(),l=u.useCallback(()=>{n(Ep("none"))},[n]),c=u.useCallback(()=>{a({image_names:[],board_id:"none"})},[a]),d=u.useCallback(()=>r.jsx(It,{visibility:"visible",children:r.jsxs(xr,{title:t("boards.uncategorized"),children:[!s&&r.jsx(he,{icon:r.jsx(Gt,{}),isDisabled:i,onClick:l,children:t(i?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),o&&r.jsx(he,{icon:r.jsx(FL,{}),onClickCapture:c,children:t("boards.downloadBoard")})]})}),[s,c,l,o,i,t]);return r.jsx(ay,{renderMenu:d,children:e})},cCe=u.memo(lCe),uCe={bg:"base.850"},_V=u.memo(({isSelected:e})=>{const t=z(),{imagesTotal:n}=jM("none",{selectFromResult:({data:h})=>({imagesTotal:(h==null?void 0:h.total)??0})}),s=I(Er),i=I(qu),o=I(ly),a=Hp("none"),l=u.useCallback(()=>{t(Ef({boardId:"none"})),i&&t(Ep("none"))},[t,i]),c=u.useMemo(()=>Y0.getData(),[]),{t:d}=M();return o.length?null:r.jsxs(Se,{position:"relative",w:"full",h:12,children:[r.jsx(cCe,{children:h=>r.jsx(De,{label:r.jsx(kV,{board:null}),openDelay:1e3,placement:"left",closeOnScroll:!0,children:r.jsxs(A,{ref:h,onClick:l,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:uCe,children:[r.jsx(A,{w:"10",justifyContent:"space-around",children:r.jsx(dt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),r.jsx(q,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:a}),s==="none"&&r.jsx(Bk,{}),r.jsx(q,{variant:"subtext",children:n})]})})}),r.jsx(gs,{dndTarget:Y0,dndTargetData:c,label:d("gallery.move")})]})});_V.displayName="HoverableBoard";const qT=u.memo(_V),KT=({isPrivate:e})=>{const{t}=M(),n=I(WS),s=I(ly),i=I(UX),{data:o}=Zl(i),a=I(Fk),{isOpen:l,onToggle:c}=ir({defaultIsOpen:!0}),d=u.useMemo(()=>o?o.filter(p=>s.length?p.is_private===e&&p.board_name.toLowerCase().includes(s.toLowerCase()):p.is_private===e):xs,[s,o,e]),h=u.useMemo(()=>{const p=[];return a&&e&&!s.length&&p.push(r.jsx(qT,{isSelected:n==="none"},"none")),!a&&!s.length&&p.push(r.jsx(qT,{isSelected:n==="none"},"none")),d.forEach(g=>{p.push(r.jsx(iCe,{board:g,isSelected:n===g.board_id},g.board_id))}),p},[a,e,s.length,d,n]),f=u.useMemo(()=>t(a?e?"boards.private":"boards.shared":"boards.boards"),[e,a,t]);return r.jsxs(A,{direction:"column",children:[r.jsxs(A,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[a?r.jsx(ye,{variant:"unstyled",onClick:c,children:r.jsxs(A,{gap:"2",alignItems:"center",children:[r.jsx(dt,{boxSize:4,as:ii,transform:l?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f})]})}):r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f}),r.jsx(eCe,{isPrivateBoard:e})]}),r.jsx(rc,{in:l,style:vv,children:r.jsx(A,{direction:"column",gap:1,children:h.length?h:r.jsx(q,{variant:"subtext",textAlign:"center",children:t("boards.noBoards",{boardType:s.length?"Matching":""})})})})]})},dCe={height:"100%",width:"100%"},hCe=()=>{const e=I(Fk),[t,n]=u.useState(null);return u.useEffect(()=>{const s=t==null?void 0:t.osInstance();if(!s)return;const i=s.elements().viewport,o=i.style.overflowY;i.style.setProperty("overflow-y","scroll","important");const a=Hn(Uw({element:i}),ND({element:i}));return i.style.setProperty("overflow-y",o),a},[t]),r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,children:r.jsxs(Ns,{ref:n,style:dCe,options:Bl.options,children:[e&&r.jsx(KT,{isPrivate:!0}),r.jsx(KT,{isPrivate:!1})]})})})},fCe=u.memo(hCe),pCe=()=>{const e=z(),t=I(ly),{t:n}=M(),s=u.useCallback(l=>{e(f0(l))},[e]),i=u.useCallback(()=>{e(f0(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(Jo,{children:[r.jsx(jt,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:o,onChange:a,"data-testid":"board-search-input"}),t&&t.length&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})},gCe=u.memo(pCe),mCe=()=>{const e=z(),{t}=M(),n=I(Er),s=I(qu),{options:i,hasBoards:o}=Zl({},{selectFromResult:({data:d})=>{const h=[{label:t("common.none"),value:"none"}].concat((d??[]).map(({board_id:f,board_name:p})=>({label:p,value:f})));return{options:h,hasBoards:h.length>1}}}),a=u.useCallback(d=>{d&&e(Ep(d.value))},[e]),l=u.useMemo(()=>i.find(d=>d.value===n),[i,n]),c=u.useCallback(()=>t("boards.noMatching"),[t]);return r.jsxs(Z,{isDisabled:!o||s,children:[r.jsx(te,{children:t("boards.autoAddBoard")}),r.jsx(Fe,{value:l,options:i,onChange:a,placeholder:t("boards.selectBoard"),noOptionsMessage:c})]})},yCe=u.memo(mCe),vCe=()=>{const e=z(),{t}=M(),n=I(qu),s=u.useCallback(i=>e(qX(i.target.checked)),[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),r.jsx(kn,{isChecked:n,onChange:s})]})},bCe=u.memo(vCe),xCe=pe(kr,e=>e.shouldShowArchivedBoards),CCe=()=>{const e=z(),{t}=M(),n=I(xCe),s=u.useCallback(i=>{e(KX(i.target.checked))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.showArchivedBoards")}),r.jsx(kn,{isChecked:n,onChange:s})]})},SCe=u.memo(CCe),wCe=$e.enum(["created_at","board_name"]),jCe=e=>wCe.safeParse(e).success,kCe=$e.enum(["ASC","DESC"]),_Ce=e=>kCe.safeParse(e).success,ICe=()=>{const{t:e}=M(),t=I(ZX),n=I(YX),s=u.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),i=u.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),o=z(),a=u.useCallback(h=>{!jCe(h==null?void 0:h.value)||h.value===t||o(XX(h.value))},[t,o]),l=u.useMemo(()=>s.find(h=>h.value===t)||s[0],[t,s]),c=u.useCallback(h=>{!_Ce(h==null?void 0:h.value)||h.value===n||o(QX(h.value))},[n,o]),d=u.useMemo(()=>i.find(h=>h.value===n),[n,i]);return r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:e("common.orderBy")}),r.jsx(Fe,{isSearchable:!1,value:l,options:s,onChange:a})]}),r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:e("common.direction")}),r.jsx(Fe,{isSearchable:!1,value:d,options:i,onChange:c})]})]})},ACe=()=>{const{t:e}=M();return r.jsxs(Fn,{isLazy:!0,children:[r.jsx(Un,{children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:r.jsx(nd,{}),tooltip:e("gallery.boardsSettings")})}),r.jsx(Bn,{children:r.jsx(qn,{children:r.jsxs(A,{direction:"column",gap:2,children:[r.jsx(bCe,{}),r.jsx(SCe,{}),r.jsx(yCe,{}),r.jsx(Se,{py:2,children:r.jsx(Pt,{})}),r.jsx(ICe,{})]})})})]})},TCe=u.memo(ACe),ECe=()=>{kt("gallery-search-state");const e=z(),t=I(JX),[n,s]=u.useState(t),i=u.useMemo(()=>ri(l=>{e(y4(l))},1e3),[e]),o=u.useCallback(l=>{s(l),i(l)},[i]),a=u.useCallback(()=>{i.cancel(),s(""),e(y4(""))},[i,e]);return[n,o,a]},MCe=pe(kr,e=>e.alwaysShowImageSizeBadge),PCe=()=>{const e=z(),{t}=M(),n=I(MCe),s=u.useCallback(i=>e(eQ(i.target.checked)),[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),r.jsx(kn,{isChecked:n,onChange:s})]})},LCe=u.memo(PCe),DCe=pe(kr,e=>e.shouldAutoSwitch),RCe=()=>{const e=z(),{t}=M(),n=I(DCe),s=u.useCallback(i=>{e(tQ(i.target.checked))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),r.jsx(kn,{isChecked:n,onChange:s})]})},OCe=u.memo(RCe),NCe=()=>{const e=z(),{t}=M(),n=I(kM),s=u.useCallback(i=>{e(nQ(i))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{children:t("gallery.galleryImageSize")}),r.jsx(Ze,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},FCe=u.memo(NCe),BCe=pe(kr,e=>e.starredFirst),$Ce=()=>{const e=z(),{t}=M(),n=I(BCe),s=u.useCallback(i=>{e(sQ(i.target.checked))},[e]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),r.jsx(at,{size:"sm",isChecked:n,onChange:s})]})},VCe=u.memo($Ce),GCe=pe(kr,e=>e.orderDir),zCe=()=>{const e=z(),{t}=M(),n=I(GCe),s=u.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),i=u.useCallback(a=>{Ge((a==null?void 0:a.value)==="ASC"||(a==null?void 0:a.value)==="DESC"),e(rQ(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[n,s]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),r.jsx(Fe,{isSearchable:!1,value:o,options:s,onChange:i})]})},HCe=u.memo(zCe),WCe=()=>{const{t:e}=M();return r.jsxs(Fn,{isLazy:!0,children:[r.jsx(Un,{children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:r.jsx(nd,{}),tooltip:e("gallery.imagesSettings")})}),r.jsx(Bn,{children:r.jsx(qn,{children:r.jsxs(A,{direction:"column",gap:2,children:[r.jsx(FCe,{}),r.jsx(OCe,{}),r.jsx(LCe,{}),r.jsx(Pt,{pt:2}),r.jsx(VCe,{}),r.jsx(HCe,{})]})})})]})},UCe=u.memo(WCe),qCe=()=>{const e=I(kS),t=u.useMemo(()=>({allowMultiple:e!==1}),[e]),n=cc(t);return r.jsxs(r.Fragment,{children:[r.jsx(oe,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":e===void 0||e>1?Te("accessibility.uploadImages"):Te("accessibility.uploadImage"),tooltip:e===void 0||e>1?Te("accessibility.uploadImages"):Te("accessibility.uploadImage"),icon:r.jsx(Gp,{}),...n.getUploadButtonProps()}),r.jsx("input",{...n.getUploadInputProps()})]})},IV=u.memo(()=>{const e=z(),t=I(iQ),{imageDTOs:n}=wk(),s=Os("gallery"),i=u.useCallback(()=>{e(q1([...t,...n]))},[e,t,n]);return Le({id:"selectAllOnPage",category:"gallery",callback:i,options:{preventDefault:!0,enabled:s},dependencies:[i,s]}),t.length<=1?null:r.jsx(AV,{})});IV.displayName="GallerySelectionCountTag";const AV=u.memo(()=>{const{t:e}=M(),t=z(),n=Os("gallery"),s=I(oQ),i=I(PS),o=u.useCallback(()=>{s&&t(q1([s]))},[t,s]);return Le({id:"clearSelection",category:"gallery",callback:o,options:{enabled:i>0&&n},dependencies:[o,i,n]}),r.jsxs(US,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[r.jsxs(_M,{children:[i," ",e("common.selected")]}),r.jsx(qS,{onClick:o})]})});AV.displayName="GallerySelectionCountTagContent";const KCe=()=>{kt("useGalleryHotkeys");const{goNext:e,goPrev:t,isNextEnabled:n,isPrevEnabled:s}=uv(),i=z(),o=I(j=>j.gallery.selection),a=I(Uu),l=sc(a),c=I(Pf),d=I(En),h=Os("workflows"),f=Os("gallery"),p=Os("viewer"),g=u.useMemo(()=>d!=="canvas"?!0:c==="gallery",[d,c]),{handleLeftImage:m,handleRightImage:y,handleUpImage:b,handleDownImage:C,isOnFirstRow:v,isOnLastRow:x,isOnFirstImageOfView:S,isOnLastImageOfView:w}=kB();Le({id:"galleryNavLeft",category:"gallery",callback:()=>{if(S&&s&&!l.isFetching){t("arrow");return}m(!1)},options:{preventDefault:!0,enabled:f||p},dependencies:[m,S,t,s,l.isFetching,f,p]}),Le({id:"galleryNavRight",category:"gallery",callback:()=>{if(w&&n&&!l.isFetching){e("arrow");return}w||y(!1)},options:{preventDefault:!0,enabled:f||p},dependencies:[w,e,n,l.isFetching,y,f,p]}),Le({id:"galleryNavUp",category:"gallery",callback:()=>{if(v&&s&&!l.isFetching){t("arrow");return}b(!1)},options:{preventDefault:!0,enabled:f},dependencies:[b,v,t,s,l.isFetching,f]}),Le({id:"galleryNavDown",category:"gallery",callback:()=>{if(x&&n&&!l.isFetching){e("arrow");return}C(!1)},options:{preventDefault:!0,enabled:f},dependencies:[x,e,n,l.isFetching,C,f]}),Le({id:"galleryNavLeftAlt",category:"gallery",callback:()=>{if(S&&s&&!l.isFetching){t("alt+arrow");return}m(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[m,S,t,s,l.isFetching,f,p]}),Le({id:"galleryNavRightAlt",category:"gallery",callback:()=>{if(w&&n&&!l.isFetching){e("alt+arrow");return}w||y(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[w,e,n,l.isFetching,y,f,p]}),Le({id:"galleryNavUpAlt",category:"gallery",callback:()=>{if(v&&s&&!l.isFetching){t("alt+arrow");return}b(!0)},options:{preventDefault:!0,enabled:f},dependencies:[b,v,t,s,l.isFetching,f]}),Le({id:"galleryNavDownAlt",category:"gallery",callback:()=>{if(x&&n&&!l.isFetching){e("alt+arrow");return}C(!0)},options:{preventDefault:!0,enabled:f},dependencies:[x,e,n,l.isFetching,C,f]}),Le({id:"deleteSelection",category:"gallery",callback:()=>{o.length&&i(up(o))},options:{enabled:(f||p)&&g&&!h},dependencies:[h,g,o,h]})},ZCe=()=>{KCe();const{t:e}=M(),t=I(Uu),{hasImages:n,isLoading:s,isError:i}=sc(t,{selectFromResult:({data:o,isLoading:a,isSuccess:l,isError:c})=>({hasImages:o&&o.items.length>0,isLoading:a,isSuccess:l,isError:c})});return i?r.jsx(Se,{w:"full",h:"full",children:r.jsx(Ot,{label:e("gallery.unableToLoad"),icon:QL})}):s?r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Ot,{label:e("gallery.loading"),icon:wu})}):n?r.jsx(TV,{}):r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Ot,{label:e("gallery.noImagesInGallery"),icon:wu})})},YCe=u.memo(ZCe),TV=u.memo(()=>{const e=z(),t=I(kM),n=I(aQ),[s,i]=u.useState(null),o=u.useMemo(()=>ri(()=>{if(!s)return;const a=document.querySelector(`.${jk}`);if(!a)return;const l=document.querySelector(`.${AC}`);if(!l)return;const c=a.getBoundingClientRect(),d=s.getBoundingClientRect(),h=window.getComputedStyle(l),f=parseFloat(h.gap);if(!c.width||!c.height||!d.width||!d.height)return;let p=0,g=0;for(;g+c.height<=d.height+1;)p++,g+=c.height,g+f<=d.height&&(g+=f);let m=0;for(g=0;g+c.width<=d.width+1;)m++,g+=c.width,g+f<=d.width&&(g+=f);const y=Math.max(m,m*p);n===0||n===y||e(lQ(y))},300),[s,e,n]);return u.useEffect(()=>{o()},[o,t]),u.useEffect(()=>{if(!s)return;const a=new ResizeObserver(o);return a.observe(s),o(),()=>{a.disconnect()}},[o,s,e]),r.jsxs(Se,{position:"relative",w:"full",h:"full",mt:2,children:[r.jsx(Se,{ref:i,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",overflow:"hidden",children:r.jsx(Xr,{className:AC,gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`,gap:1,children:r.jsx(EV,{})})}),r.jsx(IV,{})]})});TV.displayName="GalleryImageGridContent";const EV=u.memo(()=>{const e=I(Uu),{imageDTOs:t}=sc(e,{selectFromResult:({data:n})=>({imageDTOs:(n==null?void 0:n.items)??xs})});return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(jB,{imageDTO:n},n.image_name))})});EV.displayName="GalleryImageGridImages";const MV=u.memo(()=>{const{t:e}=M(),t=ir();return r.jsxs(Fn,{isOpen:t.isOpen,onClose:t.onClose,isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(Un,{children:r.jsx(ye,{"aria-label":e("gallery.jump"),size:"sm",onClick:t.onToggle,variant:"outline",children:e("gallery.jump")})}),r.jsxs(Bn,{children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsx(PV,{disclosure:t})})]})]})});MV.displayName="JumpTo";const PV=u.memo(({disclosure:e})=>{const{t}=M(),{goToPage:n,currentPage:s,pages:i}=uv(),[o,a]=u.useState(s),l=u.useRef(null),c=u.useCallback(h=>{a(h-1)},[]),d=u.useCallback(()=>{n(o),e.onClose()},[n,o,e]);return Ii("enter",()=>{d()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,d]),Ii("esc",()=>{a(s),e.onClose()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,e.onClose]),u.useEffect(()=>{setTimeout(()=>{var f;const h=(f=l.current)==null?void 0:f.querySelector("input");h==null||h.focus(),h==null||h.select()},0),a(s)},[s]),r.jsxs(A,{gap:2,alignItems:"center",children:[r.jsx(Z,{children:r.jsx(Ae,{ref:l,size:"sm",maxW:"60px",value:o+1,min:1,max:i,step:1,onChange:c})}),r.jsx(ye,{h:"full",size:"sm",onClick:d,children:t("gallery.go")})]})});PV.displayName="JumpToContent";const LV=u.memo(()=>{const{goPrev:e,goNext:t,isPrevEnabled:n,isNextEnabled:s,pageButtons:i,goToPage:o,currentPage:a,total:l}=uv(),c=u.useCallback(()=>{e()},[e]),d=u.useCallback(()=>{t()},[t]);return l?r.jsxs(A,{justifyContent:"center",alignItems:"center",w:"full",gap:1,pt:2,children:[r.jsx(oe,{size:"sm","aria-label":"prev",icon:r.jsx(Tw,{}),onClick:c,isDisabled:!n,variant:"ghost"}),r.jsx(rt,{}),i.map((h,f)=>r.jsx(DV,{page:h,currentPage:a,goToPage:o},`${h}_${f}`)),r.jsx(rt,{}),r.jsx(oe,{size:"sm","aria-label":"next",icon:r.jsx(Ty,{}),onClick:d,isDisabled:!s,variant:"ghost"}),r.jsx(MV,{})]}):null});LV.displayName="GalleryPagination";const DV=u.memo(({page:e,currentPage:t,goToPage:n})=>{const s=u.useCallback(()=>{e!==nu&&n(e-1)},[n,e]);return e===nu?r.jsx(ye,{size:"sm",variant:"link",isDisabled:!0,children:"..."}):r.jsx(ye,{size:"sm",onClick:s,variant:t===e-1?"solid":"outline",children:e})});DV.displayName="PageButton";const RV=u.memo(({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=M(),i=I(Uu),{isPending:o}=sc(i,{selectFromResult:({isLoading:c,isFetching:d})=>({isPending:c||d})}),a=u.useCallback(c=>{t(c.target.value)},[t]),l=u.useCallback(c=>{c.key==="Escape"&&n()},[n]);return r.jsxs(Jo,{children:[r.jsx(jt,{placeholder:s("gallery.searchImages"),value:e,onChange:a,"data-testid":"image-search-input",onKeyDown:l}),o&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(rr,{size:"sm",opacity:.5})}),!o&&e.length&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})});RV.displayName="GallerySearch";const ZT={fontWeight:"semibold",fontSize:"sm",color:"base.300"},YT={borderColor:"base.800",borderBottomColor:"base.900",color:"invokeBlue.300"},XCe={flexShrink:0,minHeight:0,width:"100%"},QCe=pe(kr,e=>e.galleryView),JCe=pe(kr,e=>e.searchTerm),eSe=()=>{const{t:e}=M(),t=z(),n=I(QCe),s=I(JCe),i=ir({defaultIsOpen:s.length>0}),[o,a,l]=ECe(),c=u.useCallback(()=>{t(l2("images"))},[t]),d=u.useCallback(()=>{t(l2("assets"))},[t]),h=u.useCallback(()=>{i.onToggle(),l()},[l,i]),f=I(WS),p=Hp(f);return r.jsxs(A,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",pt:1,minH:0,children:[r.jsx(ec,{index:n==="images"?0:1,variant:"enclosed",display:"flex",flexDir:"column",w:"full",children:r.jsxs(tc,{gap:2,fontSize:"sm",borderColor:"base.800",alignItems:"center",w:"full",children:[r.jsx(q,{fontSize:"sm",fontWeight:"semibold",noOfLines:1,px:"2",wordBreak:"break-all",children:p}),r.jsx(rt,{}),r.jsx(De,{label:e("gallery.imagesTab"),children:r.jsx(Sn,{sx:ZT,_selected:YT,onClick:c,"data-testid":"images-tab",children:e("parameters.images")})}),r.jsx(De,{label:e("gallery.assetsTab"),children:r.jsx(Sn,{sx:ZT,_selected:YT,onClick:d,"data-testid":"assets-tab",children:e("gallery.assets")})}),r.jsxs(A,{h:"full",justifyContent:"flex-end",children:[r.jsx(qCe,{}),r.jsx(UCe,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:h,tooltip:i.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:r.jsx(HL,{})})]})]})}),r.jsx(rc,{in:i.isOpen,style:XCe,children:r.jsx(Se,{w:"full",pt:2,children:r.jsx(RV,{searchTerm:o,onChangeSearchTerm:a,onResetSearchTerm:l})})}),r.jsx(YCe,{}),r.jsx(LV,{})]})},tSe={flexShrink:0,minHeight:0},nSe=()=>{const{t:e}=M(),t=I(ly),n=z(),s=ir({defaultIsOpen:!!t.length}),i=u.useRef(null),o=u.useRef(null);ta("gallery",o);const a=u.useMemo(()=>({id:"boards-list-panel",minSizePx:128,defaultSizePx:256,imperativePanelGroupRef:i,panelGroupDirection:"vertical"}),[]),l=DC(a),c=u.useCallback(()=>{t.length&&n(f0("")),s.onToggle(),l.expand()},[t.length,s,l,n]);return r.jsxs(A,{ref:o,position:"relative",flexDirection:"column",h:"full",w:"full",tabIndex:-1,children:[r.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"full",children:[r.jsx(A,{flexGrow:1,flexBasis:0,children:r.jsx(ye,{size:"sm",variant:"ghost",onClick:l.toggle,rightIcon:l.isCollapsed?r.jsx(ii,{}):r.jsx(DL,{}),children:l.isCollapsed?e("boards.viewBoards"):e("boards.hideBoards")})}),r.jsx(A,{children:r.jsx(wV,{})}),r.jsxs(A,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[r.jsx(TCe,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:c,tooltip:s.isOpen?`${e("gallery.exitBoardSearch")}`:`${e("gallery.displayBoardSearch")}`,"aria-label":e("gallery.displayBoardSearch"),icon:r.jsx(HL,{}),colorScheme:s.isOpen?"invokeBlue":"base"})]})]}),r.jsxs(ug,{ref:i,direction:"vertical",autoSaveId:"boards-list-panel",children:[r.jsx(io,{collapsible:!0,...l.panelProps,children:r.jsxs(A,{flexDir:"column",w:"full",h:"full",children:[r.jsx(rc,{in:s.isOpen,style:tSe,children:r.jsx(Se,{w:"full",pt:2,children:r.jsx(gCe,{})})}),r.jsx(Pt,{pt:2}),r.jsx(fCe,{})]})}),r.jsx(Ek,{id:"gallery-panel-handle",...l.resizeHandleProps}),r.jsx(io,{id:"gallery-wrapper-panel",minSize:20,children:r.jsx(eSe,{})})]})]})},OV=u.memo(nSe),NV=u.memo(()=>{const{t:e}=M(),t=I(Pf),n=Lt(),s=z(),i=u.useMemo(()=>t==="gallery"?1:0,[t]),o=u.useCallback(()=>{t!=="gallery"&&s(Cr("gallery")),n.toggle()},[n,t,s]),a=u.useCallback(l=>{s(l===0?Cr("layers"):Cr("gallery"))},[s]);return Le({id:"toggleViewer",category:"viewer",callback:n.toggle,dependencies:[n]}),r.jsxs(ec,{index:i,onChange:a,w:"full",h:"full",display:"flex",flexDir:"column",children:[r.jsxs(tc,{alignItems:"center",children:[r.jsx(FV,{}),r.jsx(rt,{}),r.jsx(ye,{size:"sm",variant:"ghost",onClick:o,children:n.isOpen?e("gallery.closeViewer"):e("gallery.openViewer")})]}),r.jsxs(Vu,{w:"full",h:"full",children:[r.jsx(Ln,{w:"full",h:"full",p:0,pt:3,children:r.jsx(bi,{children:r.jsx(SV,{})})}),r.jsx(Ln,{w:"full",h:"full",p:0,pt:3,children:r.jsx(OV,{})})]})]})});NV.displayName="CanvasRightPanel";const FV=u.memo(()=>{const{t:e}=M(),t=Wu(),n=I(cQ),[s,i]=u.useState("idle"),[o,a]=u.useState("idle"),l=u.useRef(null),c=u.useRef(null),d=u.useRef(null),h=u.useMemo(()=>n===0?e("controlLayers.layer_other"):`${e("controlLayers.layer_other")} (${n})`,[n,e]);return u.useEffect(()=>{if(!l.current)return;const f=()=>Pf(t.getState())==="layers",p=()=>{f()||(i("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(Cr("layers")),i("idle"),a("potential")},300))},g=()=>{f()?i("idle"):i("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{i("potential")};return Hn(ju({element:l.current,onDragEnter:p,onDragLeave:g}),to({canMonitor:({source:y})=>!wn.typeGuard(y.data)&&!Qr.typeGuard(y.data)?!1:!f(),onDragStart:m}),w2({element:l.current,onDragEnter:p,onDragLeave:g}),af({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{if(!c.current)return;const f=()=>Pf(t.getState())==="gallery",p=()=>{f()||(a("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(Cr("gallery")),a("idle"),i("potential")},300))},g=()=>{f()?a("idle"):a("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{a("potential")};return Hn(ju({element:c.current,onDragEnter:p,onDragLeave:g}),to({canMonitor:({source:y})=>!wn.typeGuard(y.data)&&!Qr.typeGuard(y.data)?!1:!f(),onDragStart:m}),w2({element:c.current,onDragEnter:p,onDragLeave:g}),af({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{const f=()=>{a("idle"),i("idle")},p=Hn(to({onDrop:f}),af({onDrop:f}));return()=>{p(),d.current!==null&&clearTimeout(d.current)}},[]),r.jsxs(r.Fragment,{children:[r.jsxs(Sn,{ref:l,position:"relative",w:32,children:[r.jsx(Se,{as:"span",w:"full",children:h}),r.jsx(Rf,{dndState:s,withBackdrop:!1})]}),r.jsxs(Sn,{ref:c,position:"relative",w:32,children:[r.jsx(Se,{as:"span",w:"full",children:e("gallery.gallery")}),r.jsx(Rf,{dndState:o,withBackdrop:!1})]})]})});FV.displayName="PanelTabs";const fx=Fs("dnd"),sSe=()=>{kt("useDropMonitor"),u.useEffect(()=>Hn(to({canMonitor:({source:e})=>{const t=e.data;return!(!wn.typeGuard(t)&&!Qr.typeGuard(t))},onDrop:({source:e,location:t})=>{const n=t.current.dropTargets[0];if(!n){fx.warn("No dnd target");return}const s=e.data,i=n.data,{dispatch:o,getState:a}=yp();for(const l of p1e){if(!l.typeGuard(i))continue;const c={sourceData:s,targetData:i,dispatch:o,getState:a};if(l.isValid(c)){fx.debug(Do({sourceData:s,targetData:i}),"Handling dnd drop"),l.handler(c);return}}fx.warn(Do({sourceData:s,targetData:i}),"Invalid drop")}})),[])},rSe=pe(lt,e=>{var t;return(t=uQ(e))==null?void 0:t.data}),iSe=()=>{const{t:e}=M(),t=I(rSe),[n]=Ju(t,300);return n?r.jsx(Yo,{data:n,label:"Node Data",bg:"base.850",color:"base.200"}):r.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null})},oSe=u.memo(iSe),BV=e=>{const t=u.useMemo(()=>pe(lt,s=>cy(s,e).data.notes),[e]);return I(t)},$V=u.memo(({nodeId:e})=>{const t=z(),{t:n}=M(),s=BV(e),i=u.useCallback(o=>{t(dQ({nodeId:e,notes:o.target.value}))},[t,e]);return r.jsxs(Z,{orientation:"vertical",h:"full",children:[r.jsx(te,{children:n("nodes.notes")}),r.jsx(Qn,{value:s,onChange:i,rows:10,resize:"none",variant:"darkFilled"})]})});$V.displayName="InvocationNodeNotesTextarea";const $k=e=>{const t=u.useMemo(()=>pe(lt,s=>Mp(s,e).type),[e]);return I(t)},js=e=>{const t=ce(Tn),n=$k(e);return u.useMemo(()=>{const i=t[n];return Ge(i,`Template for node type ${n} not found`),i},[t,n])},aSe=e=>{const t=ce(Tn),n=$k(e);return u.useMemo(()=>t[n]??null,[t,n])},Sv=u.memo(({nodeId:e,fallback:t,children:n})=>aSe(e)?r.jsx(r.Fragment,{children:n}):t);Sv.displayName="TemplateGate";const Vk=e=>{const t=u.useMemo(()=>pe(lt,s=>cy(s,e).data.version),[e]);return I(t)},VV=e=>{const t=$k(e),n=Vk(e),s=js(e);return u.useMemo(()=>t!==s.type?!0:n!==s.version,[s.type,s.version,t,n])},Gk=e=>{const t=u.useMemo(()=>pe(lt,s=>{const i=s.nodes.find(o=>o.id===e);return i==null?void 0:i.data.label}),[e]);return I(t)},GV=e=>{const t=ce(Tn),n=u.useMemo(()=>pe(lt,i=>{const o=i.nodes.find(l=>l.id===e);if(!Jr(o))return null;const a=t[o.data.type];return(a==null?void 0:a.title)??null}),[e,t]);return I(n)},lSe=({nodeId:e,title:t})=>{const n=z(),s=Gk(e),i=GV(e),{t:o}=M(),a=u.useRef(null),l=u.useCallback(d=>{n(IM({nodeId:e,label:d}))},[n,e]),c=oa({value:s||t||i||o("nodes.problemSettingTitle"),defaultValue:t||i||o("nodes.problemSettingTitle"),onChange:l,inputRef:a});return r.jsxs(A,{w:"full",alignItems:"center",children:[!c.isEditing&&r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",onDoubleClick:c.startEditing,children:c.value}),c.isEditing&&r.jsx(jt,{ref:a,...c.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},cSe=u.memo(lSe),uSe=()=>{const{t:e}=M(),t=I(KS);return t?r.jsx(Sv,{nodeId:t,fallback:r.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null}),children:r.jsx(zV,{nodeId:t})}):r.jsx(Ot,{label:e("nodes.noNodeSelected"),icon:null})},dSe=u.memo(uSe),zV=u.memo(({nodeId:e})=>{const{t}=M(),n=Vk(e),s=js(e),i=VV(e);return r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx($n,{children:r.jsxs(A,{flexDir:"column",position:"relative",w:"full",h:"full",gap:1,children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:t("nodes.nodeName")}),r.jsx(cSe,{nodeId:e})]}),r.jsxs(hQ,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:t("nodes.nodeType")}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:s.title})]}),r.jsxs(Z,{isInvalid:i,children:[r.jsx(te,{m:0,children:t("nodes.nodeVersion")}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n})]})]}),r.jsx($V,{nodeId:e})]})})})});zV.displayName="Content";const hSe=({output:e})=>{const{image:t}=e,{currentData:n}=Ua(t.image_name);return n?r.jsx(tl,{imageDTO:n}):null},fSe=u.memo(hSe),pSe=()=>{const e=I(KS),{t}=M();return e?r.jsx(Sv,{nodeId:e,fallback:r.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null}),children:r.jsx(HV,{nodeId:e})}):r.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null})},gSe=u.memo(pSe),mSe=(e,t)=>`${e.type}-${t}`,HV=u.memo(({nodeId:e})=>{const{t}=M(),n=js(e),s=ZS(e);return!s||s.outputs.length===0?r.jsx(Ot,{label:t("nodes.noOutputRecorded"),icon:null}):r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx($n,{children:r.jsx(A,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((i,o)=>r.jsx(fSe,{output:i},mSe(i,o))):r.jsx(Yo,{data:s.outputs,label:t("nodes.nodeOutputs"),bg:"base.850",color:"base.200"})})})})});HV.displayName="Content";const ySe=()=>{const e=I(KS),{t}=M();return e?r.jsx(Sv,{nodeId:e,fallback:r.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null}),children:r.jsx(WV,{nodeId:e})}):r.jsx(Ot,{label:t("nodes.noNodeSelected"),icon:null})},vSe=u.memo(ySe),WV=u.memo(({nodeId:e})=>{const{t}=M(),n=js(e);return r.jsx(Yo,{data:n,label:t("nodes.nodeTemplate"),bg:"base.850",color:"base.200"})});WV.displayName="Content";const bSe=()=>{const{t:e}=M();return r.jsxs(ec,{variant:"enclosed",display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(tc,{children:[r.jsx(Sn,{children:e("common.details")}),r.jsx(Sn,{children:e("common.outputs")}),r.jsx(Sn,{children:e("common.data")}),r.jsx(Sn,{children:e("common.template")})]}),r.jsxs(Vu,{h:"full",pt:2,children:[r.jsx(Ln,{h:"full",p:0,children:r.jsx(dSe,{})}),r.jsx(Ln,{h:"full",p:0,children:r.jsx(gSe,{})}),r.jsx(Ln,{h:"full",p:0,children:r.jsx(oSe,{})}),r.jsx(Ln,{h:"full",p:0,children:r.jsx(vSe,{})})]})]})},xSe=u.memo(bSe),UV=u.createContext(null),hg=u.memo(({id:e,layout:t,children:n})=>{const s=u.useMemo(()=>({id:e,layout:t}),[e,t]);return r.jsx(UV.Provider,{value:s,children:n})});hg.displayName="ContainerContextProvider";const Oi=()=>{const e=u.useContext(UV);return Ge(e!==null,"useContainerContext must be used inside a ContainerContextProvider and cannot be used by the root container"),e},qV=u.createContext(0),fg=u.memo(({depth:e,children:t})=>r.jsx(qV.Provider,{value:e,children:t}));fg.displayName="DepthContextProvider";const wv=()=>u.useContext(qV),CSe={bg:"base.700",flexShrink:0,'&[data-parent-layout="column"]':{width:"100%",height:"1px"},'&[data-parent-layout="row"]':{height:"100%",width:"1px"}},KV=u.memo(()=>{const e=Oi();return r.jsx(A,{sx:CSe,"data-parent-layout":e.layout})});KV.displayName="DividerElementComponent";const SSe={top:(e,t,n)=>{const s=Math.abs(t.y-e.top);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},right:(e,t,n)=>{const s=Math.abs(e.right-t.x);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},bottom:(e,t,n)=>{const s=Math.abs(e.bottom-t.y);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},left:(e,t,n)=>{const s=Math.abs(t.x-e.left);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},center:(e,t,n)=>{const s=e.left+e.width/2,i=e.top+e.height/2;return Math.sqrt((t.x-s)**2+(t.y-i)**2)}},ZV=Symbol("centerWithClosestEdge");function YV(e,{element:t,input:n,allowedCenterOrEdge:s}){var d;const i={x:n.clientX,y:n.clientY},o=t.getBoundingClientRect(),a=s.includes("center"),c=((d=s.map(h=>({edge:h,value:SSe[h](o,i,a)})).sort((h,f)=>h.value-f.value)[0])==null?void 0:d.edge)??null;return{...e,[ZV]:c}}function XV(e){return e[ZV]??null}const li=Fs("dnd"),QV=Symbol("form-element"),Ta=e=>({[QV]:!0,element:e}),yf=e=>QV in e,wSe=e=>{const t=document.querySelector(`#${e}`);t instanceof HTMLElement&&aB(t,oo("base.800"))},zk=()=>{const e=jn();return u.useCallback((n,s)=>{const{form:i}=ea(e.getState());return fQ(i,n,s)},[e])},jSe=()=>{const e=jn();return u.useCallback(n=>{const{form:s}=ea(e.getState());return gQ(s,n)},[e])},JV=()=>{const e=jn();return u.useCallback(n=>{const{form:s}=ea(e.getState());return mQ(s,n)},[e])},kSe=()=>{const e=jn();return u.useCallback(n=>{const{nodes:s}=lt(e.getState());return pQ(s,n)},[e])},_Se=()=>{kt("useBuilderDndMonitor");const e=z(),t=u.useCallback((o,a)=>{nc.flushSync(()=>{e(o)}),wSe(a)},[e]),n=zk(),s=kSe(),i=jSe();u.useEffect(()=>to({canMonitor:({source:o})=>yf(o.data),onDrop:({location:o,source:a})=>{const l=o.current.dropTargets[0];if(!l||!yf(a.data)||!yf(l.data))return;const c=a.data.element,d=l.data.element;if(c.id===d.id)return;const h=!i(c.id),f=XV(l.data);if(h)if(f==="center"){if(li.trace("Adding new element to empty container"),!Ur(d)){li.error(Do({target:l,source:a}),"Expected target to be a container");return}t(c2({element:c,parentId:d.id,index:0,initialValue:s(c)}),c.id);return}else{if(li.trace("Adding new element to container with children (dropped on edge of container child)"),d.parentId===void 0){li.error(Do({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Ur),g=p.data.children.indexOf(d.id),m=MC({startIndex:g+1,indexOfTarget:g,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(c2({element:c,parentId:p.id,index:m,initialValue:s(c)}),c.id);return}else if(f==="center"){if(li.trace("Reparenting element to an empty container"),!Ur(d)){li.error(Do({target:l,source:a}),"Expected target to be a container");return}t(v4({id:c.id,newParentId:d.id,index:0}),c.id);return}else if(d.parentId===c.parentId){if(li.trace("Moving element within container"),d.parentId===void 0){li.error(Do({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Ur),g=p.data.children.indexOf(c.id),m=p.data.children.indexOf(d.id),y=x$({list:p.data.children,startIndex:g,indexOfTarget:m,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(u2({id:p.id,changes:{children:y}}),c.id);return}else if(d.parentId!==c.parentId){if(li.trace("Reparenting element to container with children (dropped on edge of container child)"),d.parentId===void 0){li.error(Do({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Ur),g=p.data.children.indexOf(d.id),m=MC({startIndex:p.data.children.length+1,indexOfTarget:g,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(v4({id:c.id,newParentId:p.id,index:m}),c.id);return}else li.error(Do({target:l,source:a}),"Unhandled drop event!")}}),[t,i,n,s])},pg=(e,t,n)=>{const s=TSe(e),[i,o]=u.useState(!1),[a,l]=u.useState(null),c=zk(),d=JV();return u.useEffect(()=>{s&&Ge(!1,"Root element should not be draggable");const h=t.current,f=n.current;if(!(!h||!f))return Hn(gd(h),rd({element:h,dragHandle:f,getInitialData:()=>{const p=c(e);return Ta(p)},onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)}}),ju({element:h,getIsSticky:()=>!1,canDrop:({source:p})=>yf(p.data)&&p.data.element.id!==c(e).parentId,getData:({input:p})=>{const g=c(e),m=Ta(g),y=d(g);return YV(m,{element:h,input:p,allowedCenterOrEdge:y})},onDrag:({self:p,location:g,source:m})=>{var C;const y=(C=g.current.dropTargets.at(0))==null?void 0:C.element;if(!y||y!==h){l(null);return}const b=XV(p.data);if(b==="center"&&m.element===h){l(null);return}l(b)},onDragLeave:()=>{l(null)},onDrop:()=>{l(null)}}))},[n,t,e,d,c,s]),[a,i]},ISe=e=>{const[t,n]=u.useState(!1),s=zk(),i=JV(),o=I(YS);return u.useEffect(()=>{const a=e.current;if(a)return Hn(ju({element:a,getIsSticky:()=>!1,canDrop:({source:l})=>s(o,Ur).data.children.length===0&&yf(l.data),getData:({input:l})=>{const c=s(o,Ur),d=Ta(c);return YV(d,{element:a,input:l,allowedCenterOrEdge:["center"]})},onDrag:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:()=>{n(!1)}}))},[e,i,s,o]),t},ASe=(e,t,n,s)=>{const[i,o]=u.useState(!1);return u.useEffect(()=>{const a=n.current,l=s.current;if(!(!a||!l))return Hn(gd(a),rd({element:a,dragHandle:l,getInitialData:()=>{const{nodeId:c,fieldName:d}=e,{type:h}=t,f=AM(c,d,h);return Ta(f)},onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)}}))},[s,n,e,t]),i},TSe=e=>{const t=I(YS);return u.useMemo(()=>t===e,[t,e])},c1={thickness:2,backgroundColor:"base.600"},ESe={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:c1.backgroundColor},MSe={horizontal:{height:`${c1.thickness}px`,left:2,right:2},vertical:{width:`${c1.thickness}px`,top:2,bottom:2}},PSe={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},LSe={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function DSe({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${c1.thickness}px))`,s=PSe[e];return r.jsx(Se,{sx:{...ESe,...MSe[s],...LSe[e],"--local-line-offset":n}})}const gg=({activeDropRegion:e,gap:t})=>!e||e==="center"?null:r.jsx(DSe,{edge:e,gap:t||"var(--invoke-space-2)"}),RSe={w:"full",h:"full",borderWidth:1,borderRadius:"base",borderTopRadius:"unset",borderTop:"unset",borderColor:"baseAlpha.250",'&[data-depth="0"]':{borderColor:"baseAlpha.100"},'&[data-depth="1"]':{borderColor:"baseAlpha.150"},'&[data-depth="2"]':{borderColor:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3}},jd=u.memo(({children:e,...t})=>{const n=wv();return r.jsx(A,{sx:RSe,"data-depth":n,...t,children:e})});jd.displayName="FormElementEditModeContent";const eG=u.memo(({element:e})=>{const{id:t,data:n}=e,{layout:s}=n,{t:i}=M(),o=z(),a=u.useCallback(()=>{o(u2({id:t,changes:{layout:"row"}}))},[o,t]),l=u.useCallback(()=>{o(u2({id:t,changes:{layout:"column"}}))},[o,t]);return r.jsxs(Fn,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(Un,{children:r.jsx(oe,{"aria-label":"settings",icon:r.jsx(rD,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsx(za,{children:r.jsxs(Bn,{children:[r.jsx(Li,{}),r.jsx(qn,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:i("workflows.builder.layout")}),r.jsxs(Cs,{variant:"outline",size:"sm",children:[r.jsx(ye,{onClick:a,colorScheme:s==="row"?"invokeBlue":"base",children:i("workflows.builder.row")}),r.jsx(ye,{onClick:l,colorScheme:s==="column"?"invokeBlue":"base",children:i("workflows.builder.column")})]})]})})]})})]})});eG.displayName="ContainerElementSettings";const tG=u.memo(({id:e,config:t})=>{const{t:n}=M(),s=z(),i=u.useCallback(o=>{const a={...t,component:TM.parse(o.target.value)};s(uy({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(uo,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});tG.displayName="NodeFieldElementFloatSettings";const nG=u.memo(({id:e,config:t})=>{const{t:n}=M(),s=z(),i=u.useCallback(o=>{const a={...t,component:TM.parse(o.target.value)};s(uy({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(uo,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});nG.displayName="NodeFieldElementIntegerConfig";const sG=u.memo(({id:e,config:t})=>{const{t:n}=M(),s=z(),i=u.useCallback(o=>{const a={...t,component:yQ.parse(o.target.value)};s(uy({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(uo,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"input",children:n("workflows.builder.singleLine")}),r.jsx("option",{value:"textarea",children:n("workflows.builder.multiLine")})]})]})});sG.displayName="NodeFieldElementStringSettings";const Ni=(e,t)=>{const n=js(e);return u.useMemo(()=>{const i=n.inputs[t];return Ge(i,`Template for input field ${t} not found.`),i},[t,n.inputs])},rG=u.memo(({element:e})=>{const{id:t,data:n}=e,{showDescription:s,fieldIdentifier:i}=n,{nodeId:o,fieldName:a}=i,l=Ni(o,a),{t:c}=M(),d=z(),h=u.useCallback(()=>{d(uy({id:t,changes:{showDescription:!s}}))},[d,t,s]),f=u.useMemo(()=>n.settings?n.settings:EM(l)?vQ():MM(l)?bQ():PM(l)?xQ():null,[n.settings,l]);return r.jsxs(Fn,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(Un,{children:r.jsx(oe,{"aria-label":"settings",icon:r.jsx(rD,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsx(za,{children:r.jsxs(Bn,{children:[r.jsx(Li,{}),r.jsxs(qn,{minW:48,children:[r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:c("workflows.builder.showDescription")}),r.jsx(at,{size:"sm",isChecked:s,onChange:h})]}),(f==null?void 0:f.type)==="integer-field-config"&&r.jsx(nG,{id:t,config:f}),(f==null?void 0:f.type)==="float-field-config"&&r.jsx(tG,{id:t,config:f}),(f==null?void 0:f.type)==="string-field-config"&&r.jsx(sG,{id:t,config:f})]})]})})]})});rG.displayName="NodeFieldElementSettings";const Qm=Oe(null),iG=e=>{const[t,n]=u.useState(!1);u.useEffect(()=>Qm.subscribe(a=>{n(a===e)}),[t,e]);const s=u.useCallback(()=>{Qm.set(e)},[e]),i=u.useCallback(()=>{Qm.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:i}},px=Oe(null),Hk=e=>{const[t,n]=u.useState(!1);u.useEffect(()=>px.subscribe(a=>{n(a===e)}),[t,e]);const s=u.useCallback(()=>{px.set(e)},[e]),i=u.useCallback(()=>{px.set(null)},[]);return{isMouseOverFormField:t,handleMouseOver:s,handleMouseOut:i}},OSe=Fs("workflows"),oG=()=>u.useCallback(t=>{const n=sf.get();if(!n){OSe.warn("No flow instance found, cannot zoom to node");return}n.fitView({duration:300,maxZoom:1.5,nodes:[{id:t}]})},[]),NSe={w:"full",ps:2,h:8,minH:8,maxH:8,borderTopRadius:"base",alignItems:"center",color:"base.500",bg:"baseAlpha.250",cursor:"grab",'&[data-depth="0"]':{bg:"baseAlpha.100"},'&[data-depth="1"]':{bg:"baseAlpha.150"},'&[data-depth="2"]':{bg:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3},_hover:{bg:"baseAlpha.300"}},kd=u.memo(({element:e,dragHandleRef:t,...n})=>{const s=wv();return r.jsxs(A,{ref:t,sx:NSe,"data-depth":s,...n,children:[r.jsx(cG,{element:e}),r.jsx(rt,{}),Ur(e)&&r.jsx(eG,{element:e}),p0(e)&&r.jsx(aG,{element:e}),p0(e)&&r.jsx(rG,{element:e}),r.jsx(lG,{element:e})]})});kd.displayName="FormElementEditModeHeader";const aG=u.memo(({element:e})=>{const{t}=M(),{nodeId:n}=e.data.fieldIdentifier,s=oG(),i=Hk(n),o=u.useCallback(()=>{s(n)},[n,s]);return r.jsx(oe,{onMouseOver:i.handleMouseOver,onMouseOut:i.handleMouseOut,tooltip:t("workflows.builder.zoomToNode"),"aria-label":t("workflows.builder.zoomToNode"),onClick:o,icon:r.jsx(_ae,{}),variant:"link",size:"sm",alignSelf:"stretch"})});aG.displayName="ZoomToNodeButton";const lG=u.memo(({element:e})=>{const{t}=M(),n=z(),s=u.useCallback(()=>{n(CQ({id:e.id}))},[n,e.id]);return r.jsx(oe,{tooltip:t("common.delete"),"aria-label":t("common.delete"),onClick:s,icon:r.jsx(Nt,{}),variant:"link",size:"sm",alignSelf:"stretch",colorScheme:"error"})});lG.displayName="RemoveElementButton";const cG=u.memo(({element:e})=>{const t=u.useMemo(()=>Ur(e)&&e.data.layout==="column"?"Container (column layout)":Ur(e)&&e.data.layout==="row"?"Container (row layout)":ru(e.type),[e]);return r.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",userSelect:"none",children:t})});cG.displayName="Label";const FSe={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{w:"min-content",h:"full"},flexDir:"column"},uG=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=pg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(A,{ref:t,id:a,className:LM,sx:FSe,"data-parent-layout":o.layout,children:[r.jsx(kd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(jd,{"data-is-dragging":i,p:4,children:r.jsx(KV,{})}),r.jsx(gg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});uG.displayName="DividerElementEditMode";const BSe={bg:"base.700",flexShrink:0,'&[data-layout="column"]':{width:"100%",height:"1px"},'&[data-layout="row"]':{height:"100%",width:"1px"}},dG=u.memo(({el:e})=>{const t=Oi(),{id:n}=e;return r.jsx(A,{id:n,className:LM,sx:BSe,"data-layout":(t==null?void 0:t.layout)||"column"})});dG.displayName="DividerElementViewMode";const hG=u.memo(({id:e})=>{const t=Ku(e),n=I(bo);if(!(!t||!DM(t)))return n==="view"?r.jsx(dG,{el:t}):r.jsx(uG,{el:t})});hG.displayName="DividerElement";function Ss(){return Ss=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ss.apply(null,arguments)}function $Se(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;n[s]=e[s]}return n}var VSe=u.useLayoutEffect,GSe=function(t){var n=me.useRef(t);return VSe(function(){n.current=t}),n},XT=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},zSe=function(t,n){var s=me.useRef();return me.useCallback(function(i){t.current=i,s.current&&XT(s.current,null),s.current=n,n&&XT(n,i)},[n])},QT={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},HSe=function(t){Object.keys(QT).forEach(function(n){t.style.setProperty(n,QT[n],"important")})},JT=HSe,_s=null,e8=function(t,n){var s=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?s+n.borderSize:s-n.paddingSize};function WSe(e,t,n,s){n===void 0&&(n=1),s===void 0&&(s=1/0),_s||(_s=document.createElement("textarea"),_s.setAttribute("tabindex","-1"),_s.setAttribute("aria-hidden","true"),JT(_s)),_s.parentNode===null&&document.body.appendChild(_s);var i=e.paddingSize,o=e.borderSize,a=e.sizingStyle,l=a.boxSizing;Object.keys(a).forEach(function(p){var g=p;_s.style[g]=a[g]}),JT(_s),_s.value=t;var c=e8(_s,e);_s.value=t,c=e8(_s,e),_s.value="x";var d=_s.scrollHeight-i,h=d*n;l==="border-box"&&(h=h+i+o),c=Math.max(h,c);var f=d*s;return l==="border-box"&&(f=f+i+o),c=Math.min(f,c),[c,d]}var t8=function(){},USe=function(t,n){return t.reduce(function(s,i){return s[i]=n[i],s},{})},qSe=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],KSe=!!document.documentElement.currentStyle,ZSe=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var s=USe(qSe,n),i=s.boxSizing;if(i==="")return null;KSe&&i==="border-box"&&(s.width=parseFloat(s.width)+parseFloat(s.borderRightWidth)+parseFloat(s.borderLeftWidth)+parseFloat(s.paddingRight)+parseFloat(s.paddingLeft)+"px");var o=parseFloat(s.paddingBottom)+parseFloat(s.paddingTop),a=parseFloat(s.borderBottomWidth)+parseFloat(s.borderTopWidth);return{sizingStyle:s,paddingSize:o,borderSize:a}},YSe=ZSe;function Wk(e,t,n){var s=GSe(n);u.useLayoutEffect(function(){var i=function(a){return s.current(a)};if(e)return e.addEventListener(t,i),function(){return e.removeEventListener(t,i)}},[])}var XSe=function(t,n){Wk(document.body,"reset",function(s){t.current.form===s.target&&n(s)})},QSe=function(t){Wk(window,"resize",t)},JSe=function(t){Wk(document.fonts,"loadingdone",t)},ewe=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],twe=function(t,n){var s=t.cacheMeasurements,i=t.maxRows,o=t.minRows,a=t.onChange,l=a===void 0?t8:a,c=t.onHeightChange,d=c===void 0?t8:c,h=$Se(t,ewe),f=h.value!==void 0,p=u.useRef(null),g=zSe(p,n),m=u.useRef(0),y=u.useRef(),b=function(){var x=p.current,S=s&&y.current?y.current:YSe(x);if(S){y.current=S;var w=WSe(S,x.value||x.placeholder||"x",o,i),j=w[0],P=w[1];m.current!==j&&(m.current=j,x.style.setProperty("height",j+"px","important"),d(j,{rowHeight:P}))}},C=function(x){f||b(),l(x)};return u.useLayoutEffect(b),XSe(p,function(){if(!f){var v=p.current,x=v.value;requestAnimationFrame(function(){x!==v.value&&b()})}}),QSe(b),JSe(b),u.createElement("textarea",Ss({},h,{onChange:C,ref:g}))},nwe=u.forwardRef(twe);const swe=Qo(nwe),Uk=Ip(RM(({variant:e,...t},n)=>{const s=SQ("Textarea",{variant:e});return r.jsx(swe,{__css:s,ref:n,...t})}));Uk.displayName="AutosizeTextarea";const mg={a:{fontWeight:"semibold"},"a:hover":{textDecoration:"underline"}},yg={target:"_blank",rel:"noopener noreferrer",validate:e=>/^https?:\/\//.test(e)},rwe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",iwe="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Wl=(e,t)=>{for(const n in t)e[n]=t[n];return e},RC="numeric",OC="ascii",NC="alpha",vf="asciinumeric",tf="alphanumeric",FC="domain",fG="emoji",owe="scheme",awe="slashscheme",gx="whitespace";function lwe(e,t){return e in t||(t[e]=[]),t[e]}function jl(e,t,n){t[RC]&&(t[vf]=!0,t[tf]=!0),t[OC]&&(t[vf]=!0,t[NC]=!0),t[vf]&&(t[tf]=!0),t[NC]&&(t[tf]=!0),t[tf]&&(t[FC]=!0),t[fG]&&(t[FC]=!0);for(const s in t){const i=lwe(s,n);i.indexOf(e)<0&&i.push(e)}}function cwe(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}function gr(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}gr.groups={};gr.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const i=t.jr[s][0],o=t.jr[s][1];if(o&&i.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let i=0;i<e.length;i++)this.tt(e[i],t,n,s)},tr(e,t,n,s){s=s||gr.groups;let i;return t&&t.j?i=t:(i=new gr(t),n&&s&&jl(t,n,s)),this.jr.push([e,i]),i},ts(e,t,n,s){let i=this;const o=e.length;if(!o)return i;for(let a=0;a<o-1;a++)i=i.tt(e[a]);return i.tt(e[o-1],t,n,s)},tt(e,t,n,s){s=s||gr.groups;const i=this;if(t&&t.j)return i.j[e]=t,t;const o=t;let a,l=i.go(e);if(l?(a=new gr,Wl(a.j,l.j),a.jr.push.apply(a.jr,l.jr),a.jd=l.jd,a.t=l.t):a=new gr,o){if(s)if(a.t&&typeof a.t=="string"){const c=Wl(cwe(a.t,s),n);jl(o,c,s)}else n&&jl(o,n,s);a.t=o}return i.j[e]=a,a}};const mt=(e,t,n,s,i)=>e.ta(t,n,s,i),xn=(e,t,n,s,i)=>e.tr(t,n,s,i),n8=(e,t,n,s,i)=>e.ts(t,n,s,i),ke=(e,t,n,s,i)=>e.tt(t,n,s,i),Eo="WORD",BC="UWORD",pG="ASCIINUMERICAL",gG="ALPHANUMERICAL",Qf="LOCALHOST",$C="TLD",VC="UTLD",Jm="SCHEME",$c="SLASH_SCHEME",qk="NUM",GC="WS",Kk="NL",bf="OPENBRACE",xf="CLOSEBRACE",u1="OPENBRACKET",d1="CLOSEBRACKET",h1="OPENPAREN",f1="CLOSEPAREN",p1="OPENANGLEBRACKET",g1="CLOSEANGLEBRACKET",m1="FULLWIDTHLEFTPAREN",y1="FULLWIDTHRIGHTPAREN",v1="LEFTCORNERBRACKET",b1="RIGHTCORNERBRACKET",x1="LEFTWHITECORNERBRACKET",C1="RIGHTWHITECORNERBRACKET",S1="FULLWIDTHLESSTHAN",w1="FULLWIDTHGREATERTHAN",j1="AMPERSAND",Zk="APOSTROPHE",k1="ASTERISK",ma="AT",_1="BACKSLASH",I1="BACKTICK",A1="CARET",Ca="COLON",Yk="COMMA",T1="DOLLAR",Gi="DOT",E1="EQUALS",Xk="EXCLAMATION",Vr="HYPHEN",Cf="PERCENT",M1="PIPE",P1="PLUS",L1="POUND",Sf="QUERY",Qk="QUOTE",mG="FULLWIDTHMIDDLEDOT",Jk="SEMI",zi="SLASH",wf="TILDE",D1="UNDERSCORE",yG="EMOJI",R1="SYM";var vG=Object.freeze({__proto__:null,WORD:Eo,UWORD:BC,ASCIINUMERICAL:pG,ALPHANUMERICAL:gG,LOCALHOST:Qf,TLD:$C,UTLD:VC,SCHEME:Jm,SLASH_SCHEME:$c,NUM:qk,WS:GC,NL:Kk,OPENBRACE:bf,CLOSEBRACE:xf,OPENBRACKET:u1,CLOSEBRACKET:d1,OPENPAREN:h1,CLOSEPAREN:f1,OPENANGLEBRACKET:p1,CLOSEANGLEBRACKET:g1,FULLWIDTHLEFTPAREN:m1,FULLWIDTHRIGHTPAREN:y1,LEFTCORNERBRACKET:v1,RIGHTCORNERBRACKET:b1,LEFTWHITECORNERBRACKET:x1,RIGHTWHITECORNERBRACKET:C1,FULLWIDTHLESSTHAN:S1,FULLWIDTHGREATERTHAN:w1,AMPERSAND:j1,APOSTROPHE:Zk,ASTERISK:k1,AT:ma,BACKSLASH:_1,BACKTICK:I1,CARET:A1,COLON:Ca,COMMA:Yk,DOLLAR:T1,DOT:Gi,EQUALS:E1,EXCLAMATION:Xk,HYPHEN:Vr,PERCENT:Cf,PIPE:M1,PLUS:P1,POUND:L1,QUERY:Sf,QUOTE:Qk,FULLWIDTHMIDDLEDOT:mG,SEMI:Jk,SLASH:zi,TILDE:wf,UNDERSCORE:D1,EMOJI:yG,SYM:R1});const Io=/[a-z]/,Fh=new RegExp("\\p{L}","u"),mx=new RegExp("\\p{Emoji}","u"),Ao=/\d/,yx=/\s/,s8="\r",vx=`
`,uwe="",dwe="",bx="";let bm=null,xm=null;function hwe(e=[]){const t={};gr.groups=t;const n=new gr;bm==null&&(bm=r8(rwe)),xm==null&&(xm=r8(iwe)),ke(n,"'",Zk),ke(n,"{",bf),ke(n,"}",xf),ke(n,"[",u1),ke(n,"]",d1),ke(n,"(",h1),ke(n,")",f1),ke(n,"<",p1),ke(n,">",g1),ke(n,"",m1),ke(n,"",y1),ke(n,"",v1),ke(n,"",b1),ke(n,"",x1),ke(n,"",C1),ke(n,"",S1),ke(n,"",w1),ke(n,"&",j1),ke(n,"*",k1),ke(n,"@",ma),ke(n,"`",I1),ke(n,"^",A1),ke(n,":",Ca),ke(n,",",Yk),ke(n,"$",T1),ke(n,".",Gi),ke(n,"=",E1),ke(n,"!",Xk),ke(n,"-",Vr),ke(n,"%",Cf),ke(n,"|",M1),ke(n,"+",P1),ke(n,"#",L1),ke(n,"?",Sf),ke(n,'"',Qk),ke(n,"/",zi),ke(n,";",Jk),ke(n,"~",wf),ke(n,"_",D1),ke(n,"\\",_1),ke(n,"",mG);const s=xn(n,Ao,qk,{[RC]:!0});xn(s,Ao,s);const i=xn(s,Io,pG,{[vf]:!0}),o=xn(s,Fh,gG,{[tf]:!0}),a=xn(n,Io,Eo,{[OC]:!0});xn(a,Ao,i),xn(a,Io,a),xn(i,Ao,i),xn(i,Io,i);const l=xn(n,Fh,BC,{[NC]:!0});xn(l,Io),xn(l,Ao,o),xn(l,Fh,l),xn(o,Ao,o),xn(o,Io),xn(o,Fh,o);const c=ke(n,vx,Kk,{[gx]:!0}),d=ke(n,s8,GC,{[gx]:!0}),h=xn(n,yx,GC,{[gx]:!0});ke(n,bx,h),ke(d,vx,c),ke(d,bx,h),xn(d,yx,h),ke(h,s8),ke(h,vx),xn(h,yx,h),ke(h,bx,h);const f=xn(n,mx,yG,{[fG]:!0});ke(f,"#"),xn(f,mx,f),ke(f,uwe,f);const p=ke(f,dwe);ke(p,"#"),xn(p,mx,f);const g=[[Io,a],[Ao,i]],m=[[Io,null],[Fh,l],[Ao,o]];for(let y=0;y<bm.length;y++)ca(n,bm[y],$C,Eo,g);for(let y=0;y<xm.length;y++)ca(n,xm[y],VC,BC,m);jl($C,{tld:!0,ascii:!0},t),jl(VC,{utld:!0,alpha:!0},t),ca(n,"file",Jm,Eo,g),ca(n,"mailto",Jm,Eo,g),ca(n,"http",$c,Eo,g),ca(n,"https",$c,Eo,g),ca(n,"ftp",$c,Eo,g),ca(n,"ftps",$c,Eo,g),jl(Jm,{scheme:!0,ascii:!0},t),jl($c,{slashscheme:!0,ascii:!0},t),e=e.sort((y,b)=>y[0]>b[0]?1:-1);for(let y=0;y<e.length;y++){const b=e[y][0],v=e[y][1]?{[owe]:!0}:{[awe]:!0};b.indexOf("-")>=0?v[FC]=!0:Io.test(b)?Ao.test(b)?v[vf]=!0:v[OC]=!0:v[RC]=!0,n8(n,b,b,v)}return n8(n,"localhost",Qf,{ascii:!0}),n.jd=new gr(R1),{start:n,tokens:Wl({groups:t},vG)}}function bG(e,t){const n=fwe(t.replace(/[A-Z]/g,l=>l.toLowerCase())),s=n.length,i=[];let o=0,a=0;for(;a<s;){let l=e,c=null,d=0,h=null,f=-1,p=-1;for(;a<s&&(c=l.go(n[a]));)l=c,l.accepts()?(f=0,p=0,h=l):f>=0&&(f+=n[a].length,p++),d+=n[a].length,o+=n[a].length,a++;o-=f,a-=p,d-=f,i.push({t:h.t,v:t.slice(o-d,o),s:o-d,e:o})}return i}function fwe(e){const t=[],n=e.length;let s=0;for(;s<n;){let i=e.charCodeAt(s),o,a=i<55296||i>56319||s+1===n||(o=e.charCodeAt(s+1))<56320||o>57343?e[s]:e.slice(s,s+2);t.push(a),s+=a.length}return t}function ca(e,t,n,s,i){let o;const a=t.length;for(let l=0;l<a-1;l++){const c=t[l];e.j[c]?o=e.j[c]:(o=new gr(s),o.jr=i.slice(),e.j[c]=o),e=o}return o=new gr(n),o.jr=i.slice(),e.j[t[a-1]]=o,o}function r8(e){const t=[],n=[];let s=0,i="0123456789";for(;s<e.length;){let o=0;for(;i.indexOf(e[s+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let a=parseInt(e.substring(s,s+o),10);a>0;a--)n.pop();s+=o}else n.push(e[s]),s++}return t}const Lu={defaultProtocol:"http",events:null,format:i8,formatHref:i8,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function jv(e,t=null){let n=Wl({},Lu);e&&(n=Wl(n,e instanceof jv?e.o:e));const s=n.ignoreTags,i=[];for(let o=0;o<s.length;o++)i.push(s[o].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=i}jv.prototype={o:Lu,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=t!=null;let i=this.o[e];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:Lu[e],typeof i=="function"&&s&&(i=i(t,n))):typeof i=="function"&&s&&(i=i(t,n.t,n)),i)},getObj(e,t,n){let s=this.o[e];return typeof s=="function"&&t!=null&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function i8(e){return e}var xG=Object.freeze({__proto__:null,defaults:Lu,Options:jv,assign:Wl});function CG(e,t){this.t="token",this.v=e,this.tk=t}CG.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=Lu.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),i=e.get("tagName",n,t),o=this.toFormattedString(e),a={},l=e.get("className",n,t),c=e.get("target",n,t),d=e.get("rel",n,t),h=e.getObj("attributes",n,t),f=e.getObj("events",n,t);return a.href=s,l&&(a.class=l),c&&(a.target=c),d&&(a.rel=d),h&&Wl(a,h),{tagName:i,attributes:a,content:o,eventListeners:f}}};function kv(e,t){class n extends CG{constructor(i,o){super(i,o),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}const o8=kv("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),a8=kv("text"),pwe=kv("nl"),Cm=kv("url",{isLink:!0,toHref(e=Lu.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Qf&&e[1].t===Ca}}),Br=e=>new gr(e);function gwe({groups:e}){const t=e.domain.concat([j1,k1,ma,_1,I1,A1,T1,E1,Vr,qk,Cf,M1,P1,L1,zi,R1,wf,D1]),n=[Ca,Yk,Gi,Xk,Cf,Sf,Qk,Jk,p1,g1,bf,xf,d1,u1,h1,f1,m1,y1,v1,b1,x1,C1,S1,w1],s=[j1,Zk,k1,_1,I1,A1,T1,E1,Vr,bf,xf,Cf,M1,P1,L1,Sf,zi,R1,wf,D1],i=Br(),o=ke(i,wf);mt(o,s,o),mt(o,e.domain,o);const a=Br(),l=Br(),c=Br();mt(i,e.domain,a),mt(i,e.scheme,l),mt(i,e.slashscheme,c),mt(a,s,o),mt(a,e.domain,a);const d=ke(a,ma);ke(o,ma,d),ke(l,ma,d),ke(c,ma,d);const h=ke(o,Gi);mt(h,s,o),mt(h,e.domain,o);const f=Br();mt(d,e.domain,f),mt(f,e.domain,f);const p=ke(f,Gi);mt(p,e.domain,f);const g=Br(o8);mt(p,e.tld,g),mt(p,e.utld,g),ke(d,Qf,g);const m=ke(f,Vr);ke(m,Vr,m),mt(m,e.domain,f),mt(g,e.domain,f),ke(g,Gi,p),ke(g,Vr,m);const y=ke(g,Ca);mt(y,e.numeric,o8);const b=ke(a,Vr),C=ke(a,Gi);ke(b,Vr,b),mt(b,e.domain,a),mt(C,s,o),mt(C,e.domain,a);const v=Br(Cm);mt(C,e.tld,v),mt(C,e.utld,v),mt(v,e.domain,a),mt(v,s,o),ke(v,Gi,C),ke(v,Vr,b),ke(v,ma,d);const x=ke(v,Ca),S=Br(Cm);mt(x,e.numeric,S);const w=Br(Cm),j=Br();mt(w,t,w),mt(w,n,j),mt(j,t,w),mt(j,n,j),ke(v,zi,w),ke(S,zi,w);const P=ke(l,Ca),T=ke(c,Ca),L=ke(T,zi),E=ke(L,zi);mt(l,e.domain,a),ke(l,Gi,C),ke(l,Vr,b),mt(c,e.domain,a),ke(c,Gi,C),ke(c,Vr,b),mt(P,e.domain,w),ke(P,zi,w),ke(P,Sf,w),mt(E,e.domain,w),mt(E,t,w),ke(E,zi,w);const O=[[bf,xf],[u1,d1],[h1,f1],[p1,g1],[m1,y1],[v1,b1],[x1,C1],[S1,w1]];for(let F=0;F<O.length;F++){const[_,R]=O[F],D=ke(w,_);ke(j,_,D),ke(D,R,w);const $=Br(Cm);mt(D,t,$);const G=Br();mt(D,n),mt($,t,$),mt($,n,G),mt(G,t,$),mt(G,n,G),ke($,R,w),ke(G,R,w)}return ke(i,Qf,v),ke(i,Kk,pwe),{start:i,tokens:vG}}function mwe(e,t,n){let s=n.length,i=0,o=[],a=[];for(;i<s;){let l=e,c=null,d=null,h=0,f=null,p=-1;for(;i<s&&!(c=l.go(n[i].t));)a.push(n[i++]);for(;i<s&&(d=c||l.go(n[i].t));)c=null,l=d,l.accepts()?(p=0,f=l):p>=0&&p++,i++,h++;if(p<0)i-=h,i<s&&(a.push(n[i]),i++);else{a.length>0&&(o.push(xx(a8,t,a)),a=[]),i-=p,h-=p;const g=f.t,m=n.slice(i-h,i);o.push(xx(g,t,m))}}return a.length>0&&o.push(xx(a8,t,a)),o}function xx(e,t,n){const s=n[0].s,i=n[n.length-1].e,o=t.slice(s,i);return new e(o,n)}const ls={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function ywe(){ls.scanner=hwe(ls.customSchemes);for(let e=0;e<ls.tokenQueue.length;e++)ls.tokenQueue[e][1]({scanner:ls.scanner});ls.parser=gwe(ls.scanner.tokens);for(let e=0;e<ls.pluginQueue.length;e++)ls.pluginQueue[e][1]({scanner:ls.scanner,parser:ls.parser});return ls.initialized=!0,ls}function SG(e){return ls.initialized||ywe(),mwe(ls.parser.start,e,bG(ls.scanner.start,e))}SG.scan=bG;function vwe(e,t,n){const s=SG(e),i=[];for(let o=0;o<s.length;o++){const a=s[o];if(a.t==="nl"&&t.get("nl2br")){const l=`__linkify-el-${n.elementId++}`;i.push(u.createElement("br",{key:l}))}else if(!a.isLink||!t.check(a))i.push(a.toString());else{let l=t.render(a);if(!("key"in l.props)){const c=`__linkify-el-${n.elementId++}`,d=xG.assign({key:c},l.props);l=u.cloneElement(l,d)}i.push(l)}}return i}function wG(e,t,n){if(u.Children.count(e.props.children)===0)return e;const s=[];u.Children.forEach(e.props.children,a=>{typeof a=="string"?s.push.apply(s,vwe(a,t,n)):u.isValidElement(a)?typeof a.type=="string"&&t.ignoreTags.indexOf(a.type.toUpperCase())>=0?s.push(a):s.push(wG(a,t,n)):s.push(a)});const i=`__linkify-el-${n.elementId++}`,o=xG.assign({key:i},e.props);return u.cloneElement(e,o,s)}const vg=e=>{let t=0;const n=({tagName:c,attributes:d,content:h})=>(d.key=`__linkify-lnk-${t++}`,d.class&&(d.className=d.class,delete d.class),u.createElement(c,d,h)),s={key:"__linkify-wrapper"};for(const c in e)c!=="options"&&c!=="as"&&c!=="tagName"&&c!=="children"&&(s[c]=e[c]);const i=new jv(e.options,n),o=e.as||e.tagName||u.Fragment||"span",a=e.children,l=u.createElement(o,s,a);return wG(l,i,{elementId:0})},bwe={fontWeight:"bold",fontSize:"2xl",'&[data-is-empty="true"]':{opacity:.3},...mg},e_=u.memo(({content:e,...t})=>{const{t:n}=M();return r.jsx(q,{sx:bwe,"data-is-empty":e==="",...t,children:r.jsx(vg,{options:yg,children:e||n("workflows.builder.headingPlaceholder")})})});e_.displayName="HeadingElementContent";const jG=u.memo(({el:e})=>{const{t}=M(),n=z(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(wQ({id:s,changes:{content:d}}))},[n,s]),c=oa({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Uk,{ref:a,placeholder:t("workflows.builder.headingPlaceholder"),...c.inputProps,variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:1,px:2,fontWeight:"bold",fontSize:"2xl",_focusVisible:{borderRadius:"base",h:"unset"}}):r.jsx(e_,{content:c.value,onDoubleClick:c.startEditing})});jG.displayName="HeadingElementContentEditable";const xwe={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},kG=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=pg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(A,{ref:t,id:a,className:OM,sx:xwe,"data-parent-layout":o.layout,children:[r.jsx(kd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(jd,{"data-is-dragging":i,p:4,children:r.jsx(jG,{el:e})}),r.jsx(gg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});kG.displayName="HeadingElementEditMode";const Cwe={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},_G=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=Oi();return r.jsx(A,{id:t,className:OM,sx:Cwe,"data-parent-layout":i.layout,children:r.jsx(e_,{content:s})})});_G.displayName="HeadingElementViewMode";const IG=u.memo(({id:e})=>{const t=Ku(e),n=I(bo);return!t||!NM(t)?null:n==="view"?r.jsx(_G,{el:t}):r.jsx(kG,{el:t})});IG.displayName="HeadingElement";const Swe={position:"relative",minH:8,py:.5,alignItems:"center",w:"full",h:"full"},_v=u.memo(({children:e})=>r.jsx(A,{sx:Swe,children:e}));_v.displayName="InputFieldWrapper";const wwe=(e,t)=>{const n=ce(Tn),s=u.useMemo(()=>pe(lt,o=>{const a=dy(o,e);if(!a)return t;const l=a.data.inputs[t],c=n[a.data.type],d=c==null?void 0:c.inputs[t];return(l==null?void 0:l.label)||(d==null?void 0:d.title)||t}),[t,e,n]);return I(s)},AG=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=wwe(e,t);return r.jsx(_v,{children:r.jsx(Z,{isInvalid:!0,alignItems:"stretch",justifyContent:"center",gap:2,h:"full",w:"full",children:r.jsx(te,{display:"flex",mb:0,px:1,py:2,gap:2,children:n("nodes.unknownInput",{name:s})})})})});AG.displayName="InputFieldUnknownPlaceholder";const jwe=(e,t)=>{const n=u.useMemo(()=>pe(lt,i=>{const o=dy(i,e);return o?!!o.data.inputs[t]:!1}),[t,e]);return I(n)},kwe=(e,t)=>{const n=ce(Tn),s=u.useMemo(()=>pe(lt,o=>{const a=dy(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.inputs[t])}),[t,e,n]);return I(s)},Du=u.memo(({nodeId:e,fieldName:t,children:n})=>{const s=jwe(e,t);return!kwe(e,t)||!s?r.jsx(AG,{nodeId:e,fieldName:t}):n});Du.displayName="InputFieldGate";const t_=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(h=>{i(jQ({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useMemo(()=>{let h=-4294967295;return qe(s.minimum)||(h=s.minimum),qe(s.exclusiveMinimum)||(h=s.exclusiveMinimum+.01),h},[s.exclusiveMinimum,s.minimum]),l=u.useMemo(()=>{let h=Zu;return qe(s.maximum)||(h=s.maximum),qe(s.exclusiveMaximum)||(h=s.exclusiveMaximum-.01),h},[s.exclusiveMaximum,s.maximum]),c=u.useMemo(()=>qe(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),d=u.useMemo(()=>qe(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return{defaultValue:s.default,onChange:o,value:n.value,min:a,max:l,step:c,fineStep:d}},zC=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=t_(e);return r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,flex:"1 1 0"})});zC.displayName="FloatFieldInput ";const TG=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=t_(e);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,flex:"1 1 0"})]})});TG.displayName="FloatFieldInputAndSlider ";const EG=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=t_(e);return r.jsx(Ze,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});EG.displayName="FloatFieldSlider ";const bg=(e,t)=>{const n=ce(Tn),s=u.useMemo(()=>pe(lt,o=>{const a=cy(o,e),l=kQ(o,e,t);if(!l)return!0;const c=n[a.data.type];Ge(c,`Template for input node type ${a.data.type} not found.`);const d=c.inputs[t];return Ge(d,`Template for input field ${t} not found.`),hL(a,c,l,d,o).length>0}),[e,t,n]);return I(s)},_we=Co().options,Iwe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},MG=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=jn(),{t:o}=M(),a=bg(t,n.name),l=u.useCallback(y=>{i.dispatch(_Q({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const b=n.value?[...n.value]:[];b.splice(y,1),l(b)},[n.value,l]),d=u.useCallback((y,b)=>{const C=n.value?[...n.value]:[];C[y]=b,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return qe(s.minimum)||(y=s.minimum),qe(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=Zu;return qe(s.maximum)||(y=s.maximum),qe(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>qe(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>qe(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return r.jsxs(A,{className:Ue,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Iwe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsx(Ns,{className:ht,defer:!0,style:Za,options:_we,children:r.jsx(Xr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,b)=>r.jsx(PG,{value:y,index:b,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});MG.displayName="FloatFieldCollectionInputComponent";const PG=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=M(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,f)},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(Dt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Dt,{children:r.jsx(Ae,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:Ue,flexGrow:1})}),r.jsx(Dt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Nt,{}),"aria-label":c("common.delete")})})]})});PG.displayName="FloatListItemContent";const LG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.step")}),r.jsx(Ae,{value:e.step,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});LG.displayName="FloatGeneratorArithmeticSequenceSettings";const DG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.end")}),r.jsx(Ae,{value:e.end,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});DG.displayName="FloatGeneratorLinearDistributionSettings";const Awe=1024*128,_d=u.memo(({value:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(l=>{const c=l[0];if(!c)return;const d=new FileReader;d.onload=()=>{const h=d.result;Tf(h)&&t(h)},d.onerror=()=>{ve({title:"Failed to load file",status:"error"})},d.readAsText(c)},[t]),{getInputProps:i,getRootProps:o}=Ya({accept:{"text/csv":[".csv"],"text/plain":[".txt"]},maxSize:Awe,onDropAccepted:s,noDrag:!0,multiple:!1}),a=u.useCallback(l=>{t(l.target.value)},[t]);return r.jsxs(Z,{orientation:"vertical",position:"relative",alignItems:"stretch",children:[r.jsxs(te,{m:0,display:"flex",alignItems:"center",children:[n("common.input"),r.jsx(rt,{}),r.jsx(oe,{tooltip:n("nodes.generatorLoadFromFile"),"aria-label":n("nodes.generatorLoadFromFile"),icon:r.jsx(sle,{}),variant:"link",...o()}),r.jsx("input",{...i()})]}),r.jsx(Qn,{className:`${Ue} ${ki} ${ht}`,value:e,onChange:a,p:2,resize:"none",rows:5,fontSize:"sm"})]})});_d.displayName="GeneratorTextareaWithFileUpload";const RG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(jt,{value:e.splitOn,onChange:s})]}),r.jsx(_d,{value:e.input,onChange:i})]})});RG.displayName="FloatGeneratorParseStringSettings";const OG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(A,{gap:2,flexDir:"column",children:r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.min")}),r.jsx(Ae,{value:e.min,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.max")}),r.jsx(Ae,{value:e.max,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(kn,{onChange:a,isChecked:!qe(e.seed)})]}),r.jsx(Ae,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});OG.displayName="FloatGeneratorUniformRandomDistributionSettings";const Twe=Co().options,NG=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=z(),o=u.useCallback(d=>{i(b4({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=IQ(d.target.value);h&&i(b4({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=Ju(n,300),c=u.useMemo(()=>{if(l.value.type===Xv&&qe(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=AQ(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>_p(h,2)).join(", ")},[l,s]);return r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsxs(uo,{className:`${ht} ${Ue}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:x4,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:C4,children:s("nodes.linearDistribution")}),r.jsx("option",{value:Xv,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:S4,children:s("nodes.parseString")})]}),n.value.type===x4&&r.jsx(LG,{state:n.value,onChange:o}),n.value.type===C4&&r.jsx(DG,{state:n.value,onChange:o}),n.value.type===Xv&&r.jsx(OG,{state:n.value,onChange:o}),n.value.type===S4&&r.jsx(RG,{state:n.value,onChange:o}),r.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(A,{w:"full",h:"auto",children:r.jsx(Ns,{className:`${ht} ${Ue}`,defer:!0,style:Za,options:Twe,children:r.jsx(q,{className:`${ht} ${Ue}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});NG.displayName="FloatGeneratorFieldInputComponent";const Ewe=Co().options,Mwe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},FG=u.memo(e=>{const{t}=M(),{nodeId:n,field:s}=e,i=jn(),o=bg(n,s.name),a=u.useMemo(()=>mC.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}}),[s,n]),l=u.useCallback(d=>{i.dispatch(e2({nodeId:n,fieldName:s.name,value:d}))},[i,n,s.name]),c=u.useCallback(d=>{const h=s.value?[...s.value]:[];h.splice(d,1),i.dispatch(e2({nodeId:n,fieldName:s.name,value:h}))},[s.name,s.value,n,i]);return r.jsxs(A,{className:Ue,position:"relative",w:"full",h:"full",minH:16,maxH:64,alignItems:"stretch",justifyContent:"center",children:[(!s.value||s.value.length===0)&&r.jsx(d2e,{w:"full",h:"auto",isError:o,onUpload:l,fontSize:24,variant:"ghost"}),s.value&&s.value.length>0&&r.jsx(Se,{w:"full",h:"auto",p:1,sx:Mwe,"data-error":o,borderRadius:"base",children:r.jsx(Ns,{className:ht,defer:!0,style:Za,options:Ewe,children:r.jsx(Xr,{w:"full",h:"full",templateColumns:"repeat(4, 1fr)",gap:1,children:s.value.map((d,h)=>r.jsx(Dt,{position:"relative",className:Ue,children:r.jsx(BG,{value:d,index:h,onRemoveImage:c})},h))})})}),r.jsx(gs,{dndTarget:mC,dndTargetData:a,label:t("gallery.drop")})]})});FG.displayName="ImageFieldCollectionInputComponent";const BG=u.memo(({value:e,index:t,onRemoveImage:n})=>{const s=Ua(e.image_name),i=u.useCallback(()=>{n(t)},[t,n]);return s.isLoading?r.jsx(Ny,{}):s.data?r.jsxs(r.Fragment,{children:[r.jsx(tl,{imageDTO:s.data,asThumbnail:!0,objectFit:"contain",w:"full",h:"full",aspectRatio:"1/1",backgroundSize:8,backgroundImage:pd}),r.jsx(Xo,{onClick:i,icon:r.jsx(Nt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ot,{icon:BL}),r.jsx(Xo,{onClick:i,icon:r.jsx(Nt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]})});BG.displayName="ImageGridItemContent";const $G=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(o=>{t({...e,category:o})},[t,e]),i=u.useCallback(o=>{t({...e,board_id:o})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.board")}),r.jsx(Lwe,{board_id:e.board_id,onChange:i})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.generatorImagesCategory")}),r.jsx(Dwe,{category:e.category,onChange:s})]})]})});$G.displayName="ImageGeneratorImagesFromBoardSettings";const Pwe={include_archived:!1},Lwe=({board_id:e,onChange:t})=>{const{t:n}=M(),s=Zl(Pwe),i=u.useMemo(()=>s.data?s.data.map(c=>({label:c.board_name,value:c.board_id})):xs,[s.data]),o=u.useCallback(c=>{c&&t(c.value)},[t]),a=u.useMemo(()=>i.find(c=>c.value===e)??null,[e,i]),l=u.useCallback(()=>n("boards.noMatching"),[n]);return r.jsx(Fe,{className:`${ht} ${Ue}`,value:a,options:i,onChange:o,placeholder:n("boards.selectBoard"),noOptionsMessage:l})},Dwe=({category:e,onChange:t})=>{const{t:n}=M(),s=u.useMemo(()=>[{label:n("gallery.images"),value:"images"},{label:n("gallery.assets"),value:"assets"}],[n]),i=u.useCallback(l=>{!l||l.value!=="images"&&l.value!=="assets"||t(l.value)},[t]),o=u.useMemo(()=>s.find(l=>l.value===e),[s,e]),a=u.useCallback(()=>n("boards.noMatching"),[n]);return r.jsx(Fe,{className:`${ht} ${Ue}`,value:o,options:s,onChange:i,placeholder:n("boards.selectBoard"),noOptionsMessage:a})},Rwe=Co().options,VG=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=z(),o=u.useCallback(h=>{i(w4({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useCallback(h=>{const f=TQ(h.target.value);i(w4({nodeId:t,fieldName:n.name,value:f}))},[i,n.name,t]),[l,c]=u.useState(null),d=u.useMemo(()=>ri(async h=>{const f=await EQ(h,i);f.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(`<${s("nodes.generatorImages",{count:f.length})}>`)},300),[i,s]);return u.useEffect(()=>{d(n)},[n,d]),r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(uo,{className:`${ht} ${Ue}`,onChange:a,value:n.value.type,size:"sm",children:r.jsx("option",{value:j4,children:s("nodes.generatorImagesFromBoard")})}),n.value.type===j4&&r.jsx($G,{state:n.value,onChange:o}),r.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(A,{w:"full",h:"auto",children:r.jsx(Ns,{className:`${ht} ${Ue}`,defer:!0,style:Za,options:Rwe,children:r.jsx(q,{className:`${ht} ${Ue}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:l})})})})]})});VG.displayName="ImageGeneratorFieldInputComponent";const Owe=Co().options,Nwe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},GG=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=jn(),{t:o}=M(),a=bg(t,n.name),l=u.useCallback(y=>{i.dispatch(MQ({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const b=n.value?[...n.value]:[];b.splice(y,1),l(b)},[n.value,l]),d=u.useCallback((y,b)=>{const C=n.value?[...n.value]:[];C[y]=b,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return qe(s.minimum)||(y=s.minimum),qe(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=Zu;return qe(s.maximum)||(y=s.maximum),qe(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return r.jsxs(A,{className:Ue,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Nwe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsx(Ns,{className:ht,defer:!0,style:Za,options:Owe,children:r.jsx(Xr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,b)=>r.jsx(zG,{value:y,index:b,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});GG.displayName="IntegerFieldCollectionInputComponent";const zG=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=M(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,Math.floor(f))},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(Dt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Dt,{children:r.jsx(Ae,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:Ue,flexGrow:1})}),r.jsx(Dt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Nt,{}),"aria-label":c("common.delete")})})]})});zG.displayName="IntegerListItemContent";const HG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.step")}),r.jsx(Ae,{value:e.step,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});HG.displayName="IntegerGeneratorArithmeticSequenceSettings";const WG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.end")}),r.jsx(Ae,{value:e.end,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});WG.displayName="IntegerGeneratorLinearDistributionSettings";const UG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(jt,{value:e.splitOn,onChange:s})]}),r.jsx(_d,{value:e.input,onChange:i})]})});UG.displayName="IntegerGeneratorParseStringSettings";const qG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(A,{gap:2,flexDir:"column",children:r.jsxs(A,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.min")}),r.jsx(Ae,{value:e.min,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.max")}),r.jsx(Ae,{value:e.max,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(kn,{onChange:a,isChecked:!qe(e.seed)})]}),r.jsx(Ae,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});qG.displayName="IntegerGeneratorUniformRandomDistributionSettings";const Fwe=Co().options,KG=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=z(),o=u.useCallback(d=>{i(k4({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=PQ(d.target.value);i(k4({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=Ju(n,300),c=u.useMemo(()=>{if(l.value.type===Qv&&qe(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=LQ(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>_p(h,2)).join(", ")},[l,s]);return r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsxs(uo,{className:`${ht} ${Ue}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:_4,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:I4,children:s("nodes.linearDistribution")}),r.jsx("option",{value:Qv,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:A4,children:s("nodes.parseString")})]}),n.value.type===_4&&r.jsx(HG,{state:n.value,onChange:o}),n.value.type===I4&&r.jsx(WG,{state:n.value,onChange:o}),n.value.type===Qv&&r.jsx(qG,{state:n.value,onChange:o}),n.value.type===A4&&r.jsx(UG,{state:n.value,onChange:o}),r.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(A,{w:"full",h:"auto",children:r.jsx(Ns,{className:`${ht} ${Ue}`,defer:!0,style:Za,options:Fwe,children:r.jsx(q,{className:`${ht} ${Ue}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});KG.displayName="IntegerGeneratorFieldInputComponent";const Bwe=e=>{const{nodeId:t,field:n}=e,s=z(),{data:i,isLoading:o}=xp(),a=u.useCallback(g=>{g&&s(DQ({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),l=u.useMemo(()=>i?Va.selectAll(i):xs,[i]),{options:c,value:d,onChange:h,placeholder:f,noOptionsMessage:p}=hn({modelConfigs:l,onChange:a,isLoading:o,selectedModel:n.value,groupByType:!0});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!c.length,isInvalid:!d,children:r.jsx(Fe,{value:d,placeholder:f,options:c,onChange:h,noOptionsMessage:p})})})},$we=u.memo(Bwe),Vwe=Co().options,Gwe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},ZG=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=jn(),o=bg(t,n.name),a=u.useCallback(d=>{const h=n.value?[...n.value]:[];h.splice(d,1),i.dispatch(Jv({nodeId:t,fieldName:n.name,value:h}))},[n.name,n.value,t,i]),l=u.useCallback((d,h)=>{const f=n.value?[...n.value]:[];f[d]=h,i.dispatch(Jv({nodeId:t,fieldName:n.name,value:f}))},[n.name,n.value,t,i]),c=u.useCallback(()=>{const d=n.value?[...n.value,""]:[""];i.dispatch(Jv({nodeId:t,fieldName:n.name,value:d}))},[n.name,n.value,t,i]);return r.jsxs(A,{className:Ue,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Gwe,"data-error":o,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:c,variant:"ghost",children:s("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Pt,{}),r.jsx(Ns,{className:ht,defer:!0,style:Za,options:Vwe,children:r.jsx(Xr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((d,h)=>r.jsx(YG,{value:d,index:h,onRemoveString:a,onChangeString:l},h))})})]})]})});ZG.displayName="StringFieldCollectionInputComponent";const zwe=u.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=M(),o=u.useCallback(()=>{n(t)},[t,n]),a=u.useCallback(l=>{s(t,l.target.value)},[t,s]);return r.jsxs(A,{alignItems:"center",gap:1,children:[r.jsx(jt,{size:"xs",resize:"none",value:e,onChange:a}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:o,icon:r.jsx(Nt,{}),"aria-label":i("common.remove"),tooltip:i("common.remove")})]})});zwe.displayName="StringListItemContent";const YG=u.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=M(),o=u.useCallback(()=>{n(t)},[t,n]),a=u.useCallback(l=>{s(t,l.target.value)},[t,s]);return r.jsxs(r.Fragment,{children:[r.jsx(Dt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Dt,{children:r.jsx(jt,{size:"sm",resize:"none",value:e,onChange:a})}),r.jsx(Dt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:o,icon:r.jsx(Nt,{}),"aria-label":i("common.delete")})})]})});YG.displayName="ListItemContent";const XG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(o=>{t({...e,input:o})},[t,e]),i=u.useCallback(o=>{t({...e,maxPrompts:o})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("dynamicPrompts.maxPrompts")}),r.jsx(Ae,{value:e.maxPrompts,onChange:i,min:1,max:1e3,w:"full"})]}),r.jsx(_d,{value:e.input,onChange:s})]})});XG.displayName="StringGeneratorDynamicPromptsCombinatorialSettings";const QG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(l=>{t({...e,input:l})},[t,e]),i=u.useCallback(l=>{t({...e,count:l})},[t,e]),o=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),a=u.useCallback(l=>{t({...e,seed:l})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(A,{gap:2,children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",display:"flex",w:"full",pe:.5,children:[n("common.seed"),r.jsx(kn,{onChange:o,isChecked:!qe(e.seed)})]}),r.jsx(Ae,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:a,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:i,min:1,max:1e3})]})]}),r.jsx(_d,{value:e.input,onChange:s})]})});QG.displayName="StringGeneratorDynamicPromptsRandomSettings";const JG=u.memo(({state:e,onChange:t})=>{const{t:n}=M(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(jt,{value:e.splitOn,onChange:s})]}),r.jsx(_d,{value:e.input,onChange:i})]})});JG.displayName="StringGeneratorParseStringSettings";const Hwe=Co().options,ez=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=z(),o=u.useCallback(h=>{i(T4({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useCallback(h=>{const f=RQ(h.target.value);i(T4({nodeId:t,fieldName:n.name,value:f}))},[i,n.name,t]),[l,c]=u.useState(null),d=u.useMemo(()=>ri(async h=>{const f=await OQ(h,i);f.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(f.join(", "))},300),[i,s]);return u.useEffect(()=>{d(n)},[n,d]),r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsxs(uo,{className:`${ht} ${Ue}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:E4,children:s("nodes.parseString")}),r.jsx("option",{value:M4,children:s("nodes.dynamicPromptsRandom")}),r.jsx("option",{value:P4,children:s("nodes.dynamicPromptsCombinatorial")})]}),n.value.type===E4&&r.jsx(JG,{state:n.value,onChange:o}),n.value.type===M4&&r.jsx(QG,{state:n.value,onChange:o}),n.value.type===P4&&r.jsx(XG,{state:n.value,onChange:o}),r.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(A,{w:"full",h:"auto",children:r.jsx(Ns,{className:`${ht} ${Ue}`,defer:!0,style:Za,options:Hwe,children:r.jsx(q,{className:`${ht} ${Ue}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:l})})})})]})});ez.displayName="StringGeneratorFieldInputComponent";const n_=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(h=>{i(NQ({nodeId:t,fieldName:n.name,value:Math.floor(Number(h))}))},[i,n.name,t]),a=u.useMemo(()=>{let h=-4294967295;return qe(s.minimum)||(h=s.minimum),qe(s.exclusiveMinimum)||(h=s.exclusiveMinimum+1),h},[s.exclusiveMinimum,s.minimum]),l=u.useMemo(()=>{let h=Zu;return qe(s.maximum)||(h=s.maximum),qe(s.exclusiveMaximum)||(h=s.exclusiveMaximum-1),h},[s.exclusiveMaximum,s.maximum]),c=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),d=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return{defaultValue:s.default,onChange:o,value:n.value,min:a,max:l,step:c,fineStep:d}},HC=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=n_(e);return r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,flex:"1 1 0"})});HC.displayName="IntegerFieldInput";const tz=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=n_(e);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,flex:"1 1 0"})]})});tz.displayName="IntegerFieldInputAndSlider";const nz=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=n_(e);return r.jsx(Ze,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:Ue,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});nz.displayName="IntegerFieldSlider";const sz=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(a=>{i(FQ({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return{value:n.value,onChange:o,defaultValue:s.default}},WC=u.memo(e=>{const{value:t,onChange:n}=sz(e);return r.jsx(jt,{className:`${Ue} ${ki} ${ht}`,value:t,onChange:n})});WC.displayName="StringFieldInput";const UC=u.memo(e=>{const{value:t,onChange:n}=sz(e);return r.jsx(Qn,{className:`${Ue} ${ki} ${ht}`,value:t,onChange:n,h:"full",fontSize:"sm",p:2})});UC.displayName="StringFieldTextarea";const s_=(e,t)=>{const n=u.useMemo(()=>pe(lt,i=>{const o=NS(i,e,t);return Ge(o,`Instance for input field ${t} not found`),o}),[t,e]);return I(n)},Wwe={include_archived:!0},Uwe=e=>e==="auto"||e==="none"?e:{board_id:e},qwe=e=>{const{nodeId:t,field:n}=e,s=z(),{t:i}=M(),o=Zl(Wwe),a=u.useMemo(()=>({label:i("common.auto"),value:"auto"}),[i]),l=u.useMemo(()=>({label:`${i("common.none")} (${i("boards.uncategorized")})`,value:"none"}),[i]),c=u.useMemo(()=>{const p=[a,l];if(o.data)for(const g of o.data)p.push({label:g.board_name,value:g.board_id});return p},[a,o.data,l]),d=u.useCallback(p=>{if(!p)return;const g=Uwe(p.value);s(BQ({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),h=u.useMemo(()=>{const p=n.value;return!p||p==="auto"?a:p==="none"?l:c.find(m=>m.value===p.board_id)??a},[n.value,c,a,l]),f=u.useCallback(()=>i("boards.noMatching"),[i]);return r.jsx(Fe,{className:`${ht} ${Ue}`,value:h,options:c,onChange:d,placeholder:i("boards.selectBoard"),noOptionsMessage:f})},Kwe=u.memo(qwe),Zwe=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useCallback(o=>{s($Q({nodeId:t,fieldName:n.name,value:o.target.checked}))},[s,n.name,t]);return r.jsx(at,{className:`${Ue} ${ic}`,onChange:i,isChecked:n.value})},Ywe=u.memo(Zwe),Xwe=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=oc(),c=u.useCallback(y=>{y&&o(VQ({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},Qwe=u.memo(Xwe),Jwe=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=oc(),c=u.useCallback(y=>{y&&o(GQ({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>FM(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},eje=u.memo(Jwe),tje=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=oc(),c=u.useCallback(y=>{y&&o(zQ({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>BM(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},nje=u.memo(tje),sje={r:0,g:0,b:0,a:255},rje=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useMemo(()=>{if(!n.value)return sje;const{r:a,g:l,b:c,a:d}=n.value;return{r:a,g:l,b:c,a:d/255}},[n.value]),o=u.useCallback(a=>{typeof a=="string"&&(a=K1e(a,1));const{r:l,g:c,b:d,a:h}=a,f=Math.round(h*255);s(HQ({nodeId:t,fieldName:n.name,value:{r:l,g:c,b:d,a:f}}))},[s,n.name,t]);return r.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[r.jsx(cve,{style:{background:oo("base.700"),color:oo("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:Ue,color:q1e(i,!0),onChange:o,prefixed:!0,alpha:!0}),r.jsx(DF,{className:Ue,color:i,onChange:o,style:{width:"100%"}})]})},ije=u.memo(rje),oje=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=w7(),c=u.useCallback(y=>{y&&o(WQ({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>CE(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},aje=u.memo(oje),lje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=fj(),a=u.useCallback(p=>{p&&s(UQ({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(De,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:`${ht} ${Ue}`,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},cje=u.memo(lje),uje=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(a=>{i(qQ({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return r.jsx(uo,{className:`${ht} ${Ue}`,onChange:o,value:n.value,size:"sm",children:s.options.map(a=>r.jsx("option",{value:a,children:s.ui_choice_labels?s.ui_choice_labels[a]:a},a))})},dje=u.memo(uje),hje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=qde(),a=u.useCallback(p=>{p&&s(hy({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},fje=u.memo(hje),pje=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(m=>m.config.disabledTabs),o=z(),[a,{isLoading:l}]=_7(),c=u.useCallback(m=>{m&&o(KQ({nodeId:t,fieldName:n.name,value:m}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h,children:r.jsx(Fe,{value:h,placeholder:p,options:d,onChange:f,noOptionsMessage:g})})})})},gje=u.memo(pje),mje=e=>{var p;const{t}=M(),{nodeId:n,field:s,fieldTemplate:i}=e,o=z(),a=ce(Wn),{currentData:l,isError:c}=Ua(((p=s.value)==null?void 0:p.image_name)??ws),d=u.useCallback(()=>{o(Xx({nodeId:n,fieldName:s.name,value:void 0}))},[o,s.name,n]),h=u.useMemo(()=>{var g;return gC.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}},(g=s.value)==null?void 0:g.image_name)},[s,n]);u.useEffect(()=>{a&&c&&d()},[d,a,c]);const f=u.useCallback(g=>{o(Xx({nodeId:n,fieldName:s.name,value:g}))},[o,s.name,n]);return r.jsxs(A,{position:"relative",className:Ue,w:"full",h:32,alignItems:"stretch",children:[!l&&r.jsx(Lk,{w:"full",h:"auto",isError:i.required&&!s.value,onUpload:f,fontSize:24}),l&&r.jsxs(r.Fragment,{children:[r.jsx(A,{borderRadius:"base",borderWidth:1,borderStyle:"solid",children:r.jsx(tl,{imageDTO:l,asThumbnail:!0})}),r.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",insetInlineEnd:1,insetBlockEnd:1,opacity:.7,px:2,borderRadius:"base",pointerEvents:"none",children:`${l.width}x${l.height}`})]}),r.jsx(gs,{dndTarget:gC,dndTargetData:h,label:t("gallery.drop")})]})},yje=u.memo(mje),vje=u.memo(()=>{const{t:e}=M();return r.jsx(A,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});vje.displayName="UploadElement";const bje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=gj(),a=u.useCallback(h=>{h&&s(ZQ({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(De,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:`${ht} ${Ue}`,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},xje=u.memo(bje),Cje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Yy(),a=u.useCallback(p=>{p&&s(YQ({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Z,{className:`${ht} ${Ue}`,isInvalid:!c,isDisabled:!l.length,children:r.jsx(Fe,{value:c,placeholder:h,noOptionsMessage:f,options:l,onChange:d})})},Sje=u.memo(Cje),wje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Ude(),a=u.useCallback(p=>{p&&s(hy({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},jje=u.memo(wje),kje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Zy(),a=u.useCallback(p=>{p&&s(XQ({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},_je=u.memo(kje),Ije=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useCallback(a=>{Pp(a==null?void 0:a.value)&&s(QQ({nodeId:t,fieldName:n.name,value:a.value}))},[s,n.name,t]),o=u.useMemo(()=>ho.find(a=>a.value===(n==null?void 0:n.value)),[n==null?void 0:n.value]);return r.jsx(Z,{className:`${ht} ${Ue} ${ic}`,children:r.jsx(Fe,{value:o,options:ho,onChange:i})})},Aje=u.memo(Ije),Tje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Kde(),a=u.useCallback(p=>{p&&s(hy({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c&&e.fieldTemplate.required,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},Eje=u.memo(Tje),Mje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Zde(),a=u.useCallback(p=>{p&&s(hy({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},Pje=u.memo(Mje),Lje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Zp(),a=u.useCallback(h=>{h&&s(JQ({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(De,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:`${ht} ${Ue}`,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},Dje=u.memo(Lje),Rje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=j7(),a=u.useCallback(h=>{h&&s(eJ({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(De,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:`${ht} ${Ue}`,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},Oje=u.memo(Rje),Nje=e=>{const{nodeId:t,field:n}=e,{t:s}=M(),i=I(XS),o=z(),[a,{isLoading:l}]=pj(),c=u.useCallback(y=>{y&&o(tJ({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(De,{label:!i&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},Fje=u.memo(Nje),Bje=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Xy(),a=u.useCallback(g=>{g&&s(nJ({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o}),p=e.fieldTemplate.required;return r.jsx(A,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:`${ht} ${Ue}`,isDisabled:!l.length,isInvalid:!c&&p,children:r.jsx(Fe,{value:c,placeholder:p?h:`(Optional) ${h}`,options:l,onChange:d,noOptionsMessage:f})})})},$je=u.memo(Bje),Iv=u.memo(({nodeId:e,fieldName:t,settings:n})=>{const s=s_(e,t),i=Ni(e,t);if(F3(i))return B3(s)?r.jsx(ZG,{nodeId:e,field:s,fieldTemplate:i}):null;if(PM(i)){if(!sJ(s))return null;if((n==null?void 0:n.type)!=="string-field-config")return i.ui_component==="textarea"?r.jsx(UC,{nodeId:e,field:s,fieldTemplate:i}):r.jsx(WC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="input")return r.jsx(WC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="textarea")return r.jsx(UC,{nodeId:e,field:s,fieldTemplate:i})}if(rJ(i))return iJ(s)?r.jsx(Ywe,{nodeId:e,field:s,fieldTemplate:i}):null;if(EM(i)){if(!oJ(s))return null;if((n==null?void 0:n.type)!=="integer-field-config")return r.jsx(HC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(HC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="slider")return r.jsx(nz,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input-and-slider")return r.jsx(tz,{nodeId:e,field:s,fieldTemplate:i})}if(MM(i)){if(!aJ(s))return null;if((n==null?void 0:n.type)!=="float-field-config")return r.jsx(zC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(zC,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="slider")return r.jsx(EG,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input-and-slider")return r.jsx(TG,{nodeId:e,field:s,fieldTemplate:i})}return $3(i)?V3(s)?r.jsx(GG,{nodeId:e,field:s,fieldTemplate:i}):null:G3(i)?z3(s)?r.jsx(MG,{nodeId:e,field:s,fieldTemplate:i}):null:lJ(i)?cJ(s)?r.jsx(dje,{nodeId:e,field:s,fieldTemplate:i}):null:N3(i)?gS(s)?r.jsx(FG,{nodeId:e,field:s,fieldTemplate:i}):null:uJ(i)?dJ(s)?r.jsx(yje,{nodeId:e,field:s,fieldTemplate:i}):null:hJ(i)?fJ(s)?r.jsx(Kwe,{nodeId:e,field:s,fieldTemplate:i}):null:pJ(i)?gJ(s)?r.jsx(jje,{nodeId:e,field:s,fieldTemplate:i}):null:mJ(i)?yJ(s)?r.jsx($we,{nodeId:e,field:s,fieldTemplate:i}):null:vJ(i)?bJ(s)?r.jsx(_je,{nodeId:e,field:s,fieldTemplate:i}):null:xJ(i)?CJ(s)?r.jsx($je,{nodeId:e,field:s,fieldTemplate:i}):null:SJ(i)?wJ(s)?r.jsx(Fje,{nodeId:e,field:s,fieldTemplate:i}):null:jJ(i)?kJ(s)?r.jsx(Qwe,{nodeId:e,field:s,fieldTemplate:i}):null:_J(i)?IJ(s)?r.jsx(nje,{nodeId:e,field:s,fieldTemplate:i}):null:AJ(i)?TJ(s)?r.jsx(eje,{nodeId:e,field:s,fieldTemplate:i}):null:EJ(i)?MJ(s)?r.jsx(aje,{nodeId:e,field:s,fieldTemplate:i}):null:PJ(i)?LJ(s)?r.jsx(gje,{nodeId:e,field:s,fieldTemplate:i}):null:DJ(i)?RJ(s)?r.jsx(Sje,{nodeId:e,field:s,fieldTemplate:i}):null:OJ(i)?NJ(s)?r.jsx(cje,{nodeId:e,field:s,fieldTemplate:i}):null:FJ(i)?BJ(s)?r.jsx(xje,{nodeId:e,field:s,fieldTemplate:i}):null:$J(i)?VJ(s)?r.jsx(Oje,{nodeId:e,field:s,fieldTemplate:i}):null:GJ(i)?zJ(s)?r.jsx(Dje,{nodeId:e,field:s,fieldTemplate:i}):null:HJ(i)?WJ(s)?r.jsx(ije,{nodeId:e,field:s,fieldTemplate:i}):null:UJ(i)?qJ(s)?r.jsx(fje,{nodeId:e,field:s,fieldTemplate:i}):null:KJ(i)?ZJ(s)?r.jsx(Eje,{nodeId:e,field:s,fieldTemplate:i}):null:YJ(i)?XJ(s)?r.jsx(Pje,{nodeId:e,field:s,fieldTemplate:i}):null:QJ(i)?JJ(s)?r.jsx(Aje,{nodeId:e,field:s,fieldTemplate:i}):null:eee(i)?tee(s)?r.jsx(NG,{nodeId:e,field:s,fieldTemplate:i}):null:nee(i)?see(s)?r.jsx(KG,{nodeId:e,field:s,fieldTemplate:i}):null:ree(i)?iee(s)?r.jsx(ez,{nodeId:e,field:s,fieldTemplate:i}):null:oee(i)&&aee(s)?r.jsx(VG,{nodeId:e,field:s,fieldTemplate:i}):null});Iv.displayName="InputFieldRenderer";const r_=(e,t)=>{const n=u.useMemo(()=>pe(lt,i=>{var a;const o=i.nodes.find(l=>l.id===e);return Jr(o)?((a=o==null?void 0:o.data.inputs[t])==null?void 0:a.description)??"":""}),[t,e]);return I(n)},rz=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=z(),i=r_(n.nodeId,n.fieldName),o=Ni(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s($M({nodeId:n.nodeId,fieldName:n.fieldName,val:d}))},[s,n.fieldName,n.nodeId]),c=oa({value:i||o.description,defaultValue:o.description,inputRef:a,onChange:l});return c.isEditing?r.jsx(Qn,{ref:a,variant:"outline",fontSize:"sm",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):r.jsx(Zs,{onDoubleClick:c.startEditing,sx:mg,children:r.jsx(vg,{options:yg,children:c.value})})});rz.displayName="NodeFieldElementDescriptionEditable";const Cx=Symbol("uniqueNonexistentValue"),Vje=(e,t,n)=>{const s=z(),i=u.useMemo(()=>pe(ea,d=>e in d.formFieldInitialValues?d.formFieldInitialValues[e]:Cx),[e]),o=I(i),a=u.useMemo(()=>pe(lt,d=>{var p;if(o===Cx)return!1;const h=d.nodes.find(g=>g.id===t);if(!Jr(h))return;const f=(p=h.data.inputs[n])==null?void 0:p.value;return!bl(f,o)}),[n,o,t]),l=I(a),c=u.useCallback(()=>{o!==Cx&&s(QS({nodeId:t,fieldName:n,value:o}))},[s,n,t,o]);return{initialValue:o,isValueChanged:l,resetToInitialValue:c}},i_=u.memo(({element:e})=>{const{t}=M(),{id:n,data:s}=e,{nodeId:i,fieldName:o}=s.fieldIdentifier,{isValueChanged:a,resetToInitialValue:l}=Vje(n,i,o);return a?r.jsx(oe,{variant:"link",size:"sm",alignSelf:"stretch",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:r.jsx(Di,{}),onClick:l,isDisabled:!a}):null});i_.displayName="NodeFieldElementResetToInitialValueIconButton";const o_=(e,t)=>{const n=u.useMemo(()=>pe(lt,i=>{var o;return((o=NS(i,e,t))==null?void 0:o.label)??""}),[t,e]);return I(n)},iz=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=z(),i=o_(n.nodeId,n.fieldName),o=Ni(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s(VM({nodeId:n.nodeId,fieldName:n.fieldName,label:d}))},[s,n.fieldName,n.nodeId]),c=oa({value:i||o.title,defaultValue:o.title,inputRef:a,onChange:l});return c.isEditing?r.jsx(jt,{ref:a,variant:"outline",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):r.jsxs(A,{w:"full",gap:4,children:[r.jsx(te,{onDoubleClick:c.startEditing,cursor:"text",children:c.value}),r.jsx(rt,{}),r.jsx(i_,{element:e})]})});iz.displayName="NodeFieldElementLabelEditable";const Gje={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0"},flexDir:"column"},oz=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=pg(e.id,t,n),o=Oi(),{id:a,data:l}=e,{fieldIdentifier:c,showDescription:d}=l;return r.jsxs(A,{ref:t,id:a,className:GM,sx:Gje,"data-parent-layout":o.layout,children:[r.jsx(kd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(jd,{"data-is-dragging":i,p:4,children:r.jsxs(Z,{flex:"1 1 0",orientation:"vertical",children:[r.jsx(iz,{el:e}),r.jsx(A,{w:"full",gap:4,children:r.jsx(Iv,{nodeId:c.nodeId,fieldName:c.fieldName,settings:l.settings})}),d&&r.jsx(rz,{el:e})]})}),r.jsx(az,{element:e}),r.jsx(gg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});oz.displayName="NodeFieldElementEditMode";const zje={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",display:"none",'&[data-is-mouse-over-node-or-form-field="true"]':{display:"block",bg:"invokeBlueAlpha.100"}},az=u.memo(({element:e})=>{const t=iG(e.data.fieldIdentifier.nodeId),n=Hk(e.data.fieldIdentifier.nodeId);return r.jsx(Se,{sx:zje,"data-is-mouse-over-node-or-form-field":t.isMouseOverNode||n.isMouseOverFormField})});az.displayName="NodeFieldElementOverlay";const lz=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=o_(n.nodeId,n.fieldName),i=Ni(n.nodeId,n.fieldName),o=u.useMemo(()=>s||i.title,[s,i.title]);return r.jsxs(A,{w:"full",gap:4,children:[r.jsx(te,{children:o}),r.jsx(rt,{}),r.jsx(i_,{element:e})]})});lz.displayName="NodeFieldElementLabel";const Hje={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32},'&[data-with-description="false"]':{pb:2}},cz=u.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:i}=n,o=r_(s.nodeId,s.fieldName),a=Ni(s.nodeId,s.fieldName),l=Oi(),c=u.useMemo(()=>o||a.description,[o,a.description]);return r.jsx(A,{id:t,className:GM,sx:Hje,"data-parent-layout":l.layout,"data-with-description":i&&!!c,children:r.jsxs(Z,{flex:"1 1 0",orientation:"vertical",children:[r.jsx(lz,{el:e}),r.jsx(A,{w:"full",gap:4,children:r.jsx(Iv,{nodeId:s.nodeId,fieldName:s.fieldName,settings:n.settings})}),i&&c&&r.jsx(Zs,{sx:mg,children:r.jsx(vg,{options:yg,children:c})})]})})});cz.displayName="NodeFieldElementViewMode";const uz=u.memo(({id:e})=>{const t=Ku(e),n=I(bo);return!t||!p0(t)?null:n==="view"?r.jsx(Du,{nodeId:t.data.fieldIdentifier.nodeId,fieldName:t.data.fieldIdentifier.fieldName,children:r.jsx(cz,{el:t})}):r.jsx(Du,{nodeId:t.data.fieldIdentifier.nodeId,fieldName:t.data.fieldIdentifier.fieldName,children:r.jsx(oz,{el:t})})});uz.displayName="NodeFieldElement";const Wje={fontSize:"md",overflowWrap:"anywhere",'&[data-is-empty="true"]':{opacity:.3},...mg},a_=u.memo(({content:e,...t})=>{const{t:n}=M();return r.jsx(q,{sx:Wje,"data-is-empty":e==="",...t,children:r.jsx(vg,{options:yg,children:e||n("workflows.builder.textPlaceholder")})})});a_.displayName="TextElementContent";const dz=u.memo(({el:e})=>{const{t}=M(),n=z(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(lee({id:s,changes:{content:d}}))},[n,s]),c=oa({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Uk,{ref:a,placeholder:t("workflows.builder.textPlaceholder"),...c.inputProps,fontSize:"md",variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2}):r.jsx(a_,{content:c.value,onDoubleClick:c.startEditing})});dz.displayName="TextElementContentEditable";const Uje={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},hz=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=pg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(A,{ref:t,id:a,className:zM,sx:Uje,"data-parent-layout":o.layout,children:[r.jsx(kd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(jd,{"data-is-dragging":i,p:4,children:r.jsx(dz,{el:e})}),r.jsx(gg,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});hz.displayName="TextElementEditMode";const qje={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},fz=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=Oi();return r.jsx(A,{id:t,className:zM,sx:qje,"data-parent-layout":i.layout,children:r.jsx(a_,{content:s})})});fz.displayName="TextElementViewMode";const pz=u.memo(({id:e})=>{const t=Ku(e),n=I(bo);return!t||!HM(t)?null:n==="view"?r.jsx(fz,{el:t}):r.jsx(hz,{el:t})});pz.displayName="TextElement";const gz=u.memo(({id:e})=>{const t=Ku(e),n=I(bo);return!t||!Ur(t)?null:n==="view"?r.jsx(mz,{el:t}):r.jsx(yz,{el:t})});gz.displayName="ContainerElementComponent";const Kje={gap:2,'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start",overflowX:"auto",overflowY:"visible",h:"min-content"},'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},mz=u.memo(({el:e})=>{const{t}=M(),n=wv(),s=Oi(),{id:i,data:o}=e,{children:a,layout:l}=o;return r.jsx(fg,{depth:n+1,children:r.jsx(hg,{id:i,layout:l,children:r.jsxs(A,{id:i,className:qM,sx:Kje,"data-self-layout":l,"data-depth":n,"data-parent-layout":s.layout,children:[a.map(c=>r.jsx(xg,{id:c},c)),a.length===0&&r.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:t("workflows.builder.containerPlaceholder")})})]})})})});mz.displayName="ContainerElementComponentViewMode";const Zje={borderRadius:"base",position:"relative",'&[data-active-drop-region="center"]':{opacity:1,bg:"base.850"},flexDir:"column",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",h:"min-content"}},Yje={gap:4,p:4,flex:"1 1 0",'&[data-self-layout="column"]':{flexDir:"column"},'&[data-self-layout="row"]':{flexDir:"row",overflowX:"auto"}},yz=u.memo(({el:e})=>{const t=wv(),n=u.useRef(null),s=u.useRef(null),i=u.useRef(null),[o,a]=pg(e.id,n,s),{id:l,data:c}=e,{children:d,layout:h}=c,f=Oi();return u.useEffect(()=>{const p=i.current;if(p&&h!=="column")return Uw({element:p})},[h]),r.jsx(fg,{depth:t+1,children:r.jsx(hg,{id:l,layout:h,children:r.jsxs(A,{id:l,ref:n,className:qM,sx:Zje,"data-depth":t,"data-parent-layout":f.layout,"data-active-drop-region":o,children:[r.jsx(kd,{dragHandleRef:s,element:e,"data-is-dragging":a}),r.jsx(jd,{"data-is-dragging":a,children:r.jsxs(A,{ref:i,sx:Yje,"data-self-layout":h,children:[d.map(p=>r.jsx(xg,{id:p},p)),d.length===0&&r.jsx(Sz,{})]})}),r.jsx(gg,{activeDropRegion:o,gap:"var(--invoke-space-4)"})]})})})});yz.displayName="ContainerElementComponentEditMode";const vz={position:"relative",alignItems:"center",borderRadius:"base",w:"full",h:"full",gap:2,display:"flex",flex:1,maxW:"768px",'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start"}},bz=u.memo(()=>{const e=I(WM),{id:t,data:n}=e,{children:s,layout:i}=n;return r.jsx(fg,{depth:0,children:r.jsx(hg,{id:t,layout:i,children:r.jsx(Se,{id:t,className:UM,sx:vz,"data-self-layout":i,"data-depth":0,children:s.map(o=>r.jsx(xg,{id:o},o))})})})});bz.displayName="RootContainerElementViewMode";const Xje={...vz,gap:4,'&[data-is-dragging-over="true"]':{opacity:1,bg:"base.850"}},xz=u.memo(()=>{const e=I(WM),{id:t,data:n}=e,{children:s,layout:i}=n,o=u.useRef(null),a=ISe(o);return r.jsx(fg,{depth:0,children:r.jsx(hg,{id:t,layout:i,children:r.jsxs(A,{ref:o,id:t,className:UM,sx:Xje,"data-self-layout":i,"data-depth":0,"data-is-dragging-over":a,children:[s.map(l=>r.jsx(xg,{id:l},l)),s.length===0&&r.jsx(Cz,{})]})})})});xz.displayName="RootContainerElementEditMode";const Cz=u.memo(()=>{const{t:e}=M();return r.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:e("workflows.builder.emptyRootPlaceholderEditMode")})})});Cz.displayName="RootPlaceholder";const Sz=u.memo(()=>{const{t:e}=M();return r.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:e("workflows.builder.containerPlaceholder")})})});Sz.displayName="NonRootPlaceholder";const xg=u.memo(({id:e})=>{const t=Ku(e);if(!t)return null;if(Ur(t))return r.jsx(gz,{id:e},e);if(p0(t))return r.jsx(uz,{id:e},e);if(DM(t))return r.jsx(hG,{id:e},e);if(NM(t))return r.jsx(IG,{id:e},e);if(HM(t))return r.jsx(pz,{id:e},e);Ge(!1,`Unhandled type for element with id ${e}`)});xg.displayName="FormElementComponent";const Qje=()=>{const e=jn();return u.useCallback(()=>{const n=cee(e.getState()),s=uee(e.getState());for(const i of s){if(!(i.id in n))continue;const{nodeId:o,fieldName:a}=i.data.fieldIdentifier;e.dispatch(QS({nodeId:o,fieldName:a,value:n[i.id]}))}},[e])},wz=u.memo(()=>{const{t:e}=M(),t=jn(),n=Qje(),s=u.useCallback(()=>{t.dispatch(dee())},[t]);return r.jsxs(Yt,{placement:"bottom-end",children:[r.jsx(Xt,{as:oe,icon:r.jsx(NL,{}),variant:"ghost",size:"sm"}),r.jsxs(It,{children:[r.jsx(he,{icon:r.jsx(Di,{}),onClick:n,children:e("workflows.builder.resetAllNodeFields")}),r.jsx(he,{isDestructive:!0,icon:r.jsx(Lw,{}),onClick:s,children:e("workflows.builder.deleteAllElements")})]})]})});wz.displayName="WorkflowBuilderEditMenu";const Jje={pt:3,w:"full",h:"full",'&[data-is-empty="true"]':{pt:0}},jz=u.memo(()=>{const{t:e}=M();return _Se(),r.jsx(A,{justifyContent:"center",w:"full",h:"full",children:r.jsxs(A,{flexDir:"column",w:"full",maxW:"768px",gap:2,children:[r.jsxs(A,{w:"full",alignItems:"center",gap:2,pt:3,children:[r.jsx(Sm,{type:"container"}),r.jsx(Sm,{type:"divider"}),r.jsx(Sm,{type:"heading"}),r.jsx(Sm,{type:"text"}),r.jsx(ye,{size:"sm",variant:"ghost",tooltip:e("workflows.builder.nodeFieldTooltip"),children:e("workflows.builder.nodeField")}),r.jsx(rt,{}),r.jsx(wz,{})]}),r.jsx($n,{children:r.jsx(kz,{})})]})})});jz.displayName="WorkflowBuilder";const kz=u.memo(()=>{const{t:e}=M(),t=I(KM),n=fy(),s=ce(cp);return n.isLoading||!s?r.jsx(Ot,{label:e("nodes.loadingNodes"),icon:null}):r.jsx(A,{sx:Jje,"data-is-empty":t,children:r.jsx(xz,{})})});kz.displayName="WorkflowBuilderContent";const eke=(e,t)=>{const[n,s]=u.useState(!1);return u.useEffect(()=>{const i=t.current;if(i)return Hn(gd(i),rd({element:i,getInitialData:()=>{if(e==="container"){const o=hee("row",[]);return Ta(o)}if(e==="divider"){const o=fee();return Ta(o)}if(e==="heading"){const o=pee("");return Ta(o)}if(e==="text"){const o=gee("");return Ta(o)}Ge(!1)},onDragStart:()=>{s(!0)},onDrop:()=>{s(!1)}}))},[t,e]),n},tke={cursor:"grab",borderStyle:"dashed",_active:{borderStyle:"dashed"},_disabled:{borderStyle:"dashed",opacity:.5}},Sm=({type:e})=>{const t=u.useRef(null),n=eke(e,t);return r.jsx(ye,{as:"div",ref:t,size:"sm",isDisabled:n,variant:"outline",sx:tke,children:ru(e)})},nke=tn(ea,e=>{const{author:t,name:n,description:s,tags:i,version:o,contact:a,notes:l}=e;return{name:n,author:t,description:s,tags:i,version:o,contact:a,notes:l}}),ske=()=>{const{author:e,name:t,description:n,tags:s,version:i,contact:o,notes:a}=I(nke),l=z(),c=u.useCallback(b=>{l(ZM(b.target.value))},[l]),d=u.useCallback(b=>{l(mee(b.target.value))},[l]),h=u.useCallback(b=>{l(yee(b.target.value))},[l]),f=u.useCallback(b=>{l(vee(b.target.value))},[l]),p=u.useCallback(b=>{l(bee(b.target.value))},[l]),g=u.useCallback(b=>{l(xee(b.target.value))},[l]),m=u.useCallback(b=>{l(Cee(b.target.value))},[l]),{t:y}=M();return r.jsx($n,{children:r.jsx(A,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsxs(fs,{orientation:"vertical",formControlProps:ike,children:[r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowName")}),r.jsx(jt,{variant:"darkFilled",value:t,onChange:c})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowVersion")}),r.jsx(jt,{variant:"darkFilled",value:i,onChange:f})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowAuthor")}),r.jsx(jt,{variant:"darkFilled",value:e,onChange:d})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowContact")}),r.jsx(jt,{variant:"darkFilled",value:o,onChange:h})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowTags")}),r.jsx(jt,{variant:"darkFilled",value:s,onChange:g})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowDescription")}),r.jsx(Qn,{variant:"darkFilled",onChange:p,value:n,fontSize:"sm",resize:"none",rows:3})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowNotes")}),r.jsx(Qn,{variant:"darkFilled",onChange:m,value:a,fontSize:"sm",resize:"none",rows:10})]})]})})})},rke=u.memo(ske),ike={flexShrink:0},nl=Oe(null),oke=ri(e=>{nl.set(See(e))},300),ake=pe(lt,ea,(e,t)=>({nodes:e.nodes,edges:e.edges,workflow:t})),lke=()=>{const e=I(ake);u.useEffect(()=>{oke(e)},[e])},cke=()=>{const e=ce(nl),{t}=M();return r.jsx(A,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsx(Yo,{data:e??{},label:t("nodes.workflow"),bg:"base.850",color:"base.200"})})},uke=u.memo(cke),dke=()=>{const{t:e}=M();return r.jsxs(ec,{variant:"enclosed",display:"flex",w:"full",h:"full",flexDir:"column",children:[r.jsxs(tc,{children:[r.jsx(Sn,{children:e("workflows.builder.builder")}),r.jsx(Sn,{children:e("common.details")}),r.jsx(Sn,{children:"JSON"})]}),r.jsxs(Vu,{h:"full",pt:2,children:[r.jsx(Ln,{h:"full",p:0,children:r.jsx(jz,{})}),r.jsx(Ln,{h:"full",p:0,children:r.jsx(rke,{})}),r.jsx(Ln,{h:"full",p:0,children:r.jsx(uke,{})})]})]})},hke=u.memo(dke),fke={height:"100%",width:"100%"},_z=u.memo(()=>{const e=u.useRef(null),t=u.useCallback(()=>{e.current&&e.current.setLayout([50,50])},[]);return r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx($n,{children:r.jsxs(ug,{ref:e,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:fke,children:[r.jsx(io,{id:"workflow",collapsible:!0,minSize:25,children:r.jsx(hke,{})}),r.jsx(Ek,{onDoubleClick:t}),r.jsx(io,{id:"inspector",collapsible:!0,minSize:25,children:r.jsx(xSe,{})})]})})})});_z.displayName="EditModeLeftPanelContent";const Iz=u.memo(()=>{const e=I(wee);return e?r.jsx(q,{color:"base.300",fontStyle:"italic",pb:2,sx:mg,children:r.jsx(vg,{options:yg,children:e})}):null});Iz.displayName="ActiveWorkflowDescription";const[Az]=wE(!1),l_=()=>{const{t:e}=M(),t=z(),n=Az(),s=I(Yu),i=u.useCallback(()=>{t(YM()),t(Su("edit")),ve({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e]),o=u.useCallback(()=>{if(!s){i();return}n.open()},[n,i,s]);return{createImmediate:i,createWithDialog:o}},Tz=u.memo(()=>{kt("NewWorkflowConfirmationAlertDialog");const{t:e}=M(),t=Az(),n=l_();return r.jsx(Tr,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,children:r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(q,{children:e("nodes.newWorkflowDesc")}),r.jsx(q,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});Tz.displayName="NewWorkflowConfirmationAlertDialog";const Ez=u.memo(()=>{const e=l_(),{t}=M(),n=u.useCallback(s=>{s.stopPropagation(),e.createWithDialog()},[e]);return r.jsx(oe,{onClick:n,variant:"ghost","aria-label":t("nodes.newWorkflow"),tooltip:t("nodes.newWorkflow"),icon:r.jsx(Lf,{})})});Ez.displayName="NewWorkflowButton";const pke=Gu("workflowLibrary/workflowDownloaded"),gke=Gu("workflowLibrary/workflowLoadedFromFile"),mke=Gu("workflowLibrary/newWorkflowSaved"),yke=Gu("workflowLibrary/workflowUpdated"),Mz=({resetRef:e,onSuccess:t})=>{const n=z(),s=cL("workflows"),{t:i}=M();return u.useCallback(a=>{var c;if(!a)return;const l=new FileReader;l.onload=()=>{const d=l.result;try{n(dS({data:{workflow:String(d),graph:null},asCopy:!0})),n(gke()),t&&t()}catch{s.error(i("nodes.unableToLoadWorkflow")),ve({id:"UNABLE_TO_LOAD_WORKFLOW",title:i("nodes.unableToLoadWorkflow"),status:"error"}),l.abort()}},l.readAsText(a),(c=e.current)==null||c.call(e)},[n,s,e,i,t])},vke=e=>`${e.trim()} (copy)`,Sx=Oe(!1),wm=Oe(""),wx=Oe(!1),bke=pe(ea,({name:e,id:t})=>t?e.length?vke(e):"":e),Id=()=>{const e=I(bke),t=ce(Sx),n=u.useCallback(()=>{wm.set(e),Sx.set(!0)},[e]),s=u.useCallback(()=>{Sx.set(!1),wm.set(""),wx.set(!1)},[]),i=ce(wm),o=u.useCallback(c=>wm.set(c),[]),a=ce(wx),l=u.useCallback(c=>{wx.set(c)},[]);return{workflowName:i,setWorkflowName:o,shouldSaveToProject:a,setShouldSaveToProject:l,isOpen:t,onOpen:n,onClose:s}},xke=()=>{const{t:e}=M(),t=u.useRef(null),n=py(),s=Id(),i=Mz({resetRef:t,onSuccess:()=>{n.close(),s.onOpen()}}),o=u.useCallback(c=>{c[0]&&i(c[0])},[i]),{getInputProps:a,getRootProps:l}=Ya({accept:{"application/json":[".json"]},onDropAccepted:o,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{"aria-label":e("workflows.uploadAndSaveWorkflow"),tooltip:e("workflows.uploadAndSaveWorkflow"),icon:r.jsx(Py,{}),...l(),pointerEvents:"auto",variant:"ghost"}),r.jsx("input",{...a()})]})},Cke=u.memo(xke),Ske=e=>{const t=z(),n=u.useMemo(()=>pe(ea,o=>o.categorySections[e]??!0),[e]),s=I(n),i=u.useCallback(()=>{t(jee({id:e,isOpen:!s}))},[e,t,s]);return{isOpen:s,onToggle:i}};var wke=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,jke=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,kke=/[^-+\dA-Z]/g;function jf(e,t,n,s){if(arguments.length===1&&typeof e=="string"&&!/\d/.test(e)&&(t=e,e=void 0),e=e||e===0?e:new Date,e instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");t=String(Dl[t]||t||Dl.default);var i=t.slice(0,4);(i==="UTC:"||i==="GMT:")&&(t=t.slice(4),n=!0,i==="GMT:"&&(s=!0));var o=function(){return n?"getUTC":"get"},a=function(){return e[o()+"Date"]()},l=function(){return e[o()+"Day"]()},c=function(){return e[o()+"Month"]()},d=function(){return e[o()+"FullYear"]()},h=function(){return e[o()+"Hours"]()},f=function(){return e[o()+"Minutes"]()},p=function(){return e[o()+"Seconds"]()},g=function(){return e[o()+"Milliseconds"]()},m=function(){return n?0:e.getTimezoneOffset()},y=function(){return _ke(e)},b=function(){return Ike(e)},C={d:function(){return a()},dd:function(){return ar(a())},ddd:function(){return Vs.dayNames[l()]},DDD:function(){return l8({y:d(),m:c(),d:a(),_:o(),dayName:Vs.dayNames[l()],short:!0})},dddd:function(){return Vs.dayNames[l()+7]},DDDD:function(){return l8({y:d(),m:c(),d:a(),_:o(),dayName:Vs.dayNames[l()+7]})},m:function(){return c()+1},mm:function(){return ar(c()+1)},mmm:function(){return Vs.monthNames[c()]},mmmm:function(){return Vs.monthNames[c()+12]},yy:function(){return String(d()).slice(2)},yyyy:function(){return ar(d(),4)},h:function(){return h()%12||12},hh:function(){return ar(h()%12||12)},H:function(){return h()},HH:function(){return ar(h())},M:function(){return f()},MM:function(){return ar(f())},s:function(){return p()},ss:function(){return ar(p())},l:function(){return ar(g(),3)},L:function(){return ar(Math.floor(g()/10))},t:function(){return h()<12?Vs.timeNames[0]:Vs.timeNames[1]},tt:function(){return h()<12?Vs.timeNames[2]:Vs.timeNames[3]},T:function(){return h()<12?Vs.timeNames[4]:Vs.timeNames[5]},TT:function(){return h()<12?Vs.timeNames[6]:Vs.timeNames[7]},Z:function(){return s?"GMT":n?"UTC":Ake(e)},o:function(){return(m()>0?"-":"+")+ar(Math.floor(Math.abs(m())/60)*100+Math.abs(m())%60,4)},p:function(){return(m()>0?"-":"+")+ar(Math.floor(Math.abs(m())/60),2)+":"+ar(Math.floor(Math.abs(m())%60),2)},S:function(){return["th","st","nd","rd"][a()%10>3?0:(a()%100-a()%10!=10)*a()%10]},W:function(){return y()},WW:function(){return ar(y())},N:function(){return b()}};return t.replace(wke,function(v){return v in C?C[v]():v.slice(1,v.length-1)})}var Dl={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Vs={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},ar=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(t).padStart(n,"0")},l8=function(t){var n=t.y,s=t.m,i=t.d,o=t._,a=t.dayName,l=t.short,c=l===void 0?!1:l,d=new Date,h=new Date;h.setDate(h[o+"Date"]()-1);var f=new Date;f.setDate(f[o+"Date"]()+1);var p=function(){return d[o+"Date"]()},g=function(){return d[o+"Month"]()},m=function(){return d[o+"FullYear"]()},y=function(){return h[o+"Date"]()},b=function(){return h[o+"Month"]()},C=function(){return h[o+"FullYear"]()},v=function(){return f[o+"Date"]()},x=function(){return f[o+"Month"]()},S=function(){return f[o+"FullYear"]()};return m()===n&&g()===s&&p()===i?c?"Tdy":"Today":C()===n&&b()===s&&y()===i?c?"Ysd":"Yesterday":S()===n&&x()===s&&v()===i?c?"Tmw":"Tomorrow":a},_ke=function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());n.setDate(n.getDate()-(n.getDay()+6)%7+3);var s=new Date(n.getFullYear(),0,4);s.setDate(s.getDate()-(s.getDay()+6)%7+3);var i=n.getTimezoneOffset()-s.getTimezoneOffset();n.setHours(n.getHours()-i);var o=(n-s)/(864e5*7);return 1+Math.floor(o)},Ike=function(t){var n=t.getDay();return n===0&&(n=7),n},Ake=function(t){return(String(t).match(jke)||[""]).pop().replace(kke,"").replace(/GMT\+0000/g,"UTC")};const c_=Oe(null),Tke=()=>c_.set(null),Eke=()=>u.useCallback(t=>{c_.set(t)},[]),Mke=()=>{kt("DeleteWorkflowDialog");const{t:e}=M(),t=ce(c_),[n]=kee(),s=u.useCallback(async()=>{if(t)try{await n(t.workflow_id).unwrap(),ve({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{ve({id:`AUTH_ERROR_TOAST_${g0.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return r.jsx(Tr,{isOpen:t!==null,onClose:Tke,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(q,{children:e("workflows.deleteWorkflow2")})})},kf=Oe(null),Pz=()=>kf.set(null),Lz=()=>{const e=z(),t=py(),{getAndLoadWorkflow:n}=_ee(),s=I(Yu),i=u.useCallback(async()=>{const a=kf.get();if(!a)return;const{workflowId:l,mode:c}=a;await n(l),e(Su(c)),Pz(),t.close()},[e,n,t]),o=u.useCallback((a,l)=>{s?kf.set({workflowId:a,mode:l,isOpen:!0}):(kf.set({workflowId:a,mode:l,isOpen:!1}),i())},[i,s]);return{loadImmediate:i,loadWithDialog:o}},Dz=u.memo(()=>{kt("LoadWorkflowConfirmationAlertDialog");const{t:e}=M(),t=ce(kf),n=Lz();return r.jsx(Tr,{isOpen:!!(t!=null&&t.isOpen),onClose:Pz,title:e("nodes.loadWorkflow"),acceptCallback:n.loadImmediate,useInert:!1,children:r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(q,{children:e("nodes.loadWorkflowDesc")}),r.jsx(q,{variant:"subtext",children:e("nodes.loadWorkflowDesc2")})]})})});Dz.displayName="LoadWorkflowConfirmationAlertDialog";const Rz=()=>{const e=z();return u.useCallback(()=>{const n=nl.get();if(!n)return;const s=new Blob([JSON.stringify(n,null,2)]),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`${n.name||"My Workflow"}.json`,document.body.appendChild(i),i.click(),i.remove(),e(pke())},[e])},Pke=({workflow:e})=>{const{t}=M();return r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsx(q,{children:e.description}),e.category!=="default"&&r.jsxs(A,{flexDir:"column",children:[r.jsxs(q,{children:[t("workflows.opened"),": ",jf(e.opened_at,Dl.shortDate)]}),r.jsxs(q,{children:[t("common.updated"),": ",jf(e.updated_at,Dl.shortDate)]}),r.jsxs(q,{children:[t("common.created"),": ",jf(e.created_at,Dl.shortDate)]})]})]})},Lke=({workflow:e})=>{const{t}=M(),n=ce(RS),[s,i]=u.useState(!1),o=u.useCallback(()=>{i(!0)},[]),a=u.useCallback(()=>{i(!1)},[]),l=I(Iee),c=Rz(),d=the(),h=Eke(),f=Lz(),p=u.useMemo(()=>l===e.workflow_id,[l,e.workflow_id]),g=u.useCallback(()=>{i(!1),f.loadWithDialog(e.workflow_id,"view")},[f,e.workflow_id]),m=u.useCallback(()=>{i(!1),f.loadWithDialog(e.workflow_id,"view")},[f,e.workflow_id]),y=u.useCallback(v=>{v.stopPropagation(),i(!1),h(e)},[h,e]),b=u.useCallback(v=>{v.stopPropagation(),i(!1),d(e)},[d,e]),C=u.useCallback(v=>{v.stopPropagation(),i(!1),c()},[c]);return r.jsxs(A,{gap:4,onClick:g,cursor:"pointer",_hover:{backgroundColor:"base.750"},p:2,ps:3,borderRadius:"base",w:"full",onMouseOver:o,onMouseOut:a,alignItems:"center",children:[r.jsx(De,{label:r.jsx(Pke,{workflow:e}),closeOnScroll:!0,children:r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsxs(A,{gap:4,alignItems:"center",children:[r.jsx(q,{noOfLines:2,children:e.name}),p&&r.jsx(is,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:t("workflows.opened")})]}),e.category!=="default"&&r.jsxs(q,{fontSize:"xs",variant:"subtext",flexShrink:0,noOfLines:1,children:[t("common.updated"),": ",jf(e.updated_at,Dl.shortDate)," ",jf(e.updated_at,Dl.shortTime)]})]})}),r.jsx(rt,{}),r.jsxs(A,{alignItems:"center",gap:1,opacity:s?1:0,children:[r.jsx(De,{label:t("workflows.edit"),isOpen:s?void 0:!1,closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"ghost","aria-label":t("workflows.edit"),onClick:m,icon:r.jsx(My,{})})}),r.jsx(De,{label:t("workflows.download"),isOpen:s?void 0:!1,closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"ghost","aria-label":t("workflows.download"),onClick:C,icon:r.jsx(ed,{})})}),!!n&&e.workflow_id&&e.category!=="user"&&r.jsx(De,{label:t("workflows.copyShareLink"),isOpen:s?void 0:!1,closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"ghost","aria-label":t("workflows.copyShareLink"),onClick:b,icon:r.jsx(YL,{})})}),e.category!=="default"&&r.jsx(De,{label:t("workflows.delete"),isOpen:s?void 0:!1,closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"ghost","aria-label":t("workflows.delete"),onClick:y,colorScheme:"error",icon:r.jsx(Lw,{})})})]})]})},Dke=({category:e})=>{const t=I(XM),n=I(QM),s=I(JM),{t:i}=M(),o=u.useMemo(()=>e!=="default"?{order_by:n,direction:s,category:e}:{order_by:"name",direction:"ASC",category:e},[e,s,n]),{data:a,isLoading:l}=Aee(o,{selectFromResult:({data:h,isLoading:f})=>({data:(h==null?void 0:h.items.filter(g=>g.name.toLowerCase().includes(t.toLowerCase())))||xs,isLoading:f})}),{isOpen:c,onToggle:d}=Ske(e);return r.jsxs(A,{flexDir:"column",children:[r.jsx(ye,{variant:"unstyled",onClick:d,children:r.jsxs(A,{gap:2,alignItems:"center",children:[r.jsx(dt,{boxSize:4,as:ii,transform:c?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:i(`workflows.${e}Workflows`)})]})}),r.jsx(rc,{in:c,style:vv,children:l?r.jsx(A,{alignItems:"center",justifyContent:"center",p:20,children:r.jsx(rr,{})}):a.length?a.map(h=>r.jsx(Lke,{workflow:h},h.workflow_id)):r.jsx(Ot,{fontSize:"sm",py:4,label:i(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})})]})},Oz=u.memo(({searchInputRef:e})=>{const t=z(),n=I(XM),{t:s}=M(),i=u.useCallback(c=>{t(L4(c))},[t]),o=u.useCallback(()=>{t(L4(""))},[t]),a=u.useCallback(c=>{c.key==="Escape"&&o()},[o]),l=u.useCallback(c=>{i(c.target.value)},[i]);return u.useEffect(()=>{e.current&&e.current.focus()},[e]),r.jsxs(Jo,{children:[r.jsx(jt,{ref:e,placeholder:s("stylePresets.searchByName"),value:n,onKeyDown:a,onChange:l}),n&&n.length&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{onClick:o,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})});Oz.displayName="WorkflowSearch";const Rke=$e.enum(["opened_at","created_at","updated_at","name"]),Oke=e=>Rke.safeParse(e).success,Nke=$e.enum(["ASC","DESC"]),Fke=e=>Nke.safeParse(e).success,Bke=()=>{const e=ce(Tee),{t}=M(),n=I(QM),s=I(JM),i=u.useMemo(()=>({opened_at:t("workflows.opened"),created_at:t("workflows.created"),updated_at:t("workflows.updated"),name:t("workflows.name")}),[t]),o=u.useMemo(()=>({ASC:t("workflows.ascending"),DESC:t("workflows.descending")}),[t]),a=z(),l=u.useCallback(h=>{Oke(h.target.value)&&a(Eee(h.target.value))},[a]),c=u.useCallback(h=>{Fke(h.target.value)&&a(Mee(h.target.value))},[a]),d=e!==void 0?"opened_at":"created_at";return r.jsxs(Fn,{placement:"bottom",children:[r.jsx(Un,{children:r.jsx(oe,{tooltip:`Sorting by ${i[n??d]} ${o[s]}`,"aria-label":"Sort Workflow Library",icon:s==="ASC"?r.jsx(zae,{}):r.jsx(Hae,{}),variant:"ghost"})}),r.jsx(Bn,{children:r.jsx(qn,{children:r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:t("common.orderBy")}),r.jsxs(uo,{value:n??d,onChange:l,size:"sm",children:[e!==void 0&&r.jsx("option",{value:"opened_at",children:i.opened_at}),r.jsx("option",{value:"created_at",children:i.created_at}),r.jsx("option",{value:"updated_at",children:i.updated_at}),r.jsx("option",{value:"name",children:i.name})]})]}),r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:t("common.direction")}),r.jsxs(uo,{value:s,onChange:c,size:"sm",children:[r.jsx("option",{value:"ASC",children:o.ASC}),r.jsx("option",{value:"DESC",children:o.DESC})]})]})]})})})]})},$ke=()=>{const e=py(),{t}=M(),n=ce(eP),s=u.useRef(null),i=I(JS);return r.jsxs(Fn,{isOpen:e.isOpen,onClose:e.close,onOpen:e.open,isLazy:!0,lazyBehavior:"unmount",placement:"bottom-end",initialFocusRef:s,children:[r.jsx(Un,{children:r.jsx(ye,{variant:"ghost",rightIcon:r.jsx(Qae,{}),size:"sm",children:r.jsx(q,{display:"auto",noOfLines:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",wordBreak:"break-all",children:i||t("workflows.chooseWorkflowFromLibrary")})})}),r.jsx(za,{children:r.jsx(Bn,{p:4,w:512,maxW:"full",minH:512,maxH:"full",children:r.jsx(qn,{flex:"1 1 0",children:r.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsxs(A,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[r.jsx(Oz,{searchInputRef:s}),r.jsx(Bke,{}),r.jsx(Cke,{}),r.jsx(Ez,{})]}),r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx($n,{children:n.map(o=>r.jsx(Dke,{category:o},o))})})]})})})})]})},Nz=u.memo(()=>{const e=z(),t=I(bo),{t:n}=M(),s=u.useCallback(o=>{o.stopPropagation(),e(Su("edit"))},[e]),i=u.useCallback(o=>{o.stopPropagation(),e(Su("view"))},[e]);return t==="view"?r.jsx(oe,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:r.jsx(Jae,{}),variant:"ghost",size:"sm"}):r.jsx(oe,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:i,icon:r.jsx($p,{}),variant:"ghost",size:"sm"})});Nz.displayName="WorkflowViewEditToggleButton";const Vke=()=>{const{t:e}=M(),t=Rz();return r.jsx(he,{as:"button",icon:r.jsx(ed,{}),onClick:t,children:e("workflows.downloadWorkflow")})},Gke=u.memo(Vke),jx=Oe(!1),Fz=()=>{const e=ce(jx),t=u.useCallback(()=>{jx.set(!0)},[]),n=u.useCallback(()=>{jx.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},zke=()=>{const{t:e}=M(),t=z(),{isOpen:n,onClose:s}=Fz(),[i,o]=u.useState(""),[a,l]=u.useState(""),[c,d]=u.useState(!0),h=u.useCallback(y=>{o(y.target.value)},[]),f=u.useCallback(y=>{l(y.target.value)},[]),p=u.useCallback(y=>{d(y.target.checked)},[]),g=u.useCallback(()=>{const y=JSON.parse(i),b=Pee(y,c);l(JSON.stringify(b,null,2))},[i,c]),m=u.useCallback(()=>{t(dS({data:{workflow:a,graph:null},asCopy:!0})),s()},[t,s,a]);return r.jsxs(ni,{isOpen:n,onClose:s,isCentered:!0,useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(Mr,{children:e("workflows.loadFromGraph")}),r.jsx(yo,{}),r.jsxs(sr,{as:A,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(A,{gap:4,children:[r.jsx(ye,{onClick:g,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("workflows.autoLayout")}),r.jsx(kn,{isChecked:c,onChange:p})]}),r.jsx(rt,{}),r.jsx(ye,{onClick:m,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),r.jsxs(Z,{orientation:"vertical",h:"50%",children:[r.jsx(te,{children:e("nodes.graph")}),r.jsx(Qn,{h:"full",value:i,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:h})]}),r.jsxs(Z,{orientation:"vertical",h:"50%",children:[r.jsx(te,{children:e("nodes.workflow")}),r.jsx(Qn,{h:"full",value:a,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:f})]})]})]})]})},Hke=()=>{const{t:e}=M(),t=ce(Tn),{onOpen:n}=Fz();return r.jsx(he,{as:"button",icon:r.jsx(Ew,{}),onClick:n,isDisabled:!LS(t),children:e("workflows.loadFromGraph")})},Wke=u.memo(Hke),Bz=u.memo(()=>{const{t:e}=M(),t=l_();return r.jsx(he,{as:"button",icon:r.jsx(Lf,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});Bz.displayName="NewWorkflowMenuItem";const Uke=()=>{const{t:e}=M(),{onOpen:t}=Id();return r.jsx(he,{as:"button",icon:r.jsx(an,{}),onClick:t,children:e("workflows.saveWorkflowAs")})},qke=u.memo(Uke),$z=()=>{const e=jn();return u.useCallback(()=>{const n=Lee(e.getState()),{nodes:s}=lt(e.getState());return Dee(n,s)},[e])},Av=e=>!!e.id,u_=()=>{const{t:e}=M(),t=z(),n=$z(),[s,i]=Ree(),[o,a]=tP(),l=Y1(),c=u.useRef();return{saveWorkflow:u.useCallback(async()=>{const h=nl.get();if(h){c.current=l({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{if(Av(h))await s(h).unwrap(),t(yke());else{const f=await o(h).unwrap();t(nP(f.workflow.id))}t(sP()),t(rP({formFieldInitialValues:n()})),l.update(c.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{!l.isActive(`auth-error-toast-${g0.endpoints.createWorkflow.name}`)&&!l.isActive(`auth-error-toast-${g0.endpoints.updateWorkflow.name}`)?l.update(c.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0}):l.close(c.current)}}},[l,e,t,n,s,o]),isLoading:i.isLoading||a.isLoading,isError:i.isError||a.isError}},Kke=()=>{const{t:e}=M(),{saveWorkflow:t}=u_(),{onOpen:n}=Id(),s=I(Yu),i=u.useCallback(()=>{const o=nl.get();o&&(Av(o)?t():n())},[n,t]);return r.jsx(he,{as:"button",isDisabled:!s,icon:r.jsx(eo,{}),onClick:i,children:e("workflows.saveWorkflow")})},Zke=u.memo(Kke),Yke=()=>{const{t:e}=M(),t=u.useRef(null),n=Mz({resetRef:t}),s=u.useCallback(a=>{a[0]&&n(a[0])},[n]),{getRootProps:i,getInputProps:o}=Ya({accept:{"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return r.jsxs(he,{as:"button",icon:r.jsx(Py,{}),...i(),children:[e("workflows.uploadWorkflow"),r.jsx("input",{...o()})]})},Xke=u.memo(Yke),Vz=u.memo(()=>{const{t:e}=M(),{isOpen:t,onOpen:n,onClose:s}=ir(),i=Wa();return bp(s),r.jsxs(Yt,{isOpen:t,onOpen:n,onClose:s,children:[r.jsx(Xt,{as:oe,"aria-label":e("workflows.workflowEditorMenu"),icon:r.jsx(Dw,{}),pointerEvents:"auto",size:"sm",variant:"ghost"}),r.jsxs(It,{pointerEvents:"auto",children:[r.jsx(Bz,{}),r.jsx(Xke,{}),r.jsx(vs,{}),r.jsx(Zke,{}),r.jsx(qke,{}),r.jsx(Gke,{}),i&&r.jsx(vs,{}),i&&r.jsx(Wke,{})]})]})});Vz.displayName="WorkflowLibraryMenu";const Qke=()=>{const{t:e}=M(),{onOpen:t}=Id(),{saveWorkflow:n}=u_(),s=u.useCallback(i=>{i.stopPropagation();const o=nl.get();o&&(Av(o)?n():t())},[t,n]);return r.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(eo,{}),onClick:s,pointerEvents:"auto",variant:"ghost",size:"sm"})},Jke=u.memo(Qke),Gz=u.memo(()=>{const e=I(bo);return r.jsxs(A,{w:"full",alignItems:"center",gap:1,minW:0,children:[r.jsx($ke,{}),r.jsx(rt,{}),e==="edit"&&r.jsx(Jke,{}),r.jsx(Nz,{}),r.jsx(Vz,{})]})});Gz.displayName="ActiveWorkflowNameAndActions";const e_e=()=>{const e=I(Oee);return r.jsx(A,{w:"full",h:"full",userSelect:"none",justifyContent:"center",children:r.jsxs(A,{alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:5,maxW:"230px",pt:24,children:[r.jsx(dn,{src:Nee,alt:"invoke-ai-logo",opacity:.2,mixBlendMode:"overlay",w:16,h:16,minW:16,minH:16,userSelect:"none"}),e?r.jsx(t_e,{}):r.jsx(n_e,{})]})})},t_e=()=>{const{t:e}=M(),t=z(),n=py(),s=u.useCallback(()=>{t(Su("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{gap:2,children:[r.jsx(ye,{size:"sm",onClick:s,children:e("nodes.newWorkflow")}),r.jsx(ye,{size:"sm",colorScheme:"invokeBlue",onClick:n.open,children:e("nodes.loadWorkflow")})]}),r.jsx(q,{textAlign:"center",fontSize:"md",children:r.jsx(Jt,{i18nKey:"nodes.workflowHelpText",size:"sm",components:s_e})})]})},n_e=()=>{const{t:e}=M(),t=z(),n=u.useCallback(()=>{t(Su("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(q,{textAlign:"center",fontSize:"md",children:e("nodes.noFieldsViewMode")}),r.jsx(ye,{size:"sm",colorScheme:"invokeBlue",onClick:n,children:e("nodes.edit")})]})},s_e={LinkComponent:r.jsx(oy,{fontSize:"md",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},zz=u.memo(()=>r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx($n,{children:r.jsx(Hz,{})})}));zz.displayName="ViewModeLeftPanelContent";const Hz=u.memo(()=>{const{isLoading:e}=fy(),t=ce(cp),n=I(KM);return e||!t?r.jsx(Ot,{label:Te("nodes.loadingNodes"),icon:null}):n?r.jsx(e_e,{}):r.jsx(A,{w:"full",h:"full",justifyContent:"center",children:r.jsx(bz,{})})});Hz.displayName=" ViewModeLeftPanelContentInner";const r_e=()=>{const e=I(bo);return r.jsxs(A,{w:"full",h:"full",gap:2,flexDir:"column",children:[r.jsx(Gz,{}),e==="view"&&r.jsx(Iz,{}),e==="view"&&r.jsx(zz,{}),e==="edit"&&r.jsx(_z,{})]})},i_e=u.memo(r_e),Wz=u.memo(e=>{const{t}=M(),n=Yp(),s=wy(),i=Wa();return r.jsx(oe,{size:"lg",isDisabled:i?n.isDisabled:s.isDisabled,isLoading:i?n.isLoading:s.isLoading,"aria-label":t(i?"queue.clear":"queue.cancel"),tooltip:t(i?"queue.clearTooltip":"queue.cancelTooltip"),icon:i?r.jsx(ei,{}):r.jsx(Nt,{}),colorScheme:"error",onClick:i?n.openDialog:s.cancelQueueItem,"data-testid":t(i?"queue.clear":"queue.cancel")})});Wz.displayName="ClearQueueIconButton";const Uz=u.memo(({targetRef:e})=>{const[t,n]=u.useState(null),s=ce(d2),{queueSize:i}=ti(void 0,{selectFromResult:o=>({queueSize:o.data?o.data.queue.pending+o.data.queue.in_progress:0})});return u.useEffect(()=>{if(!e.current)return;const o=e.current,a=o.parentElement;if(!a)return;const l=()=>{if(!d2.get())return;const{x:d,y:h}=o.getBoundingClientRect();n({x:`${d-7}px`,y:`${h-5}px`})},c=new ResizeObserver(l);return c.observe(a),l(),()=>{c.disconnect()}},[e]),i===0||!t||!s?null:r.jsx(za,{children:r.jsx(is,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:i})})});Uz.displayName="QueueCountBadge";const qz=()=>{const{t:e}=M(),t=ce(Wn),{data:n}=ti(),[s,{isLoading:i}]=bM({fixedCacheKey:"pauseProcessor"}),o=u.useMemo(()=>!!(n!=null&&n.processor.is_started),[n==null?void 0:n.processor.is_started]),a=u.useCallback(async()=>{if(o)try{await s().unwrap(),ve({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{ve({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[o,s,e]),l=u.useMemo(()=>!t||!o,[t,o]);return{pauseProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},Kz=()=>{const e=ce(Wn),{data:t}=ti(),{t:n}=M(),[s,{isLoading:i}]=vM({fixedCacheKey:"resumeProcessor"}),o=u.useMemo(()=>!!(t!=null&&t.processor.is_started),[t==null?void 0:t.processor.is_started]),a=u.useCallback(async()=>{if(!o)try{await s().unwrap(),ve({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{ve({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[o,s,n]),l=u.useMemo(()=>!e||o,[e,o]);return{resumeProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},Zz=u.memo(()=>{const e=u.useRef(null),t=z(),{t:n}=M(),s=en("pauseQueue"),i=en("resumeQueue"),o=I7(),a=wy(),l=Yp(),{resumeProcessor:c,isLoading:d,isDisabled:h}=Kz(),{pauseProcessor:f,isLoading:p,isDisabled:g}=qz(),m=u.useCallback(()=>{t(Kt("queue"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(Yt,{placement:"bottom-end",children:[r.jsx(Xt,{ref:e,as:oe,size:"lg","aria-label":"Queue Actions Menu",icon:r.jsx(Dae,{})}),r.jsxs(It,{children:[r.jsx(xr,{title:n("common.new"),children:r.jsx(gk,{})}),r.jsxs(xr,{title:n("queue.queue"),children:[r.jsx(he,{isDestructive:!0,icon:r.jsx(Nt,{}),onClick:a.cancelQueueItem,isLoading:a.isLoading,isDisabled:a.isDisabled,children:n("queue.cancelTooltip")}),r.jsx(he,{isDestructive:!0,icon:r.jsx(ale,{}),onClick:o.openDialog,isLoading:o.isLoading,isDisabled:o.isDisabled,children:n("queue.cancelAllExceptCurrentTooltip")}),r.jsx(he,{isDestructive:!0,icon:r.jsx(ei,{}),onClick:l.openDialog,isLoading:l.isLoading,isDisabled:l.isDisabled,children:n("queue.clearTooltip")}),i&&r.jsx(he,{icon:r.jsx(nD,{}),onClick:c,isLoading:d,isDisabled:h,children:n("queue.resumeTooltip")}),s&&r.jsx(he,{icon:r.jsx(tD,{}),onClick:f,isLoading:p,isDisabled:g,children:n("queue.pauseTooltip")}),r.jsx(he,{icon:r.jsx(KL,{}),onClick:m,children:n("queue.openQueue")})]})]})]}),r.jsx(Uz,{targetRef:e})]})});Zz.displayName="QueueActionsMenuButton";const o_e=e=>({bg:"base.700",w:"72px",cursor:"pointer","&[data-checked]":{".thumb":{left:`calc(100% - ${e})`,transform:"translateX(-100%)",bg:"invokeGreen.300"},".unchecked-icon":{color:"base.50",opacity:.4},".checked-icon":{color:"base.900",opacity:1}},"&[data-disabled]":{bg:"base.700",".thumb":{bg:"base.500"},".unchecked-icon":{color:"base.800"},".checked-icon":{color:"base.800"}},".thumb":{transition:"left 0.1s ease-in-out, transform 0.1s ease-in-out",left:e,transform:"translateX(0)",bg:"invokeBlue.400",shadow:"md"},".unchecked-icon":{color:"base.900",opacity:1},".checked-icon":{color:"base.50",opacity:.4}}),Yz=u.memo(()=>{const{t:e}=M(),t=z(),n=I(ew),s=I(On),i=HS("space",1),o=u.useMemo(()=>o_e(i),[i]),a=u.useCallback(h=>{t(Fee(h.target.checked))},[t]),{getCheckboxProps:l,getInputProps:c,htmlProps:d}=Bee({onChange:a,isChecked:n,isDisabled:s});return r.jsxs(Fn,{trigger:"hover",children:[r.jsx(Un,{children:r.jsx(Qo.label,{...d,children:r.jsxs(A,{position:"relative",borderRadius:"base",alignItems:"center",justifyContent:"space-between",h:"full",p:i,gap:i,sx:o,...l(),children:[r.jsx("input",{...c(),hidden:!0}),r.jsx(Se,{className:"thumb",position:"absolute",borderRadius:"base",w:10,top:i,bottom:i}),r.jsx(A,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(dt,{className:"unchecked-icon",w:6,h:6,as:wu,"aria-label":e("controlLayers.sendToGallery")})}),r.jsx(A,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(dt,{className:"checked-icon",w:6,h:6,as:Mw,"aria-label":e("controlLayers.sendToCanvas")})})]})})}),r.jsx(za,{children:r.jsxs(Bn,{maxW:296,p:2,bg:"base.200",color:"base.800",children:[r.jsx(Li,{bg:"base.200",left:n?"18px !important":"-18px !important",transitionProperty:"all",transitionDuration:"0.2s"}),r.jsx(qn,{children:r.jsx(Xz,{})})]})})]})});Yz.displayName="SendToToggle";const Xz=u.memo(()=>{const{t:e}=M(),t=I(ew);return I(On)?r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e("controlLayers.sendingToCanvas")}),r.jsx(q,{fontWeight:"normal",children:r.jsx(Jt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(Qz,{})}})})]}):r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e(t?"controlLayers.sendToCanvas":"controlLayers.sendToGallery")}),r.jsx(q,{fontWeight:"normal",children:e(t?"controlLayers.sendToCanvasDesc":"controlLayers.sendToGalleryDesc")})]})});Xz.displayName="TooltipContent";const Qz=u.memo(e=>{const t=z(),n=u.useCallback(()=>{t(Kt("canvas")),t(Cr("layers")),_S.set(!1)},[t]);return r.jsx(ye,{onClick:n,size:"sm",variant:"link",color:"base.800",_hover:{color:"base.900",textDecoration:"underline"},children:e.children})});Qz.displayName="ActivateCanvasButton";const a_e=()=>{const{t:e}=M(),t=Cj(),{data:n}=ti(),s=ce(Wn),i=ce(Fo),o=u.useMemo(()=>i?(i.percentage??0)*100:0,[i]),a=u.useMemo(()=>!s||!(n!=null&&n.queue.in_progress)?!1:!i||i.percentage===null,[s,i,n==null?void 0:n.queue.in_progress]),l=u.useMemo(()=>t==="canvas"?"invokeGreen":t==="gallery"?"invokeBlue":"base",[t]);return r.jsx(xE,{value:o,"aria-label":e("accessibility.invokeProgressBar"),isIndeterminate:a,h:2,w:"full",colorScheme:l})},l_e=u.memo(a_e),Jz=u.memo(()=>{const e=I(tw),t=I($ee),n=z(),s=u.useCallback(i=>{n(Vee(i))},[n]);return r.jsx(Ve,{feature:"paramIterations",children:r.jsx(Ae,{step:t.coarseStep,fineStep:t.fineStep,min:1,max:999,onChange:s,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});Jz.displayName="QueueIterationsNumberInput";const eH=({prepend:e,children:t,...n})=>r.jsx(De,{label:r.jsx(tH,{prepend:e}),maxW:512,...n,children:t}),tH=u.memo(({prepend:e=!1})=>{const t=I(En);return t==="canvas"?r.jsx(nH,{prepend:e}):t==="workflows"?r.jsx(rH,{prepend:e}):t==="upscaling"?r.jsx(sH,{prepend:e}):null});tH.displayName="TooltipContent";const nH=u.memo(({prepend:e=!1})=>{const t=ce(jy),n=ce(Aa);return r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsx(Tv,{isReady:t,prepend:e}),r.jsx(d_,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Jf,{}),r.jsx(Ev,{reasons:n})]}),r.jsx(Jf,{}),r.jsx(aH,{})]})});nH.displayName="CanvasTabTooltipContent";const sH=u.memo(({prepend:e=!1})=>{const t=ce(jy),n=ce(Aa);return r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsx(Tv,{isReady:t,prepend:e}),r.jsx(d_,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Jf,{}),r.jsx(Ev,{reasons:n})]})]})});sH.displayName="UpscaleTabTooltipContent";const rH=u.memo(({prepend:e=!1})=>{const t=ce(jy),n=ce(Aa);return r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsx(Tv,{isReady:t,prepend:e}),r.jsx(iH,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Jf,{}),r.jsx(Ev,{reasons:n})]})]})});rH.displayName="WorkflowsTabTooltipContent";const d_=u.memo(()=>{const{t:e}=M(),t=I(Yie),n=I(tw),s=u.useMemo(()=>{const i=Math.min(t*n,1e4),o=e("queue.prompts",{count:t}),a=e("queue.iterations",{count:n}),l=e("queue.generations",{count:i});return`${t} ${o}  ${n} ${a} -> ${i} ${l}`.toLowerCase()},[n,t,e]);return r.jsx(q,{children:s})});d_.displayName="QueueCountPredictionCanvasOrUpscaleTab";const iH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(lt),[s,i]=u.useState("LOADING"),o=u.useMemo(()=>ri(async c=>{i("LOADING");const d=await Gee(c,t);i(d)},300),[t]);u.useEffect(()=>{o(n)},[o,n]);const a=I(tw),l=u.useMemo(()=>{if(s==="LOADING")return`${e("common.loading")}...`;const c=e("queue.iterations",{count:a});if(s==="NO_BATCHES"){const f=Math.min(1e4,a),p=e("queue.generations",{count:f});return`${a} ${c} -> ${f} ${p}`.toLowerCase()}if(s==="EMPTY_BATCHES")return e("parameters.invoke.batchNodeEmptyCollection");if(s==="MISMATCHED_BATCH_GROUP")return e("parameters.invoke.batchNodeCollectionSizeMismatchNoGroupId");const d=Math.min(s*a,1e4),h=e("queue.generations",{count:d});return`${s} ${e("queue.batchSize")}  ${a} ${c} -> ${d} ${h}`.toLowerCase()},[s,a,e]);return r.jsx(q,{children:l})});iH.displayName="QueueCountPredictionWorkflowsTab";const Tv=u.memo(({isReady:e,prepend:t})=>{const{t:n}=M(),s=I(Z1),[i,o]=mS(H1),a=u.useMemo(()=>o.isLoading?n("queue.enqueueing"):n(s?"dynamicPrompts.loading":e?t?"queue.queueFront":"queue.queueBack":"queue.notReady"),[o.isLoading,s,e,t,n]);return r.jsx(q,{fontWeight:"semibold",children:a})});Tv.displayName="IsReadyText";const Ev=u.memo(({reasons:e})=>r.jsx(Pi,{children:e.map((t,n)=>r.jsx(oH,{reason:t},`${t.content}.${n}`))}));Ev.displayName="ReasonsList";const oH=u.memo(({reason:e})=>r.jsx(Vt,{children:r.jsxs("span",{children:[e.prefix&&r.jsxs(q,{as:"span",fontWeight:"semibold",children:[e.prefix,":"," "]}),r.jsx(q,{as:"span",children:e.content})]})}));oH.displayName="ReasonListItem";const Jf=u.memo(()=>r.jsx(Pt,{opacity:.2,borderColor:"base.900"}));Jf.displayName="StyledDivider";const aH=u.memo(()=>{const{t:e}=M(),t=I(ew),n=I(Er),s=Hp(n),i=u.useMemo(()=>e(t?"controlLayers.stagingOnCanvas":"parameters.invoke.addingImagesTo"),[t,e]),o=u.useMemo(()=>t?e("queue.canvas"):s||e("boards.uncategorized"),[s,t,e]);return r.jsxs(q,{fontStyle:"oblique 10deg",children:[i," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:o})]})});aH.displayName="AddingToText";const c8="Invoke",lH=u.memo(()=>{const e=vw(),t=Wa(),n=I(Z1);return r.jsxs(A,{pos:"relative",w:"200px",children:[r.jsx(Jz,{}),r.jsx(eH,{prepend:t,children:r.jsxs(ye,{onClick:t?e.queueFront:e.queueBack,isLoading:e.isLoading||n,loadingText:c8,isDisabled:e.isDisabled,rightIcon:t?r.jsx(Ly,{}):r.jsx(Dy,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[r.jsx("span",{children:c8}),r.jsx(rt,{})]})})]})});lH.displayName="InvokeQueueBackButton";const c_e=()=>{const e=I(En);return r.jsxs(A,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[r.jsxs(A,{gap:2,children:[r.jsx(lH,{}),r.jsx(rt,{}),e==="canvas"&&r.jsx(bi,{children:r.jsx(Yz,{})}),r.jsx(Zz,{}),r.jsx(Wz,{})]}),r.jsx(l_e,{})]})},u_e=u.memo(c_e),d_e=e=>{const{t}=M();return r.jsx(A,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:r.jsx(De,{label:t("accessibility.toggleRightPanel"),placement:"start",children:r.jsx(oe,{"aria-label":t("accessibility.toggleRightPanel"),onClick:e.panelApi.toggle,icon:r.jsx(Tae,{}),h:48})})})},h_e=u.memo(d_e),cH=u.memo(()=>{const{t:e}=M(),t=lc("bbox"),n=ia("bbox"),s=Lt();return Le({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:r.jsx(qa,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});cH.displayName="ToolBboxButton";const uH=u.memo(()=>{const{t:e}=M(),t=ia("brush"),n=lc("brush"),s=Lt();return Le({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:r.jsx(Mw,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});uH.displayName="ToolBrushButton";const dH=u.memo(()=>{const{t:e}=M(),t=ia("colorPicker"),n=lc("colorPicker"),s=Lt();return Le({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:r.jsx(jae,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});dH.displayName="ToolColorPickerButton";const hH=u.memo(()=>{const{t:e}=M(),t=ia("move"),n=lc("move"),s=Lt();return Le({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:r.jsx(bae,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});hH.displayName="ToolMoveButton";const fH=u.memo(()=>{const{t:e}=M(),t=ia("rect"),n=lc("rect"),s=Lt();return Le({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:r.jsx(Nae,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});fH.displayName="ToolRectButton";const pH=u.memo(()=>{const{t:e}=M(),t=ia("eraser"),n=lc("eraser"),s=Lt();return Le({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:r.jsx(Cae,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});pH.displayName="ToolEraserButton";const gH=u.memo(()=>{const{t:e}=M(),t=ia("view"),n=lc("view"),s=Lt();return Le({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(De,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:r.jsx(Iae,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});gH.displayName="ToolViewButton";const f_e=()=>r.jsx(r.Fragment,{children:r.jsxs(Cs,{isAttached:!0,orientation:"vertical",children:[r.jsx(uH,{}),r.jsx(pH,{}),r.jsx(fH,{}),r.jsx(hH,{}),r.jsx(gH,{}),r.jsx(cH,{}),r.jsx(dH,{})]})}),p_e=e=>{const{t}=M(),n=vw(),s=Wa(),i=I(En),o=Lt(),a=Yp(),{data:l}=ti(),c=wy(),d=u.useMemo(()=>{const h=((l==null?void 0:l.queue.in_progress)??0)>0;return!n.isDisabled&&h?r.jsx(dt,{boxSize:6,as:mae,animation:gy}):s?r.jsx(Ly,{}):r.jsx(Dy,{})},[n.isDisabled,l==null?void 0:l.queue.in_progress,s]);return r.jsxs(A,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[i==="canvas"&&!o.isOpen&&r.jsx(bi,{children:r.jsx(f_e,{})}),r.jsxs(Cs,{orientation:"vertical",h:48,children:[r.jsx(De,{label:t("accessibility.toggleLeftPanel"),placement:"end",children:r.jsx(oe,{"aria-label":t("accessibility.toggleLeftPanel"),onClick:e.panelApi.toggle,icon:r.jsx(Gae,{}),flexGrow:1})}),r.jsx(eH,{prepend:s,placement:"end",children:r.jsx(oe,{"aria-label":t("queue.queueBack"),onClick:s?n.queueFront:n.queueBack,isLoading:n.isLoading,isDisabled:n.isDisabled,icon:d,colorScheme:"invokeYellow",flexGrow:1})}),r.jsx(De,{label:t("queue.cancelTooltip"),placement:"end",children:r.jsx(oe,{isDisabled:c.isDisabled,isLoading:c.isLoading,"aria-label":t("queue.cancelTooltip"),icon:r.jsx(Nt,{}),onClick:c.cancelQueueItem,colorScheme:"error",flexGrow:1})}),r.jsx(De,{label:t("queue.clearTooltip"),placement:"end",children:r.jsx(oe,{isDisabled:a.isDisabled,isLoading:a.isLoading,"aria-label":t("queue.clearTooltip"),icon:r.jsx(ei,{}),colorScheme:"error",onClick:a.openDialog,"data-testid":t("queue.clear"),flexGrow:1})})]})]})},g_e=u.memo(p_e),Cg=({label:e})=>r.jsx(q,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),Sg=u.memo(e=>r.jsx(A,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"center",children:e.children}));Sg.displayName="PromptOverlayButtonWrapper";const m_e=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(Al))return["",`${e} `,t];const[n,...s]=t.split(Al);return[n||"",e,s.join(Al)||""]},mH=({presetPrompt:e,prompt:t,label:n})=>{const s=z(),{t:i}=M(),o=u.useMemo(()=>m_e(t,e),[e,t]),a=u.useCallback(()=>{s(Om(!1))},[s]);return r.jsx(Se,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:r.jsxs(A,{flexDir:"column",onClick:a,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[r.jsx(Cg,{label:n}),r.jsx(A,{overflow:"scroll",children:r.jsx(q,{w:"full",lineHeight:"short",children:o.map((l,c)=>r.jsx(q,{as:"span",color:c===1?"white":"base.200",fontWeight:c===1?"semibold":"normal",children:l},c))})}),r.jsx(De,{label:i("stylePresets.viewModeTooltip"),children:r.jsx(A,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:r.jsx(dt,{as:$p,color:"base.500",boxSize:4})})})]})})},yH=u.memo(()=>{var m;const e=z(),t=I(zee),n=I(nw),s=I(lp),{activeStylePreset:i}=Lp(void 0,{selectFromResult:({data:y})=>{let b=null;return y&&(b=y.find(C=>C.id===s)),{activeStylePreset:b}}}),o=u.useRef(null),{t:a}=M(),l=u.useCallback(y=>{e(iP(y))},[e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=wd({prompt:t,textareaRef:o,onChange:l});return r.jsx(dc,{isOpen:d,onClose:h,onSelect:p,width:(m=o.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(Qn,{id:"negativePrompt",name:"negativePrompt",ref:o,value:t,onChange:c,onKeyDown:g,fontSize:"sm",variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Sg,{children:r.jsx(uc,{isOpen:d,onOpen:f})}),r.jsx(Cg,{label:a("parameters.negativePromptPlaceholder")}),n&&r.jsx(mH,{prompt:t,presetPrompt:(i==null?void 0:i.preset_data.negative_prompt)||"",label:`${a("parameters.negativePromptPlaceholder")} (${a("stylePresets.preview")})`})]})})});yH.displayName="ParamNegativePrompt";const y_e={svg:{animation:gy}},vH=u.memo(()=>{const{t:e}=M(),t=I(Z1),n=I(hE),{isOpen:s,onOpen:i}=AD();return r.jsx(De,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:r.jsx(oe,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:r.jsx(hae,{}),onClick:i,sx:t?y_e:void 0,colorScheme:n&&!t?"error":"base"})})});vH.displayName="ShowDynamicPromptsPreviewButton";const bH=u.memo(()=>{const e=I(Hee),t=z(),{t:n}=M(),s=u.useCallback(()=>{t(Wee(!e))},[t,e]),i=u.useMemo(()=>n(e?"sdxl.concatPromptStyle":"sdxl.freePromptStyle"),[e,n]);return r.jsx(De,{label:i,children:r.jsx(oe,{"aria-label":i,onClick:s,icon:e?r.jsx(Pae,{size:14}):r.jsx(Lae,{size:14}),variant:"promptOverlay",fontSize:12,px:.5})})});bH.displayName="SDXLConcatButton";const xH=u.memo(()=>{var C;const e=z(),t=I(Uee),n=I(Yl),s=I(nw),i=I(lp),{activeStylePreset:o}=Lp(void 0,{selectFromResult:({data:v})=>{let x=null;return v&&(x=v.find(S=>S.id===i)),{activeStylePreset:x}}}),a=u.useRef(null),{t:l}=M(),c=u.useCallback(v=>{e(oP(v))},[e]),{onChange:d,isOpen:h,onClose:f,onOpen:p,onSelect:g,onKeyDown:m,onFocus:y}=wd({prompt:t,textareaRef:a,onChange:c}),b=u.useCallback(v=>{y(),v.preventDefault()},[y]);return Le({id:"focusPrompt",category:"app",callback:b,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[b]}),r.jsx(dc,{isOpen:h,onClose:f,onSelect:g,width:(C=a.current)==null?void 0:C.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(Qn,{id:"prompt",name:"prompt",ref:a,value:t,onChange:d,minH:40,onKeyDown:m,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsxs(Sg,{children:[r.jsx(uc,{isOpen:h,onOpen:p}),n==="sdxl"&&r.jsx(bH,{}),r.jsx(vH,{})]}),r.jsx(Cg,{label:l("parameters.positivePromptPlaceholder")}),s&&r.jsx(mH,{prompt:t,presetPrompt:(o==null?void 0:o.preset_data.positive_prompt)||"",label:`${l("parameters.positivePromptPlaceholder")} (${l("stylePresets.preview")})`})]})})});xH.displayName="ParamPositivePrompt";const CH=u.memo(()=>{var f;const e=z(),t=I(qee),n=u.useRef(null),{t:s}=M(),i=u.useCallback(p=>{e(Kee(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=wd({prompt:t,textareaRef:n,onChange:i});return r.jsx(dc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(Qn,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Sg,{children:r.jsx(uc,{isOpen:a,onOpen:c})}),r.jsx(Cg,{label:s("sdxl.negStylePrompt")})]})})});CH.displayName="ParamSDXLNegativeStylePrompt";const SH=u.memo(()=>{var f;const e=z(),t=I(Zee),n=u.useRef(null),{t:s}=M(),i=u.useCallback(p=>{e(Yee(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=wd({prompt:t,textareaRef:n,onChange:i});return r.jsx(dc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(Qn,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Sg,{children:r.jsx(uc,{isOpen:a,onOpen:c})}),r.jsx(Cg,{label:s("sdxl.posStylePrompt")})]})})});SH.displayName="ParamSDXLPositiveStylePrompt";const v_e=Xee(e=>{var s;const t=((s=e.model)==null?void 0:s.base)==="sdxl",n=e.shouldConcatPrompts;return t&&!n}),h_=u.memo(()=>{const e=I(v_e),t=I(ji);return r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(xH,{}),e&&r.jsx(SH,{}),!t&&r.jsx(yH,{}),e&&r.jsx(CH,{})]})});h_.displayName="Prompts";const b_e=()=>{const e=I(aP),t=I(lP),n=z(),{t:s}=M(),i=u.useCallback(o=>n(Qee(o)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGRescaleMultiplier",children:r.jsx(te,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i,marks:!0}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i})]})},x_e=u.memo(b_e),C_e=()=>{const e=z(),{t}=M(),n=I(Jee),[s,{isLoading:i}]=oc(),o=u.useCallback(h=>{h&&e(ete(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Ja({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},S_e=u.memo(C_e),w_e=()=>{const e=z(),{t}=M(),n=I(tte),[s,{isLoading:i}]=oc(),o=u.useCallback(h=>{h&&e(nte(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Ja({modelConfigs:s.filter(h=>FM(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipGEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},j_e=u.memo(w_e),k_e=()=>{const e=z(),{t}=M(),n=I(ste),[s,{isLoading:i}]=oc(),o=u.useCallback(h=>{h&&e(rte(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Ja({modelConfigs:s.filter(h=>BM(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipLEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},__e=u.memo(k_e),I_e=()=>{const e=I(ite),t=I(ote),n=I(Ap),s=z(),{t:i}=M(),o=u.useCallback(c=>{s(ate(c))},[s]),a=u.useMemo(()=>n?Og[n.base].maxClip:Og["sd-1"].maxClip,[n]),l=u.useMemo(()=>n?Og[n.base].markers:Og["sd-1"].markers,[n]);return(n==null?void 0:n.base)==="sdxl"?null:r.jsxs(Z,{children:[r.jsx(Ve,{feature:"clipSkip",children:r.jsx(te,{children:i("parameters.clipSkip")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:l}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},A_e=u.memo(I_e),T_e=()=>{const e=z(),{t}=M(),n=I(lte),[s,{isLoading:i}]=pj(),o=u.useCallback(h=>{h&&e(cte(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Ja({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.t5Encoder")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},u8=u.memo(T_e),E_e=()=>{const{t:e}=M(),t=I(ute),n=z(),s=u.useCallback(i=>{n(dte(i.target.checked))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"seamlessTilingXAxis",children:r.jsx(te,{children:e("parameters.seamlessXAxis")})}),r.jsx(at,{isChecked:t,onChange:s})]})},M_e=u.memo(E_e),P_e=()=>{const{t:e}=M(),t=I(hte),n=z(),s=u.useCallback(i=>{n(fte(i.target.checked))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"seamlessTilingYAxis",children:r.jsx(te,{children:e("parameters.seamlessYAxis")})}),r.jsx(at,{isChecked:t,onChange:s})]})},L_e=u.memo(P_e),f_=u.memo(()=>{const e=I(pte),t=I(sw),{t:n}=M(),s=z(),i=u.useCallback(o=>s(cP(o)),[s]);return r.jsxs(Z,{flexGrow:1,children:[r.jsx(Ve,{feature:"paramSeed",children:r.jsx(te,{children:n("parameters.seed")})}),r.jsx(Ae,{step:1,min:uP,max:Zu,isDisabled:t,onChange:i,value:e,flexGrow:1,defaultValue:0})]})});f_.displayName="ParamSeedNumberInput";const p_=u.memo(()=>{const e=z(),{t}=M(),n=I(sw),s=u.useCallback(i=>e(gte(i.target.checked)),[e]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("common.random")}),r.jsx(at,{isChecked:n,onChange:s})]})});p_.displayName="ParamSeedRandomize";const D_e=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),g_=u.memo(()=>{const e=z(),t=I(sw),{t:n}=M(),s=u.useCallback(()=>e(cP(D_e(uP,Zu))),[e]);return r.jsx(ye,{size:"sm",isDisabled:t,onClick:s,leftIcon:r.jsx(Vae,{}),flexShrink:0,children:n("parameters.shuffle")})});g_.displayName="ParamSeedShuffle";const R_e=()=>{const e=z(),{t}=M(),n=I(mte),[s,{isLoading:i}]=_7(),o=u.useCallback(h=>{h&&e(yte(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=hn({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{m:0,children:t("modelManager.vae")})}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},O_e=u.memo(R_e),N_e=()=>{const e=z(),{t}=M(),n=I(Yl),s=I(dP),[i,{isLoading:o}]=Xy(),a=u.useCallback(p=>{const g=n===p.base;return!!!n||!g},[n]),l=u.useCallback(p=>{e(vte(p?Ei.parse(p):null))},[e]),{options:c,value:d,onChange:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:l,selectedModel:s,isLoading:o,getIsDisabled:a});return r.jsxs(Z,{isDisabled:!c.length,isInvalid:!c.length,minW:0,flexGrow:1,children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{m:0,children:t("modelManager.vae")})}),r.jsx(Fe,{isClearable:!0,value:d,placeholder:d?d.value:t("models.defaultVAE"),options:c,onChange:h,noOptionsMessage:f})]})},F_e=u.memo(N_e),d8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],B_e=()=>{const{t:e}=M(),t=z(),n=I(hP),s=u.useCallback(o=>{fP(o==null?void 0:o.value)&&t(bte(o.value))},[t]),i=u.useMemo(()=>d8.find(o=>o.value===n),[n]);return r.jsxs(Z,{flexGrow:0,children:[r.jsx(Ve,{feature:"paramVAEPrecision",children:r.jsx(te,{m:0,children:e("modelManager.vaePrecision")})}),r.jsx(Fe,{value:i,options:d8,onChange:s})]})},$_e=u.memo(B_e),Ad=e=>{const t=z(),n=u.useMemo(()=>pe(Fu,o=>o.accordions[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(xte({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:i}},V_e={minW:"9.2rem"},G_e={flexGrow:1},m_=u.memo(()=>{const e=I(Cte),{currentData:t}=Tp(e??ws),n=I(En),s=I(ji),i=I(Jl),o=u.useMemo(()=>tn([Bu,ji],(h,f)=>{const p=[];if(f){if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}}else{if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}else h.vaePrecision==="fp16"&&p.push(`VAE ${h.vaePrecision}`);h.clipSkip&&p.push(`Skip ${h.clipSkip}`),h.cfgRescaleMultiplier&&p.push(`Rescale ${h.cfgRescaleMultiplier}`),(h.seamlessXAxis||h.seamlessYAxis)&&p.push("seamless"),n==="upscaling"&&!h.shouldRandomizeSeed&&p.push("Manual Seed")}return p}),[t,n]),a=I(o),{t:l}=M(),{isOpen:c,onToggle:d}=Ad({id:`'advanced-settings-${n}`,defaultIsOpen:!1});return r.jsx(Xu,{label:l("accordions.advanced.title"),badges:a,isOpen:c,onToggle:d,children:r.jsxs(A,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[r.jsxs(A,{gap:4,w:"full",children:[s?r.jsx(O_e,{}):r.jsx(F_e,{}),!s&&!i&&r.jsx($_e,{})]}),n==="upscaling"?r.jsxs(A,{gap:4,alignItems:"center",children:[r.jsx(f_,{}),r.jsx(g_,{}),r.jsx(p_,{})]}):r.jsxs(r.Fragment,{children:[!s&&!i&&r.jsxs(r.Fragment,{children:[r.jsxs(fs,{formLabelProps:V_e,children:[r.jsx(A_e,{}),r.jsx(x_e,{})]}),r.jsx(A,{gap:4,w:"full",children:r.jsxs(fs,{formLabelProps:G_e,children:[r.jsx(M_e,{}),r.jsx(L_e,{})]})})]}),s&&r.jsxs(fs,{children:[r.jsx(u8,{}),r.jsx(S_e,{})]}),i&&r.jsxs(fs,{children:[r.jsx(u8,{}),r.jsx(__e,{}),r.jsx(j_e,{})]})]})]})})});m_.displayName="AdvancedSettingsAccordion";const z_e=()=>{const e=z(),t=I(Ste),n=I(wte),{t:s}=M(),i=u.useCallback(o=>{e(jte(o))},[e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceEdgeSize",children:r.jsx(te,{children:s("parameters.coherenceEdgeSize")})}),r.jsx(Ze,{min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i,marks:!0}),r.jsx(Ae,{min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i})]})},H_e=u.memo(z_e),W_e=()=>{const e=z(),t=I(kte),{t:n}=M(),s=u.useCallback(i=>{e(_te(i))},[e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceMinDenoise",children:r.jsx(te,{children:n("parameters.coherenceMinDenoise")})}),r.jsx(Ze,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),r.jsx(Ae,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},U_e=u.memo(W_e),q_e=()=>{const e=z(),t=I(Ite),{t:n}=M(),s=u.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),i=u.useCallback(a=>{Ate(a==null?void 0:a.value)&&e(Tte(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===t),[t,s]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceMode",children:r.jsx(te,{children:n("parameters.coherenceMode")})}),r.jsx(Fe,{options:s,value:o,onChange:i})]})},K_e=u.memo(q_e),Z_e=()=>{const{t:e}=M(),t=z(),n=I(Ete),s=I(Mte),i=u.useCallback(o=>{t(Pte(o))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingMaskBlur",children:r.jsx(te,{children:e("parameters.maskBlur")})}),r.jsx(Ze,{value:n,onChange:i,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,step:s.coarseStep,fineStep:s.fineStep,marks:!0}),r.jsx(Ae,{value:n,onChange:i,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},Y_e=u.memo(Z_e),X_e=()=>{const{t:e}=M(),t=z(),n=I(Dp),{data:s}=pP(),i=u.useMemo(()=>s?s.infill_methods.map(l=>({label:l,value:l})):[],[s]),o=u.useCallback(l=>{!l||!i.find(c=>c.value===l.value)||t(Lte(l.value))},[t,i]),a=u.useMemo(()=>i.find(l=>l.value===n),[i,n]);return r.jsxs(Z,{isDisabled:i.length===0,children:[r.jsx(Ve,{feature:"infillMethod",children:r.jsx(te,{children:e("parameters.infillMethod")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})},Q_e=u.memo(X_e),J_e=()=>{const e=z(),t=I(Dte),n=I(Dp),{t:s}=M(),i=u.useCallback(o=>{e(Rte(o))},[e]);return r.jsx(A,{flexDir:"column",gap:4,children:r.jsxs(Z,{isDisabled:n!=="color",children:[r.jsx(te,{children:s("parameters.infillColorValue")}),r.jsx(Se,{w:"full",pt:2,pb:2,children:r.jsx(RF,{color:t,onChange:i})})]})})},e4e=u.memo(J_e),t4e=()=>{const e=z(),t=I(Dp),n=I(Ote),s=I(Nte),{t:i}=M(),o=u.useCallback(a=>{e(Fte(a))},[e]);return r.jsxs(Z,{isDisabled:t!=="patchmatch",children:[r.jsx(Ve,{feature:"patchmatchDownScaleSize",children:r.jsx(te,{children:i("parameters.patchmatchDownScaleSize")})}),r.jsx(Ze,{value:n,onChange:o,marks:!0,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep}),r.jsx(Ae,{value:n,onChange:o,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},n4e=u.memo(t4e),s4e=()=>{const e=z(),t=I(Bte),n=I($te),s=I(Dp),{t:i}=M(),o=u.useCallback(a=>{e(Vte(a))},[e]);return r.jsxs(Z,{isDisabled:s!=="tile",children:[r.jsx(te,{children:i("parameters.tileSize")}),r.jsx(Ze,{value:t,onChange:o,defaultValue:n.initial,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,marks:!0}),r.jsx(Ae,{value:t,onChange:o,defaultValue:n.initial,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep})]})},r4e=u.memo(s4e),i4e=()=>{const e=I(Dp);return e==="tile"?r.jsx(r4e,{}):e==="patchmatch"?r.jsx(n4e,{}):e==="color"?r.jsx(e4e,{}):null},o4e=u.memo(i4e),h8={minW:"4.5rem"},wH=u.memo(()=>{const{t:e}=M(),{isOpen:t,onToggle:n}=Ad({id:"compositing-settings",defaultIsOpen:!1});return r.jsx(Xu,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:r.jsxs(ec,{variant:"collapse",children:[r.jsxs(tc,{children:[r.jsx(Sn,{children:e("accordions.compositing.coherenceTab")}),r.jsx(Sn,{children:e("accordions.compositing.infillTab")})]}),r.jsxs(Vu,{children:[r.jsx(Ln,{children:r.jsx(A,{gap:4,p:4,flexDir:"column",children:r.jsxs(fs,{formLabelProps:h8,children:[r.jsx(K_e,{}),r.jsx(H_e,{}),r.jsx(U_e,{}),r.jsx(Y_e,{})]})})}),r.jsx(Ln,{children:r.jsx(A,{gap:4,p:4,flexDir:"column",children:r.jsxs(fs,{formLabelProps:h8,children:[r.jsx(Q_e,{}),r.jsx(o4e,{})]})})})]})]})})});wH.displayName="CompositingSettingsAccordion";const a4e=[-1,0,1,2],jH=u.memo(e=>{const{lora:t}=e,n=z(),{data:s}=Tp(t.model.key),i=u.useCallback(l=>{n(Gte({id:t.id,weight:l}))},[n,t.id]),o=u.useCallback(()=>{n(zte({id:t.id,isEnabled:!t.isEnabled}))},[n,t.id,t.isEnabled]),a=u.useCallback(()=>{n(Hte({id:t.id}))},[n,t.id]);return r.jsxs(Wte,{variant:"lora",children:[r.jsx(Ute,{children:r.jsxs(A,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[r.jsx(q,{noOfLines:1,wordBreak:"break-all",color:t.isEnabled?"base.200":"base.500",children:(s==null?void 0:s.name)??t.model.key.substring(0,8)}),r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(at,{size:"sm",onChange:o,isChecked:t.isEnabled}),r.jsx(oe,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:a,icon:r.jsx(ei,{})})]})]})}),r.jsx(Ve,{feature:"loraWeight",children:r.jsxs(qte,{children:[r.jsx(Ze,{value:t.weight,onChange:i,min:-1,max:2,step:.01,marks:a4e,defaultValue:.75,isDisabled:!t.isEnabled}),r.jsx(Ae,{value:t.weight,onChange:i,min:-10,max:10,step:.01,w:20,flexShrink:0,defaultValue:.75,isDisabled:!t.isEnabled})]})})]})});jH.displayName="LoRACard";const l4e=tn(rw,e=>e.loras),kH=u.memo(()=>{const e=I(l4e);return e.length?r.jsx(A,{flexWrap:"wrap",gap:2,children:e.map(t=>r.jsx(jH,{lora:t},t.id))}):null});kH.displayName="LoRAList";const c4e=pe(rw,e=>e.loras),u4e=()=>{const e=z(),[t,{isLoading:n}]=Yy(),{t:s}=M(),i=I(c4e),o=I(Yl),a=p=>{const g=o===p.base,m=!!i.find(b=>b.model.key===p.key);return!!!o||!g||m},l=u.useCallback(p=>{p&&e(Kte({model:p}))},[e]),{options:c,onChange:d}=hn({modelConfigs:t,getIsDisabled:a,onChange:l}),h=u.useMemo(()=>n?s("common.loading"):c.length===0?s("models.noLoRAsInstalled"):s("models.addLora"),[n,c.length,s]),f=u.useCallback(()=>s("models.noMatchingLoRAs"),[s]);return r.jsxs(Z,{isDisabled:!c.length,children:[r.jsx(Ve,{feature:"lora",children:r.jsxs(te,{children:[s("models.concepts")," "]})}),r.jsx(Fe,{placeholder:h,value:null,options:c,noOptionsMessage:f,onChange:d,"data-testid":"add-lora",sx:h4e})]})},d4e=u.memo(u4e),h4e={w:"full"},f4e=()=>{const e=I(gP),t=I(my),n=z(),{t:s}=M(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(Zte(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},p4e=u.memo(f4e),g4e=()=>{const e=I(mP),t=I(yP),n=z(),{t:s}=M(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax-(t.sliderMax-t.sliderMin)/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(Yte(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramGuidance",children:r.jsx(te,{children:s("parameters.guidance")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},m4e=u.memo(g4e),y4e=()=>{const e=z(),{t}=M(),n=I(vP),s=u.useCallback(o=>{Pp(o==null?void 0:o.value)&&e(Xte(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Fe,{value:i,options:ho,onChange:s})]})},v4e=u.memo(y4e),b4e=()=>{const e=I(bP),t=I(iw),n=z(),{t:s}=M(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>{n(Qte(a))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramSteps",children:r.jsx(te,{children:s("parameters.steps")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},x4e=u.memo(b4e),_H=u.memo(e=>{const{t}=M(),n=z(),s=I(XS),i=u.useCallback(()=>{n(Kt("models"))},[n]);return s?null:r.jsx(oe,{icon:r.jsx(nd,{}),tooltip:`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,"aria-label":`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,onClick:i,size:"sm",variant:"ghost",...e})});_H.displayName="NavigateToModelManagerButton";function C4e(e){return ue({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const S4e=()=>{const e=z(),{t}=M(),n=I(En),s=I(xP),[i,{isLoading:o}]=Ky(),a=u.useMemo(()=>{if(!i||s===null)return null;const b=i.find(C=>C.key===s);return b||null},[i,s]),l=u.useMemo(()=>{var b;if(!(!i.length||!a))return(b=i.find(C=>C.key===(a==null?void 0:a.key)))==null?void 0:b.description},[i,a]),c=u.useCallback(b=>{if(b)try{e(Jte(Ei.parse(b)))}catch{}},[e]),d=u.useCallback(b=>n==="upscaling"&&b.base==="flux",[n]),{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}=hn({modelConfigs:i,selectedModel:a,onChange:c,isLoading:o,getIsDisabled:d}),y=u.useMemo(()=>a&&ene(a)&&a.config_path==="flux-dev",[a]);return r.jsxs(Z,{isDisabled:!i.length,isInvalid:!f||!i.length,children:[r.jsxs(A,{alignItems:"center",children:[r.jsx(Ve,{feature:"paramModel",children:r.jsx(te,{children:t("modelManager.model")})}),y?r.jsx(Ve,{feature:"fluxDevLicense",hideDisable:!0,children:r.jsx(A,{justifyContent:"flex-start",children:r.jsx(dt,{as:C4e})})}):r.jsx(rt,{})]}),r.jsx(De,{label:l,children:r.jsx(Se,{w:"full",minW:0,children:r.jsx(Fe,{value:f,placeholder:g,options:h,onChange:p,noOptionsMessage:m,isInvalid:f==null?void 0:f.isDisabled})})})]})},w4e=u.memo(S4e),j4e=()=>{const e=I(Ap),{t}=M(),n=z(),{data:s}=xp(),i=I(vP),o=I(bP),a=I(dP),l=I(hP),c=I(ow),d=I(aw),h=I(mP),f=I(gP),p=I(aP),g=u.useMemo(()=>!s||e===null?null:Va.selectById(s,e.key),[s,e]),m=u.useMemo(()=>{const x=g&&d0(g)&&g.default_settings;return x&&Object.values(x).some(S=>!!S)},[g]),y=u.useMemo(()=>g&&d0(g)&&g.default_settings?g.default_settings:tne,[g]),b=u.useMemo(()=>{const x=[];if(m){const{vae:S,vae_precision:w,cfg_scale:j,cfg_rescale_multiplier:P,steps:T,scheduler:L,width:E,height:O,guidance:F}=y;!qe(S)&&a&&S!==a.key&&x.push(t("modelManager.vae")),!qe(S)&&!a&&S!=="default"&&x.push(t("modelManager.vae")),!qe(w)&&w!==l&&x.push(t("modelManager.vaePrecision")),!qe(j)&&j!==f&&x.push(t("parameters.cfgScale")),!qe(P)&&P!==p&&x.push(t("parameters.cfgRescaleMultiplier")),!qe(T)&&T!==o&&x.push(t("parameters.steps")),!qe(L)&&L!==i&&x.push(t("parameters.scheduler")),!qe(E)&&E!==c&&x.push(t("parameters.width")),!qe(O)&&O!==d&&x.push(t("parameters.height")),!qe(F)&&F!==h&&x.push(t("parameters.guidance"))}return x},[m,a,l,f,p,o,i,c,d,h,t,y]),C=u.useMemo(()=>e?m?b.length===0?t("modelManager.usingDefaultSettings"):r.jsxs(A,{direction:"column",gap:2,children:[r.jsx(q,{children:t("modelManager.defaultSettingsOutOfSync")}),r.jsx(Pi,{children:b.map(x=>r.jsx(Vt,{children:x},x))}),r.jsx(q,{children:t("modelManager.restoreDefaultSettings")})]}):t("modelManager.noDefaultSettings"):t("modelManager.noModelSelected"),[e,m,b,t]),v=u.useCallback(()=>{n(nne())},[n]);return r.jsx(oe,{icon:r.jsx(Dy,{}),tooltip:C,"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e||!m||b.length===0,onClick:v,size:"sm",variant:"ghost",colorScheme:"warning"})},k4e=()=>{const e=I(sne),t=I(my),n=z(),{t:s}=M(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(rne(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},_4e=u.memo(k4e),I4e=()=>{const e=z(),{t}=M(),n=I(ine),s=u.useCallback(o=>{Pp(o==null?void 0:o.value)&&e(one(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Fe,{value:i,options:ho,onChange:s})]})},A4e=u.memo(I4e),y_=e=>{const t=z(),n=u.useMemo(()=>pe(Fu,o=>o.expanders[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(ane({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:i}},T4e=()=>{const e=I(xP),{currentData:t}=Tp(e??ws);return t},E4e={minW:"4rem"},v_=u.memo(()=>{const{t:e}=M(),t=T4e(),n=I(En),s=I(ji),i=I(Jl),o=u.useMemo(()=>n==="upscaling",[n]),a=u.useMemo(()=>tn(rw,g=>{const m=g.loras.filter(C=>C.isEnabled).length,y=m?[`${m} ${e("models.concepts")}`]:xs,b=t?[t.name,t.base]:xs;return{loraTabBadges:y,accordionBadges:b}}),[t,e]),{loraTabBadges:l,accordionBadges:c}=I(a),{isOpen:d,onToggle:h}=y_({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:f,onToggle:p}=Ad({id:`generation-settings-${n}`,defaultIsOpen:n!=="upscaling"});return r.jsx(Xu,{label:e("accordions.generation.title"),badges:[...c,...l],isOpen:f,onToggle:p,children:r.jsxs(Se,{px:4,pt:4,"data-testid":"generation-accordion",children:[r.jsxs(A,{gap:4,flexDir:"column",children:[r.jsxs(A,{gap:4,alignItems:"center",children:[r.jsx(w4e,{}),r.jsxs(A,{children:[r.jsx(j4e,{}),r.jsx(_H,{})]})]}),r.jsxs(A,{gap:4,flexDir:"column",children:[r.jsx(d4e,{}),r.jsx(kH,{})]})]}),r.jsx(lw,{label:e("accordions.advanced.options"),isOpen:d,onToggle:h,children:r.jsx(A,{gap:4,flexDir:"column",pb:4,children:r.jsxs(fs,{formLabelProps:E4e,children:[!s&&!i&&!o&&r.jsx(v4e,{}),o&&r.jsx(A4e,{}),r.jsx(x4e,{}),s&&r.jsx(m4e,{}),o&&r.jsx(_4e,{}),!s&&!o&&r.jsx(p4e,{})]})})})]})})});v_.displayName="GenerationSettingsAccordion";const IH=u.memo(()=>{const e=I(lne),t=z(),n=u.useCallback(i=>{t(cne(i.target.checked))},[t]),{t:s}=M();return r.jsxs(Z,{w:"min-content",children:[r.jsx(Ve,{feature:"optimizedDenoising",children:r.jsxs(te,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),r.jsx(at,{isChecked:e,onChange:n})]})});IH.displayName="ParamOptimizedDenoisingToggle";const M4e=pe(et,e=>e.bbox.scaleMethod==="manual"),P4e=pe(et,e=>e.bbox.scaledSize.height),L4e=pe(Ar,e=>e.sd.scaledBoundingBoxHeight),D4e=()=>{const{t:e}=M(),t=z(),n=I(On),s=I(Rp),i=I(M4e),o=I(P4e),a=I(L4e),l=I(wp),c=u.useCallback(d=>{t(une(d))},[t]);return r.jsxs(Z,{isDisabled:!i||n,children:[r.jsx(te,{children:e("parameters.scaledHeight")}),r.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,marks:!0,defaultValue:s}),r.jsx(Ae,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},R4e=u.memo(D4e),O4e=pe(et,e=>e.bbox.scaleMethod==="manual"),N4e=pe(et,e=>e.bbox.scaledSize.width),F4e=pe(Ar,e=>e.sd.scaledBoundingBoxWidth),B4e=()=>{const{t:e}=M(),t=z(),n=I(On),s=I(Rp),i=I(O4e),o=I(N4e),a=I(F4e),l=I(wp),c=u.useCallback(d=>{t(dne(d))},[t]);return r.jsxs(Z,{isDisabled:!i||n,children:[r.jsx(te,{children:e("parameters.scaledWidth")}),r.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s,marks:!0}),r.jsx(Ae,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},$4e=u.memo(B4e),V4e=pe(et,e=>e.bbox.scaleMethod),G4e=()=>{const e=z(),{t}=M(),n=I(V4e),s=I(On),i=u.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),o=u.useCallback(l=>{hne(l==null?void 0:l.value)&&e(fne(l.value))},[e]),a=u.useMemo(()=>i.find(l=>l.value===n),[n,i]);return r.jsxs(Z,{isDisabled:s,children:[r.jsx(Ve,{feature:"scaleBeforeProcessing",children:r.jsx(te,{children:t("parameters.scaleBeforeProcessing")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})},z4e=u.memo(G4e),AH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(pne),s=I(On),i=u.useCallback(a=>{!a||!gne(a.value)||t(mne({id:a.value}))},[t]),o=u.useMemo(()=>D4.filter(a=>a.value===n)[0],[n]);return r.jsxs(Z,{isDisabled:s,children:[r.jsx(Ve,{feature:"paramAspect",children:r.jsx(te,{children:e("parameters.aspect")})}),r.jsx(Fe,{value:o,onChange:i,options:D4,sx:H4e})]})});AH.displayName="BboxAspectRatioSelect";const H4e={minW:24},TH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Rp),s=I(aw),i=I(CP),o=I(On),a=I(wp),l=u.useCallback(d=>{t(yne({height:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,n,i.sliderMax],[i.sliderMin,i.sliderMax,n]);return r.jsxs(Z,{isDisabled:o,children:[r.jsx(Ve,{feature:"paramHeight",children:r.jsx(te,{children:e("parameters.height")})}),r.jsx(Ze,{value:s,defaultValue:n,onChange:l,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ae,{value:s,defaultValue:n,onChange:l,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});TH.displayName="BboxHeight";const W4e=pe(et,e=>e.bbox.aspectRatio.isLocked),EH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(W4e),s=I(On),i=u.useCallback(()=>{t(vne())},[t]);return r.jsx(oe,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:i,variant:n?"outline":"ghost",size:"sm",icon:n?r.jsx(eD,{}):r.jsx(zL,{}),isDisabled:s})});EH.displayName="BboxLockAspectRatioButton";const MH=u.memo(()=>{const e=I(ow),t=I(aw),n=I(bne),[s,i]=g$(),o=u.useMemo(()=>{if(!i)return{width:0,height:0};let a=e,l=t;return e>t?(a=i.width,l=a/n):(l=i.height,a=l*n),{width:a,height:l}},[i,e,t,n]);return r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:r.jsx(A,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${o.width}px`,height:`${o.height}px`,alignItems:"center",justifyContent:"center",children:r.jsxs(Xr,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"}),r.jsx(Dt,{bg:"base.800"})]})})})});MH.displayName="BboxPreview";const U4e=pe(et,e=>e.bbox.rect.width),q4e=pe(et,e=>e.bbox.rect.height),PH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(On),s=I(U4e),i=I(q4e),o=I(Rp),a=u.useMemo(()=>xne(s,i,o),[i,s,o]),l=u.useMemo(()=>Cne(s,i,o),[i,s,o]),c=u.useCallback(()=>{t(Sne())},[t]),d=u.useMemo(()=>e(a?"parameters.setToOptimalSizeTooSmall":l?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[l,a,e]);return r.jsx(oe,{tooltip:d,"aria-label":e("parameters.setToOptimalSize"),onClick:c,variant:"ghost",size:"sm",icon:r.jsx(Dy,{}),colorScheme:a||l?"warning":"base",isDisabled:n})});PH.displayName="BboxSetOptimalSizeButton";const LH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(On),s=u.useCallback(()=>{t(wne())},[t]);return r.jsx(oe,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:r.jsx(cae,{}),isDisabled:n})});LH.displayName="BboxSwapDimensionsButton";const DH=u.memo(()=>{const{t:e}=M(),t=z(),n=I(ow),s=I(Rp),i=I(SP),o=I(On),a=I(wp),l=u.useCallback(d=>{t(jne({width:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,s,i.sliderMax],[i.sliderMax,i.sliderMin,s]);return r.jsxs(Z,{isDisabled:o,children:[r.jsx(Ve,{feature:"paramWidth",children:r.jsx(te,{children:e("parameters.width")})}),r.jsx(Ze,{value:n,onChange:l,defaultValue:s,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ae,{value:n,onChange:l,defaultValue:s,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});DH.displayName="BboxWidth";const RH=u.memo(()=>r.jsxs(A,{gap:4,alignItems:"center",children:[r.jsx(A,{gap:4,flexDirection:"column",width:"full",children:r.jsxs(fs,{formLabelProps:K4e,children:[r.jsxs(A,{gap:4,children:[r.jsx(AH,{}),r.jsx(LH,{}),r.jsx(EH,{}),r.jsx(PH,{})]}),r.jsx(DH,{}),r.jsx(TH,{})]})}),r.jsx(A,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:r.jsx(MH,{})})]}));RH.displayName="BboxSettings";const K4e={minW:10},Z4e=tn([et,Bu],(e,t)=>{const{shouldRandomizeSeed:n}=t,s=[],{aspectRatio:i}=e.bbox,{width:o,height:a}=e.bbox.rect;if(s.push(`${o}${a}`),s.push(i.id),i.isLocked&&s.push("locked"),n||s.push("Manual Seed"),s.length===0)return xs}),Y4e={minW:"4.5rem"},OH=u.memo(()=>{const{t:e}=M(),t=I(Z4e),n=I(RE),{isOpen:s,onToggle:i}=Ad({id:"image-settings",defaultIsOpen:!0}),{isOpen:o,onToggle:a}=y_({id:"image-settings-advanced",defaultIsOpen:!1}),l=I(ji),c=I(Jl);return r.jsx(Xu,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:i,children:r.jsxs(A,{px:4,pt:4,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[r.jsx(RH,{}),r.jsxs(A,{py:3,gap:4,alignItems:"center",children:[r.jsx(f_,{}),r.jsx(g_,{}),r.jsx(p_,{})]}),r.jsx(lw,{label:e("accordions.advanced.options"),isOpen:o,onToggle:a,children:r.jsxs(A,{gap:4,pb:4,flexDir:"column",children:[(l||c)&&r.jsx(IH,{}),r.jsx(z4e,{}),n!=="none"&&r.jsxs(fs,{formLabelProps:Y4e,children:[r.jsx($4e,{}),r.jsx(R4e,{})]})]})})]})})});OH.displayName="ImageSettingsAccordion";const X4e=()=>{const{t:e}=M(),t=z(),n=I(kne),s=I(my),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>t(_ne(a)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerCfgScale",children:r.jsx(te,{children:e("sdxl.cfgScale")})}),r.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},Q4e=u.memo(X4e),J4e=e=>e.base==="sdxl-refiner",e5e=()=>{const e=z(),t=I(Ine),{t:n}=M(),[s,{isLoading:i}]=Zy(),o=u.useCallback(p=>{if(!p){e(R4(null));return}e(R4(Ei.parse(p)))},[e]),{options:a,value:l,onChange:c,placeholder:d,noOptionsMessage:h}=Ja({modelConfigs:s,onChange:o,selectedModel:t,isLoading:i,optionsFilter:J4e}),f=u.useCallback(()=>{o(null)},[o]);return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,w:"full",children:[r.jsx(Ve,{feature:"refinerModel",children:r.jsx(te,{children:n("sdxl.refinermodel")})}),r.jsxs(A,{w:"full",minW:0,gap:2,alignItems:"center",children:[r.jsx(Fe,{value:l,placeholder:d,options:a,onChange:c,noOptionsMessage:h}),r.jsx(oe,{size:"sm",variant:"ghost",icon:r.jsx(Nt,{}),"aria-label":n("common.reset"),onClick:f,isDisabled:!l})]})]})},t5e=u.memo(e5e),n5e=()=>{const e=I(Ane),t=z(),{t:n}=M(),s=u.useCallback(i=>t(Tne(i)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerNegativeAestheticScore",children:r.jsx(te,{children:n("sdxl.negAestheticScore")})}),r.jsx(Ze,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),r.jsx(Ae,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},s5e=u.memo(n5e),r5e=()=>{const e=I(Ene),t=z(),{t:n}=M(),s=u.useCallback(i=>t(Mne(i)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerPositiveAestheticScore",children:r.jsx(te,{children:n("sdxl.posAestheticScore")})}),r.jsx(Ze,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),r.jsx(Ae,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},i5e=u.memo(r5e),o5e=()=>{const e=z(),{t}=M(),n=I(Pne),s=u.useCallback(o=>{Pp(o==null?void 0:o.value)&&e(Lne(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerScheduler",children:r.jsx(te,{children:t("sdxl.scheduler")})}),r.jsx(Fe,{value:i,options:ho,onChange:s})]})},a5e=u.memo(o5e),l5e=()=>{const e=I(Dne),t=z(),n=u.useCallback(i=>t(Rne(i)),[t]),{t:s}=M();return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerStart",children:r.jsx(te,{children:s("sdxl.refinerStart")})}),r.jsx(Ze,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),r.jsx(Ae,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},c5e=u.memo(l5e),u5e=()=>{const{t:e}=M(),t=z(),n=I(One),s=I(iw),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>{t(Nne(a))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerSteps",children:r.jsx(te,{children:e("sdxl.steps")})}),r.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},d5e=u.memo(u5e),h5e=()=>{const[e]=Zy();return!!e.length},f5e={minW:"9.2rem"},p5e={minW:"5rem"},g5e=tn(Bu,e=>e.refinerModel?["Enabled"]:void 0),NH=u.memo(()=>{const{t:e}=M(),t=h5e(),n=I(g5e),{isOpen:s,onToggle:i}=Ad({id:"refiner-settings",defaultIsOpen:!1});return r.jsx(Xu,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:i,children:t?r.jsx(BH,{}):r.jsx(FH,{})})});NH.displayName="RefinerSettingsAccordion";const FH=u.memo(()=>{const{t:e}=M();return r.jsx(A,{justifyContent:"center",p:4,children:r.jsx(q,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});FH.displayName="RefinerSettingsAccordionNoRefiner";const BH=u.memo(()=>{const e=I(Fne);return r.jsx(fs,{isDisabled:!e,children:r.jsxs(A,{p:4,gap:4,flexDir:"column",minW:0,children:[r.jsx(t5e,{}),r.jsxs(fs,{formLabelProps:p5e,isDisabled:!e,children:[r.jsx(a5e,{}),r.jsx(d5e,{}),r.jsx(Q4e,{}),r.jsx(c5e,{})]}),r.jsxs(fs,{formLabelProps:f5e,isDisabled:!e,children:[r.jsx(i5e,{}),r.jsx(s5e,{})]})]})})});BH.displayName="RefinerSettingsAccordionContent";const m5e={svg:{animation:gy}},y5e=()=>{const[e,{isLoading:t}]=Bne(),{t:n}=M(),{presetCount:s}=Lp(void 0,{selectFromResult:({data:o})=>({presetCount:((o==null?void 0:o.filter(l=>l.type!=="default"))??xs).length})}),i=u.useCallback(async()=>{let o;try{const a=await e().unwrap();o=new Blob([a],{type:"text/csv"})}catch{ve({status:"error",title:n("stylePresets.exportFailed")});return}if(o){const a=window.URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download="data.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),ve({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return r.jsx(oe,{onClick:i,icon:t?r.jsx(oD,{}):r.jsx(ed,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?m5e:void 0,isDisabled:t||s===0})},v5e={svg:{animation:gy}},b5e=()=>{const[e,{isLoading:t}]=$ne(),{t:n}=M(),s=u.useCallback(a=>{const l=a[0];l&&e(l).unwrap().then(()=>{ve({status:"success",title:n("toast.importSuccessful")})}).catch(c=>{ve({status:"error",title:n("toast.importFailed"),description:c?`${c.data.detail}`:void 0})})},[e,n]),{getInputProps:i,getRootProps:o}=Ya({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{icon:t?r.jsx(oD,{}):r.jsx(Py,{}),tooltip:r.jsx(x5e,{}),"aria-label":n("stylePresets.importTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?v5e:void 0,isDisabled:t,...o()}),r.jsx("input",{...i()})]})},x5e=()=>{const{t:e}=M();return r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),r.jsx(q,{children:e("stylePresets.acceptedColumnsKeys")}),r.jsxs(Pi,{children:[r.jsx(Vt,{children:e("stylePresets.nameColumn")}),r.jsx(Vt,{children:e("stylePresets.positivePromptColumn")}),r.jsx(Vt,{children:e("stylePresets.negativePromptColumn")})]})]})},C5e=()=>{const e=u.useCallback(()=>{Oa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=M();return r.jsx(oe,{icon:r.jsx(Gt,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e,size:"md",variant:"ghost",w:8,h:8})},Td=u.memo,_c="40px",S5e="24px",w5e=({presetImageUrl:e,imageWidth:t})=>r.jsx(De,{closeOnScroll:!0,openDelay:0,label:e&&r.jsx(dn,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:r.jsx(dn,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:r.jsx(A,{height:t||_c,minWidth:t||_c,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(dt,{color:"base.500",as:iD,boxSize:t?t/2:S5e})}),objectFit:"cover",objectPosition:"50% 50%",height:t||_c,width:t||_c,minHeight:t||_c,minWidth:t||_c,borderRadius:"base"})}),$H=Td(w5e),j5e=({preset:e})=>{const t=z(),n=I(lp),{t:s}=M(),i=ahe(),o=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;Oa.set({prefilledFormData:{name:h,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),a=u.useCallback(()=>{t(l0(e.id)),Mf.set(!1)},[t,e.id]),l=u.useCallback(d=>{d.stopPropagation(),i(e)},[i,e]),c=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;Oa.set({prefilledFormData:{name:`${h} (${s("common.copy")})`,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,s]);return r.jsxs(A,{gap:4,onClick:a,cursor:"pointer",_hover:{backgroundColor:"base.750"},py:3,px:2,borderRadius:"base",alignItems:"flex-start",w:"full",children:[r.jsx($H,{presetImageUrl:e.image}),r.jsxs(A,{flexDir:"column",w:"full",children:[r.jsxs(A,{w:"full",justifyContent:"space-between",alignItems:"flex-start",children:[r.jsxs(A,{alignItems:"center",gap:2,children:[r.jsx(q,{fontSize:"md",noOfLines:2,children:e.name}),n===e.id&&r.jsx(is,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:s("stylePresets.active")})]}),r.jsxs(A,{alignItems:"center",gap:1,children:[r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.copyTemplate"),onClick:c,icon:r.jsx(an,{})}),e.type!=="default"&&r.jsxs(r.Fragment,{children:[r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.editTemplate"),onClick:o,icon:r.jsx(My,{})}),r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.deleteTemplate"),onClick:l,colorScheme:"error",icon:r.jsx(Lw,{})})]})]})]}),r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsxs(q,{fontSize:"xs",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[s("stylePresets.positivePrompt"),":"]})," ",e.preset_data.positive_prompt]}),r.jsxs(q,{fontSize:"xs",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[s("stylePresets.negativePrompt"),":"]})," ",e.preset_data.negative_prompt]})]})]})]})},kx=({title:e,data:t})=>{const{t:n}=M(),{onToggle:s,isOpen:i}=ir({defaultIsOpen:!0}),o=I(cw);return r.jsxs(A,{flexDir:"column",children:[r.jsx(ye,{variant:"unstyled",onClick:s,children:r.jsxs(A,{gap:2,alignItems:"center",children:[r.jsx(dt,{boxSize:4,as:ii,transform:i?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),r.jsx(rc,{in:i,style:vv,children:t.length?t.map(a=>r.jsx(j5e,{preset:a},a.id)):r.jsx(Ot,{fontSize:"sm",py:4,label:n(o?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},k5e=()=>{const e=z(),t=I(cw),{t:n}=M(),s=u.useCallback(l=>{e(O4(l))},[e]),i=u.useCallback(()=>{e(O4(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(Jo,{children:[r.jsx(jt,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:o,onChange:a}),t&&t.length&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})},_5e=u.memo(k5e),VH=()=>{const e=I(cw),t=I(SE),{data:n}=Lp(void 0,{selectFromResult:({data:i})=>({data:((i==null?void 0:i.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())))||xs).reduce((l,c)=>(c.type==="default"?l.defaultPresets.push(c):c.type==="project"?l.sharedPresets.push(c):l.presets.push(c),l),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:s}=M();return r.jsxs(A,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[r.jsxs(A,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[r.jsx(_5e,{}),r.jsx(C5e,{}),r.jsx(b5e,{}),r.jsx(y5e,{})]}),r.jsx(kx,{title:s("stylePresets.myTemplates"),data:n.presets}),t&&r.jsx(kx,{title:s("stylePresets.sharedTemplates"),data:n.sharedPresets}),r.jsx(kx,{title:s("stylePresets.defaultTemplates"),data:n.defaultPresets})]})},I5e=()=>{const e=I(nw),t=I(lp),{activeStylePreset:n}=Lp(void 0,{selectFromResult:({data:h})=>{let f=null;return h&&(f=h.find(p=>p.id===t)),{activeStylePreset:f}}}),s=z(),{t:i}=M(),{presetModifiedPositivePrompt:o,presetModifiedNegativePrompt:a}=Vne(),l=u.useCallback(h=>{h.stopPropagation(),s(Om(!1)),s(l0(null))},[s]),c=u.useCallback(h=>{h.stopPropagation(),s(oP(o)),s(iP(a)),s(Om(!1)),s(l0(null))},[s,o,a]),d=u.useCallback(h=>{h.stopPropagation(),s(Om(!e))},[s,e]);return n?r.jsxs(A,{w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx($H,{imageWidth:25,presetImageUrl:n.image}),r.jsx(is,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),r.jsx(rt,{}),r.jsx(De,{label:i("stylePresets.toggleViewMode"),children:r.jsx(oe,{onClick:d,variant:"outline",size:"sm","aria-label":i("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:r.jsx($p,{})})}),r.jsx(De,{label:i("stylePresets.flatten"),children:r.jsx(oe,{onClick:c,variant:"outline",size:"sm","aria-label":i("stylePresets.flatten"),icon:r.jsx(XL,{})})}),r.jsx(De,{label:i("stylePresets.clearTemplateSelection"),children:r.jsx(oe,{onClick:l,variant:"outline",size:"sm","aria-label":i("stylePresets.clearTemplateSelection"),icon:r.jsx(Nt,{})})})]}):r.jsx(A,{h:25,alignItems:"center",children:r.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:i("stylePresets.choosePromptTemplate")})})},A5e={bg:"base.750"},GH=()=>{const e=ce(Mf),{t}=M(),n=u.useCallback(()=>{Mf.set(!e)},[e]);return r.jsxs(A,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:A5e,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[r.jsx(I5e,{}),r.jsx(oe,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:r.jsx(ii,{}),size:"sm"})]})},f8={height:"100%",width:"100%"},T5e=()=>{const e=I(Gne),t=ce(Mf);return r.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(GH,{}),r.jsx(A,{w:"full",h:"full",position:"relative",children:r.jsxs(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[t&&r.jsx(Ns,{defer:!0,style:f8,options:Bl.options,children:r.jsx(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(VH,{})})}),r.jsx(Ns,{defer:!0,style:f8,options:Bl.options,children:r.jsxs(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(h_,{}),r.jsx(OH,{}),r.jsx(v_,{}),r.jsx(wH,{}),e&&r.jsx(NH,{}),r.jsx(m_,{})]})})]})})]})},E5e=u.memo(T5e),M5e={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf"},P5e={diffusers:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base"},L5e=({format:e})=>r.jsx(is,{flexGrow:0,colorScheme:P5e[e],variant:"subtle",children:M5e[e]}),D5e=u.memo(L5e),Ro="40px",R5e="24px",O5e=({image_url:e})=>e?r.jsx(dn,{src:e,objectFit:"cover",objectPosition:"50% 50%",height:Ro,width:Ro,minHeight:Ro,minWidth:Ro,borderRadius:"base"}):r.jsx(A,{height:Ro,minWidth:Ro,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(dt,{color:"base.500",as:iD,boxSize:R5e})}),N5e=Td(O5e),F5e={_hover:{bg:"base.700"},"&[aria-selected='true']":{bg:"base.700"}},B5e=({model:e})=>{const{t}=M(),n=z(),s=u.useMemo(()=>pe(zne,p=>p.selectedModelKey===e.key),[e.key]),i=I(s),[o]=Hne(),{isOpen:a,onOpen:l,onClose:c}=ir(),d=u.useCallback(()=>{n(h2(e.key))},[e.key,n]),h=u.useCallback(p=>{p.stopPropagation(),l()},[l]),f=u.useCallback(()=>{o({key:e.key}).unwrap().then(p=>{ve({id:"MODEL_DELETED",title:`${t("modelManager.modelDeleted")}: ${e.name}`,status:"success"})}).catch(p=>{p&&ve({id:"MODEL_DELETE_FAILED",title:`${t("modelManager.modelDeleteFailed")}: ${e.name}`,status:"error"})}),n(h2(null))},[o,e,n,t]);return r.jsxs(A,{sx:F5e,"aria-selected":i,justifyContent:"flex-start",p:2,borderRadius:"base",w:"full",alignItems:"center",gap:2,cursor:"pointer",onClick:d,children:[r.jsxs(A,{gap:2,w:"full",h:"full",minW:0,children:[r.jsx(N5e,{image_url:e.cover_image}),r.jsxs(A,{gap:1,alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[r.jsxs(A,{gap:2,w:"full",alignItems:"flex-start",children:[r.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(rt,{})]}),r.jsx(q,{variant:"subtext",noOfLines:1,children:e.description||"No Description"})]}),r.jsxs(A,{h:Ro,flexDir:"column",alignItems:"flex-end",justifyContent:"space-between",gap:2,children:[r.jsx(KR,{base:e.base}),r.jsx(D5e,{format:e.format})]})]}),r.jsx(oe,{onClick:h,icon:r.jsx(ei,{size:16}),"aria-label":t("modelManager.deleteConfig"),colorScheme:"error",h:Ro,w:Ro}),r.jsx(Tr,{isOpen:a,onClose:c,title:t("modelManager.deleteModel"),acceptCallback:f,acceptButtonText:t("modelManager.delete"),useInert:!1,children:r.jsxs(A,{rowGap:4,flexDirection:"column",children:[r.jsx(q,{fontWeight:"bold",children:t("modelManager.deleteMsg1")}),r.jsx(q,{children:t("modelManager.deleteMsg2")})]})})]})},$5e=u.memo(B5e),Hs=u.memo(e=>{const{title:t,modelList:n}=e;return r.jsx(Wi,{title:t,contentSx:{gap:1,p:2},children:n.map(s=>r.jsx($5e,{model:s},s.key))})});Hs.displayName="ModelListWrapper";const V5e=()=>{const e=I(wP),t=I(jP),{t:n}=M(),[s,{isLoading:i}]=Ky(),o=u.useMemo(()=>lr(s,t,e),[s,t,e]),[a,{isLoading:l}]=Zy(),c=u.useMemo(()=>lr(a,t,e),[a,t,e]),[d,{isLoading:h}]=Yy(),f=u.useMemo(()=>lr(d,t,e),[d,t,e]),[p,{isLoading:g}]=k7(),m=u.useMemo(()=>lr(p,t,e),[p,t,e]),[y,{isLoading:b}]=fj(),C=u.useMemo(()=>lr(y,t,e),[y,t,e]),[v,{isLoading:x}]=j7(),S=u.useMemo(()=>lr(v,t,e),[v,t,e]),[w,{isLoading:j}]=gj(),P=u.useMemo(()=>lr(w,t,e),[w,t,e]),[T,{isLoading:L}]=Xde(),E=u.useMemo(()=>lr(T,t,e),[T,t,e]),[O,{isLoading:F}]=Xy({excludeSubmodels:!0}),_=u.useMemo(()=>lr(O,t,e),[O,t,e]),[R,{isLoading:D}]=pj({excludeSubmodels:!0}),$=u.useMemo(()=>lr(R,t,e),[R,t,e]),[G,{isLoading:ee}]=w7(),Q=u.useMemo(()=>lr(G,t,e),[G,t,e]),[se,{isLoading:ne}]=oc({excludeSubmodels:!0}),H=u.useMemo(()=>lr(se,t,e),[se,t,e]),[V,{isLoading:Y}]=Zp(),W=u.useMemo(()=>lr(V,t,e),[V,t,e]),J=u.useMemo(()=>o.length+c.length+f.length+m.length+C.length+S.length+P.length+E.length+_.length+W.length+R.length+se.length+G.length,[C.length,m.length,P.length,E.length,f.length,o.length,c.length,S.length,_.length,W.length,R.length,se.length,G.length]);return r.jsx($n,{children:r.jsxs(A,{flexDirection:"column",w:"full",h:"full",gap:4,children:[i&&r.jsx(As,{loadingMessage:"Loading Main Models..."}),!i&&o.length>0&&r.jsx(Hs,{title:n("modelManager.main"),modelList:o},"main"),l&&r.jsx(As,{loadingMessage:"Loading Refiner Models..."}),!l&&c.length>0&&r.jsx(Hs,{title:n("sdxl.refiner"),modelList:c},"refiner"),h&&r.jsx(As,{loadingMessage:"Loading LoRAs..."}),!h&&f.length>0&&r.jsx(Hs,{title:n("modelManager.loraModels"),modelList:f},"loras"),g&&r.jsx(As,{loadingMessage:"Loading Textual Inversions..."}),!g&&m.length>0&&r.jsx(Hs,{title:n("modelManager.textualInversions"),modelList:m},"textual-inversions"),F&&r.jsx(As,{loadingMessage:"Loading VAEs..."}),!F&&_.length>0&&r.jsx(Hs,{title:"VAE",modelList:_},"vae"),b&&r.jsx(As,{loadingMessage:"Loading ControlNets..."}),!b&&C.length>0&&r.jsx(Hs,{title:"ControlNet",modelList:C},"controlnets"),j&&r.jsx(As,{loadingMessage:"Loading IP Adapters..."}),!j&&P.length>0&&r.jsx(Hs,{title:n("common.ipAdapter"),modelList:P},"ip-adapters"),L&&r.jsx(As,{loadingMessage:"Loading CLIP Vision Models..."}),!L&&E.length>0&&r.jsx(Hs,{title:"CLIP Vision",modelList:E},"clip-vision"),x&&r.jsx(As,{loadingMessage:"Loading T2I Adapters..."}),!x&&S.length>0&&r.jsx(Hs,{title:n("common.t2iAdapter"),modelList:S},"t2i-adapters"),D&&r.jsx(As,{loadingMessage:"Loading T5 Encoder Models..."}),!D&&$.length>0&&r.jsx(Hs,{title:n("modelManager.t5Encoder"),modelList:$},"t5-encoder"),ee&&r.jsx(As,{loadingMessage:"Loading Control Loras..."}),!ee&&Q.length>0&&r.jsx(Hs,{title:n("modelManager.controlLora"),modelList:Q},"control-lora"),ne&&r.jsx(As,{loadingMessage:"Loading Clip Embed Models..."}),!ne&&H.length>0&&r.jsx(Hs,{title:n("modelManager.clipEmbed"),modelList:H},"clip-embed"),Y&&r.jsx(As,{loadingMessage:"Loading Image-to-Image Models..."}),!Y&&W.length>0&&r.jsx(Hs,{title:n("modelManager.spandrelImageToImage"),modelList:W},"spandrel-image-to-image"),J===0&&r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{children:n("modelManager.noMatchingModels")})})]})})},G5e=u.memo(V5e),lr=(e,t,n)=>e.filter(s=>{const i=s.name.toLowerCase().includes(t.toLowerCase()),o=z5e(s,n);return i&&o}),z5e=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,zH=u.memo(()=>{const{t:e}=M(),t=z(),n=u.useMemo(()=>({main:e("modelManager.main"),refiner:e("sdxl.refiner"),lora:"LoRA",embedding:e("modelManager.textualInversions"),controlnet:"ControlNet",vae:"VAE",t2i_adapter:e("common.t2iAdapter"),t5_encoder:e("modelManager.t5Encoder"),clip_embed:e("modelManager.clipEmbed"),ip_adapter:e("common.ipAdapter"),clip_vision:"CLIP Vision",spandrel_image_to_image:e("modelManager.spandrelImageToImage"),control_lora:e("modelManager.controlLora")}),[e]),s=I(wP),i=u.useCallback(a=>{t(N4(a))},[t]),o=u.useCallback(()=>{t(N4(null))},[t]);return r.jsxs(Yt,{children:[r.jsx(Xt,{as:ye,size:"sm",leftIcon:r.jsx(kae,{}),children:s?n[s]:e("modelManager.allModels")}),r.jsxs(It,{children:[r.jsx(he,{onClick:o,children:e("modelManager.allModels")}),fw(n).map(a=>r.jsx(he,{bg:s===a?"base.700":"transparent",onClick:i.bind(null,a),children:n[a]},a))]})]})});zH.displayName="ModelTypeFilter";const HH=u.memo(()=>{const e=z(),t=I(jP),n=u.useCallback(i=>{e(F4(i.target.value))},[e]),s=u.useCallback(()=>{e(F4(""))},[e]);return r.jsxs(A,{gap:2,alignItems:"center",justifyContent:"space-between",children:[r.jsx(zH,{}),r.jsx(rt,{}),r.jsxs(Jo,{maxW:"400px",children:[r.jsx(jt,{placeholder:Te("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!(t!=null&&t.length)&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":Te("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:s})})]})]})});HH.displayName="ModelListNavigation";const WH=u.memo(()=>{const{t:e}=M(),t=z(),n=u.useCallback(()=>{t(h2(null))},[t]),s=I(Op);return r.jsxs(A,{flexDir:"column",layerStyle:"first",p:4,gap:4,borderRadius:"base",w:"50%",h:"full",children:[r.jsxs(A,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[r.jsx(Rt,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&r.jsx(ye,{size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(Gt,{}),onClick:n,children:e("modelManager.addModels")})]}),r.jsxs(A,{flexDir:"column",layerStyle:"second",p:4,gap:4,borderRadius:"base",w:"full",h:"full",children:[r.jsx(HH,{}),r.jsx(G5e,{})]})]})});WH.displayName="ModelManager";const H5e=({model_key:e,model_image:t})=>{const[n,s]=u.useState(t||null),{t:i}=M(),[o,a]=Wne(),[l]=Une(),c=u.useCallback(p=>{const g=p[0];!g||!e||o({key:e,image:g}).unwrap().then(()=>{s(URL.createObjectURL(g)),ve({id:"MODEL_IMAGE_UPDATED",title:i("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{ve({id:"MODEL_IMAGE_UPDATE_FAILED",title:i("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,i,o]),d=u.useCallback(()=>{e&&(s(null),l(e).unwrap().then(()=>{ve({id:"MODEL_IMAGE_DELETED",title:i("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{ve({id:"MODEL_IMAGE_DELETE_FAILED",title:i("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,i,l]),{getInputProps:h,getRootProps:f}=Ya({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,noDrag:!0,multiple:!1});return n?r.jsxs(Se,{position:"relative",flexShrink:0,children:[r.jsx(dn,{src:n,objectFit:"cover",objectPosition:"50% 50%",height:108,width:108,minWidth:108,borderRadius:"base"}),r.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:d,"aria-label":i("modelManager.deleteModelImage"),tooltip:i("modelManager.deleteModelImage"),icon:r.jsx(Di,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(oe,{variant:"ghost","aria-label":i("modelManager.uploadImage"),tooltip:i("modelManager.uploadImage"),w:108,h:108,fontSize:36,icon:r.jsx(Gp,{}),isLoading:a.isLoading,...f()}),r.jsx("input",{...h()})]})},W5e=Td(H5e),b_=u.memo(({modelConfig:e,children:t})=>{const{t:n}=M();return r.jsxs(A,{alignItems:"flex-start",gap:4,children:[r.jsx(W5e,{model_key:e.key,model_image:e.cover_image}),r.jsxs(A,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[r.jsxs(A,{gap:2,children:[r.jsx(Rt,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(rt,{}),t]}),e.source&&r.jsxs(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),r.jsx(q,{noOfLines:3,children:e.description})]})]})});b_.displayName="ModelHeader";const p8=[{value:"sd-1",label:Cc["sd-1"]},{value:"sd-2",label:Cc["sd-2"]},{value:"sd-3",label:Cc["sd-3"]},{value:"flux",label:Cc.flux},{value:"sdxl",label:Cc.sdxl},{value:"sdxl-refiner",label:Cc["sdxl-refiner"]}],U5e=({control:e})=>{const{field:t}=os({control:e,name:"base"}),n=u.useMemo(()=>p8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:p8,onChange:s})},q5e=Td(U5e),g8=[{value:"normal",label:"Normal"},{value:"inpaint",label:"Inpaint"},{value:"depth",label:"Depth"}],K5e=({control:e})=>{const{field:t}=os({control:e,name:"variant"}),n=u.useMemo(()=>g8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:g8,onChange:s})},Z5e=Td(K5e),m8=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],Y5e=({control:e})=>{const{field:t}=os({control:e,name:"prediction_type"}),n=u.useMemo(()=>m8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{(i==null?void 0:i.value)==="none"?t.onChange(void 0):t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:m8,onChange:s})},X5e=Td(Y5e),y8={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},UH=u.memo(({modelConfig:e})=>{var c,d;const{t}=M(),[n,{isLoading:s}]=yy(),i=z(),o=Kp({defaultValues:e,mode:"onChange"}),a=u.useCallback(h=>{const f={key:e.key,body:h};n(f).unwrap().then(p=>{o.reset(p,{keepDefaultValues:!0}),i(f2("view")),ve({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(p=>{o.reset(),ve({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[i,e.key,o,t,n]),l=u.useCallback(()=>{i(f2("view"))},[i]);return r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(b_,{modelConfig:e,children:[r.jsx(ye,{flexShrink:0,size:"sm",onClick:l,leftIcon:r.jsx(Nt,{}),children:t("common.cancel")}),r.jsx(ye,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(Bp,{}),onClick:o.handleSubmit(a),isLoading:s,isDisabled:!!Object.keys(o.formState.errors).length,children:t("common.save")})]}),r.jsx(A,{flexDir:"column",h:"full",children:r.jsxs("form",{children:[r.jsx(A,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!o.formState.errors.name,children:[r.jsx(te,{children:t("modelManager.modelName")}),r.jsx(jt,{...o.register("name",y8),size:"md"}),((c=o.formState.errors.name)==null?void 0:c.message)&&r.jsx(Cp,{children:(d=o.formState.errors.name)==null?void 0:d.message})]})}),r.jsxs(A,{flexDir:"column",gap:3,mt:"4",children:[r.jsx(A,{gap:"4",alignItems:"center",children:r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.description")}),r.jsx(Qn,{...o.register("description"),minH:32})]})}),e.type!=="clip_vision"&&r.jsx(Rt,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),r.jsxs(vy,{columns:2,gap:4,children:[e.type!=="clip_vision"&&r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.baseModel")}),r.jsx(q5e,{control:o.control})]}),e.type==="main"&&r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.variant")}),r.jsx(Z5e,{control:o.control})]}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.pathToConfig")}),r.jsx(jt,{...o.register("config_path",y8)})]}),r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.predictionType")}),r.jsx(X5e,{control:o.control})]}),r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.upcastAttention")}),r.jsx(kn,{...o.register("upcast_attention")})]})]})]})]})]})})]})});UH.displayName="ModelEdit";const Q5e=e=>u.useMemo(()=>{var n,s;return{preprocessor:{isEnabled:!qe((n=e==null?void 0:e.default_settings)==null?void 0:n.preprocessor),value:((s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor)||"none"}}},[e==null?void 0:e.default_settings]),Fi=Ip(e=>{const{field:t}=os(e),n=u.useMemo(()=>!!t.value.isEnabled,[t.value]),s=u.useCallback(i=>{const o={...t.value,isEnabled:i.target.checked};t.onChange(o)},[t]);return r.jsx(at,{size:"sm",isChecked:n,onChange:s})});Fi.displayName="SettingToggle";const v8=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],qH=u.memo(e=>{const{t}=M(),{field:n}=os(e),s=u.useCallback(a=>{if(!a)return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>v8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"controlNetProcessor",children:r.jsx(te,{children:t("controlLayers.filter.filter")})}),r.jsx(Fi,{control:e.control,name:"preprocessor"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:v8,onChange:s})]})});qH.displayName="DefaultPreprocessor";const KH=u.memo(({modelConfig:e})=>{const{t}=M(),n=Q5e(e),[s,{isLoading:i}]=yy(),{handleSubmit:o,control:a,formState:l,reset:c}=Kp({defaultValues:n}),d=u.useCallback(h=>{const f={preprocessor:h.preprocessor.isEnabled?h.preprocessor.value:null};s({key:e.key,body:{default_settings:f}}).unwrap().then(p=>{ve({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),c(h)}).catch(p=>{p&&ve({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${p.data.detail} `,status:"error"})})},[s,e.key,t,c]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Rt,{fontSize:"md",children:t("modelManager.defaultSettings")}),r.jsx(ye,{size:"sm",leftIcon:r.jsx(Bp,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:o(d),isLoading:i,children:t("common.save")})]}),r.jsx(vy,{columns:2,gap:8,children:r.jsx(qH,{control:a,name:"preprocessor"})})]})});KH.displayName="ControlAdapterModelDefaultSettings";const ZH=u.memo(({modelConfig:e})=>{const{t}=M(),[n,{isLoading:s}]=qne(),{isOpen:i,onOpen:o,onClose:a}=ir(),l=u.useCallback(()=>{if(!e||s)return;const c=`CONVERTING_MODEL_${e.key}`;ve({id:c,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{ve({id:c,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{ve({id:c,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(ye,{onClick:o,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:[" ",t("modelManager.convert")]}),r.jsx(Tr,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:l,acceptButtonText:`${t("modelManager.convert")}`,isOpen:i,onClose:a,useInert:!1,children:r.jsxs(A,{flexDirection:"column",rowGap:4,children:[r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),r.jsxs(Pi,{children:[r.jsx(Vt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),r.jsx(Vt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),r.jsx(Vt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),r.jsx(Vt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),r.jsx(Pt,{}),r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});ZH.displayName="ModelConvertButton";const YH=u.memo(()=>{const{t:e}=M(),t=z(),n=u.useCallback(()=>{t(f2("edit"))},[t]);return r.jsx(ye,{size:"sm",leftIcon:r.jsx(My,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});YH.displayName="ModelEditButton";const XH=u.memo(({modelConfig:e})=>{const{t}=M(),[n,s]=u.useState(""),[i,{isLoading:o}]=yy(),a=u.useCallback(p=>{s(p.target.value)},[]),l=u.useMemo(()=>(e==null?void 0:e.trigger_phrases)||[],[e]),c=u.useMemo(()=>{const p=[];return n.length&&l.includes(n)&&p.push("Phrase is already in list"),p},[n,l]),d=u.useCallback(async()=>{!n.length||l.includes(n)||(s(""),await i({key:e.key,body:{trigger_phrases:[...l,n]}}).unwrap())},[n,l,i,e.key]),h=u.useCallback(async p=>{const g=l.filter(m=>m!==p);await i({key:e.key,body:{trigger_phrases:g}}).unwrap()},[l,i,e]),f=u.useCallback(p=>{p.preventDefault(),d()},[d]);return r.jsxs(A,{flexDir:"column",w:"full",gap:"5",children:[r.jsx("form",{onSubmit:f,children:r.jsxs(Z,{w:"full",isInvalid:!!c.length,orientation:"vertical",children:[r.jsx(te,{children:t("modelManager.triggerPhrases")}),r.jsxs(A,{flexDir:"column",w:"full",children:[r.jsxs(A,{gap:"3",alignItems:"center",w:"full",children:[r.jsx(jt,{value:n,onChange:a,placeholder:t("modelManager.typePhraseHere")}),r.jsx(ye,{leftIcon:r.jsx(Gt,{}),size:"sm",onClick:d,isDisabled:!n||!!c.length,isLoading:o,children:t("common.add")})]}),c.map(p=>r.jsx(Cp,{children:p},p))]})]})}),r.jsx(A,{gap:"4",flexWrap:"wrap",children:l.map((p,g)=>r.jsxs(US,{size:"md",py:2,px:4,bg:"base.700",children:[r.jsx(_M,{children:p}),r.jsx(qS,{onClick:h.bind(null,p),isDisabled:o})]},g))})]})});XH.displayName="TriggerPhrases";const J5e=tn(Ar,e=>{const{steps:t,guidance:n,scheduler:s,cfgRescaleMultiplier:i,vaePrecision:o,width:a,height:l}=e.sd,{guidance:c}=e.flux;return{initialSteps:t.initial,initialCfg:n.initial,initialScheduler:s,initialCfgRescaleMultiplier:i.initial,initialVaePrecision:o,initialWidth:a.initial,initialHeight:l.initial,initialGuidance:c.initial}}),eIe=e=>{const{initialSteps:t,initialCfg:n,initialScheduler:s,initialCfgRescaleMultiplier:i,initialVaePrecision:o,initialWidth:a,initialHeight:l,initialGuidance:c}=I(J5e);return u.useMemo(()=>{var h,f,p,g,m,y,b,C,v,x,S,w,j,P,T,L,E,O;return{vae:{isEnabled:!qe((h=e==null?void 0:e.default_settings)==null?void 0:h.vae),value:((f=e==null?void 0:e.default_settings)==null?void 0:f.vae)||"default"},vaePrecision:{isEnabled:!qe((p=e==null?void 0:e.default_settings)==null?void 0:p.vae_precision),value:((g=e==null?void 0:e.default_settings)==null?void 0:g.vae_precision)||o||"fp32"},scheduler:{isEnabled:!qe((m=e==null?void 0:e.default_settings)==null?void 0:m.scheduler),value:((y=e==null?void 0:e.default_settings)==null?void 0:y.scheduler)||s||"dpmpp_3m_k"},steps:{isEnabled:!qe((b=e==null?void 0:e.default_settings)==null?void 0:b.steps),value:((C=e==null?void 0:e.default_settings)==null?void 0:C.steps)||t},cfgScale:{isEnabled:!qe((v=e==null?void 0:e.default_settings)==null?void 0:v.cfg_scale),value:((x=e==null?void 0:e.default_settings)==null?void 0:x.cfg_scale)||n},cfgRescaleMultiplier:{isEnabled:!qe((S=e==null?void 0:e.default_settings)==null?void 0:S.cfg_rescale_multiplier),value:((w=e==null?void 0:e.default_settings)==null?void 0:w.cfg_rescale_multiplier)||i},width:{isEnabled:!qe((j=e==null?void 0:e.default_settings)==null?void 0:j.width),value:((P=e==null?void 0:e.default_settings)==null?void 0:P.width)||a},height:{isEnabled:!qe((T=e==null?void 0:e.default_settings)==null?void 0:T.height),value:((L=e==null?void 0:e.default_settings)==null?void 0:L.height)||l},guidance:{isEnabled:!qe((E=e==null?void 0:e.default_settings)==null?void 0:E.guidance),value:((O=e==null?void 0:e.default_settings)==null?void 0:O.guidance)||c}}},[e,o,s,t,n,i,a,l,c])},QH=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=os({control:e,name:"height"}),s=I(CP),{t:i}=M(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramHeight",children:r.jsx(te,{children:i("parameters.height")})}),r.jsx(Fi,{control:e,name:"height"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ae,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});QH.displayName="DefaultHeight";const JH=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=os({control:e,name:"width"}),s=I(SP),{t:i}=M(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramWidth",children:r.jsx(te,{children:i("parameters.width")})}),r.jsx(Fi,{control:e,name:"width"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ae,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});JH.displayName="DefaultWidth";const eW=u.memo(e=>{const{field:t}=os(e),n=I(lP),{t:s}=M(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramCFGRescaleMultiplier",children:r.jsx(te,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(Fi,{control:e.control,name:"cfgRescaleMultiplier"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});eW.displayName="DefaultCfgRescaleMultiplier";const tW=u.memo(e=>{const{field:t}=os(e),n=I(my),{t:s}=M(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(Fi,{control:e.control,name:"cfgScale"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});tW.displayName="DefaultCfgScale";const nW=u.memo(e=>{const{field:t}=os(e),n=I(yP),{t:s}=M(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax-(n.sliderMax-n.sliderMin)/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramGuidance",children:r.jsx(te,{children:s("parameters.guidance")})}),r.jsx(Fi,{control:e.control,name:"guidance"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});nW.displayName="DefaultGuidance";const sW=u.memo(e=>{const{t}=M(),{field:n}=os(e),s=u.useCallback(a=>{if(!Pp(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>ho.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Fi,{control:e.control,name:"scheduler"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:ho,onChange:s})]})});sW.displayName="DefaultScheduler";const rW=u.memo(e=>{const{field:t}=os(e),n=I(iw),{t:s}=M(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramSteps",children:r.jsx(te,{children:s("parameters.steps")})}),r.jsx(Fi,{control:e.control,name:"steps"})]}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});rW.displayName="DefaultSteps";const iW=u.memo(e=>{const{t}=M(),{field:n}=os(e),s=I(Op),{data:i}=Tp(s??ws),[o]=Xy(),a=u.useMemo(()=>{const h=o.filter(p=>p.base===(i==null?void 0:i.base)).map(p=>({label:p.name,value:p.key}));return[{label:"Default VAE",value:"default"},...h]},[i==null?void 0:i.base,o]),l=u.useCallback(h=>{const f=h!=null&&h.value?h.value:"default",p={...n.value,value:f};n.onChange(p)},[n]),c=u.useMemo(()=>a.find(h=>h.value===n.value.value),[a,n.value]),d=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{children:t("modelManager.vae")})}),r.jsx(Fi,{control:e.control,name:"vae"})]}),r.jsx(Fe,{isDisabled:d,value:c,options:a,onChange:l})]})});iW.displayName="DefaultVae";const b8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],oW=u.memo(e=>{const{t}=M(),{field:n}=os(e),s=u.useCallback(a=>{if(!fP(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>b8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:1,alignItems:"flex-start",children:[r.jsxs(A,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramVAEPrecision",children:r.jsx(te,{children:t("modelManager.vaePrecision")})}),r.jsx(Fi,{control:e.control,name:"vaePrecision"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:b8,onChange:s})]})});oW.displayName="DefaultVaePrecision";const aW=u.memo(({modelConfig:e})=>{const t=I(Op),{t:n}=M(),s=u.useMemo(()=>e.base==="flux",[e]),i=eIe(e),o=u.useMemo(()=>{const g=e==null?void 0:e.base;return sE(g??null)},[e]),[a,{isLoading:l}]=yy(),{handleSubmit:c,control:d,formState:h,reset:f}=Kp({defaultValues:i}),p=u.useCallback(g=>{if(!t)return;const m={vae:g.vae.isEnabled?g.vae.value:null,vae_precision:g.vaePrecision.isEnabled?g.vaePrecision.value:null,cfg_scale:g.cfgScale.isEnabled?g.cfgScale.value:null,cfg_rescale_multiplier:g.cfgRescaleMultiplier.isEnabled?g.cfgRescaleMultiplier.value:null,steps:g.steps.isEnabled?g.steps.value:null,scheduler:g.scheduler.isEnabled?g.scheduler.value:null,width:g.width.isEnabled?g.width.value:null,height:g.height.isEnabled?g.height.value:null,guidance:g.guidance.isEnabled?g.guidance.value:null};a({key:t,body:{default_settings:m}}).unwrap().then(y=>{ve({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),f(g)}).catch(y=>{y&&ve({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${y.data.detail} `,status:"error"})})},[t,f,a,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Rt,{fontSize:"md",children:n("modelManager.defaultSettings")}),r.jsx(ye,{size:"sm",leftIcon:r.jsx(Bp,{}),colorScheme:"invokeYellow",isDisabled:!h.isDirty,onClick:c(p),isLoading:l,children:n("common.save")})]}),r.jsxs(vy,{columns:2,gap:8,children:[r.jsx(iW,{control:d,name:"vae"}),!s&&r.jsx(oW,{control:d,name:"vaePrecision"}),!s&&r.jsx(sW,{control:d,name:"scheduler"}),r.jsx(rW,{control:d,name:"steps"}),s&&r.jsx(nW,{control:d,name:"guidance"}),!s&&r.jsx(tW,{control:d,name:"cfgScale"}),!s&&r.jsx(eW,{control:d,name:"cfgRescaleMultiplier"}),r.jsx(JH,{control:d,optimalDimension:o}),r.jsx(QH,{control:d,optimalDimension:o})]})]})});aW.displayName="MainModelDefaultSettings";const ci=u.memo(({label:e,value:t})=>r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:0,children:[r.jsx(te,{children:e}),r.jsx(q,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));ci.displayName="ModelAttrView";const lW=u.memo(({modelConfig:e})=>{const{t}=M(),n=u.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora"||e.type==="main"||e.type==="lora",[e.base,e.type]);return r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(b_,{modelConfig:e,children:[e.format==="checkpoint"&&e.type==="main"&&r.jsx(ZH,{modelConfig:e}),r.jsx(YH,{})]}),r.jsxs(A,{flexDir:"column",h:"full",gap:4,children:[r.jsx(Se,{layerStyle:"second",borderRadius:"base",p:4,children:r.jsxs(vy,{columns:2,gap:4,children:[r.jsx(ci,{label:t("modelManager.baseModel"),value:e.base}),r.jsx(ci,{label:t("modelManager.modelType"),value:e.type}),r.jsx(ci,{label:t("common.format"),value:e.format}),r.jsx(ci,{label:t("modelManager.path"),value:e.path}),e.type==="main"&&r.jsx(ci,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&r.jsx(ci,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsx(ci,{label:t("modelManager.pathToConfig"),value:e.config_path}),r.jsx(ci,{label:t("modelManager.predictionType"),value:e.prediction_type}),r.jsx(ci,{label:t("modelManager.upcastAttention"),value:`${e.upcast_attention}`})]}),e.type==="ip_adapter"&&e.format==="invokeai"&&r.jsx(ci,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),n&&r.jsxs(Se,{layerStyle:"second",borderRadius:"base",p:4,children:[e.type==="main"&&e.base!=="sdxl-refiner"&&r.jsx(aW,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora")&&r.jsx(KH,{modelConfig:e}),(e.type==="main"||e.type==="lora")&&r.jsx(XH,{modelConfig:e})]})]})]})});lW.displayName="ModelView";const cW=u.memo(()=>{const{t:e}=M(),t=I(Kne),n=I(Op),{data:s,isLoading:i}=xp(),o=u.useMemo(()=>{if(!s||n===null)return null;const a=Va.selectById(s,n);return a||null},[s,n]);return i?r.jsx(Ny,{label:e("common.loading")}):o?t==="view"?r.jsx(lW,{modelConfig:o}):r.jsx(UH,{modelConfig:o}):r.jsx(Ot,{label:e("common.somethingWentWrong"),icon:BL})});cW.displayName="Model";const uW=u.memo(()=>{const e=I(Op);return r.jsx(Se,{layerStyle:"first",p:4,borderRadius:"base",w:"50%",h:"full",children:e?r.jsx(cW,{},e):r.jsx(S7,{})})});uW.displayName="ModelPane";const tIe=()=>r.jsxs(A,{layerStyle:"body",w:"full",h:"full",gap:"2",children:[r.jsx(WH,{}),r.jsx(uW,{})]}),nIe=u.memo(tIe),sIe=()=>{const{t:e}=M(),{data:t}=Np(),n=ce(Wn),[s,{isLoading:i}]=Zne({fixedCacheKey:"clearInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.size)||!n,[t==null?void 0:t.size,n]);return{clearInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ve({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{ve({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},rIe=()=>{const{t:e}=M(),{clearInvocationCache:t,isDisabled:n,isLoading:s}=sIe();return r.jsx(ye,{isDisabled:n,isLoading:s,onClick:t,children:e("invocationCache.clear")})},iIe=u.memo(rIe),oIe=({children:e,...t})=>r.jsx(Yne,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),dW=u.memo(oIe),aIe={'&[aria-disabled="true"]':{color:"base.500"}},lIe=({label:e,value:t,isDisabled:n=!1,...s})=>r.jsxs(Xne,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:aIe,...s,children:[r.jsx(Qne,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),r.jsx(Jne,{children:t})]}),Ui=u.memo(lIe),cIe=()=>{const{t:e}=M(),{data:t}=Np(),n=ce(Wn),[s,{isLoading:i}]=ese({fixedCacheKey:"disableInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{disableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ve({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{ve({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},uIe=()=>{const{t:e}=M(),{data:t}=Np(),n=ce(Wn),[s,{isLoading:i}]=tse({fixedCacheKey:"enableInvocationCache"}),o=u.useMemo(()=>(t==null?void 0:t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{enableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ve({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{ve({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},dIe=()=>{const{t:e}=M(),{data:t}=Np(),{enableInvocationCache:n,isDisabled:s,isLoading:i}=uIe(),{disableInvocationCache:o,isDisabled:a,isLoading:l}=cIe();return t!=null&&t.enabled?r.jsx(ye,{isDisabled:a,isLoading:l,onClick:o,children:e("invocationCache.disable")}):r.jsx(ye,{isDisabled:s,isLoading:i,onClick:n,children:e("invocationCache.enable")})},hIe=u.memo(dIe),fIe=()=>{const{t:e}=M(),{data:t}=Np(void 0);return r.jsxs(dW,{children:[r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.cacheSize"),value:(t==null?void 0:t.size)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.hits"),value:(t==null?void 0:t.hits)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.misses"),value:(t==null?void 0:t.misses)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.maxCacheSize"),value:(t==null?void 0:t.max_size)??0}),r.jsxs(Cs,{w:24,orientation:"vertical",size:"sm",children:[r.jsx(iIe,{}),r.jsx(hIe,{})]})]})},pIe=u.memo(fIe),Mv=0,sl=1,Ed=2,hW=4;function fW(e,t){return n=>e(t(n))}function gIe(e,t){return t(e)}function pW(e,t){return n=>e(t,n)}function x8(e,t){return()=>e(t)}function Pv(e,t){return t(e),e}function ln(...e){return e}function mIe(e){e()}function C8(e){return()=>e}function yIe(...e){return()=>{e.map(mIe)}}function x_(e){return e!==void 0}function hc(){}function zt(e,t){return e(sl,t)}function vt(e,t){e(Mv,t)}function C_(e){e(Ed)}function ms(e){return e(hW)}function Ke(e,t){return zt(e,pW(t,Mv))}function go(e,t){const n=e(sl,s=>{n(),t(s)});return n}function At(){const e=[];return(t,n)=>{switch(t){case Ed:e.splice(0,e.length);return;case sl:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)};case Mv:e.slice().forEach(s=>{s(n)});return;default:throw new Error(`unrecognized action ${t}`)}}}function Ie(e){let t=e;const n=At();return(s,i)=>{switch(s){case sl:i(t);break;case Mv:t=i;break;case hW:return t}return n(s,i)}}function vIe(e){let t,n;const s=()=>t&&t();return function(i,o){switch(i){case sl:return o?n===o?void 0:(s(),n=o,t=zt(e,o),t):(s(),hc);case Ed:s(),n=null;return;default:throw new Error(`unrecognized action ${i}`)}}}function wr(e){return Pv(At(),t=>Ke(e,t))}function ys(e,t){return Pv(Ie(t),n=>Ke(e,n))}function bIe(...e){return t=>e.reduceRight(gIe,t)}function we(e,...t){const n=bIe(...t);return(s,i)=>{switch(s){case sl:return zt(e,n(i));case Ed:C_(e);return}}}function gW(e,t){return e===t}function on(e=gW){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function ot(e){return t=>n=>{e(n)&&t(n)}}function We(e){return t=>fW(t,e)}function qi(e){return t=>()=>t(e)}function Qi(e,t){return n=>s=>n(t=e(t,s))}function Ru(e){return t=>n=>{e>0?e--:t(n)}}function Ea(e){let t=null,n;return s=>i=>{t=i,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function S8(e){let t,n;return s=>i=>{t=i,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function xt(...e){const t=new Array(e.length);let n=0,s=null;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);zt(o,c=>{const d=n;n=n|l,t[a]=c,d!==i&&n===i&&s&&(s(),s=null)})}),o=>a=>{const l=()=>o([a].concat(t));n===i?l():s=l}}function w8(...e){return function(t,n){switch(t){case sl:return yIe(...e.map(s=>zt(s,n)));case Ed:return;default:throw new Error(`unrecognized action ${t}`)}}}function it(e,t=gW){return we(e,on(t))}function Xn(...e){const t=At(),n=new Array(e.length);let s=0;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);zt(o,c=>{n[a]=c,s=s|l,s===i&&vt(t,n)})}),function(o,a){switch(o){case sl:return s===i&&a(n),zt(t,a);case Ed:return C_(t);default:throw new Error(`unrecognized action ${o}`)}}}function Ft(e,t=[],{singleton:n}={singleton:!0}){return{id:xIe(),constructor:e,dependencies:t,singleton:n}}const xIe=()=>Symbol();function CIe(e){const t=new Map,n=({id:s,constructor:i,dependencies:o,singleton:a})=>{if(a&&t.has(s))return t.get(s);const l=i(o.map(c=>n(c)));return a&&t.set(s,l),l};return n(e)}function SIe(e,t){const n={},s={};let i=0;const o=e.length;for(;i<o;)s[e[i]]=1,i+=1;for(const a in t)s.hasOwnProperty(a)||(n[a]=t[a]);return n}const jm=typeof document<"u"?me.useLayoutEffect:me.useEffect;function mW(e,t,n){const s=Object.keys(t.required||{}),i=Object.keys(t.optional||{}),o=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),l=me.createContext({});function c(C,v){C.propsReady&&vt(C.propsReady,!1);for(const x of s){const S=C[t.required[x]];vt(S,v[x])}for(const x of i)if(x in v){const S=C[t.optional[x]];vt(S,v[x])}C.propsReady&&vt(C.propsReady,!0)}function d(C){return o.reduce((v,x)=>(v[x]=S=>{const w=C[t.methods[x]];vt(w,S)},v),{})}function h(C){return a.reduce((v,x)=>(v[x]=vIe(C[t.events[x]]),v),{})}const f=me.forwardRef((C,v)=>{const{children:x,...S}=C,[w]=me.useState(()=>Pv(CIe(e),T=>c(T,S))),[j]=me.useState(x8(h,w));jm(()=>{for(const T of a)T in S&&zt(j[T],S[T]);return()=>{Object.values(j).map(C_)}},[S,j,w]),jm(()=>{c(w,S)}),me.useImperativeHandle(v,C8(d(w)));const P=n;return r.jsx(l.Provider,{value:w,children:n?r.jsx(P,{...SIe([...s,...i,...a],S),children:x}):x})}),p=C=>me.useCallback(pW(vt,me.useContext(l)[C]),[C]),g=C=>{const x=me.useContext(l)[C],S=me.useCallback(w=>zt(x,w),[x]);return me.useSyncExternalStore(S,()=>ms(x),()=>ms(x))},m=C=>{const x=me.useContext(l)[C],[S,w]=me.useState(x8(ms,x));return jm(()=>zt(x,j=>{j!==S&&w(C8(j))}),[x,S]),S},y=me.version.startsWith("18")?g:m;return{Component:f,usePublisher:p,useEmitterValue:y,useEmitter:(C,v)=>{const S=me.useContext(l)[C];jm(()=>zt(S,v),[v,S])}}}const yW=typeof document<"u"?me.useLayoutEffect:me.useEffect;var jr=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(jr||{});const wIe={0:"debug",1:"log",2:"warn",3:"error"},jIe=()=>typeof globalThis>"u"?window:globalThis,rl=Ft(()=>{const e=Ie(3);return{log:Ie((n,s,i=1)=>{var o;const a=(o=jIe().VIRTUOSO_LOG_LEVEL)!=null?o:ms(e);i>=a&&console[wIe[i]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",n,s)}),logLevel:e}},[],{singleton:!0});function S_(e,t,n){const s=me.useRef(null);let i=o=>{};if(typeof ResizeObserver<"u"){const o=me.useMemo(()=>new ResizeObserver(a=>{const l=()=>{const c=a[0].target;c.offsetParent!==null&&e(c)};n?l():requestAnimationFrame(l)}),[e]);i=a=>{a&&t?(o.observe(a),s.current=a):(s.current&&o.unobserve(s.current),s.current=null)}}return{ref:s,callbackRef:i}}function fc(e,t,n){return S_(e,t,n).callbackRef}function kIe(e,t,n,s,i,o,a,l,c){const d=me.useCallback(h=>{const f=_Ie(h.children,t,l?"offsetWidth":"offsetHeight",i);let p=h.parentElement;for(;!p.dataset.virtuosoScroller;)p=p.parentElement;const g=p.lastElementChild.dataset.viewportType==="window",m=a?l?a.scrollLeft:a.scrollTop:g?l?window.pageXOffset||document.documentElement.scrollLeft:window.pageYOffset||document.documentElement.scrollTop:l?p.scrollLeft:p.scrollTop,y=a?l?a.scrollWidth:a.scrollHeight:g?l?document.documentElement.scrollWidth:document.documentElement.scrollHeight:l?p.scrollWidth:p.scrollHeight,b=a?l?a.offsetWidth:a.offsetHeight:g?l?window.innerWidth:window.innerHeight:l?p.offsetWidth:p.offsetHeight;s({scrollTop:Math.max(m,0),scrollHeight:y,viewportHeight:b}),o==null||o(l?j8("column-gap",getComputedStyle(h).columnGap,i):j8("row-gap",getComputedStyle(h).rowGap,i)),f!==null&&e(f)},[e,t,i,o,a,s]);return S_(d,n,c)}function _Ie(e,t,n,s){const i=e.length;if(i===0)return null;const o=[];for(let a=0;a<i;a++){const l=e.item(a);if(!l||l.dataset.index===void 0)continue;const c=parseInt(l.dataset.index),d=parseFloat(l.dataset.knownSize),h=t(l,n);if(h===0&&s("Zero-sized element, this should not happen",{child:l},jr.ERROR),h===d)continue;const f=o[o.length-1];o.length===0||f.size!==h||f.endIndex!==c-1?o.push({startIndex:c,endIndex:c,size:h}):o[o.length-1].endIndex++}return o}function j8(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,jr.WARN),t==="normal"?0:parseInt(t??"0",10)}function $a(e,t){return Math.round(e.getBoundingClientRect()[t])}function vW(e,t){return Math.abs(e-t)<1.01}function bW(e,t,n,s=hc,i,o){const a=me.useRef(null),l=me.useRef(null),c=me.useRef(null),d=me.useCallback(p=>{const g=p.target,m=g===window||g===document,y=o?m?window.pageXOffset||document.documentElement.scrollLeft:g.scrollLeft:m?window.pageYOffset||document.documentElement.scrollTop:g.scrollTop,b=o?m?document.documentElement.scrollWidth:g.scrollWidth:m?document.documentElement.scrollHeight:g.scrollHeight,C=o?m?window.innerWidth:g.offsetWidth:m?window.innerHeight:g.offsetHeight,v=()=>{e({scrollTop:Math.max(y,0),scrollHeight:b,viewportHeight:C})};p.suppressFlushSync?v():kP.flushSync(v),l.current!==null&&(y===l.current||y<=0||y===b-C)&&(l.current=null,t(!0),c.current&&(clearTimeout(c.current),c.current=null))},[e,t]);me.useEffect(()=>{const p=i||a.current;return s(i||a.current),d({target:p,suppressFlushSync:!0}),p.addEventListener("scroll",d,{passive:!0}),()=>{s(null),p.removeEventListener("scroll",d)}},[a,d,n,s,i]);function h(p){const g=a.current;if(!g||(o?"offsetWidth"in g&&g.offsetWidth===0:"offsetHeight"in g&&g.offsetHeight===0))return;const m=p.behavior==="smooth";let y,b,C;g===window?(b=Math.max($a(document.documentElement,o?"width":"height"),o?document.documentElement.scrollWidth:document.documentElement.scrollHeight),y=o?window.innerWidth:window.innerHeight,C=o?document.documentElement.scrollLeft:document.documentElement.scrollTop):(b=g[o?"scrollWidth":"scrollHeight"],y=$a(g,o?"width":"height"),C=g[o?"scrollLeft":"scrollTop"]);const v=b-y;if(p.top=Math.ceil(Math.max(Math.min(v,p.top),0)),vW(y,b)||p.top===C){e({scrollTop:C,scrollHeight:b,viewportHeight:y}),m&&t(!0);return}m?(l.current=p.top,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{c.current=null,l.current=null,t(!0)},1e3)):l.current=null,o&&(p={left:p.top,behavior:p.behavior}),g.scrollTo(p)}function f(p){o&&(p={left:p.top,behavior:p.behavior}),a.current.scrollBy(p)}return{scrollerRef:a,scrollByCallback:f,scrollToCallback:h}}const Bs=Ft(()=>{const e=At(),t=At(),n=Ie(0),s=At(),i=Ie(0),o=At(),a=At(),l=Ie(0),c=Ie(0),d=Ie(0),h=Ie(0),f=At(),p=At(),g=Ie(!1),m=Ie(!1),y=Ie(!1);return Ke(we(e,We(({scrollTop:b})=>b)),t),Ke(we(e,We(({scrollHeight:b})=>b)),a),Ke(t,i),{scrollContainerState:e,scrollTop:t,viewportHeight:o,headerHeight:l,fixedHeaderHeight:c,fixedFooterHeight:d,footerHeight:h,scrollHeight:a,smoothScrollTargetReached:s,horizontalDirection:m,skipAnimationFrameInResizeObserver:y,scrollTo:f,scrollBy:p,statefulScrollTop:i,deviation:n,scrollingInProgress:g}},[],{singleton:!0}),ep={lvl:0};function xW(e,t,n,s=ep,i=ep){return{k:e,v:t,lvl:n,l:s,r:i}}function Zt(e){return e===ep}function gu(){return ep}function qC(e,t){if(Zt(e))return ep;const{k:n,l:s,r:i}=e;if(t===n){if(Zt(s))return i;if(Zt(i))return s;{const[o,a]=CW(s);return e0(zn(e,{k:o,v:a,l:SW(s)}))}}else return t<n?e0(zn(e,{l:qC(s,t)})):e0(zn(e,{r:qC(i,t)}))}function tp(e,t){if(!Zt(e))return t===e.k?e.v:t<e.k?tp(e.l,t):tp(e.r,t)}function Ti(e,t,n="k"){if(Zt(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Ti(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Ti(e.l,t,n)}function br(e,t,n){return Zt(e)?xW(t,n,1):t===e.k?zn(e,{k:t,v:n}):t<e.k?k8(zn(e,{l:br(e.l,t,n)})):k8(zn(e,{r:br(e.r,t,n)}))}function KC(e,t,n){if(Zt(e))return[];const{k:s,v:i,l:o,r:a}=e;let l=[];return s>t&&(l=l.concat(KC(o,t,n))),s>=t&&s<=n&&l.push({k:s,v:i}),s<=n&&(l=l.concat(KC(a,t,n))),l}function kl(e){return Zt(e)?[]:[...kl(e.l),{k:e.k,v:e.v},...kl(e.r)]}function CW(e){return Zt(e.r)?[e.k,e.v]:CW(e.r)}function SW(e){return Zt(e.r)?e.l:e0(zn(e,{r:SW(e.r)}))}function zn(e,t){return xW(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function _x(e){return Zt(e)||e.lvl>e.r.lvl}function k8(e){return ZC(jW(e))}function e0(e){const{l:t,r:n,lvl:s}=e;if(n.lvl>=s-1&&t.lvl>=s-1)return e;if(s>n.lvl+1){if(_x(t))return jW(zn(e,{lvl:s-1}));if(!Zt(t)&&!Zt(t.r))return zn(t.r,{l:zn(t,{r:t.r.l}),r:zn(e,{l:t.r.r,lvl:s-1}),lvl:s});throw new Error("Unexpected empty nodes")}else{if(_x(e))return ZC(zn(e,{lvl:s-1}));if(!Zt(n)&&!Zt(n.l)){const i=n.l,o=_x(i)?n.lvl-1:n.lvl;return zn(i,{l:zn(e,{r:i.l,lvl:s-1}),r:ZC(zn(n,{l:i.r,lvl:o})),lvl:i.lvl+1})}else throw new Error("Unexpected empty nodes")}}function Lv(e,t,n){if(Zt(e))return[];const s=Ti(e,t)[0];return IIe(KC(e,s,n))}function wW(e,t){const n=e.length;if(n===0)return[];let{index:s,value:i}=t(e[0]);const o=[];for(let a=1;a<n;a++){const{index:l,value:c}=t(e[a]);o.push({start:s,end:l-1,value:i}),s=l,i=c}return o.push({start:s,end:1/0,value:i}),o}function IIe(e){return wW(e,({k:t,v:n})=>({index:t,value:n}))}function ZC(e){const{r:t,lvl:n}=e;return!Zt(t)&&!Zt(t.r)&&t.lvl===n&&t.r.lvl===n?zn(t,{l:zn(e,{r:t.l}),lvl:n+1}):e}function jW(e){const{l:t}=e;return!Zt(t)&&t.lvl===e.lvl?zn(t,{r:zn(e,{l:t.r})}):e}function O1(e,t,n,s=0){let i=e.length-1;for(;s<=i;){const o=Math.floor((s+i)/2),a=e[o],l=n(a,t);if(l===0)return o;if(l===-1){if(i-s<2)return o-1;i=o-1}else{if(i===s)return o;s=o+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function kW(e,t,n){return e[O1(e,t,n)]}function AIe(e,t,n,s){const i=O1(e,t,s),o=O1(e,n,s,i);return e.slice(i,o+1)}const w_=Ft(()=>({recalcInProgress:Ie(!1)}),[],{singleton:!0});function TIe(e){const{size:t,startIndex:n,endIndex:s}=e;return i=>i.start===n&&(i.end===s||i.end===1/0)&&i.value===t}function _8(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function EIe(e,t){let n=Zt(e)?0:1/0;for(const s of t){const{size:i,startIndex:o,endIndex:a}=s;if(n=Math.min(n,o),Zt(e)){e=br(e,0,i);continue}const l=Lv(e,o-1,a+1);if(l.some(TIe(s)))continue;let c=!1,d=!1;for(const{start:h,end:f,value:p}of l)c?(a>=h||i===p)&&(e=qC(e,h)):(d=p!==i,c=!0),f>a&&a>=h&&p!==i&&(e=br(e,a+1,p));d&&(e=br(e,o,i))}return[e,n]}function MIe(){return{offsetTree:[],sizeTree:gu(),groupOffsetTree:gu(),lastIndex:0,lastOffset:0,lastSize:0,groupIndices:[]}}function j_({index:e},t){return t===e?0:t<e?-1:1}function PIe({offset:e},t){return t===e?0:t<e?-1:1}function LIe(e){return{index:e.index,value:e}}function DIe(e,t,n,s=0){return s>0&&(t=Math.max(t,kW(e,s,j_).offset)),wW(AIe(e,t,n,PIe),LIe)}function YC(e,t,n,s){let i=e,o=0,a=0,l=0,c=0;if(t!==0){c=O1(i,t-1,j_),l=i[c].offset;const h=Ti(n,t-1);o=h[0],a=h[1],i.length&&i[c].size===Ti(n,t)[1]&&(c-=1),i=i.slice(0,c+1)}else i=[];for(const{start:d,value:h}of Lv(n,t,1/0)){const f=d-o,p=f*a+l+f*s;i.push({offset:p,size:h,index:d}),o=d,l=p,a=h}return{offsetTree:i,lastIndex:o,lastOffset:l,lastSize:a}}function RIe(e,[t,n,s,i]){t.length>0&&s("received item sizes",t,jr.DEBUG);const o=e.sizeTree;let a=o,l=0;if(n.length>0&&Zt(o)&&t.length===2){const p=t[0].size,g=t[1].size;a=n.reduce((m,y)=>br(br(m,y,p),y+1,g),a)}else[a,l]=EIe(a,t);if(a===o)return e;const{offsetTree:c,lastIndex:d,lastSize:h,lastOffset:f}=YC(e.offsetTree,l,a,i);return{sizeTree:a,offsetTree:c,lastIndex:d,lastOffset:f,lastSize:h,groupOffsetTree:n.reduce((p,g)=>br(p,g,np(g,c,i)),gu()),groupIndices:n}}function np(e,t,n){if(t.length===0)return 0;const{offset:s,index:i,size:o}=kW(t,e,j_),a=e-i,l=o*a+(a-1)*n+s;return l>0?l+n:l}function OIe(e){return typeof e.groupIndex<"u"}function _W(e,t,n){if(OIe(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let i=IW(s,t);return i=Math.max(0,i,Math.min(n,i)),i}}function IW(e,t){if(!Dv(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function Dv(e){return!Zt(e.groupOffsetTree)}function NIe(e){return kl(e).map(({k:t,v:n},s,i)=>{const o=i[s+1],a=o?o.k-1:1/0;return{startIndex:t,endIndex:a,size:n}})}const FIe={offsetHeight:"height",offsetWidth:"width"},wo=Ft(([{log:e},{recalcInProgress:t}])=>{const n=At(),s=At(),i=ys(s,0),o=At(),a=At(),l=Ie(0),c=Ie([]),d=Ie(void 0),h=Ie(void 0),f=Ie((w,j)=>$a(w,FIe[j])),p=Ie(void 0),g=Ie(0),m=MIe(),y=ys(we(n,xt(c,e,g),Qi(RIe,m),on()),m),b=ys(we(c,on(),Qi((w,j)=>({prev:w.current,current:j}),{prev:[],current:[]}),We(({prev:w})=>w)),[]);Ke(we(c,ot(w=>w.length>0),xt(y,g),We(([w,j,P])=>{const T=w.reduce((L,E,O)=>br(L,E,np(E,j.offsetTree,P)||O),gu());return{...j,groupIndices:w,groupOffsetTree:T}})),y),Ke(we(s,xt(y),ot(([w,{lastIndex:j}])=>w<j),We(([w,{lastIndex:j,lastSize:P}])=>[{startIndex:w,endIndex:j,size:P}])),n),Ke(d,h);const C=ys(we(d,We(w=>w===void 0)),!0);Ke(we(h,ot(w=>w!==void 0&&Zt(ms(y).sizeTree)),We(w=>[{startIndex:0,endIndex:0,size:w}])),n);const v=wr(we(n,xt(y),Qi(({sizes:w},[j,P])=>({changed:P!==w,sizes:P}),{changed:!1,sizes:m}),We(w=>w.changed)));zt(we(l,Qi((w,j)=>({diff:w.prev-j,prev:j}),{diff:0,prev:0}),We(w=>w.diff)),w=>{const{groupIndices:j}=ms(y);if(w>0)vt(t,!0),vt(o,w+_8(w,j));else if(w<0){const P=ms(b);P.length>0&&(w-=_8(-w,P)),vt(a,w)}}),zt(we(l,xt(e)),([w,j])=>{w<0&&j("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},jr.ERROR)});const x=wr(o);Ke(we(o,xt(y),We(([w,j])=>{const P=j.groupIndices.length>0,T=[],L=j.lastSize;if(P){const E=tp(j.sizeTree,0);let O=0,F=0;for(;O<w;){const D=j.groupIndices[F],$=j.groupIndices.length===F+1?1/0:j.groupIndices[F+1]-D-1;T.push({startIndex:D,endIndex:D,size:E}),T.push({startIndex:D+1,endIndex:D+1+$-1,size:L}),F++,O+=$+1}const _=kl(j.sizeTree);return O!==w&&_.shift(),_.reduce((D,{k:$,v:G})=>{let ee=D.ranges;return D.prevSize!==0&&(ee=[...D.ranges,{startIndex:D.prevIndex,endIndex:$+w-1,size:D.prevSize}]),{ranges:ee,prevIndex:$+w,prevSize:G}},{ranges:T,prevIndex:w,prevSize:0}).ranges}return kl(j.sizeTree).reduce((E,{k:O,v:F})=>({ranges:[...E.ranges,{startIndex:E.prevIndex,endIndex:O+w-1,size:E.prevSize}],prevIndex:O+w,prevSize:F}),{ranges:[],prevIndex:0,prevSize:L}).ranges})),n);const S=wr(we(a,xt(y,g),We(([w,{offsetTree:j},P])=>{const T=-w;return np(T,j,P)})));return Ke(we(a,xt(y,g),We(([w,j,P])=>{if(j.groupIndices.length>0){if(Zt(j.sizeTree))return j;let L=gu();const E=ms(b);let O=0,F=0,_=0;for(;O<-w;){_=E[F];const D=E[F+1]-_-1;F++,O+=D+1}if(L=kl(j.sizeTree).reduce((D,{k:$,v:G})=>br(D,Math.max(0,$+w),G),L),O!==-w){const D=tp(j.sizeTree,_);L=br(L,0,D);const $=Ti(j.sizeTree,-w+1)[1];L=br(L,1,$)}return{...j,sizeTree:L,...YC(j.offsetTree,0,L,P)}}else{const L=kl(j.sizeTree).reduce((E,{k:O,v:F})=>br(E,Math.max(0,O+w),F),gu());return{...j,sizeTree:L,...YC(j.offsetTree,0,L,P)}}})),y),{data:p,totalCount:s,sizeRanges:n,groupIndices:c,defaultItemSize:h,fixedItemSize:d,unshiftWith:o,shiftWith:a,shiftWithOffset:S,beforeUnshiftWith:x,firstItemIndex:l,gap:g,sizes:y,listRefresh:v,statefulTotalCount:i,trackItemSizes:C,itemSize:f}},ln(rl,w_),{singleton:!0}),BIe=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function AW(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!BIe)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const wg=Ft(([{sizes:e,totalCount:t,listRefresh:n,gap:s},{scrollingInProgress:i,viewportHeight:o,scrollTo:a,smoothScrollTargetReached:l,headerHeight:c,footerHeight:d,fixedHeaderHeight:h,fixedFooterHeight:f},{log:p}])=>{const g=At(),m=At(),y=Ie(0);let b=null,C=null,v=null;function x(){b&&(b(),b=null),v&&(v(),v=null),C&&(clearTimeout(C),C=null),vt(i,!1)}return Ke(we(g,xt(e,o,t,y,c,d,p),xt(s,h,f),We(([[S,w,j,P,T,L,E,O],F,_,R])=>{const D=AW(S),{align:$,behavior:G,offset:ee}=D,Q=P-1,se=_W(D,w,Q);let ne=np(se,w.offsetTree,F)+L;$==="end"?(ne+=_+Ti(w.sizeTree,se)[1]-j+R,se===Q&&(ne+=E)):$==="center"?ne+=(_+Ti(w.sizeTree,se)[1]-j+R)/2:ne-=T,ee&&(ne+=ee);const H=V=>{x(),V?(O("retrying to scroll to",{location:S},jr.DEBUG),vt(g,S)):(vt(m,!0),O("list did not change, scroll successful",{},jr.DEBUG))};if(x(),G==="smooth"){let V=!1;v=zt(n,Y=>{V=V||Y}),b=go(l,()=>{H(V)})}else b=go(we(n,$Ie(150)),H);return C=setTimeout(()=>{x()},1200),vt(i,!0),O("scrolling from index to",{index:se,top:ne,behavior:G},jr.DEBUG),{top:ne,behavior:G}})),a),{scrollToIndex:g,scrollTargetReached:m,topListHeight:y}},ln(wo,Bs,rl),{singleton:!0});function $Ie(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}const sp="up",_f="down",VIe="none",GIe={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollTop:0,viewportHeight:0,scrollHeight:0}},zIe=0,jg=Ft(([{scrollContainerState:e,scrollTop:t,viewportHeight:n,headerHeight:s,footerHeight:i,scrollBy:o}])=>{const a=Ie(!1),l=Ie(!0),c=At(),d=At(),h=Ie(4),f=Ie(zIe),p=ys(we(w8(we(it(t),Ru(1),qi(!0)),we(it(t),Ru(1),qi(!1),S8(100))),on()),!1),g=ys(we(w8(we(o,qi(!0)),we(o,qi(!1),S8(200))),on()),!1);Ke(we(Xn(it(t),it(f)),We(([v,x])=>v<=x),on()),l),Ke(we(l,Ea(50)),d);const m=wr(we(Xn(e,it(n),it(s),it(i),it(h)),Qi((v,[{scrollTop:x,scrollHeight:S},w,j,P,T])=>{const L=x+w-S>-T,E={viewportHeight:w,scrollTop:x,scrollHeight:S};if(L){let F,_;return x>v.state.scrollTop?(F="SCROLLED_DOWN",_=v.state.scrollTop-x):(F="SIZE_DECREASED",_=v.state.scrollTop-x||v.scrollTopDelta),{atBottom:!0,state:E,atBottomBecause:F,scrollTopDelta:_}}let O;return E.scrollHeight>v.state.scrollHeight?O="SIZE_INCREASED":w<v.state.viewportHeight?O="VIEWPORT_HEIGHT_DECREASING":x<v.state.scrollTop?O="SCROLLING_UPWARDS":O="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:O,state:E}},GIe),on((v,x)=>v&&v.atBottom===x.atBottom))),y=ys(we(e,Qi((v,{scrollTop:x,scrollHeight:S,viewportHeight:w})=>{if(vW(v.scrollHeight,S))return{scrollTop:x,scrollHeight:S,jump:0,changed:!1};{const j=S-(x+w)<1;return v.scrollTop!==x&&j?{scrollHeight:S,scrollTop:x,jump:v.scrollTop-x,changed:!0}:{scrollHeight:S,scrollTop:x,jump:0,changed:!0}}},{scrollHeight:0,jump:0,scrollTop:0,changed:!1}),ot(v=>v.changed),We(v=>v.jump)),0);Ke(we(m,We(v=>v.atBottom)),a),Ke(we(a,Ea(50)),c);const b=Ie(_f);Ke(we(e,We(({scrollTop:v})=>v),on(),Qi((v,x)=>ms(g)?{direction:v.direction,prevScrollTop:x}:{direction:x<v.prevScrollTop?sp:_f,prevScrollTop:x},{direction:_f,prevScrollTop:0}),We(v=>v.direction)),b),Ke(we(e,Ea(50),qi(VIe)),b);const C=Ie(0);return Ke(we(p,ot(v=>!v),qi(0)),C),Ke(we(t,Ea(100),xt(p),ot(([v,x])=>!!x),Qi(([v,x],[S])=>[x,S],[0,0]),We(([v,x])=>x-v)),C),{isScrolling:p,isAtTop:l,isAtBottom:a,atBottomState:m,atTopStateChange:d,atBottomStateChange:c,scrollDirection:b,atBottomThreshold:h,atTopThreshold:f,scrollVelocity:C,lastJumpDueToItemResize:y}},ln(Bs)),il=Ft(([{log:e}])=>{const t=Ie(!1),n=wr(we(t,ot(s=>s),on()));return zt(t,s=>{s&&ms(e)("props updated",{},jr.DEBUG)}),{propsReady:t,didMount:n}},ln(rl),{singleton:!0});function k_(e,t){e==0?t():requestAnimationFrame(()=>k_(e-1,t))}function __(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const kg=Ft(([{sizes:e,listRefresh:t,defaultItemSize:n},{scrollTop:s},{scrollToIndex:i,scrollTargetReached:o},{didMount:a}])=>{const l=Ie(!0),c=Ie(0),d=Ie(!0);return Ke(we(a,xt(c),ot(([h,f])=>!!f),qi(!1)),l),Ke(we(a,xt(c),ot(([h,f])=>!!f),qi(!1)),d),zt(we(Xn(t,a),xt(l,e,n,d),ot(([[,h],f,{sizeTree:p},g,m])=>h&&(!Zt(p)||x_(g))&&!f&&!m),xt(c)),([,h])=>{go(o,()=>{vt(d,!0)}),k_(4,()=>{go(s,()=>{vt(l,!0)}),vt(i,h)})}),{scrolledToInitialItem:l,initialTopMostItemIndex:c,initialItemFinalLocationReached:d}},ln(wo,Bs,wg,il),{singleton:!0});function I8(e){return e?e==="smooth"?"smooth":"auto":!1}const HIe=(e,t)=>typeof e=="function"?I8(e(t)):t&&I8(e),WIe=Ft(([{totalCount:e,listRefresh:t},{isAtBottom:n,atBottomState:s},{scrollToIndex:i},{scrolledToInitialItem:o},{propsReady:a,didMount:l},{log:c},{scrollingInProgress:d}])=>{const h=Ie(!1),f=At();let p=null;function g(y){vt(i,{index:"LAST",align:"end",behavior:y})}zt(we(Xn(we(it(e),Ru(1)),l),xt(it(h),n,o,d),We(([[y,b],C,v,x,S])=>{let w=b&&x,j="auto";return w&&(j=HIe(C,v||S),w=w&&!!j),{totalCount:y,shouldFollow:w,followOutputBehavior:j}}),ot(({shouldFollow:y})=>y)),({totalCount:y,followOutputBehavior:b})=>{p&&(p(),p=null),p=go(t,()=>{ms(c)("following output to ",{totalCount:y},jr.DEBUG),g(b),p=null})});function m(y){const b=go(s,C=>{y&&!C.atBottom&&C.notAtBottomBecause==="SIZE_INCREASED"&&!p&&(ms(c)("scrolling to bottom due to increased size",{},jr.DEBUG),g("auto"))});setTimeout(b,100)}return zt(we(Xn(it(h),e,a),ot(([y,,b])=>y&&b),Qi(({value:y},[,b])=>({refreshed:y===b,value:b}),{refreshed:!1,value:0}),ot(({refreshed:y})=>y),xt(h,e)),([,y])=>{ms(o)&&m(y!==!1)}),zt(f,()=>{m(ms(h)!==!1)}),zt(Xn(it(h),s),([y,b])=>{y&&!b.atBottom&&b.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&g("auto")}),{followOutput:h,autoscrollToBottom:f}},ln(wo,jg,wg,kg,il,rl,Bs));function UIe(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{totalCount:0,groupIndices:[]})}const TW=Ft(([{totalCount:e,groupIndices:t,sizes:n},{scrollTop:s,headerHeight:i}])=>{const o=At(),a=At(),l=wr(we(o,We(UIe)));return Ke(we(l,We(c=>c.totalCount)),e),Ke(we(l,We(c=>c.groupIndices)),t),Ke(we(Xn(s,n,i),ot(([c,d])=>Dv(d)),We(([c,d,h])=>Ti(d.groupOffsetTree,Math.max(c-h,0),"v")[0]),on(),We(c=>[c])),a),{groupCounts:o,topItemsIndexes:a}},ln(wo,Bs));function rp(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}function EW(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}const N1="top",F1="bottom",A8="none";function T8(e,t,n){return typeof e=="number"?n===sp&&t===N1||n===_f&&t===F1?e:0:n===sp?t===N1?e.main:e.reverse:t===F1?e.main:e.reverse}function E8(e,t){return typeof e=="number"?e:e[t]||0}const I_=Ft(([{scrollTop:e,viewportHeight:t,deviation:n,headerHeight:s,fixedHeaderHeight:i}])=>{const o=At(),a=Ie(0),l=Ie(0),c=Ie(0),d=ys(we(Xn(it(e),it(t),it(s),it(o,rp),it(c),it(a),it(i),it(n),it(l)),We(([h,f,p,[g,m],y,b,C,v,x])=>{const S=h-v,w=b+C,j=Math.max(p-S,0);let P=A8;const T=E8(x,N1),L=E8(x,F1);return g-=v,g+=p+C,m+=p+C,m-=v,g>h+w-T&&(P=sp),m<h-j+f+L&&(P=_f),P!==A8?[Math.max(S-p-T8(y,N1,P)-T,0),S-j-C+f+T8(y,F1,P)+L]:null}),ot(h=>h!=null),on(rp)),[0,0]);return{listBoundary:o,overscan:c,topListHeight:a,increaseViewportBy:l,visibleRange:d}},ln(Bs),{singleton:!0});function qIe(e,t,n){if(Dv(t)){const s=IW(e,t);return[{index:Ti(t.groupOffsetTree,s)[0],size:0,offset:0},{index:s,size:0,offset:0,data:n&&n[0]}]}return[{index:e,size:0,offset:0,data:n&&n[0]}]}const Ix={items:[],topItems:[],offsetTop:0,offsetBottom:0,top:0,bottom:0,topListHeight:0,totalCount:0,firstItemIndex:0};function M8(e,t,n){if(e.length===0)return[];if(!Dv(t))return e.map(d=>({...d,index:d.index+n,originalIndex:d.index}));const s=e[0].index,i=e[e.length-1].index,o=[],a=Lv(t.groupOffsetTree,s,i);let l,c=0;for(const d of e){(!l||l.end<d.index)&&(l=a.shift(),c=t.groupIndices.indexOf(l.start));let h;d.index===l.start?h={type:"group",index:c}:h={index:d.index-(c+1)+n,groupIndex:c},o.push({...h,size:d.size,offset:d.offset,originalIndex:d.index,data:d.data})}return o}function t0(e,t,n,s,i,o){const{lastSize:a,lastOffset:l,lastIndex:c}=i;let d=0,h=0;if(e.length>0){d=e[0].offset;const y=e[e.length-1];h=y.offset+y.size}const f=n-c,p=l+f*a+(f-1)*s,g=d,m=p-h;return{items:M8(e,i,o),topItems:M8(t,i,o),topListHeight:t.reduce((y,b)=>b.size+y,0),offsetTop:d,offsetBottom:m,top:g,bottom:h,totalCount:n,firstItemIndex:o}}function MW(e,t,n,s,i,o){let a=0;if(n.groupIndices.length>0)for(const h of n.groupIndices){if(h-a>=e)break;a++}const l=e+a,c=__(t,l),d=Array.from({length:l}).map((h,f)=>({index:f+c,size:0,offset:0,data:o[f+c]}));return t0(d,[],l,i,n,s)}const pc=Ft(([{sizes:e,totalCount:t,data:n,firstItemIndex:s,gap:i},o,{visibleRange:a,listBoundary:l,topListHeight:c},{scrolledToInitialItem:d,initialTopMostItemIndex:h},{topListHeight:f},p,{didMount:g},{recalcInProgress:m}])=>{const y=Ie([]),b=Ie(0),C=At();Ke(o.topItemsIndexes,y);const v=ys(we(Xn(g,m,it(a,rp),it(t),it(e),it(h),d,it(y),it(s),it(i),n),ot(([j,P,,T,,,,,,,L])=>{const E=L&&L.length!==T;return j&&!P&&!E}),We(([,,[j,P],T,L,E,O,F,_,R,D])=>{const $=L,{sizeTree:G,offsetTree:ee}=$,Q=ms(b);if(T===0)return{...Ix,totalCount:T};if(j===0&&P===0)return Q===0?{...Ix,totalCount:T}:MW(Q,E,L,_,R,D||[]);if(Zt(G))return Q>0?null:t0(qIe(__(E,T),$,D),[],T,R,$,_);const se=[];if(F.length>0){const W=F[0],J=F[F.length-1];let N=0;for(const B of Lv(G,W,J)){const U=B.value,ie=Math.max(B.start,W),de=Math.min(B.end,J);for(let be=ie;be<=de;be++)se.push({index:be,size:U,offset:N,data:D&&D[be]}),N+=U}}if(!O)return t0([],se,T,R,$,_);const ne=F.length>0?F[F.length-1]+1:0,H=DIe(ee,j,P,ne);if(H.length===0)return null;const V=T-1,Y=Pv([],W=>{for(const J of H){const N=J.value;let B=N.offset,U=J.start;const ie=N.size;if(N.offset<j){U+=Math.floor((j-N.offset+R)/(ie+R));const be=U-J.start;B+=be*ie+be*R}U<ne&&(B+=(ne-U)*ie,U=ne);const de=Math.min(J.end,V);for(let be=U;be<=de&&!(B>=P);be++)W.push({index:be,size:ie,offset:B,data:D&&D[be]}),B+=ie+R}});return t0(Y,se,T,R,$,_)}),ot(j=>j!==null),on()),Ix);Ke(we(n,ot(x_),We(j=>j==null?void 0:j.length)),t),Ke(we(v,We(j=>j.topListHeight)),f),Ke(f,c),Ke(we(v,We(j=>[j.top,j.bottom])),l),Ke(we(v,We(j=>j.items)),C);const x=wr(we(v,ot(({items:j})=>j.length>0),xt(t,n),ot(([{items:j},P])=>j[j.length-1].originalIndex===P-1),We(([,j,P])=>[j-1,P]),on(rp),We(([j])=>j))),S=wr(we(v,Ea(200),ot(({items:j,topItems:P})=>j.length>0&&j[0].originalIndex===P.length),We(({items:j})=>j[0].index),on())),w=wr(we(v,ot(({items:j})=>j.length>0),We(({items:j})=>{let P=0,T=j.length-1;for(;j[P].type==="group"&&P<T;)P++;for(;j[T].type==="group"&&T>P;)T--;return{startIndex:j[P].index,endIndex:j[T].index}}),on(EW)));return{listState:v,topItemsIndexes:y,endReached:x,startReached:S,rangeChanged:w,itemsRendered:C,initialItemCount:b,...p}},ln(wo,TW,I_,kg,wg,jg,il,w_),{singleton:!0}),KIe=Ft(([{sizes:e,firstItemIndex:t,data:n,gap:s},{initialTopMostItemIndex:i},{initialItemCount:o,listState:a},{didMount:l}])=>(Ke(we(l,xt(o),ot(([,c])=>c!==0),xt(i,e,t,s,n),We(([[,c],d,h,f,p,g=[]])=>MW(c,d,h,f,p,g))),a),{}),ln(wo,kg,pc,il),{singleton:!0}),PW=Ft(([{scrollVelocity:e}])=>{const t=Ie(!1),n=At(),s=Ie(!1);return Ke(we(e,xt(s,t,n),ot(([i,o])=>!!o),We(([i,o,a,l])=>{const{exit:c,enter:d}=o;if(a){if(c(i,l))return!1}else if(d(i,l))return!0;return a}),on()),t),zt(we(Xn(t,e,n),xt(s)),([[i,o,a],l])=>i&&l&&l.change&&l.change(o,a)),{isSeeking:t,scrollSeekConfiguration:s,scrollVelocity:e,scrollSeekRangeChanged:n}},ln(jg),{singleton:!0}),ZIe=Ft(([{topItemsIndexes:e}])=>{const t=Ie(0);return Ke(we(t,ot(n=>n>0),We(n=>Array.from({length:n}).map((s,i)=>i))),e),{topItemCount:t}},ln(pc)),LW=Ft(([{footerHeight:e,headerHeight:t,fixedHeaderHeight:n,fixedFooterHeight:s},{listState:i}])=>{const o=At(),a=ys(we(Xn(e,s,t,n,i),We(([l,c,d,h,f])=>l+c+d+h+f.offsetBottom+f.bottom)),0);return Ke(it(a),o),{totalListHeight:a,totalListHeightChanged:o}},ln(Bs,pc),{singleton:!0});function DW(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const YIe=DW(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),XIe=Ft(([{scrollBy:e,scrollTop:t,deviation:n,scrollingInProgress:s},{isScrolling:i,isAtBottom:o,scrollDirection:a,lastJumpDueToItemResize:l},{listState:c},{beforeUnshiftWith:d,shiftWithOffset:h,sizes:f,gap:p},{log:g},{recalcInProgress:m}])=>{const y=wr(we(c,xt(l),Qi(([,C,v,x],[{items:S,totalCount:w,bottom:j,offsetBottom:P},T])=>{const L=j+P;let E=0;return v===w&&C.length>0&&S.length>0&&(S[0].originalIndex===0&&C[0].originalIndex===0||(E=L-x,E!==0&&(E+=T))),[E,S,w,L]},[0,[],0,0]),ot(([C])=>C!==0),xt(t,a,s,o,g,m),ot(([,C,v,x,,,S])=>!S&&!x&&C!==0&&v===sp),We(([[C],,,,,v])=>(v("Upward scrolling compensation",{amount:C},jr.DEBUG),C))));function b(C){C>0?(vt(e,{top:-C,behavior:"auto"}),vt(n,0)):(vt(n,0),vt(e,{top:-C,behavior:"auto"}))}return zt(we(y,xt(n,i)),([C,v,x])=>{x&&YIe()?vt(n,v-C):b(-C)}),zt(we(Xn(ys(i,!1),n,m),ot(([C,v,x])=>!C&&!x&&v!==0),We(([C,v])=>v),Ea(1)),b),Ke(we(h,We(C=>({top:-C}))),e),zt(we(d,xt(f,p),We(([C,{lastSize:v,groupIndices:x,sizeTree:S},w])=>{function j(P){return P*(v+w)}if(x.length===0)return j(C);{let P=0;const T=tp(S,0);let L=0,E=0;for(;L<C;){L++,P+=T;let O=x.length===E+1?1/0:x[E+1]-x[E]-1;L+O>C&&(P-=T,O=C-L+1),L+=O,P+=j(O),E++}return P}})),C=>{vt(n,C),requestAnimationFrame(()=>{vt(e,{top:C}),requestAnimationFrame(()=>{vt(n,0),vt(m,!1)})})}),{deviation:n}},ln(Bs,jg,pc,wo,rl,w_)),QIe=Ft(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Ie(0);return zt(we(e,xt(s),ot(([,i])=>i!==0),We(([,i])=>({top:i}))),i=>{go(we(n,Ru(1),ot(o=>o.items.length>1)),()=>{requestAnimationFrame(()=>{vt(t,i)})})}),{initialScrollTop:s}},ln(il,Bs,pc),{singleton:!0}),JIe=Ft(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Ie(!1),s=ys(we(Xn(n,e,t),ot(([i])=>i),We(([,i,o])=>Math.max(0,i-o)),Ea(0),on()),0);return{alignToBottom:n,paddingTopAddition:s}},ln(Bs,LW),{singleton:!0}),A_=Ft(([{scrollTo:e,scrollContainerState:t}])=>{const n=At(),s=At(),i=At(),o=Ie(!1),a=Ie(void 0);return Ke(we(Xn(n,s),We(([{viewportHeight:l,scrollTop:c,scrollHeight:d},{offsetTop:h}])=>({scrollTop:Math.max(0,c-h),scrollHeight:d,viewportHeight:l}))),t),Ke(we(e,xt(s),We(([l,{offsetTop:c}])=>({...l,top:l.top+c}))),i),{useWindowScroll:o,customScrollParent:a,windowScrollContainerState:n,windowViewportRect:s,windowScrollTo:i}},ln(Bs)),e6e=({itemTop:e,itemBottom:t,viewportTop:n,viewportBottom:s,locationParams:{behavior:i,align:o,...a}})=>e<n?{...a,behavior:i,align:o??"start"}:t>s?{...a,behavior:i,align:o??"end"}:null,t6e=Ft(([{sizes:e,totalCount:t,gap:n},{scrollTop:s,viewportHeight:i,headerHeight:o,fixedHeaderHeight:a,fixedFooterHeight:l,scrollingInProgress:c},{scrollToIndex:d}])=>{const h=At();return Ke(we(h,xt(e,i,t,o,a,l,s),xt(n),We(([[f,p,g,m,y,b,C,v],x])=>{const{done:S,behavior:w,align:j,calculateViewLocation:P=e6e,...T}=f,L=_W(f,p,m-1),E=np(L,p.offsetTree,x)+y+b,O=E+Ti(p.sizeTree,L)[1],F=v+b,_=v+g-C,R=P({itemTop:E,itemBottom:O,viewportTop:F,viewportBottom:_,locationParams:{behavior:w,align:j,...T}});return R?S&&go(we(c,ot(D=>D===!1),Ru(ms(c)?1:2)),S):S&&S(),R}),ot(f=>f!==null)),d),{scrollIntoView:h}},ln(wo,Bs,wg,pc,rl),{singleton:!0}),n6e=Ft(([{sizes:e,sizeRanges:t},{scrollTop:n,headerHeight:s},{initialTopMostItemIndex:i},{didMount:o},{useWindowScroll:a,windowScrollContainerState:l,windowViewportRect:c}])=>{const d=At(),h=Ie(void 0),f=Ie(null),p=Ie(null);return Ke(l,f),Ke(c,p),zt(we(d,xt(e,n,a,f,p,s)),([g,m,y,b,C,v,x])=>{const S=NIe(m.sizeTree);b&&C!==null&&v!==null&&(y=C.scrollTop-v.offsetTop),y-=x,g({ranges:S,scrollTop:y})}),Ke(we(h,ot(x_),We(s6e)),i),Ke(we(o,xt(h),ot(([,g])=>g!==void 0),on(),We(([,g])=>g.ranges)),t),{getState:d,restoreStateFrom:h}},ln(wo,Bs,kg,il,A_));function s6e(e){return{offset:e.scrollTop,index:0,align:"start"}}const r6e=Ft(([e,t,n,s,i,o,a,l,c,d])=>({...e,...t,...n,...s,...i,...o,...a,...l,...c,...d}),ln(I_,KIe,il,PW,LW,QIe,JIe,A_,t6e,rl)),RW=Ft(([{totalCount:e,sizeRanges:t,fixedItemSize:n,defaultItemSize:s,trackItemSizes:i,itemSize:o,data:a,firstItemIndex:l,groupIndices:c,statefulTotalCount:d,gap:h,sizes:f},{initialTopMostItemIndex:p,scrolledToInitialItem:g,initialItemFinalLocationReached:m},y,b,C,{listState:v,topItemsIndexes:x,...S},{scrollToIndex:w},j,{topItemCount:P},{groupCounts:T},L])=>(Ke(S.rangeChanged,L.scrollSeekRangeChanged),Ke(we(L.windowViewportRect,We(E=>E.visibleHeight)),y.viewportHeight),{totalCount:e,data:a,firstItemIndex:l,sizeRanges:t,initialTopMostItemIndex:p,scrolledToInitialItem:g,initialItemFinalLocationReached:m,topItemsIndexes:x,topItemCount:P,groupCounts:T,fixedItemHeight:n,defaultItemHeight:s,gap:h,...C,statefulTotalCount:d,listState:v,scrollToIndex:w,trackItemSizes:i,itemSize:o,groupIndices:c,...S,...L,...y,sizes:f,...b}),ln(wo,kg,Bs,n6e,WIe,pc,wg,XIe,ZIe,TW,r6e)),Ax="-webkit-sticky",P8="sticky",OW=DW(()=>{if(typeof document>"u")return P8;const e=document.createElement("div");return e.style.position=Ax,e.style.position===Ax?Ax:P8});function NW(e,t,n){const s=me.useRef(null),i=me.useCallback(c=>{if(c===null||!c.offsetParent)return;const d=c.getBoundingClientRect(),h=d.width;let f,p;if(t){const g=t.getBoundingClientRect(),m=d.top-g.top;f=g.height-Math.max(0,m),p=m+t.scrollTop}else f=window.innerHeight-Math.max(0,d.top),p=d.top+window.pageYOffset;s.current={offsetTop:p,visibleHeight:f,visibleWidth:h},e(s.current)},[e,t]),{callbackRef:o,ref:a}=S_(i,!0,n),l=me.useCallback(()=>{i(a.current)},[i,a]);return me.useEffect(()=>{if(t){t.addEventListener("scroll",l);const c=new ResizeObserver(()=>{requestAnimationFrame(l)});return c.observe(t),()=>{t.removeEventListener("scroll",l),c.unobserve(t)}}else return window.addEventListener("scroll",l),window.addEventListener("resize",l),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[l,t]),o}const FW=me.createContext(void 0),BW=me.createContext(void 0);function T_(e){return e}const i6e=Ft(()=>{const e=Ie(c=>`Item ${c}`),t=Ie(null),n=Ie(c=>`Group ${c}`),s=Ie({}),i=Ie(T_),o=Ie("div"),a=Ie(hc),l=(c,d=null)=>ys(we(s,We(h=>h[c]),on()),d);return{context:t,itemContent:e,groupContent:n,components:s,computeItemKey:i,HeaderFooterTag:o,scrollerRef:a,FooterComponent:l("Footer"),HeaderComponent:l("Header"),TopItemListComponent:l("TopItemList"),ListComponent:l("List","div"),ItemComponent:l("Item","div"),GroupComponent:l("Group","div"),ScrollerComponent:l("Scroller","div"),EmptyPlaceholder:l("EmptyPlaceholder"),ScrollSeekPlaceholder:l("ScrollSeekPlaceholder")}}),o6e=Ft(([e,t])=>({...e,...t}),ln(RW,i6e)),a6e=({height:e})=>r.jsx("div",{style:{height:e}}),l6e={position:OW(),zIndex:1,overflowAnchor:"none"},$W={overflowAnchor:"none"},c6e={...$W,display:"inline-block",height:"100%"},L8=me.memo(function({showTopList:t=!1}){const n=ft("listState"),s=Zr("sizeRanges"),i=ft("useWindowScroll"),o=ft("customScrollParent"),a=Zr("windowScrollContainerState"),l=Zr("scrollContainerState"),c=o||i?a:l,d=ft("itemContent"),h=ft("context"),f=ft("groupContent"),p=ft("trackItemSizes"),g=ft("itemSize"),m=ft("log"),y=Zr("gap"),b=ft("horizontalDirection"),{callbackRef:C}=kIe(s,g,p,t?hc:c,m,y,o,b,ft("skipAnimationFrameInResizeObserver")),[v,x]=me.useState(0);E_("deviation",D=>{v!==D&&x(D)});const S=ft("EmptyPlaceholder"),w=ft("ScrollSeekPlaceholder")||a6e,j=ft("ListComponent"),P=ft("ItemComponent"),T=ft("GroupComponent"),L=ft("computeItemKey"),E=ft("isSeeking"),O=ft("groupIndices").length>0,F=ft("alignToBottom"),_=ft("initialItemFinalLocationReached"),R=t?{}:{boxSizing:"border-box",...b?{whiteSpace:"nowrap",display:"inline-block",height:"100%",paddingLeft:n.offsetTop,paddingRight:n.offsetBottom,marginLeft:v!==0?v:F?"auto":0}:{marginTop:v!==0?v:F?"auto":0,paddingTop:n.offsetTop,paddingBottom:n.offsetBottom},..._?{}:{visibility:"hidden"}};return!t&&n.totalCount===0&&S?r.jsx(S,{...Ps(S,h)}):r.jsx(j,{...Ps(j,h),ref:C,style:R,"data-testid":t?"virtuoso-top-item-list":"virtuoso-item-list",children:(t?n.topItems:n.items).map(D=>{const $=D.originalIndex,G=L($+n.firstItemIndex,D.data,h);return E?u.createElement(w,{...Ps(w,h),key:G,index:D.index,height:D.size,type:D.type||"item",...D.type==="group"?{}:{groupIndex:D.groupIndex}}):D.type==="group"?u.createElement(T,{...Ps(T,h),key:G,"data-index":$,"data-known-size":D.size,"data-item-index":D.index,style:l6e},f(D.index,h)):u.createElement(P,{...Ps(P,h),...f6e(P,D.data),key:G,"data-index":$,"data-known-size":D.size,"data-item-index":D.index,"data-item-group-index":D.groupIndex,style:b?c6e:$W},O?d(D.index,D.groupIndex,D.data,h):d(D.index,D.data,h))})})}),u6e={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},d6e={outline:"none",overflowX:"auto",position:"relative"},Rv=e=>({width:"100%",height:"100%",position:"absolute",top:0,...e?{display:"flex",flexDirection:"column"}:{}}),h6e={width:"100%",position:OW(),top:0,zIndex:1};function Ps(e,t){if(typeof e!="string")return{context:t}}function f6e(e,t){return{item:typeof e=="string"?void 0:t}}const p6e=me.memo(function(){const t=ft("HeaderComponent"),n=Zr("headerHeight"),s=ft("HeaderFooterTag"),i=fc(me.useMemo(()=>a=>n($a(a,"height")),[n]),!0,ft("skipAnimationFrameInResizeObserver")),o=ft("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),g6e=me.memo(function(){const t=ft("FooterComponent"),n=Zr("footerHeight"),s=ft("HeaderFooterTag"),i=fc(me.useMemo(()=>a=>n($a(a,"height")),[n]),!0,ft("skipAnimationFrameInResizeObserver")),o=ft("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null});function VW({usePublisher:e,useEmitter:t,useEmitterValue:n}){return me.memo(function({style:o,children:a,...l}){const c=e("scrollContainerState"),d=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),f=n("scrollerRef"),p=n("context"),g=n("horizontalDirection")||!1,{scrollerRef:m,scrollByCallback:y,scrollToCallback:b}=bW(c,h,d,f,void 0,g);t("scrollTo",b),t("scrollBy",y);const C=g?d6e:u6e;return r.jsx(d,{ref:m,style:{...C,...o},"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,tabIndex:0,...l,...Ps(d,p),children:a})})}function GW({usePublisher:e,useEmitter:t,useEmitterValue:n}){return me.memo(function({style:o,children:a,...l}){const c=e("windowScrollContainerState"),d=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),f=n("totalListHeight"),p=n("deviation"),g=n("customScrollParent"),m=n("context"),{scrollerRef:y,scrollByCallback:b,scrollToCallback:C}=bW(c,h,d,hc,g);return yW(()=>(y.current=g||window,()=>{y.current=null}),[y,g]),t("windowScrollTo",C),t("scrollBy",b),r.jsx(d,{style:{position:"relative",...o,...f!==0?{height:f+p}:{}},"data-virtuoso-scroller":!0,...l,...Ps(d,m),children:a})})}const m6e=({children:e})=>{const t=me.useContext(FW),n=Zr("viewportHeight"),s=Zr("fixedItemHeight"),i=ft("alignToBottom"),o=ft("horizontalDirection"),a=me.useMemo(()=>fW(n,c=>$a(c,o?"width":"height")),[n,o]),l=fc(a,!0,ft("skipAnimationFrameInResizeObserver"));return me.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),r.jsx("div",{style:Rv(i),ref:l,"data-viewport-type":"element",children:e})},y6e=({children:e})=>{const t=me.useContext(FW),n=Zr("windowViewportRect"),s=Zr("fixedItemHeight"),i=ft("customScrollParent"),o=NW(n,i,ft("skipAnimationFrameInResizeObserver")),a=ft("alignToBottom");return me.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),r.jsx("div",{ref:o,style:Rv(a),"data-viewport-type":"window",children:e})},v6e=({children:e})=>{const t=ft("TopItemListComponent")||"div",n=ft("headerHeight"),s={...h6e,marginTop:`${n}px`},i=ft("context");return r.jsx(t,{style:s,...Ps(t,i),children:e})},b6e=me.memo(function(t){const n=ft("useWindowScroll"),s=ft("topItemsIndexes").length>0,i=ft("customScrollParent"),o=i||n?S6e:C6e,a=i||n?y6e:m6e;return r.jsxs(o,{...t,children:[s&&r.jsx(v6e,{children:r.jsx(L8,{showTopList:!0})}),r.jsxs(a,{children:[r.jsx(p6e,{}),r.jsx(L8,{}),r.jsx(g6e,{})]})]})}),{Component:x6e,usePublisher:Zr,useEmitterValue:ft,useEmitter:E_}=mW(o6e,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},b6e),C6e=VW({usePublisher:Zr,useEmitterValue:ft,useEmitter:E_}),S6e=GW({usePublisher:Zr,useEmitterValue:ft,useEmitter:E_}),w6e=x6e,D8={items:[],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},j6e={items:[{index:0}],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},{round:R8,ceil:O8,floor:B1,min:Tx,max:If}=Math;function k6e(e){return{...j6e,items:e}}function N8(e,t,n){return Array.from({length:t-e+1}).map((s,i)=>{const o=n===null?null:n[i+e];return{index:i+e,data:o}})}function _6e(e,t){return e&&e.column===t.column&&e.row===t.row}function km(e,t){return e&&e.width===t.width&&e.height===t.height}const I6e=Ft(([{overscan:e,visibleRange:t,listBoundary:n},{scrollTop:s,viewportHeight:i,scrollBy:o,scrollTo:a,smoothScrollTargetReached:l,scrollContainerState:c,footerHeight:d,headerHeight:h},f,p,{propsReady:g,didMount:m},{windowViewportRect:y,useWindowScroll:b,customScrollParent:C,windowScrollContainerState:v,windowScrollTo:x},S])=>{const w=Ie(0),j=Ie(0),P=Ie(D8),T=Ie({height:0,width:0}),L=Ie({height:0,width:0}),E=At(),O=At(),F=Ie(0),_=Ie(null),R=Ie({row:0,column:0}),D=At(),$=At(),G=Ie(!1),ee=Ie(0),Q=Ie(!0),se=Ie(!1),ne=Ie(!1);zt(we(m,xt(ee),ot(([N,B])=>!!B)),()=>{vt(Q,!1)}),zt(we(Xn(m,Q,L,T,ee,se),ot(([N,B,U,ie,,de])=>N&&!B&&U.height!==0&&ie.height!==0&&!de)),([,,,,N])=>{vt(se,!0),k_(1,()=>{vt(E,N)}),go(we(s),()=>{vt(n,[0,0]),vt(Q,!0)})}),Ke(we($,ot(N=>N!=null&&N.scrollTop>0),qi(0)),j),zt(we(m,xt($),ot(([,N])=>N!=null)),([,N])=>{N&&(vt(T,N.viewport),vt(L,N==null?void 0:N.item),vt(R,N.gap),N.scrollTop>0&&(vt(G,!0),go(we(s,Ru(1)),B=>{vt(G,!1)}),vt(a,{top:N.scrollTop})))}),Ke(we(T,We(({height:N})=>N)),i),Ke(we(Xn(it(T,km),it(L,km),it(R,(N,B)=>N&&N.column===B.column&&N.row===B.row),it(s)),We(([N,B,U,ie])=>({viewport:N,item:B,gap:U,scrollTop:ie}))),D),Ke(we(Xn(it(w),t,it(R,_6e),it(L,km),it(T,km),it(_),it(j),it(G),it(Q),it(ee)),ot(([,,,,,,,N])=>!N),We(([N,[B,U],ie,de,be,Ee,je,,Be,Xe])=>{const{row:Re,column:K}=ie,{height:re,width:ae}=de,{width:xe}=be;if(je===0&&(N===0||xe===0))return D8;if(ae===0){const pn=__(Xe,N),es=Math.max(pn+je-1,0);return k6e(N8(pn,es,Ee))}const ge=zW(xe,ae,K);let fe,le;Be?B===0&&U===0&&je>0?(fe=0,le=je-1):(fe=ge*B1((B+Re)/(re+Re)),le=ge*O8((U+Re)/(re+Re))-1,le=Tx(N-1,If(le,ge-1)),fe=Tx(le,If(0,fe))):(fe=0,le=-1);const Ce=N8(fe,le,Ee),{top:ze,bottom:Qe}=F8(be,ie,de,Ce),gt=O8(N/ge),cn=gt*re+(gt-1)*Re-Qe;return{items:Ce,offsetTop:ze,offsetBottom:cn,top:ze,bottom:Qe,itemHeight:re,itemWidth:ae}})),P),Ke(we(_,ot(N=>N!==null),We(N=>N.length)),w),Ke(we(Xn(T,L,P,R),ot(([N,B,{items:U}])=>U.length>0&&B.height!==0&&N.height!==0),We(([N,B,{items:U},ie])=>{const{top:de,bottom:be}=F8(N,ie,B,U);return[de,be]}),on(rp)),n);const H=Ie(!1);Ke(we(s,xt(H),We(([N,B])=>B||N!==0)),H);const V=wr(we(it(P),ot(({items:N})=>N.length>0),xt(w,H),ot(([{items:N},B,U])=>U&&N[N.length-1].index===B-1),We(([,N])=>N-1),on())),Y=wr(we(it(P),ot(({items:N})=>N.length>0&&N[0].index===0),qi(0),on())),W=wr(we(it(P),xt(G),ot(([{items:N},B])=>N.length>0&&!B),We(([{items:N}])=>({startIndex:N[0].index,endIndex:N[N.length-1].index})),on(EW),Ea(0)));Ke(W,p.scrollSeekRangeChanged),Ke(we(E,xt(T,L,w,R),We(([N,B,U,ie,de])=>{const be=AW(N),{align:Ee,behavior:je,offset:Be}=be;let Xe=be.index;Xe==="LAST"&&(Xe=ie-1),Xe=If(0,Xe,Tx(ie-1,Xe));let Re=XC(B,de,U,Xe);return Ee==="end"?Re=R8(Re-B.height+U.height):Ee==="center"&&(Re=R8(Re-B.height/2+U.height/2)),Be&&(Re+=Be),{top:Re,behavior:je}})),a);const J=ys(we(P,We(N=>N.offsetBottom+N.bottom)),0);return Ke(we(y,We(N=>({width:N.visibleWidth,height:N.visibleHeight}))),T),{data:_,totalCount:w,viewportDimensions:T,itemDimensions:L,scrollTop:s,scrollHeight:O,overscan:e,scrollBy:o,scrollTo:a,scrollToIndex:E,smoothScrollTargetReached:l,windowViewportRect:y,windowScrollTo:x,useWindowScroll:b,customScrollParent:C,windowScrollContainerState:v,deviation:F,scrollContainerState:c,footerHeight:d,headerHeight:h,initialItemCount:j,gap:R,restoreStateFrom:$,...p,initialTopMostItemIndex:ee,horizontalDirection:ne,gridState:P,totalListHeight:J,...f,startReached:Y,endReached:V,rangeChanged:W,stateChanged:D,propsReady:g,stateRestoreInProgress:G,...S}},ln(I_,Bs,jg,PW,il,A_,rl));function F8(e,t,n,s){const{height:i}=n;if(i===void 0||s.length===0)return{top:0,bottom:0};const o=XC(e,t,n,s[0].index),a=XC(e,t,n,s[s.length-1].index)+i;return{top:o,bottom:a}}function XC(e,t,n,s){const i=zW(e.width,n.width,t.column),o=B1(s/i),a=o*n.height+If(0,o-1)*t.row;return a>0?a+t.row:a}function zW(e,t,n){return If(1,B1((e+n)/(B1(t)+n)))}const A6e=Ft(()=>{const e=Ie(f=>`Item ${f}`),t=Ie({}),n=Ie(null),s=Ie("virtuoso-grid-item"),i=Ie("virtuoso-grid-list"),o=Ie(T_),a=Ie("div"),l=Ie(hc),c=(f,p=null)=>ys(we(t,We(g=>g[f]),on()),p),d=Ie(!1),h=Ie(!1);return Ke(it(h),d),{readyStateChanged:d,reportReadyState:h,context:n,itemContent:e,components:t,computeItemKey:o,itemClassName:s,listClassName:i,headerFooterTag:a,scrollerRef:l,FooterComponent:c("Footer"),HeaderComponent:c("Header"),ListComponent:c("List","div"),ItemComponent:c("Item","div"),ScrollerComponent:c("Scroller","div"),ScrollSeekPlaceholder:c("ScrollSeekPlaceholder","div")}}),T6e=Ft(([e,t])=>({...e,...t}),ln(I6e,A6e)),E6e=me.memo(function(){const t=yn("gridState"),n=yn("listClassName"),s=yn("itemClassName"),i=yn("itemContent"),o=yn("computeItemKey"),a=yn("isSeeking"),l=Yr("scrollHeight"),c=yn("ItemComponent"),d=yn("ListComponent"),h=yn("ScrollSeekPlaceholder"),f=yn("context"),p=Yr("itemDimensions"),g=Yr("gap"),m=yn("log"),y=yn("stateRestoreInProgress"),b=Yr("reportReadyState"),C=fc(me.useMemo(()=>v=>{const x=v.parentElement.parentElement.scrollHeight;l(x);const S=v.firstChild;if(S){const{width:w,height:j}=S.getBoundingClientRect();p({width:w,height:j})}g({row:B8("row-gap",getComputedStyle(v).rowGap,m),column:B8("column-gap",getComputedStyle(v).columnGap,m)})},[l,p,g,m]),!0,!1);return yW(()=>{t.itemHeight>0&&t.itemWidth>0&&b(!0)},[t]),y?null:r.jsx(d,{ref:C,className:n,...Ps(d,f),style:{paddingTop:t.offsetTop,paddingBottom:t.offsetBottom},"data-testid":"virtuoso-item-list",children:t.items.map(v=>{const x=o(v.index,v.data,f);return a?r.jsx(h,{...Ps(h,f),index:v.index,height:t.itemHeight,width:t.itemWidth},x):u.createElement(c,{...Ps(c,f),className:s,"data-index":v.index,key:x},i(v.index,v.data,f))})})}),M6e=me.memo(function(){const t=yn("HeaderComponent"),n=Yr("headerHeight"),s=yn("headerFooterTag"),i=fc(me.useMemo(()=>a=>n($a(a,"height")),[n]),!0,!1),o=yn("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),P6e=me.memo(function(){const t=yn("FooterComponent"),n=Yr("footerHeight"),s=yn("headerFooterTag"),i=fc(me.useMemo(()=>a=>n($a(a,"height")),[n]),!0,!1),o=yn("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),L6e=({children:e})=>{const t=me.useContext(BW),n=Yr("itemDimensions"),s=Yr("viewportDimensions"),i=fc(me.useMemo(()=>o=>{s(o.getBoundingClientRect())},[s]),!0,!1);return me.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),r.jsx("div",{style:Rv(!1),ref:i,children:e})},D6e=({children:e})=>{const t=me.useContext(BW),n=Yr("windowViewportRect"),s=Yr("itemDimensions"),i=yn("customScrollParent"),o=NW(n,i,!1);return me.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),r.jsx("div",{ref:o,style:Rv(!1),children:e})},R6e=me.memo(function({...t}){const n=yn("useWindowScroll"),s=yn("customScrollParent"),i=s||n?N6e:O6e,o=s||n?D6e:L6e;return r.jsx(i,{...t,children:r.jsxs(o,{children:[r.jsx(M6e,{}),r.jsx(E6e,{}),r.jsx(P6e,{})]})})}),{usePublisher:Yr,useEmitterValue:yn,useEmitter:HW}=mW(T6e,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},R6e),O6e=VW({usePublisher:Yr,useEmitterValue:yn,useEmitter:HW}),N6e=GW({usePublisher:Yr,useEmitterValue:yn,useEmitter:HW});function B8(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,jr.WARN),t==="normal"?0:parseInt(t??"0",10)}const F6e=Ft(()=>{const e=Ie(c=>r.jsxs("td",{children:["Item $",c]})),t=Ie(null),n=Ie(null),s=Ie(null),i=Ie({}),o=Ie(T_),a=Ie(hc),l=(c,d=null)=>ys(we(i,We(h=>h[c]),on()),d);return{context:t,itemContent:e,fixedHeaderContent:n,fixedFooterContent:s,components:i,computeItemKey:o,scrollerRef:a,TableComponent:l("Table","table"),TableHeadComponent:l("TableHead","thead"),TableFooterComponent:l("TableFoot","tfoot"),TableBodyComponent:l("TableBody","tbody"),TableRowComponent:l("TableRow","tr"),ScrollerComponent:l("Scroller","div"),EmptyPlaceholder:l("EmptyPlaceholder"),ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),FillerRow:l("FillerRow")}});ln(RW,F6e);const $8={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},B6e=({status:e})=>{const{t}=M();return r.jsx(is,{colorScheme:$8[e].colorScheme,children:t($8[e].translationKey)})},$6e=u.memo(B6e),WW=e=>{const{t}=M();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},UW=e=>{const{t}=M();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},qW=e=>{const t=ce(Wn),[n,{isLoading:s}]=hS(),{t:i}=M();return{cancelQueueItem:u.useCallback(async()=>{try{await n(e).unwrap(),ve({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{ve({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[e,i,n]),isLoading:s,isDisabled:!t}},KW=e=>{const t=ce(Wn),[n,{isLoading:s}]=nse(),{t:i}=M();return{retryQueueItem:u.useCallback(async()=>{try{if(!(await n([e]).unwrap()).retried_item_ids.includes(e))throw new Error("Failed to retry item");ve({id:"QUEUE_RETRY_SUCCEEDED",title:i("queue.retrySucceeded"),status:"success"})}catch{ve({id:"QUEUE_RETRY_FAILED",title:i("queue.retryFailed"),status:"error"})}},[e,i,n]),isLoading:s,isDisabled:!t}},ZW=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),Ks={number:"3rem",statusBadge:"5.7rem",time:"4rem",origin:"5rem",destination:"6rem",batchId:"5rem",fieldValues:"auto",actions:"auto"},V6e=e=>{const t=ce(Wn),{isCanceled:n}=sse({batch_id:e},{selectFromResult:({data:l})=>l?{isCanceled:(l==null?void 0:l.in_progress)===0&&(l==null?void 0:l.pending)===0}:{isCanceled:!0}}),[s,{isLoading:i}]=rse({fixedCacheKey:"cancelByBatchIds"}),{t:o}=M();return{cancelBatch:u.useCallback(async()=>{if(!n)try{await s({batch_ids:[e]}).unwrap(),ve({id:"CANCEL_BATCH_SUCCEEDED",title:o("queue.cancelBatchSucceeded"),status:"success"})}catch{ve({id:"CANCEL_BATCH_FAILED",title:o("queue.cancelBatchFailed"),status:"error"})}},[e,n,o,s]),isLoading:i,isCanceled:n,isDisabled:!t}},G6e=({queueItemDTO:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:i,destination:o}=e,{t:a}=M(),l=en("retryQueueItem"),{cancelBatch:c,isLoading:d,isCanceled:h}=V6e(n),{cancelQueueItem:f,isLoading:p}=qW(s),{retryQueueItem:g,isLoading:m}=KW(s),{data:y}=ise(s),b=UW(i),C=WW(o),v=u.useMemo(()=>{if(!y)return a("common.loading");if(!y.completed_at||!y.started_at)return a(`queue.${y.status}`);const w=ZW(y.started_at,y.completed_at);return y.status==="completed"?`${a("queue.completedIn")} ${w}${w===1?"":"s"}`:`${w}s`},[y,a]),x=u.useMemo(()=>!!y&&["canceled","completed","failed"].includes(y.status),[y]),S=u.useMemo(()=>!!y&&["canceled","failed"].includes(y.status),[y]);return r.jsxs(A,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[r.jsxs(A,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[r.jsx(Ic,{label:a("queue.status"),data:v}),r.jsx(Ic,{label:a("queue.origin"),data:b}),r.jsx(Ic,{label:a("queue.destination"),data:C}),r.jsx(Ic,{label:a("queue.item"),data:s}),r.jsx(Ic,{label:a("queue.batch"),data:n}),r.jsx(Ic,{label:a("queue.session"),data:t}),r.jsxs(Cs,{size:"xs",orientation:"vertical",children:[(!S||!l)&&r.jsx(ye,{onClick:f,isLoading:p,isDisabled:y?x:!0,"aria-label":a("queue.cancelItem"),leftIcon:r.jsx(Nt,{}),colorScheme:"error",children:a("queue.cancelItem")}),S&&l&&r.jsx(ye,{onClick:g,isLoading:m,isDisabled:!y,"aria-label":a("queue.retryItem"),leftIcon:r.jsx(Di,{}),colorScheme:"invokeBlue",children:a("queue.retryItem")}),r.jsx(ye,{onClick:c,isLoading:d,isDisabled:h,"aria-label":a("queue.cancelBatch"),leftIcon:r.jsx(Nt,{}),colorScheme:"error",children:a("queue.cancelBatch")})]})]}),((y==null?void 0:y.error_traceback)||(y==null?void 0:y.error_message))&&r.jsxs(A,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[r.jsx(Rt,{size:"sm",color:"error.400",children:a("common.error")}),r.jsx("pre",{children:(y==null?void 0:y.error_traceback)||(y==null?void 0:y.error_message)})]}),r.jsx(A,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:y?r.jsx(Yo,{label:"Queue Item",data:y,extraCopyActions:[{label:"Graph",getData:w=>HE(w,"session.graph")}]}):r.jsx(rr,{opacity:.5})})]})},z6e=u.memo(G6e),Ic=({label:e,data:t})=>r.jsxs(A,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[r.jsx(Rt,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),V8={bg:"base.700"},H6e={_hover:V8,"&[aria-selected='true']":V8},W6e=({index:e,item:t,context:n})=>{const{t:s}=M(),i=en("retryQueueItem"),o=u.useCallback(()=>{n.toggleQueueItem(t.item_id)},[n,t.item_id]),{cancelQueueItem:a,isLoading:l}=qW(t.item_id),c=u.useCallback(v=>{v.stopPropagation(),a()},[a]),{retryQueueItem:d,isLoading:h}=KW(t.item_id),f=u.useCallback(v=>{v.stopPropagation(),d()},[d]),p=u.useMemo(()=>n.openQueueItems.includes(t.item_id),[n.openQueueItems,t.item_id]),g=u.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${ZW(t.started_at,t.completed_at)}s`,[t]),m=u.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),y=u.useMemo(()=>["canceled","failed"].includes(t.status),[t.status]),b=UW(t.origin),C=WW(t.destination);return r.jsxs(A,{flexDir:"column","aria-selected":p,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:H6e,"data-testid":"queue-item",children:[r.jsxs(A,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:o,children:[r.jsx(A,{w:Ks.number,justifyContent:"flex-end",alignItems:"center",flexShrink:0,children:r.jsx(q,{variant:"subtext",children:e+1})}),r.jsx(A,{w:Ks.statusBadge,alignItems:"center",flexShrink:0,children:r.jsx($6e,{status:t.status})}),r.jsx(A,{w:Ks.origin,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:b})}),r.jsx(A,{w:Ks.destination,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:C})}),r.jsx(A,{w:Ks.time,alignItems:"center",flexShrink:0,children:g||"-"}),r.jsx(A,{w:Ks.batchId,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),r.jsx(A,{alignItems:"center",overflow:"hidden",flexGrow:1,children:t.field_values&&r.jsx(A,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(v=>v.node_path!=="metadata_accumulator").map(({node_path:v,field_name:x,value:S})=>r.jsxs(q,{as:"span",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[v,".",x]}),": ",JSON.stringify(S)]},`${t.item_id}.${v}.${x}.${S}`))})}),r.jsx(A,{alignItems:"center",w:Ks.actions,pe:3,children:r.jsxs(Cs,{size:"xs",variant:"ghost",children:[(!y||!i)&&r.jsx(oe,{onClick:c,isDisabled:m,isLoading:l,"aria-label":s("queue.cancelItem"),icon:r.jsx(Nt,{})}),y&&i&&r.jsx(oe,{onClick:f,isLoading:h,"aria-label":s("queue.retryItem"),icon:r.jsx(Di,{})})]})})]}),r.jsx(rc,{in:p,transition:U6e,unmountOnExit:!0,children:r.jsx(z6e,{queueItemDTO:t})})]})},U6e={enter:{duration:.1},exit:{duration:.1}},q6e=u.memo(W6e),YW=Ip(RM((e,t)=>r.jsx(A,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));YW.displayName="QueueListComponent";const K6e=()=>{const{t:e}=M();return r.jsxs(A,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[r.jsx(A,{w:Ks.number,justifyContent:"flex-end",alignItems:"center",children:r.jsx(q,{variant:"subtext",children:"#"})}),r.jsx(A,{ps:.5,w:Ks.statusBadge,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.status")})}),r.jsx(A,{ps:.5,w:Ks.origin,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.origin")})}),r.jsx(A,{ps:.5,w:Ks.destination,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.destination")})}),r.jsx(A,{ps:.5,w:Ks.time,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.time")})}),r.jsx(A,{ps:.5,w:Ks.batchId,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.batch")})}),r.jsx(A,{ps:.5,w:Ks.fieldValues,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.batchFieldValues")})})]})},Z6e=u.memo(K6e),Y6e=(e,t)=>t.item_id,X6e={List:YW},Q6e=(e,t,n)=>r.jsx(q6e,{index:e,item:t,context:n}),J6e=()=>{const e=I(ose),t=I(ase),n=z(),s=u.useRef(null),[i,o]=u.useState(null),[a,l]=kR(Bl),{t:c}=M();u.useEffect(()=>{const{current:C}=s;return i&&C&&a({target:C,elements:{viewport:i}}),()=>{var v;return(v=l())==null?void 0:v.destroy()}},[i,a,l]);const{data:d,isLoading:h}=lse({cursor:e,priority:t}),f=u.useMemo(()=>d?cse.selectAll(d):[],[d]),p=u.useCallback(()=>{if(!(d!=null&&d.has_more))return;const C=f[f.length-1];C&&(n(fS(C.item_id)),n(pS(C.priority)))},[n,d==null?void 0:d.has_more,f]),[g,m]=u.useState([]),y=u.useCallback(C=>{m(v=>v.includes(C)?v.filter(x=>x!==C):[...v,C])},[]),b=u.useMemo(()=>({openQueueItems:g,toggleQueueItem:y}),[g,y]);return h?r.jsx(Ny,{}):f.length?r.jsxs(A,{w:"full",h:"full",flexDir:"column",children:[r.jsx(Z6e,{}),r.jsx(A,{ref:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(w6e,{data:f,endReached:p,scrollerRef:o,itemContent:Q6e,computeItemKey:Y6e,components:X6e,context:b})})]}):r.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Rt,{color:"base.500",children:c("queue.queueEmpty")})})},eAe=u.memo(J6e),tAe=()=>{const{data:e}=ti(),{t}=M();return r.jsxs(dW,{"data-testid":"queue-status",children:[r.jsx(Ui,{label:t("queue.in_progress"),value:(e==null?void 0:e.queue.in_progress)??0}),r.jsx(Ui,{label:t("queue.pending"),value:(e==null?void 0:e.queue.pending)??0}),r.jsx(Ui,{label:t("queue.completed"),value:(e==null?void 0:e.queue.completed)??0}),r.jsx(Ui,{label:t("queue.failed"),value:(e==null?void 0:e.queue.failed)??0}),r.jsx(Ui,{label:t("queue.canceled"),value:(e==null?void 0:e.queue.canceled)??0}),r.jsx(Ui,{label:t("queue.total"),value:(e==null?void 0:e.queue.total)??0})]})},nAe=u.memo(tAe),sAe=()=>{const e=en("modelCache"),[t,{isLoading:n}]=use(),{t:s}=M(),i=u.useCallback(async()=>{try{await t().unwrap(),ve({status:"success",title:s("modelCache.clearSucceeded")})}catch{ve({status:"error",title:s("modelCache.clearFailed")})}},[t,s]);return e?r.jsx(ye,{size:"sm",colorScheme:"red",onClick:i,isLoading:n,children:s("modelCache.clear")}):r.jsx(r.Fragment,{})},rAe=u.memo(sAe),iAe=e=>{const{t}=M(),n=Yp();return r.jsx(r.Fragment,{children:r.jsx(ye,{isDisabled:n.isDisabled,isLoading:n.isLoading,tooltip:t("queue.clearTooltip"),leftIcon:r.jsx(Ry,{}),colorScheme:"error",onClick:n.openDialog,"data-testid":t("queue.clear"),...e,children:t("queue.clear")})})},oAe=u.memo(iAe),aAe=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,asIconButton:a,isLoading:l,loadingText:c,sx:d})=>a?r.jsx(oe,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,sx:d,"data-testid":e}):r.jsx(ye,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,loadingText:c??e,flexGrow:1,sx:d,"data-testid":e,children:e}),M_=u.memo(aAe),lAe=({asIconButton:e})=>{const{t}=M(),{pauseProcessor:n,isLoading:s,isDisabled:i}=qz();return r.jsx(M_,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(tD,{}),onClick:n,colorScheme:"gold"})},cAe=u.memo(lAe),uAe=()=>{const e=z(),{t}=M(),n=ce(Wn),[s,{isLoading:i}]=xM({fixedCacheKey:"pruneQueue"}),{finishedCount:o}=ti(void 0,{selectFromResult:({data:c})=>c?{finishedCount:c.queue.completed+c.queue.canceled+c.queue.failed}:{finishedCount:0}}),a=u.useCallback(async()=>{if(o)try{const c=await s().unwrap();ve({id:"PRUNE_SUCCEEDED",title:t("queue.pruneSucceeded",{item_count:c.deleted}),status:"success"}),e(fS(void 0)),e(pS(void 0))}catch{ve({id:"PRUNE_FAILED",title:t("queue.pruneFailed"),status:"error"})}},[o,s,e,t]),l=u.useMemo(()=>!n||!o,[o,n]);return{pruneQueue:a,isLoading:i,finishedCount:o,isDisabled:l}},dAe=({asIconButton:e})=>{const{t}=M(),{pruneQueue:n,isLoading:s,finishedCount:i,isDisabled:o}=uAe();return r.jsx(M_,{isDisabled:o,isLoading:s,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:i}),icon:r.jsx(fae,{}),onClick:n,colorScheme:"invokeBlue"})},hAe=u.memo(dAe),fAe=({asIconButton:e})=>{const{t}=M(),{resumeProcessor:n,isLoading:s,isDisabled:i}=Kz();return r.jsx(M_,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(nD,{}),onClick:n,colorScheme:"green"})},pAe=u.memo(fAe),gAe=()=>{const e=en("pauseQueue"),t=en("resumeQueue");return r.jsxs(A,{flexDir:"column",layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[r.jsxs(A,{gap:2,children:[e||t?r.jsxs(Cs,{w:28,orientation:"vertical",size:"sm",children:[t?r.jsx(pAe,{}):r.jsx(r.Fragment,{}),e?r.jsx(cAe,{}):r.jsx(r.Fragment,{})]}):r.jsx(r.Fragment,{}),r.jsxs(Cs,{w:28,orientation:"vertical",size:"sm",children:[r.jsx(hAe,{}),r.jsx(oAe,{})]})]}),r.jsx(rAe,{})]})},mAe=u.memo(gAe),yAe=()=>{const e=en("invocationCache"),t=I(En);return r.jsxs(A,{display:t==="queue"?void 0:"none",hidden:t!=="queue",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsxs(A,{gap:2,w:"full",children:[r.jsx(mAe,{}),r.jsx(nAe,{}),e&&r.jsx(pIe,{})]}),r.jsx(Se,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:r.jsx(eAe,{})})]})},vAe=u.memo(yAe),bAe=()=>r.jsx(A,{layerStyle:"body",w:"full",h:"full",children:r.jsx(vAe,{})}),xAe=u.memo(bAe);var G8=1,CAe=.9,SAe=.8,wAe=.17,Ex=.1,Mx=.999,jAe=.9999,kAe=.99,_Ae=/[\\\/_+.#"@\[\(\{&]/,IAe=/[\\\/_+.#"@\[\(\{&]/g,AAe=/[\s-]/,XW=/[\s-]/g;function QC(e,t,n,s,i,o,a){if(o===t.length)return i===e.length?G8:kAe;var l=`${i},${o}`;if(a[l]!==void 0)return a[l];for(var c=s.charAt(o),d=n.indexOf(c,i),h=0,f,p,g,m;d>=0;)f=QC(e,t,n,s,d+1,o+1,a),f>h&&(d===i?f*=G8:_Ae.test(e.charAt(d-1))?(f*=SAe,g=e.slice(i,d-1).match(IAe),g&&i>0&&(f*=Math.pow(Mx,g.length))):AAe.test(e.charAt(d-1))?(f*=CAe,m=e.slice(i,d-1).match(XW),m&&i>0&&(f*=Math.pow(Mx,m.length))):(f*=wAe,i>0&&(f*=Math.pow(Mx,d-i))),e.charAt(d)!==t.charAt(o)&&(f*=jAe)),(f<Ex&&n.charAt(d-1)===s.charAt(o+1)||s.charAt(o+1)===s.charAt(o)&&n.charAt(d-1)!==s.charAt(o))&&(p=QC(e,t,n,s,d+1,o+2,a),p*Ex>f&&(f=p*Ex)),f>h&&(h=f),d=n.indexOf(c,d+1);return a[l]=h,h}function z8(e){return e.toLowerCase().replace(XW," ")}function TAe(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,QC(e,t,z8(e),z8(t),0,0,{})}function mu(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(e==null||e(i),n===!1||!i.defaultPrevented)return t==null?void 0:t(i)}}function EAe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function QW(...e){return t=>e.forEach(n=>EAe(n,t))}function _g(...e){return u.useCallback(QW(...e),e)}function MAe(e,t){const n=u.createContext(t);function s(o){const{children:a,...l}=o,c=u.useMemo(()=>l,Object.values(l));return u.createElement(n.Provider,{value:c},a)}function i(o){const a=u.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return s.displayName=e+"Provider",[s,i]}function PAe(e,t=[]){let n=[];function s(o,a){const l=u.createContext(a),c=n.length;n=[...n,a];function d(f){const{scope:p,children:g,...m}=f,y=(p==null?void 0:p[e][c])||l,b=u.useMemo(()=>m,Object.values(m));return u.createElement(y.Provider,{value:b},g)}function h(f,p){const g=(p==null?void 0:p[e][c])||l,m=u.useContext(g);if(m)return m;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${o}\``)}return d.displayName=o+"Provider",[d,h]}const i=()=>{const o=n.map(a=>u.createContext(a));return function(l){const c=(l==null?void 0:l[e])||o;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return i.scopeName=e,[s,LAe(i,...t)]}function LAe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const a=s.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}const JC=globalThis!=null&&globalThis.document?u.useLayoutEffect:()=>{},DAe=zS.useId||(()=>{});let RAe=0;function Px(e){const[t,n]=u.useState(DAe());return JC(()=>{n(s=>s??String(RAe++))},[e]),e||(t?`radix-${t}`:"")}function Ul(e){const t=u.useRef(e);return u.useEffect(()=>{t.current=e}),u.useMemo(()=>(...n)=>{var s;return(s=t.current)===null||s===void 0?void 0:s.call(t,...n)},[])}function OAe({prop:e,defaultProp:t,onChange:n=()=>{}}){const[s,i]=NAe({defaultProp:t,onChange:n}),o=e!==void 0,a=o?e:s,l=Ul(n),c=u.useCallback(d=>{if(o){const f=typeof d=="function"?d(e):d;f!==e&&l(f)}else i(d)},[o,e,i,l]);return[a,c]}function NAe({defaultProp:e,onChange:t}){const n=u.useState(e),[s]=n,i=u.useRef(s),o=Ul(t);return u.useEffect(()=>{i.current!==s&&(o(s),i.current=s)},[s,i,o]),n}const P_=u.forwardRef((e,t)=>{const{children:n,...s}=e,i=u.Children.toArray(n),o=i.find(BAe);if(o){const a=o.props.children,l=i.map(c=>c===o?u.Children.count(a)>1?u.Children.only(null):u.isValidElement(a)?a.props.children:null:c);return u.createElement(eS,Ss({},s,{ref:t}),u.isValidElement(a)?u.cloneElement(a,void 0,l):null)}return u.createElement(eS,Ss({},s,{ref:t}),n)});P_.displayName="Slot";const eS=u.forwardRef((e,t)=>{const{children:n,...s}=e;return u.isValidElement(n)?u.cloneElement(n,{...$Ae(s,n.props),ref:t?QW(t,n.ref):n.ref}):u.Children.count(n)>1?u.Children.only(null):null});eS.displayName="SlotClone";const FAe=({children:e})=>u.createElement(u.Fragment,null,e);function BAe(e){return u.isValidElement(e)&&e.type===FAe}function $Ae(e,t){const n={...t};for(const s in t){const i=e[s],o=t[s];/^on[A-Z]/.test(s)?i&&o?n[s]=(...l)=>{o(...l),i(...l)}:i&&(n[s]=i):s==="style"?n[s]={...i,...o}:s==="className"&&(n[s]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}const VAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],oi=VAe.reduce((e,t)=>{const n=u.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?P_:t;return u.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),u.createElement(l,Ss({},a,{ref:i}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function GAe(e,t){e&&nc.flushSync(()=>e.dispatchEvent(t))}function zAe(e,t=globalThis==null?void 0:globalThis.document){const n=Ul(e);u.useEffect(()=>{const s=i=>{i.key==="Escape"&&n(i)};return t.addEventListener("keydown",s),()=>t.removeEventListener("keydown",s)},[n,t])}const tS="dismissableLayer.update",HAe="dismissableLayer.pointerDownOutside",WAe="dismissableLayer.focusOutside";let H8;const UAe=u.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),qAe=u.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...d}=e,h=u.useContext(UAe),[f,p]=u.useState(null),g=(n=f==null?void 0:f.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,m]=u.useState({}),y=_g(t,T=>p(T)),b=Array.from(h.layers),[C]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),v=b.indexOf(C),x=f?b.indexOf(f):-1,S=h.layersWithOutsidePointerEventsDisabled.size>0,w=x>=v,j=KAe(T=>{const L=T.target,E=[...h.branches].some(O=>O.contains(L));!w||E||(o==null||o(T),l==null||l(T),T.defaultPrevented||c==null||c())},g),P=ZAe(T=>{const L=T.target;[...h.branches].some(O=>O.contains(L))||(a==null||a(T),l==null||l(T),T.defaultPrevented||c==null||c())},g);return zAe(T=>{x===h.layers.size-1&&(i==null||i(T),!T.defaultPrevented&&c&&(T.preventDefault(),c()))},g),u.useEffect(()=>{if(f)return s&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(H8=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(f)),h.layers.add(f),W8(),()=>{s&&h.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=H8)}},[f,g,s,h]),u.useEffect(()=>()=>{f&&(h.layers.delete(f),h.layersWithOutsidePointerEventsDisabled.delete(f),W8())},[f,h]),u.useEffect(()=>{const T=()=>m({});return document.addEventListener(tS,T),()=>document.removeEventListener(tS,T)},[]),u.createElement(oi.div,Ss({},d,{ref:y,style:{pointerEvents:S?w?"auto":"none":void 0,...e.style},onFocusCapture:mu(e.onFocusCapture,P.onFocusCapture),onBlurCapture:mu(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:mu(e.onPointerDownCapture,j.onPointerDownCapture)}))});function KAe(e,t=globalThis==null?void 0:globalThis.document){const n=Ul(e),s=u.useRef(!1),i=u.useRef(()=>{});return u.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let d=function(){JW(HAe,n,c,{discrete:!0})};const c={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",i.current),i.current=d,t.addEventListener("click",i.current,{once:!0})):d()}else t.removeEventListener("click",i.current);s.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",o),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function ZAe(e,t=globalThis==null?void 0:globalThis.document){const n=Ul(e),s=u.useRef(!1);return u.useEffect(()=>{const i=o=>{o.target&&!s.current&&JW(WAe,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",i),()=>t.removeEventListener("focusin",i)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function W8(){const e=new CustomEvent(tS);document.dispatchEvent(e)}function JW(e,t,n,{discrete:s}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),s?GAe(i,o):i.dispatchEvent(o)}const Lx="focusScope.autoFocusOnMount",Dx="focusScope.autoFocusOnUnmount",U8={bubbles:!1,cancelable:!0},YAe=u.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...a}=e,[l,c]=u.useState(null),d=Ul(i),h=Ul(o),f=u.useRef(null),p=_g(t,y=>c(y)),g=u.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;u.useEffect(()=>{if(s){let y=function(x){if(g.paused||!l)return;const S=x.target;l.contains(S)?f.current=S:ga(f.current,{select:!0})},b=function(x){if(g.paused||!l)return;const S=x.relatedTarget;S!==null&&(l.contains(S)||ga(f.current,{select:!0}))},C=function(x){if(document.activeElement===document.body)for(const w of x)w.removedNodes.length>0&&ga(l)};document.addEventListener("focusin",y),document.addEventListener("focusout",b);const v=new MutationObserver(C);return l&&v.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",b),v.disconnect()}}},[s,l,g.paused]),u.useEffect(()=>{if(l){K8.add(g);const y=document.activeElement;if(!l.contains(y)){const C=new CustomEvent(Lx,U8);l.addEventListener(Lx,d),l.dispatchEvent(C),C.defaultPrevented||(XAe(nTe(eU(l)),{select:!0}),document.activeElement===y&&ga(l))}return()=>{l.removeEventListener(Lx,d),setTimeout(()=>{const C=new CustomEvent(Dx,U8);l.addEventListener(Dx,h),l.dispatchEvent(C),C.defaultPrevented||ga(y??document.body,{select:!0}),l.removeEventListener(Dx,h),K8.remove(g)},0)}}},[l,d,h,g]);const m=u.useCallback(y=>{if(!n&&!s||g.paused)return;const b=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,C=document.activeElement;if(b&&C){const v=y.currentTarget,[x,S]=QAe(v);x&&S?!y.shiftKey&&C===S?(y.preventDefault(),n&&ga(x,{select:!0})):y.shiftKey&&C===x&&(y.preventDefault(),n&&ga(S,{select:!0})):C===v&&y.preventDefault()}},[n,s,g.paused]);return u.createElement(oi.div,Ss({tabIndex:-1},a,{ref:p,onKeyDown:m}))});function XAe(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(ga(s,{select:t}),document.activeElement!==n)return}function QAe(e){const t=eU(e),n=q8(t,e),s=q8(t.reverse(),e);return[n,s]}function eU(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function q8(e,t){for(const n of e)if(!JAe(n,{upTo:t}))return n}function JAe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function eTe(e){return e instanceof HTMLInputElement&&"select"in e}function ga(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&eTe(e)&&t&&e.select()}}const K8=tTe();function tTe(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=Z8(e,t),e.unshift(t)},remove(t){var n;e=Z8(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function Z8(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function nTe(e){return e.filter(t=>t.tagName!=="A")}const sTe=u.forwardRef((e,t)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...i}=e;return s?kP.createPortal(u.createElement(oi.div,Ss({},i,{ref:t})),s):null});function rTe(e,t){return u.useReducer((n,s)=>{const i=t[n][s];return i??n},e)}const Ov=e=>{const{present:t,children:n}=e,s=iTe(t),i=typeof n=="function"?n({present:s.isPresent}):u.Children.only(n),o=_g(s.ref,i.ref);return typeof n=="function"||s.isPresent?u.cloneElement(i,{ref:o}):null};Ov.displayName="Presence";function iTe(e){const[t,n]=u.useState(),s=u.useRef({}),i=u.useRef(e),o=u.useRef("none"),a=e?"mounted":"unmounted",[l,c]=rTe(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return u.useEffect(()=>{const d=_m(s.current);o.current=l==="mounted"?d:"none"},[l]),JC(()=>{const d=s.current,h=i.current;if(h!==e){const p=o.current,g=_m(d);e?c("MOUNT"):g==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(h&&p!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,c]),JC(()=>{if(t){const d=f=>{const g=_m(s.current).includes(f.animationName);f.target===t&&g&&nc.flushSync(()=>c("ANIMATION_END"))},h=f=>{f.target===t&&(o.current=_m(s.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:u.useCallback(d=>{d&&(s.current=getComputedStyle(d)),n(d)},[])}}function _m(e){return(e==null?void 0:e.animationName)||"none"}let Rx=0;function oTe(){u.useEffect(()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:Y8()),document.body.insertAdjacentElement("beforeend",(t=n[1])!==null&&t!==void 0?t:Y8()),Rx++,()=>{Rx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),Rx--}},[])}function Y8(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var n0="right-scroll-bar-position",s0="width-before-scroll-bar",aTe="with-scroll-bars-hidden",lTe="--removed-body-scroll-bar-size";function Ox(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function cTe(e,t){var n=u.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var i=n.value;i!==s&&(n.value=s,n.callback(s,i))}}}})[0];return n.callback=t,n.facade}var uTe=typeof window<"u"?u.useLayoutEffect:u.useEffect,X8=new WeakMap;function dTe(e,t){var n=cTe(null,function(s){return e.forEach(function(i){return Ox(i,s)})});return uTe(function(){var s=X8.get(n);if(s){var i=new Set(s),o=new Set(e),a=n.current;i.forEach(function(l){o.has(l)||Ox(l,null)}),o.forEach(function(l){i.has(l)||Ox(l,a)})}X8.set(n,e)},[e]),n}function hTe(e){return e}function fTe(e,t){t===void 0&&(t=hTe);var n=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var a=t(o,s);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(s=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){s=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var h=a;a=[],h.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(h){a.push(h),d()},filter:function(h){return a=a.filter(h),n}}}};return i}function pTe(e){e===void 0&&(e={});var t=fTe(null);return t.options=Zi({async:!0,ssr:!1},e),t}var tU=function(e){var t=e.sideCar,n=M7(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return u.createElement(s,Zi({},n))};tU.isSideCarExport=!0;function gTe(e,t){return e.useMedium(t),tU}var nU=pTe(),Nx=function(){},Nv=u.forwardRef(function(e,t){var n=u.useRef(null),s=u.useState({onScrollCapture:Nx,onWheelCapture:Nx,onTouchMoveCapture:Nx}),i=s[0],o=s[1],a=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,h=e.enabled,f=e.shards,p=e.sideCar,g=e.noIsolation,m=e.inert,y=e.allowPinchZoom,b=e.as,C=b===void 0?"div":b,v=M7(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),x=p,S=dTe([n,t]),w=Zi(Zi({},v),i);return u.createElement(u.Fragment,null,h&&u.createElement(x,{sideCar:nU,removeScrollBar:d,shards:f,noIsolation:g,inert:m,setCallbacks:o,allowPinchZoom:!!y,lockRef:n}),a?u.cloneElement(u.Children.only(l),Zi(Zi({},w),{ref:S})):u.createElement(C,Zi({},w,{className:c,ref:S}),l))});Nv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Nv.classNames={fullWidth:s0,zeroRight:n0};var mTe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function yTe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=mTe();return t&&e.setAttribute("nonce",t),e}function vTe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function bTe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var xTe=function(){var e=0,t=null;return{add:function(n){e==0&&(t=yTe())&&(vTe(t,n),bTe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},CTe=function(){var e=xTe();return function(t,n){u.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},sU=function(){var e=CTe(),t=function(n){var s=n.styles,i=n.dynamic;return e(s,i),null};return t},STe={left:0,top:0,right:0,gap:0},Fx=function(e){return parseInt(e||"",10)||0},wTe=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],i=t[e==="padding"?"paddingRight":"marginRight"];return[Fx(n),Fx(s),Fx(i)]},jTe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return STe;var t=wTe(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},kTe=sU(),yu="data-scroll-locked",_Te=function(e,t,n,s){var i=e.left,o=e.top,a=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(aTe,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(yu,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(n0,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(s0,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(n0," .").concat(n0,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(s0," .").concat(s0,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(yu,`] {
    `).concat(lTe,": ").concat(l,`px;
  }
`)},Q8=function(){var e=parseInt(document.body.getAttribute(yu)||"0",10);return isFinite(e)?e:0},ITe=function(){u.useEffect(function(){return document.body.setAttribute(yu,(Q8()+1).toString()),function(){var e=Q8()-1;e<=0?document.body.removeAttribute(yu):document.body.setAttribute(yu,e.toString())}},[])},ATe=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,i=s===void 0?"margin":s;ITe();var o=u.useMemo(function(){return jTe(i)},[i]);return u.createElement(kTe,{styles:_Te(o,!t,i,n?"":"!important")})},nS=!1;if(typeof window<"u")try{var Im=Object.defineProperty({},"passive",{get:function(){return nS=!0,!0}});window.addEventListener("test",Im,Im),window.removeEventListener("test",Im,Im)}catch{nS=!1}var Ac=nS?{passive:!1}:!1,TTe=function(e){return e.tagName==="TEXTAREA"},rU=function(e,t){var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!TTe(e)&&n[t]==="visible")},ETe=function(e){return rU(e,"overflowY")},MTe=function(e){return rU(e,"overflowX")},J8=function(e,t){var n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=iU(e,n);if(s){var i=oU(e,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},PTe=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},LTe=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},iU=function(e,t){return e==="v"?ETe(t):MTe(t)},oU=function(e,t){return e==="v"?PTe(t):LTe(t)},DTe=function(e,t){return e==="h"&&t==="rtl"?-1:1},RTe=function(e,t,n,s,i){var o=DTe(e,window.getComputedStyle(t).direction),a=o*s,l=n.target,c=t.contains(l),d=!1,h=a>0,f=0,p=0;do{var g=oU(e,l),m=g[0],y=g[1],b=g[2],C=y-b-o*m;(m||C)&&iU(e,l)&&(f+=C,p+=m),l=l.parentNode}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(h&&f===0||!h&&p===0)&&(d=!0),d},Am=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},e3=function(e){return[e.deltaX,e.deltaY]},t3=function(e){return e&&"current"in e?e.current:e},OTe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},NTe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},FTe=0,Tc=[];function BTe(e){var t=u.useRef([]),n=u.useRef([0,0]),s=u.useRef(),i=u.useState(FTe++)[0],o=u.useState(function(){return sU()})[0],a=u.useRef(e);u.useEffect(function(){a.current=e},[e]),u.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var y=H2([e.lockRef.current],(e.shards||[]).map(t3),!0).filter(Boolean);return y.forEach(function(b){return b.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),y.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var l=u.useCallback(function(y,b){if("touches"in y&&y.touches.length===2)return!a.current.allowPinchZoom;var C=Am(y),v=n.current,x="deltaX"in y?y.deltaX:v[0]-C[0],S="deltaY"in y?y.deltaY:v[1]-C[1],w,j=y.target,P=Math.abs(x)>Math.abs(S)?"h":"v";if("touches"in y&&P==="h"&&j.type==="range")return!1;var T=J8(P,j);if(!T)return!0;if(T?w=P:(w=P==="v"?"h":"v",T=J8(P,j)),!T)return!1;if(!s.current&&"changedTouches"in y&&(x||S)&&(s.current=w),!w)return!0;var L=s.current||w;return RTe(L,b,y,L==="h"?x:S)},[]),c=u.useCallback(function(y){var b=y;if(!(!Tc.length||Tc[Tc.length-1]!==o)){var C="deltaY"in b?e3(b):Am(b),v=t.current.filter(function(w){return w.name===b.type&&w.target===b.target&&OTe(w.delta,C)})[0];if(v&&v.should){b.cancelable&&b.preventDefault();return}if(!v){var x=(a.current.shards||[]).map(t3).filter(Boolean).filter(function(w){return w.contains(b.target)}),S=x.length>0?l(b,x[0]):!a.current.noIsolation;S&&b.cancelable&&b.preventDefault()}}},[]),d=u.useCallback(function(y,b,C,v){var x={name:y,delta:b,target:C,should:v};t.current.push(x),setTimeout(function(){t.current=t.current.filter(function(S){return S!==x})},1)},[]),h=u.useCallback(function(y){n.current=Am(y),s.current=void 0},[]),f=u.useCallback(function(y){d(y.type,e3(y),y.target,l(y,e.lockRef.current))},[]),p=u.useCallback(function(y){d(y.type,Am(y),y.target,l(y,e.lockRef.current))},[]);u.useEffect(function(){return Tc.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Ac),document.addEventListener("touchmove",c,Ac),document.addEventListener("touchstart",h,Ac),function(){Tc=Tc.filter(function(y){return y!==o}),document.removeEventListener("wheel",c,Ac),document.removeEventListener("touchmove",c,Ac),document.removeEventListener("touchstart",h,Ac)}},[]);var g=e.removeScrollBar,m=e.inert;return u.createElement(u.Fragment,null,m?u.createElement(o,{styles:NTe(i)}):null,g?u.createElement(ATe,{gapMode:"margin"}):null)}const $Te=gTe(nU,BTe);var aU=u.forwardRef(function(e,t){return u.createElement(Nv,Zi({},e,{ref:t,sideCar:$Te}))});aU.classNames=Nv.classNames;var VTe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Ec=new WeakMap,Tm=new WeakMap,Em={},Bx=0,lU=function(e){return e&&(e.host||lU(e.parentNode))},GTe=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=lU(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},zTe=function(e,t,n,s){var i=GTe(t,Array.isArray(e)?e:[e]);Em[n]||(Em[n]=new WeakMap);var o=Em[n],a=[],l=new Set,c=new Set(i),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};i.forEach(d);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(p){if(l.has(p))h(p);else try{var g=p.getAttribute(s),m=g!==null&&g!=="false",y=(Ec.get(p)||0)+1,b=(o.get(p)||0)+1;Ec.set(p,y),o.set(p,b),a.push(p),y===1&&m&&Tm.set(p,!0),b===1&&p.setAttribute(n,"true"),m||p.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",p,C)}})};return h(t),l.clear(),Bx++,function(){a.forEach(function(f){var p=Ec.get(f)-1,g=o.get(f)-1;Ec.set(f,p),o.set(f,g),p||(Tm.has(f)||f.removeAttribute(s),Tm.delete(f)),g||f.removeAttribute(n)}),Bx--,Bx||(Ec=new WeakMap,Ec=new WeakMap,Tm=new WeakMap,Em={})}},HTe=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),i=VTe(e);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live]"))),zTe(s,i,n,"aria-hidden")):function(){return null}};const cU="Dialog",[uU,BLe]=PAe(cU),[WTe,gc]=uU(cU),UTe=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:i,onOpenChange:o,modal:a=!0}=e,l=u.useRef(null),c=u.useRef(null),[d=!1,h]=OAe({prop:s,defaultProp:i,onChange:o});return u.createElement(WTe,{scope:t,triggerRef:l,contentRef:c,contentId:Px(),titleId:Px(),descriptionId:Px(),open:d,onOpenChange:h,onOpenToggle:u.useCallback(()=>h(f=>!f),[h]),modal:a},n)},dU="DialogPortal",[qTe,hU]=uU(dU,{forceMount:void 0}),KTe=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:i}=e,o=gc(dU,t);return u.createElement(qTe,{scope:t,forceMount:n},u.Children.map(s,a=>u.createElement(Ov,{present:n||o.open},u.createElement(sTe,{asChild:!0,container:i},a))))},sS="DialogOverlay",ZTe=u.forwardRef((e,t)=>{const n=hU(sS,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=gc(sS,e.__scopeDialog);return o.modal?u.createElement(Ov,{present:s||o.open},u.createElement(YTe,Ss({},i,{ref:t}))):null}),YTe=u.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=gc(sS,n);return u.createElement(aU,{as:P_,allowPinchZoom:!0,shards:[i.contentRef]},u.createElement(oi.div,Ss({"data-state":pU(i.open)},s,{ref:t,style:{pointerEvents:"auto",...s.style}})))}),Ou="DialogContent",XTe=u.forwardRef((e,t)=>{const n=hU(Ou,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=gc(Ou,e.__scopeDialog);return u.createElement(Ov,{present:s||o.open},o.modal?u.createElement(QTe,Ss({},i,{ref:t})):u.createElement(JTe,Ss({},i,{ref:t})))}),QTe=u.forwardRef((e,t)=>{const n=gc(Ou,e.__scopeDialog),s=u.useRef(null),i=_g(t,n.contentRef,s);return u.useEffect(()=>{const o=s.current;if(o)return HTe(o)},[]),u.createElement(fU,Ss({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:mu(e.onCloseAutoFocus,o=>{var a;o.preventDefault(),(a=n.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:mu(e.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:mu(e.onFocusOutside,o=>o.preventDefault())}))}),JTe=u.forwardRef((e,t)=>{const n=gc(Ou,e.__scopeDialog),s=u.useRef(!1),i=u.useRef(!1);return u.createElement(fU,Ss({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var a;if((a=e.onCloseAutoFocus)===null||a===void 0||a.call(e,o),!o.defaultPrevented){var l;s.current||(l=n.triggerRef.current)===null||l===void 0||l.focus(),o.preventDefault()}s.current=!1,i.current=!1},onInteractOutside:o=>{var a,l;(a=e.onInteractOutside)===null||a===void 0||a.call(e,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const c=o.target;((l=n.triggerRef.current)===null||l===void 0?void 0:l.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),fU=u.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,...a}=e,l=gc(Ou,n),c=u.useRef(null),d=_g(t,c);return oTe(),u.createElement(u.Fragment,null,u.createElement(YAe,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:o},u.createElement(qAe,Ss({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":pU(l.open)},a,{ref:d,onDismiss:()=>l.onOpenChange(!1)}))),!1)}),e8e="DialogTitle";function pU(e){return e?"open":"closed"}const t8e="DialogTitleWarning";MAe(t8e,{contentName:Ou,titleName:e8e,docsSlug:"dialog"});const n8e=UTe,s8e=KTe,r8e=ZTe,i8e=XTe;var Bh='[cmdk-group=""]',$x='[cmdk-group-items=""]',o8e='[cmdk-group-heading=""]',L_='[cmdk-item=""]',n3=`${L_}:not([aria-disabled="true"])`,rS="cmdk-item-select",yl="data-value",a8e=(e,t,n)=>TAe(e,t,n),gU=u.createContext(void 0),Ig=()=>u.useContext(gU),mU=u.createContext(void 0),D_=()=>u.useContext(mU),yU=u.createContext(void 0),R_=u.forwardRef((e,t)=>{let n=Vc(()=>{var H,V;return{search:"",value:(V=(H=e.value)!=null?H:e.defaultValue)!=null?V:"",filtered:{count:0,items:new Map,groups:new Set}}}),s=Vc(()=>new Set),i=Vc(()=>new Map),o=Vc(()=>new Map),a=Vc(()=>new Set),l=CU(e),{label:c,children:d,value:h,onValueChange:f,filter:p,shouldFilter:g,loop:m,disablePointerSelection:y=!1,vimBindings:b=!0,...C}=e,v=u.useId(),x=u.useId(),S=u.useId(),w=u.useRef(null),j=g8e();ql(()=>{if(h!==void 0){let H=h.trim();n.current.value=H,P.emit()}},[h]),ql(()=>{j(6,_)},[]);let P=u.useMemo(()=>({subscribe:H=>(a.current.add(H),()=>a.current.delete(H)),snapshot:()=>n.current,setState:(H,V,Y)=>{var W,J,N;if(!Object.is(n.current[H],V)){if(n.current[H]=V,H==="search")F(),E(),j(1,O);else if(H==="value"&&(Y||j(5,_),((W=l.current)==null?void 0:W.value)!==void 0)){let B=V??"";(N=(J=l.current).onValueChange)==null||N.call(J,B);return}P.emit()}},emit:()=>{a.current.forEach(H=>H())}}),[]),T=u.useMemo(()=>({value:(H,V,Y)=>{var W;V!==((W=o.current.get(H))==null?void 0:W.value)&&(o.current.set(H,{value:V,keywords:Y}),n.current.filtered.items.set(H,L(V,Y)),j(2,()=>{E(),P.emit()}))},item:(H,V)=>(s.current.add(H),V&&(i.current.has(V)?i.current.get(V).add(H):i.current.set(V,new Set([H]))),j(3,()=>{F(),E(),n.current.value||O(),P.emit()}),()=>{o.current.delete(H),s.current.delete(H),n.current.filtered.items.delete(H);let Y=R();j(4,()=>{F(),(Y==null?void 0:Y.getAttribute("id"))===H&&O(),P.emit()})}),group:H=>(i.current.has(H)||i.current.set(H,new Set),()=>{o.current.delete(H),i.current.delete(H)}),filter:()=>l.current.shouldFilter,label:c||e["aria-label"],disablePointerSelection:y,listId:v,inputId:S,labelId:x,listInnerRef:w}),[]);function L(H,V){var Y,W;let J=(W=(Y=l.current)==null?void 0:Y.filter)!=null?W:a8e;return H?J(H,n.current.search,V):0}function E(){if(!n.current.search||l.current.shouldFilter===!1)return;let H=n.current.filtered.items,V=[];n.current.filtered.groups.forEach(W=>{let J=i.current.get(W),N=0;J.forEach(B=>{let U=H.get(B);N=Math.max(U,N)}),V.push([W,N])});let Y=w.current;D().sort((W,J)=>{var N,B;let U=W.getAttribute("id"),ie=J.getAttribute("id");return((N=H.get(ie))!=null?N:0)-((B=H.get(U))!=null?B:0)}).forEach(W=>{let J=W.closest($x);J?J.appendChild(W.parentElement===J?W:W.closest(`${$x} > *`)):Y.appendChild(W.parentElement===Y?W:W.closest(`${$x} > *`))}),V.sort((W,J)=>J[1]-W[1]).forEach(W=>{let J=w.current.querySelector(`${Bh}[${yl}="${encodeURIComponent(W[0])}"]`);J==null||J.parentElement.appendChild(J)})}function O(){let H=D().find(Y=>Y.getAttribute("aria-disabled")!=="true"),V=H==null?void 0:H.getAttribute(yl);P.setState("value",V||void 0)}function F(){var H,V,Y,W;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let J=0;for(let N of s.current){let B=(V=(H=o.current.get(N))==null?void 0:H.value)!=null?V:"",U=(W=(Y=o.current.get(N))==null?void 0:Y.keywords)!=null?W:[],ie=L(B,U);n.current.filtered.items.set(N,ie),ie>0&&J++}for(let[N,B]of i.current)for(let U of B)if(n.current.filtered.items.get(U)>0){n.current.filtered.groups.add(N);break}n.current.filtered.count=J}function _(){var H,V,Y;let W=R();W&&(((H=W.parentElement)==null?void 0:H.firstChild)===W&&((Y=(V=W.closest(Bh))==null?void 0:V.querySelector(o8e))==null||Y.scrollIntoView({block:"nearest"})),W.scrollIntoView({block:"nearest"}))}function R(){var H;return(H=w.current)==null?void 0:H.querySelector(`${L_}[aria-selected="true"]`)}function D(){var H;return Array.from((H=w.current)==null?void 0:H.querySelectorAll(n3))}function $(H){let V=D()[H];V&&P.setState("value",V.getAttribute(yl))}function G(H){var V;let Y=R(),W=D(),J=W.findIndex(B=>B===Y),N=W[J+H];(V=l.current)!=null&&V.loop&&(N=J+H<0?W[W.length-1]:J+H===W.length?W[0]:W[J+H]),N&&P.setState("value",N.getAttribute(yl))}function ee(H){let V=R(),Y=V==null?void 0:V.closest(Bh),W;for(;Y&&!W;)Y=H>0?f8e(Y,Bh):p8e(Y,Bh),W=Y==null?void 0:Y.querySelector(n3);W?P.setState("value",W.getAttribute(yl)):G(H)}let Q=()=>$(D().length-1),se=H=>{H.preventDefault(),H.metaKey?Q():H.altKey?ee(1):G(1)},ne=H=>{H.preventDefault(),H.metaKey?$(0):H.altKey?ee(-1):G(-1)};return u.createElement(oi.div,{ref:t,tabIndex:-1,...C,"cmdk-root":"",onKeyDown:H=>{var V;if((V=C.onKeyDown)==null||V.call(C,H),!H.defaultPrevented)switch(H.key){case"n":case"j":{b&&H.ctrlKey&&se(H);break}case"ArrowDown":{se(H);break}case"p":case"k":{b&&H.ctrlKey&&ne(H);break}case"ArrowUp":{ne(H);break}case"Home":{H.preventDefault(),$(0);break}case"End":{H.preventDefault(),Q();break}case"Enter":if(!H.nativeEvent.isComposing&&H.keyCode!==229){H.preventDefault();let Y=R();if(Y){let W=new Event(rS);Y.dispatchEvent(W)}}}}},u.createElement("label",{"cmdk-label":"",htmlFor:T.inputId,id:T.labelId,style:y8e},c),Fv(e,H=>u.createElement(mU.Provider,{value:P},u.createElement(gU.Provider,{value:T},H))))}),vU=u.forwardRef((e,t)=>{var n,s;let i=u.useId(),o=u.useRef(null),a=u.useContext(yU),l=Ig(),c=CU(e),d=(s=(n=c.current)==null?void 0:n.forceMount)!=null?s:a==null?void 0:a.forceMount;ql(()=>{if(!d)return l.item(i,a==null?void 0:a.id)},[d]);let h=SU(i,o,[e.value,e.children,o],e.keywords),f=D_(),p=Kl(j=>j.value&&j.value===h.current),g=Kl(j=>d||l.filter()===!1?!0:j.search?j.filtered.items.get(i)>0:!0);u.useEffect(()=>{let j=o.current;if(!(!j||e.disabled))return j.addEventListener(rS,m),()=>j.removeEventListener(rS,m)},[g,e.onSelect,e.disabled]);function m(){var j,P;y(),(P=(j=c.current).onSelect)==null||P.call(j,h.current)}function y(){f.setState("value",h.current,!0)}if(!g)return null;let{disabled:b,value:C,onSelect:v,forceMount:x,keywords:S,...w}=e;return u.createElement(oi.div,{ref:ip([o,t]),...w,id:i,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!p,"data-disabled":!!b,"data-selected":!!p,onPointerMove:b||l.disablePointerSelection?void 0:y,onClick:b?void 0:m},e.children)}),l8e=u.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:i,...o}=e,a=u.useId(),l=u.useRef(null),c=u.useRef(null),d=u.useId(),h=Ig(),f=Kl(g=>i||h.filter()===!1?!0:g.search?g.filtered.groups.has(a):!0);ql(()=>h.group(a),[]),SU(a,l,[e.value,e.heading,c]);let p=u.useMemo(()=>({id:a,forceMount:i}),[i]);return u.createElement(oi.div,{ref:ip([l,t]),...o,"cmdk-group":"",role:"presentation",hidden:f?void 0:!0},n&&u.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:d},n),Fv(e,g=>u.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?d:void 0},u.createElement(yU.Provider,{value:p},g))))}),c8e=u.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,i=u.useRef(null),o=Kl(a=>!a.search);return!n&&!o?null:u.createElement(oi.div,{ref:ip([i,t]),...s,"cmdk-separator":"",role:"separator"})}),u8e=u.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,i=e.value!=null,o=D_(),a=Kl(h=>h.search),l=Kl(h=>h.value),c=Ig(),d=u.useMemo(()=>{var h;let f=(h=c.listInnerRef.current)==null?void 0:h.querySelector(`${L_}[${yl}="${encodeURIComponent(l)}"]`);return f==null?void 0:f.getAttribute("id")},[]);return u.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),u.createElement(oi.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":d,id:c.inputId,type:"text",value:i?e.value:a,onChange:h=>{i||o.setState("search",h.target.value),n==null||n(h.target.value)}})}),bU=u.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...i}=e,o=u.useRef(null),a=u.useRef(null),l=Ig();return u.useEffect(()=>{if(a.current&&o.current){let c=a.current,d=o.current,h,f=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let p=c.offsetHeight;d.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return f.observe(c),()=>{cancelAnimationFrame(h),f.unobserve(c)}}},[]),u.createElement(oi.div,{ref:ip([o,t]),...i,"cmdk-list":"",role:"listbox","aria-label":s,id:l.listId},Fv(e,c=>u.createElement("div",{ref:ip([a,l.listInnerRef]),"cmdk-list-sizer":""},c)))}),d8e=u.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:i,contentClassName:o,container:a,...l}=e;return u.createElement(n8e,{open:n,onOpenChange:s},u.createElement(s8e,{container:a},u.createElement(r8e,{"cmdk-overlay":"",className:i}),u.createElement(i8e,{"aria-label":e.label,"cmdk-dialog":"",className:o},u.createElement(R_,{ref:t,...l}))))}),xU=u.forwardRef((e,t)=>Kl(n=>n.filtered.count===0)?u.createElement(oi.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),h8e=u.forwardRef((e,t)=>{let{progress:n,children:s,label:i="Loading...",...o}=e;return u.createElement(oi.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},Fv(e,a=>u.createElement("div",{"aria-hidden":!0},a)))});Object.assign(R_,{List:bU,Item:vU,Input:u8e,Group:l8e,Separator:c8e,Dialog:d8e,Empty:xU,Loading:h8e});function f8e(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function p8e(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function CU(e){let t=u.useRef(e);return ql(()=>{t.current=e}),t}var ql=typeof window>"u"?u.useEffect:u.useLayoutEffect;function Vc(e){let t=u.useRef();return t.current===void 0&&(t.current=e()),t}function ip(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function Kl(e){let t=D_(),n=()=>e(t.snapshot());return u.useSyncExternalStore(t.subscribe,n,n)}function SU(e,t,n,s=[]){let i=u.useRef(),o=Ig();return ql(()=>{var a;let l=(()=>{var d;for(let h of n){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(d=h.current.textContent)==null?void 0:d.trim():i.current}})(),c=s.map(d=>d.trim());o.value(e,l,c),(a=t.current)==null||a.setAttribute(yl,l),i.current=l}),i}var g8e=()=>{let[e,t]=u.useState(),n=Vc(()=>new Map);return ql(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,i)=>{n.current.set(s,i),t({})}};function m8e(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function Fv({asChild:e,children:t},n){return e&&u.isValidElement(t)?u.cloneElement(m8e(t),{ref:t.ref},n(t.props.children)):n(t)}var y8e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const v8e=e=>{const t=m0();return{..._P,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},b8e=e=>{const t=m0();return{..._P,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},x8e=()=>{const e=ce(Tn);return u.useCallback(t=>{var c;const n=sf.get();Ge(n!==null);let s=window.innerWidth/2,i=window.innerHeight/2;const o=(c=document.querySelector("#workflow-editor"))==null?void 0:c.getBoundingClientRect();o&&(s=o.width/2-p2/2+o.left,i=o.height/2-p2/2+o.top);const a=n.screenToFlowPosition({x:s,y:i});if(t==="current_image")return v8e(a);if(t==="notes")return b8e(a);const l=e[t];return dse(a,l)},[e])},wU=(e,t,n)=>{let s=t,i=n;for(;e.find(o=>o.position.x===s&&o.position.y===i);)s=Math.floor(s+50),i=Math.floor(i+50);return{x:s,y:i}},jU=(e,t)=>{const n="originalType"in e?Ol(e,"originalType"):e,s="originalType"in t?Ol(t,"originalType"):t,i="originalType"in e?e.originalType:null,o="originalType"in t?t.originalType:null;return!!(bl(n,s)||o&&bl(n,o)||i&&bl(i,s)||i&&o&&bl(i,o))},C8e=(e,t,n,s)=>{const i=n.find(c=>c.target===s&&c.targetHandle==="item");if(!(i!=null&&i.sourceHandle))return null;const o=t.find(c=>c.id===i.source);if(!o)return null;const a=e[o.data.type];if(!a)return null;const l=a.outputs[i.sourceHandle];return l?l.type:null};var S8e=hse();const s3=Nu(S8e),w8e=(e,t,n,s)=>{const i=new s3.Graph;return n.forEach(o=>{i.setNode(o.id)}),s.forEach(o=>{i.setEdge(o.source,o.target)}),i.setEdge(e,t),!s3.alg.isAcyclic(i)},kU=(e,t)=>{if(jU(e,t))return!0;if(e.batch!==t.batch)return!1;const n=e.name==="CollectionItemField"&&!Lc(t),s=Ng(e)&&t.name==="CollectionItemField",i=ya(t)&&e.name===t.name,o=e.name==="CollectionField"&&!Ng(t),a=t.name==="CollectionField"&&Lc(e),l=Ng(e),c=Ng(t),d=l&&c,h=l&&ya(t),f=Lc(e)&&Lc(t),p=Lc(e)&&ya(t),g=ya(e)&&ya(t),m=d||f||p||g||h,y=e.name==="IntegerField"&&t.name==="FloatField",b=e.name==="IntegerField"&&t.name==="StringField",C=e.name==="FloatField"&&t.name==="StringField",v=m&&(y||b||C),x=t.name==="AnyField";return n||s||i||o||a||v||x},j8e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,k8e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,Ag=(e,t,n,s,i,o=!0)=>{if(e.source===e.target)return"nodes.cannotConnectToSelf";if(o){const a=n.filter(g=>g.id!==(i==null?void 0:i.id));if(a.some(j8e(e)))return"nodes.cannotDuplicateConnection";const l=t.find(g=>g.id===e.source);if(!l)return"nodes.missingNode";const c=t.find(g=>g.id===e.target);if(!c)return"nodes.missingNode";const d=s[l.data.type];if(!d)return"nodes.missingInvocationTemplate";const h=s[c.data.type];if(!h)return"nodes.missingInvocationTemplate";const f=d.outputs[e.sourceHandle];if(!f)return"nodes.missingFieldTemplate";const p=h.inputs[e.targetHandle];if(!p)return"nodes.missingFieldTemplate";if(p.input==="direct")return"nodes.cannotConnectToDirectInput";if(c.data.type==="collect"&&e.targetHandle==="item"){const g=C8e(s,t,n,c.id);if(g&&!jU(f.type,g))return"nodes.cannotMixAndMatchCollectionItemTypes"}if(a.find(k8e(e))&&p.type.name!=="CollectionItemField")return"nodes.inputMayOnlyHaveOneConnection";if(!kU(f.type,p.type))return"nodes.fieldTypesMustMatch"}return w8e(e.source,e.target,t,n)?"nodes.connectionWouldCreateCycle":null},_U=(e,t,n,s,i,o,a,l)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const d=_8e(e,t,n,i,o,a,l)[0];return d?{source:e,sourceHandle:t,target:n,targetHandle:d.name}:null}if(!t&&s){const d=I8e(n,s,e,i,o,a,l)[0];return d?{source:e,sourceHandle:d.name,target:n,targetHandle:s}:null}return null},_8e=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!l||!c)return[];const d=o[l.data.type],h=o[c.data.type];return!d||!h?[]:d.outputs[t]?_i(h.inputs).filter(g=>{const m={source:e,sourceHandle:t,target:n,targetHandle:g.name};return Ag(m,s,i,o,a,!0)===null}):[]},I8e=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!c||!l)return[];const d=o[c.data.type],h=o[l.data.type];return!d||!h?[]:h.inputs[t]?_i(d.outputs).filter(g=>{const m={source:n,sourceHandle:g.name,target:e,targetHandle:t};return Ag(m,s,i,o,a,!0)===null}):[]},A8e=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return`reactflow__edge-${t}${n||""}-${s}${i||""}`},$1=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return Ge(t&&n&&s&&i,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:i,id:A8e({source:t,sourceHandle:n,target:s,targetHandle:i})}},T8e=()=>{const{t:e}=M(),t=Wu(),n=x8e(),s=ce(Tn),i=ce(mr);return u.useCallback(a=>{const l=n(a);if(!l){const g=e("nodes.unknownNode",{nodeType:a});ve({status:"error",title:g});return}const c=uw.get(),{nodes:d,edges:h}=lt(t.getState());l.position=wU(d,(c==null?void 0:c.x)??l.position.x,(c==null?void 0:c.y)??l.position.y),l.selected=!0;const f=[{type:"add",item:l}],p=[];if(d.forEach(({id:g,selected:m})=>{m&&f.push({type:"select",id:g,selected:!1})}),h.forEach(({id:g,selected:m})=>{m&&p.push({type:"select",id:g,selected:!1})}),f.length>0&&t.dispatch(rf(f)),p.length>0&&t.dispatch(Ki(p)),i&&Jr(l)){const g=Tl.get(),{handleType:m}=i,y=m==="source"?i.nodeId:l.id,b=m==="source"?i.handleId:null,C=m==="target"?i.nodeId:l.id,v=m==="target"?i.handleId:null,{nodes:x,edges:S}=lt(t.getState()),w=_U(y,b,C,v,x,S,s,g);if(w){const j=$1(w);t.dispatch(Ki([{type:"add",item:j}]))}}},[n,i,t,e,s])},E8e={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},IU=u.memo(()=>{const{t:e}=M(),t=u.useRef(null),[n,s]=u.useState(""),i=T8e(),o=I(En),[a]=Ju(n,300),l=ce(ou),c=u.useCallback(()=>{ou.set(!0)},[]),d=u.useCallback(()=>{ou.set(!1)},[]);Le({id:"addNode",category:"workflows",callback:c,options:{enabled:o==="workflows",preventDefault:!0},dependencies:[c,o]});const h=u.useCallback(g=>{s(g.target.value)},[]),f=u.useCallback(()=>{d(),s(""),mr.set(null)},[d]),p=u.useCallback(g=>{i(g),f()},[i,f]);return r.jsxs(ni,{isOpen:l,onClose:f,useInert:!1,initialFocusRef:t,size:"xl",isCentered:!0,children:[r.jsx(nr,{}),r.jsx(si,{h:"512",maxH:"70%",children:r.jsx(sr,{p:2,h:"full",sx:E8e,children:r.jsx(R_,{loop:!0,shouldFilter:!1,children:r.jsxs(A,{flexDir:"column",h:"full",gap:2,children:[r.jsx(jt,{ref:t,value:n,onChange:h,placeholder:e("nodes.nodeSearch")}),r.jsx(Se,{w:"full",h:"full",children:r.jsxs($n,{children:[r.jsx(xU,{children:r.jsx(Ot,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),r.jsx(bU,{children:r.jsx(AU,{searchTerm:a,onSelect:p})})]})})]})})})})]})});IU.displayName="AddNodeCmdk";const M8e={'&[data-selected="true"]':{bg:"base.700"}},P8e=rs(Tn,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),L8e=IP(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),Vx=IP((e,t)=>{const n=L8e(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),AU=u.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=M(),s=ce(P8e),i=ce(mr),o=u.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),a=u.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),l=u.useMemo(()=>{const c=[];if(i){for(const d of s)if(Vx(d,e)){const h=i.handleType==="source"?d.inputs:d.outputs;for(const[f,p]of iie(h)){const g=i.handleType==="source"?i.fieldTemplate.type:p.type,m=i.handleType==="target"?i.fieldTemplate.type:p.type;if(kU(g,m)){c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});break}}}}else{for(const d of s)Vx(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});for(const d of[o,a])Vx(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack})}return c},[i,s,e,o,a]);return r.jsx(r.Fragment,{children:l.map(c=>r.jsx(vU,{value:c.value,onSelect:t,asChild:!0,children:r.jsxs(A,{role:"button",flexDir:"column",sx:M8e,py:1,px:2,borderRadius:"base",children:[r.jsxs(A,{alignItems:"center",gap:2,children:[c.classification==="beta"&&r.jsx(dt,{boxSize:4,color:"invokeYellow.300",as:VL}),c.classification==="prototype"&&r.jsx(dt,{boxSize:4,color:"invokeRed.300",as:Ew}),c.classification==="internal"&&r.jsx(dt,{boxSize:4,color:"invokePurple.300",as:RL}),c.classification==="special"&&r.jsx(dt,{boxSize:4,color:"invokeGreen.300",as:Ly}),r.jsx(q,{fontWeight:"semibold",children:c.label}),r.jsx(rt,{}),r.jsx(q,{variant:"subtext",fontWeight:"semibold",children:c.nodePack})]}),c.description&&r.jsx(q,{color:"base.200",children:c.description})]})},c.value))})});AU.displayName="CommandListItems";const D8e=()=>{const{t:e}=M(),t=u.useCallback(()=>{ou.set(!0)},[]);return r.jsx(oe,{tooltip:e("nodes.addNodeToolTip"),"aria-label":e("nodes.addNode"),icon:r.jsx(Gt,{}),onClick:t,pointerEvents:"auto"})},R8e=u.memo(D8e),O8e=()=>{const e=z(),{t}=M(),{isOpen:n,onOpen:s,onClose:i}=ir(),o=I(Yu),a=u.useCallback(()=>{e(YM()),ve({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),i()},[e,i,t]),l=u.useCallback(()=>{if(!o){a();return}s()},[a,o,s]);return r.jsxs(r.Fragment,{children:[r.jsx(oe,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:r.jsx(Ry,{}),onClick:l,pointerEvents:"auto"}),r.jsx(Tr,{isOpen:n,onClose:i,title:t("nodes.clearWorkflow"),acceptCallback:a,useInert:!1,children:r.jsxs(A,{flexDir:"column",gap:2,children:[r.jsx(q,{children:t("nodes.clearWorkflowDesc")}),r.jsx(q,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},N8e=u.memo(O8e),F8e=()=>{const{t:e}=M(),t=I(Yu),{onOpen:n}=Id(),{saveWorkflow:s}=u_(),i=u.useCallback(()=>{const o=nl.get();o&&(Av(o)?s():n())},[n,s]);return r.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(eo,{}),isDisabled:!t,onClick:i,pointerEvents:"auto"})},B8e=u.memo(F8e),TU=()=>{const e=ce(Tn),t=u.useMemo(()=>pe(lt,s=>s.nodes.filter(Jr).some(i=>{const o=e[i.data.type];return o?fse(i.data,o):!1})),[e]);return I(t)},$8e=()=>{const e=z(),{t}=M(),n=TU(),s=u.useCallback(()=>{e(pse())},[e]);return n?r.jsx(oe,{tooltip:t("nodes.updateAllNodes"),"aria-label":t("nodes.updateAllNodes"),icon:r.jsx(zp,{}),onClick:s,pointerEvents:"auto",colorScheme:"warning"}):null},V8e=u.memo($8e),G8e=()=>{const{t:e}=M(),[t]=gse(),n=u.useCallback(()=>{t()},[t]);return r.jsx(ye,{leftIcon:r.jsx(lae,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},z8e=u.memo(G8e),H8e={flexGrow:1},[EU]=Ql(!1),W8e=()=>{const e=z(),t=EU(),n=I(AP),s=I(TP),i=I(EP),o=I(by),a=I(MP),l=I(PP),c=u.useCallback(y=>{e(mse(y.target.checked))},[e]),d=u.useCallback(y=>{e(yse(y.target.checked))},[e]),h=u.useCallback(y=>{e(vse(y.target.checked))},[e]),f=u.useCallback(y=>{e(bse(y.target.checked))},[e]),p=u.useCallback(y=>{e(xse(y.target.checked))},[e]),g=u.useCallback(y=>{e(Cse(y.target.checked))},[e]),{t:m}=M();return r.jsxs(ni,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{children:[r.jsx(Mr,{children:m("nodes.workflowSettings")}),r.jsx(yo,{}),r.jsx(sr,{children:r.jsxs(A,{flexDirection:"column",gap:4,py:4,children:[r.jsx(Rt,{size:"sm",children:m("parameters.general")}),r.jsxs(fs,{orientation:"vertical",formLabelProps:H8e,children:[r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.animatedEdges")}),r.jsx(at,{onChange:d,isChecked:o})]}),r.jsx(Zs,{children:m("nodes.animatedEdgesHelp")})]}),r.jsx(Pt,{}),r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.snapToGrid")}),r.jsx(at,{isChecked:n,onChange:h})]}),r.jsx(Zs,{children:m("nodes.snapToGridHelp")})]}),r.jsx(Pt,{}),r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.colorCodeEdges")}),r.jsx(at,{isChecked:i,onChange:f})]}),r.jsx(Zs,{children:m("nodes.colorCodeEdgesHelp")})]}),r.jsx(Pt,{}),r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.fullyContainNodes")}),r.jsx(at,{isChecked:s===Sse.Full,onChange:p})]}),r.jsx(Zs,{children:m("nodes.fullyContainNodesHelp")})]}),r.jsx(Pt,{}),r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.showEdgeLabels")}),r.jsx(at,{isChecked:a,onChange:g})]}),r.jsx(Zs,{children:m("nodes.showEdgeLabelsHelp")})]}),r.jsx(Pt,{}),r.jsx(Rt,{size:"sm",pt:4,children:m("common.advanced")}),r.jsxs(Z,{children:[r.jsxs(A,{w:"full",children:[r.jsx(te,{children:m("nodes.validateConnections")}),r.jsx(at,{isChecked:l,onChange:c})]}),r.jsx(Zs,{children:m("nodes.validateConnectionsHelp")})]}),r.jsx(Pt,{})]}),r.jsx(z8e,{})]})})]})]})},U8e=u.memo(W8e),q8e=tn(ea,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),K8e=()=>{const{name:e,description:t,notes:n,author:s,tags:i}=I(q8e),{t:o}=M();return r.jsxs(A,{flexDir:"column",gap:"2",children:[!!e.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowName")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowAuthor")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!i.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowTags")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i})]}),!!t.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowDescription")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowNotes")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},Z8e=u.memo(K8e),Y8e=()=>{const{t:e}=M();return r.jsx(A,{flexDir:"column",gap:"2",children:r.jsxs(A,{flexDir:"column",gap:"2",children:[r.jsx(q,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),r.jsxs(A,{flexDir:"column",children:[r.jsxs(q,{children:[e("common.toResolve"),":"]}),r.jsxs(q,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},X8e=()=>TU()?r.jsx(De,{label:r.jsx(Y8e,{}),children:r.jsx(A,{h:"full",alignItems:"center",gap:"2",children:r.jsx(dt,{color:"warning.400",as:zp})})}):r.jsx(r.Fragment,{}),Q8e=()=>{const{t:e}=M(),t=I(JS),n=I(Yu),s=I(bo);return r.jsxs(A,{gap:"1",alignItems:"center",children:[t.length?r.jsx(De,{label:r.jsx(Z8e,{}),placement:"top",children:r.jsx(q,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):r.jsx(q,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&r.jsx(De,{label:e("nodes.newWorkflowDesc2"),children:r.jsx(A,{children:r.jsx(dt,{as:Yae,boxSize:"20px",sx:{color:"invokeYellow.500"}})})}),r.jsx(X8e,{})]})},J8e=()=>{const e=I(JS),t=EU(),{t:n}=M();return r.jsxs(A,{gap:2,top:2,left:2,right:2,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:[r.jsxs(A,{gap:"2",children:[r.jsx(R8e,{}),r.jsx(V8e,{})]}),r.jsx(rt,{}),!!e.length&&r.jsx(Q8e,{}),r.jsx(rt,{}),r.jsx(N8e,{}),r.jsx(B8e,{}),r.jsx(oe,{pointerEvents:"auto","aria-label":n("workflows.workflowEditorMenu"),icon:r.jsx(nd,{}),onClick:t.setTrue})]})},e3e=u.memo(J8e),t3e=()=>{const{t:e}=M(),t=z(),[n,s]=tP(),i=$z(),o=Y1(),a=u.useRef();return{saveWorkflowAs:u.useCallback(async({name:c,category:d,onSuccess:h,onError:f})=>{const p=nl.get();if(p){a.current=o({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{p.id=void 0,p.name=c,p.meta.category=d;const g=await n(p).unwrap();t(nP(g.workflow.id)),t(ZM(g.workflow.name)),t(wse(g.workflow.meta.category)),t(sP()),t(rP({formFieldInitialValues:i()})),t(mke({category:d})),h&&h(),o.update(a.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{f&&f(),o.isActive(`auth-error-toast-${g0.endpoints.createWorkflow.name}`)?o.close(a.current):o.update(a.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}}},[o,e,n,t,i]),isLoading:s.isLoading,isError:s.isError}},n3e=()=>{const{isOpen:e,onClose:t,workflowName:n,setWorkflowName:s,shouldSaveToProject:i,setShouldSaveToProject:o}=Id(),a=ce(eP),{saveWorkflowAs:l}=t3e(),c=u.useRef(null),d=u.useRef(null),h=u.useCallback(m=>{s(m.target.value)},[s]),f=u.useCallback(m=>{o(m.target.checked)},[o]),p=u.useCallback(()=>{t()},[t]),g=u.useCallback(async()=>{await l({name:n,category:i?"project":"user",onSuccess:p,onError:p})},[n,l,i,p]);return r.jsx(fE,{isOpen:e,onClose:t,leastDestructiveRef:c,isCentered:!0,children:r.jsx(nr,{children:r.jsxs(pE,{children:[r.jsx(Mr,{fontSize:"lg",fontWeight:"bold",children:Te("workflows.saveWorkflowAs")}),r.jsx(sr,{children:r.jsxs(Z,{alignItems:"flex-start",children:[r.jsx(te,{mt:"2",children:Te("workflows.workflowName")}),r.jsxs(A,{flexDir:"column",width:"full",gap:"2",children:[r.jsx(jt,{ref:d,value:n,onChange:h,placeholder:Te("workflows.workflowName")}),a.includes("project")&&r.jsx(kn,{isChecked:i,onChange:f,children:r.jsx(te,{children:Te("workflows.saveWorkflowToProject")})})]})]})}),r.jsxs(vo,{children:[r.jsx(ye,{ref:c,onClick:p,children:Te("common.cancel")}),r.jsx(ye,{colorScheme:"invokeBlue",onClick:g,ml:3,isDisabled:!n||!n.length,children:Te("common.saveAs")})]})]})})})},s3e=()=>{const e=Wu(),t=ce(Tn),n=dw(),s=u.useCallback((l,{nodeId:c,handleId:d,handleType:h})=>{Ge(c&&d&&h,"Invalid connection start event");const p=xy(e.getState()).find(b=>b.id===c);if(!p)return;const g=t[p.data.type];if(!g)return;const y=g[h==="source"?"outputs":"inputs"][d];y&&mr.set({nodeId:c,handleId:d,handleType:h,fieldTemplate:y})},[e,t]),i=u.useCallback(l=>{const{dispatch:c}=e,d=$1(l);c(Ki([{type:"add",item:d}])),n([d.source,d.target]),mr.set(null)},[e,n]),o=u.useCallback(()=>{const{dispatch:l}=e,c=mr.get(),d=Tl.get(),h=Qm.get();if(d&&!h){mr.set(null);return}if(!c)return;const{nodes:f,edges:p}=lt(e.getState());if(h){const{handleType:g}=c,m=g==="source"?c.nodeId:h,y=g==="source"?c.handleId:null,b=g==="target"?c.nodeId:h,C=g==="target"?c.handleId:null,v=_U(m,y,b,C,f,p,t,d);if(v){const x=$1(v),S=[{type:"add",item:x}],w=[x.source,x.target];d&&(Wh.set(!0),S.push({type:"remove",id:d.id}),w.push(d.source,d.target)),l(Ki(S)),n(w)}mr.set(null)}else ou.set(!0)},[e,t,n]);return u.useMemo(()=>({onConnectStart:s,onConnect:i,onConnectEnd:o}),[s,i,o])},r3e=()=>{const e=Wu(),t=ce(Tn),n=I(PP);return u.useCallback(({source:i,sourceHandle:o,target:a,targetHandle:l})=>{if(!(i&&o&&a&&l))return!1;const c=Tl.get(),{nodes:d,edges:h}=lt(e.getState());return Ag({source:i,sourceHandle:o,target:a,targetHandle:l},d,h,t,c,n)===null},[t,n,e])},Mm=Fs("workflows"),i3e=()=>{const{getState:e}=yp(),{nodes:t,edges:n}=lt(e()),s=t.filter(a=>a.selected),i=n.filter(a=>a.selected),o=n.filter(a=>s.some(l=>l.id===a.target));LP.set(s),DP.set(i),RP.set(o)},MU=e=>{const{getState:t,dispatch:n}=yp(),{nodes:s,edges:i}=lt(t()),o=Tn.get(),a=uw.get(),l=bt(LP.get());let c=bt(DP.get());if(e){const x=bt(RP.get());c=ZP([...c,...x],bl)}const d=l.map(x=>x.position.x),h=l.map(x=>x.position.y),f=Math.min(...d),p=Math.min(...h),g=a?a.x-f:50,m=a?a.y-p:50;l.forEach(x=>{const{x:S,y:w}=wU(s,x.position.x+g,x.position.y+m);x.position.x=S,x.position.y=w,x.selected=!0;const j=m0();for(const P of c)P.source===x.id?P.source=j:P.target===x.id&&(P.target=j);x.id=j,x.data.id=j}),c.forEach(x=>{x.id=m0()});const y=[],b=[];s.forEach(({id:x,selected:S})=>{S&&y.push({type:"select",id:x,selected:!1})}),l.forEach(x=>{y.push({type:"add",item:x})}),i.forEach(({id:x,selected:S})=>{S&&b.push({type:"select",id:x,selected:!1})});const C=[...s,...l],v=[...i];c.forEach(x=>{if(x.type==="collapsed"){const{type:S,source:w,target:j}=x;if(C.find(P=>P.id===x.source)===void 0||C.find(P=>P.id===x.target)===void 0){Mm.warn({edge:{type:S,source:w,target:j}},`Invalid collapsed edge, cannot paste: ${Te("nodes.missingSourceOrTargetNode")}`);return}}else if(x.type==="default"){const{type:S,source:w,sourceHandle:j,target:P,targetHandle:T}=x;if(!j||!T){Mm.warn({edge:{type:S,source:w,sourceHandle:j,target:P,targetHandle:T}},`Invalid edge, cannot paste: ${Te("nodes.missingSourceOrTargetHandle")}`);return}const L=Ag({source:w,sourceHandle:j,target:P,targetHandle:T},C,v,o,null,!0);if(L!==null){Mm.warn({edge:{source:w,sourceHandle:j,target:P,targetHandle:T}},`Invalid edge, cannot paste: ${Te(L)}`);return}}else{const{type:S}=x;Mm.warn({edge:{type:S}},"Invalid edge type, cannot paste");return}b.push({type:"add",item:x}),v.push(x)}),y.length>0&&n(rf(y)),b.length>0&&n(Ki(b))},o3e=()=>{MU(!1)},a3e=()=>{MU(!0)},l3e={copySelection:i3e,pasteSelection:o3e,pasteSelectionWithEdges:a3e},c3e=()=>l3e,Bv=e=>{if(!e)return oo("base.500");const t=jse[e.name];return oo(t||"base.500")},u3e={opacity:.8},d3e=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:i,toPosition:o})=>{const a=ce(mr),l=I(EP),c=I(by),d=u.useMemo(()=>l&&a?Bv(a.fieldTemplate.type):oo("base.500"),[a,l]),h=u.useMemo(()=>c?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[c]),f={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:i,targetPosition:o},[p]=hw(f);return r.jsx("g",{children:r.jsx("path",{fill:"none",stroke:d,strokeWidth:2,className:h,d:p,style:u3e})})},h3e=u.memo(d3e),PU=(e,t)=>pe(lt,n=>{const s=n.nodes.find(o=>o.id===e),i=n.nodes.find(o=>o.id===t);return!!(s!=null&&s.selected||i!=null&&i.selected)}),f3e=(e,t,n,s,i)=>pe(lt,W3,(o,a)=>{const{shouldColorEdges:l}=a,c=o.nodes.find(m=>m.id===t),d=o.nodes.find(m=>m.id===s);if(!c||!n||!d||!i)return oo("base.500");const h=e[c.data.type],f=Jr(c)&&Jr(d),p=h==null?void 0:h.outputs[n],g=f?p==null?void 0:p.type:void 0;return g&&l?Bv(g):oo("base.500")}),p3e=(e,t,n,s,i)=>pe(lt,o=>{var h,f;const a=o.nodes.find(p=>p.id===t),l=o.nodes.find(p=>p.id===s);if(!a||!n||!l||!i)return null;const c=e[a.data.type],d=e[l.data.type];return`${(c==null?void 0:c.title)||((h=a.data)==null?void 0:h.label)} -> ${(d==null?void 0:d.title)||((f=l.data)==null?void 0:f.label)}`}),g3e=Qo(NP),m3e={strokeWidth:"3px !important",stroke:"base.500 !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important"}},y3e={bg:"base.500",opacity:.5,shadow:"base",'&[data-selected="true"]':{opacity:1}},v3e=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,data:l,selected:c=!1,source:d,target:h})=>{const f=I(by),p=u.useMemo(()=>PU(d,h),[d,h]),g=I(p),[m,y,b]=hw({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(g3e,{path:m,markerEnd:a,sx:m3e,"data-selected":c,"data-are-connected-nodes-selected":g,"data-should-animate-edges":f}),(l==null?void 0:l.count)!==void 0&&r.jsx(OP,{children:r.jsx(Se,{position:"absolute",transform:`translate(-50%, -50%) translate(${y}px,${b}px)`,className:`edge-label-renderer__custom-edge ${Ue} ${ki}`,zIndex:1001,children:r.jsx(is,{variant:"solid",sx:y3e,"data-selected":c,children:l.count})})})]})},b3e=u.memo(v3e),x3e=Qo(NP),C3e={strokeWidth:"3px !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important",'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"}}},S3e={pointerEvents:"all",position:"absolute",bg:"base.800",borderRadius:"base",borderWidth:1,opacity:.5,borderColor:"transparent",py:1,px:3,shadow:"md",'&[data-selected="true"]':{opacity:1,borderColor:void 0}},w3e={fontWeight:"semibold",color:"base.300",'&[data-selected="true"]':{color:"base.100"}},j3e=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,selected:l=!1,source:c,target:d,sourceHandleId:h,targetHandleId:f})=>{const p=ce(Tn),g=I(by),m=I(MP),y=u.useMemo(()=>PU(c,d),[c,d]),b=u.useMemo(()=>f3e(p,c,h,d,f),[p,c,h,d,f]),C=u.useMemo(()=>p3e(p,c,h,d,f),[p,c,h,d,f]),v=I(y),x=I(b),S=I(C),[w,j,P]=hw({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(x3e,{path:w,markerEnd:a,sx:C3e,stroke:`${x} !important`,"data-selected":l,"data-are-connected-nodes-selected":v,"data-should-animate-edges":g}),S&&m&&r.jsx(OP,{children:r.jsx(A,{className:`${Ue} ${ki}`,transform:`translate(-50%, -50%) translate(${j}px,${P}px)`,"data-selected":l,sx:S3e,children:r.jsx(q,{size:"sm",sx:w3e,"data-selected":l,children:S})})})]})},k3e=u.memo(j3e),_3e={h:"full",position:"relative",borderRadius:"base",transitionProperty:"none",cursor:"grab","& .node-selection-overlay":{display:"none",position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",opacity:.5},'&[data-is-mouse-over-node="true"] .node-selection-overlay':{opacity:1,display:"block"},'&[data-is-mouse-over-form-field="true"] .node-selection-overlay':{opacity:1,display:"block",bg:"invokeBlueAlpha.100"},_hover:{"& .node-selection-overlay":{display:"block",shadow:"0 0 0 2px var(--invoke-colors-blue-300)"},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",opacity:1,shadow:"0 0 0 3px var(--invoke-colors-blue-300)"}},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",shadow:"0 0 0 3px var(--invoke-colors-blue-300)"}},I3e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",zIndex:-1,shadow:"var(--invoke-shadows-xl), var(--invoke-shadows-base), var(--invoke-shadows-base)"},A3e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"none",opacity:.7,zIndex:-1,display:"none",shadow:"0 0 0 2px var(--invoke-colors-yellow-400), 0 0 20px 2px var(--invoke-colors-orange-700)",'&[data-is-in-progress="true"]':{display:"block"}},T3e=e=>{const{nodeId:t,width:n,children:s,selected:i}=e,o=iG(t),a=Hk(t),l=oG(),c=ZS(t),d=(c==null?void 0:c.status)===Xs.enum.IN_PROGRESS,h=I(FP),f=bp(),p=u.useCallback(g=>{g.target instanceof HTMLElement&&(g.target instanceof HTMLInputElement||g.target instanceof HTMLTextAreaElement||g.target instanceof HTMLSelectElement||g.target instanceof HTMLButtonElement||g.target instanceof HTMLAnchorElement||g.target.closest(`.${ic}`)===null&&l(t))},[t,l]);return r.jsxs(Se,{onClick:f.onCloseGlobal,onDoubleClick:p,onMouseOver:o.handleMouseOver,onMouseOut:o.handleMouseOut,className:Fp,sx:_3e,width:n||p2,opacity:h,"data-is-selected":i,"data-is-mouse-over-form-field":a.isMouseOverFormField,children:[r.jsx(Se,{sx:I3e}),r.jsx(Se,{sx:A3e,"data-is-in-progress":d}),s,r.jsx(Se,{className:"node-selection-overlay"})]})},V1=u.memo(T3e),E3e=e=>{const t=I(dp),n=ce(Fo);return n!=null&&n.image?r.jsx(Gx,{nodeProps:e,children:r.jsx(dn,{src:n==null?void 0:n.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):t?r.jsx(Gx,{nodeProps:e,children:r.jsx(tl,{imageDTO:t})}):r.jsx(Gx,{nodeProps:e,children:r.jsx(Ot,{})})},M3e=u.memo(E3e),Gx=e=>{const[t,n]=u.useState(!1),s=u.useCallback(()=>{n(!0)},[]),i=u.useCallback(()=>{n(!1)},[]),{t:o}=M();return r.jsx(V1,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:r.jsxs(A,{onMouseEnter:s,onMouseLeave:i,className:Fp,position:"relative",flexDirection:"column",children:[r.jsx(A,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:r.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:o("nodes.currentImage")})}),r.jsxs(A,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&r.jsx(Jj.div,{initial:P3e,animate:L3e,exit:D3e,style:R3e,children:r.jsx(_B,{inset:2})},"nextPrevButtons")]})]})})},P3e={opacity:0},L3e={opacity:1,transition:{duration:.1}},D3e={opacity:0,transition:{duration:.1}},R3e={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},O3e={position:"relative",minH:8,py:.5,alignItems:"center",justifyContent:"flex-end"},O_=u.memo(({children:e})=>r.jsx(A,{sx:O3e,children:e}));O_.displayName="OutputFieldWrapper";const N3e=(e,t)=>{const n=ce(Tn),s=u.useMemo(()=>pe(lt,o=>{const a=cy(o,e),l=n[a.data.type],c=l==null?void 0:l.outputs[t];return(c==null?void 0:c.title)||t}),[t,e,n]);return I(s)},LU=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=N3e(e,t);return r.jsx(O_,{children:r.jsx(Z,{isInvalid:!0,alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:r.jsx(te,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:n("nodes.unknownOutput",{name:s})})})})});LU.displayName="OutputFieldUnknownPlaceholder";const F3e=(e,t)=>{const n=ce(Tn),s=u.useMemo(()=>pe(lt,o=>{const a=dy(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.outputs[t])}),[t,e,n]);return I(s)},DU=u.memo(({nodeId:e,fieldName:t,children:n})=>F3e(e,t)?n:r.jsx(LU,{nodeId:e,fieldName:t}));DU.displayName="OutputFieldGate";const B3e=(e,t,n,s,i,o)=>pe(lt,a=>{const{nodes:l,edges:c}=a;if(!i)return"nodes.noConnectionInProgress";if(s===i.handleType)return s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput";const d=s==="source"?t:i.nodeId,h=s==="source"?n:i.handleId,f=s==="target"?t:i.nodeId,p=s==="target"?n:i.handleId;return Ag({source:d,sourceHandle:h,target:f,targetHandle:p},l,c,e,o)}),$v=(e,t,n)=>{const s=ce(mr),i=ce(Tn),o=ce(Tl),a=u.useMemo(()=>B3e(i,e,t,n,s,o),[i,e,t,n,s,o]);return I(a)},Vv=(e,t,n)=>{const s=ce(mr);return u.useMemo(()=>!s||s.nodeId!==e||s.handleId!==t?!1:n==="source"&&s.fieldTemplate.fieldKind==="output"||n==="target"&&s.fieldTemplate.fieldKind==="input",[t,n,e,s])},Gv=()=>ce(kse),N_=(e,t)=>{const n=js(e);return u.useMemo(()=>{const i=n.outputs[t];return Ge(i,`Template for output field ${t} not found`),i},[t,n.outputs])},zv=e=>{const{t}=M();return u.useMemo(()=>{const{name:s}=e;return Lc(e)?t("nodes.collectionFieldType",{name:s}):ya(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},RU={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},OU={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineEnd:"-0.5rem"},NU=u.memo(({nodeId:e,fieldName:t})=>{const n=N_(e,t),s=zv(n.type),i=u.useMemo(()=>Bv(n.type),[n.type]),o=u.useMemo(()=>BP(n.type),[n.type]);return Gv()?r.jsx(BU,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):r.jsx(FU,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});NU.displayName="OutputFieldHandle";const FU=u.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>r.jsx(De,{label:t,placement:"start",openDelay:Qu,children:r.jsx(ja,{type:"source",id:e.name,position:ka.Right,style:OU,children:r.jsx(Se,{sx:RU,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})}));FU.displayName="IdleHandle";const BU=u.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:a}=M(),l=Vv(e,t,"target"),c=$v(e,t,"target"),d=u.useMemo(()=>c!==null?a(c):s,[s,a,c]);return r.jsx(De,{label:d,placement:"start",openDelay:Qu,children:r.jsx(ja,{type:"source",id:n.name,position:ka.Right,style:OU,children:r.jsx(Se,{sx:RU,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});BU.displayName="ConnectionInProgressHandle";const $U=u.memo(({nodeId:e,fieldName:t})=>{const n=N_(e,t),s=zv(n.type),{t:i}=M();return r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:n.title}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:n.description}),r.jsxs(q,{children:[i("parameters.type"),": ",s]})]})});$U.displayName="OutputFieldTooltipContent";const F_=(e,t)=>{const n=u.useMemo(()=>pe(lt,i=>i.edges.find(a=>a.target===e&&a.targetHandle===t)!==void 0),[t,e]);return I(n)},$3e={fontSize:"sm",color:"base.300",fontWeight:"semibold",pe:2,'&[data-is-disabled="true"]':{opacity:.5}},VU=u.memo(({nodeId:e,fieldName:t})=>{const n=N_(e,t),s=F_(e,t),i=Vv(e,t,"source"),o=Gv(),a=$v(e,t,"source");return r.jsx(De,{label:r.jsx($U,{nodeId:e,fieldName:t}),openDelay:Qu,placement:"top",children:r.jsx(q,{"data-is-disabled":o&&a!==null&&!i||s,sx:$3e,children:n.title})})});VU.displayName="OutputFieldTitle";const GU=u.memo(({nodeId:e,fieldName:t})=>r.jsxs(O_,{children:[r.jsx(VU,{nodeId:e,fieldName:t}),r.jsx(NU,{nodeId:e,fieldName:t})]}));GU.displayName="OutputFieldNodesEditorView";const V3e=e=>{const t=u.useMemo(()=>pe(lt,s=>Mp(s,e)),[e]);return I(t)},G3e=e=>e.input==="connection"&&!ya(e.type)||!(e.type.name in $P),z3e=e=>(["any","direct"].includes(e.input)||ya(e.type))&&e.type.name in $P,H3e=e=>{const t=js(e),n=V3e(e);return u.useMemo(()=>{const i=new Set(Object.keys(n.inputs)),o=new Set(Object.keys(t.inputs));return Array.from(i.difference(o))},[n.inputs,t.inputs])},W3e=e=>{const t=js(e);return u.useMemo(()=>{const s=[];for(const[i,o]of Object.entries(t.inputs))z3e(o)&&s.push(i);return s},[t.inputs])},U3e=e=>{const t=js(e);return u.useMemo(()=>{const s=[];for(const[i,o]of Object.entries(t.inputs))G3e(o)&&s.push(i);return s},[t.inputs])},q3e=e=>{const t=e.filter(i=>!i.ui_hidden),n=t.filter(i=>!qe(i.ui_order)).sort((i,o)=>(i.ui_order??0)-(o.ui_order??0)),s=t.filter(i=>qe(i.ui_order));return n.concat(s).map(i=>i.name).filter(i=>i!=="is_intermediate")},K3e=e=>{const t=js(e);return u.useMemo(()=>q3e(_i(t.outputs)),[t.outputs])},zU=e=>{const t=js(e);return u.useMemo(()=>!_se(t.type)&&!Ise(t.type),[t])},B_=e=>{const t=js(e);return u.useMemo(()=>ds(t==null?void 0:t.outputs,s=>s.type.name==="ImageField"&&(t==null?void 0:t.type)!=="image"),[t])},Z3e=e=>{const t=B_(e),n=zU(e),s=en("invocationCache");return u.useMemo(()=>n&&(t||s),[t,s,n])},Y3e=(e,t)=>{const n=z(),s=I(YS),i=Ni(e,t),o=s_(e,t);return u.useCallback(()=>{const l=AM(e,t,i.type);n(c2({element:l,parentId:s,initialValue:o.value}))},[e,t,i.type,n,s,o.value])},HU=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=Y3e(e,t);return r.jsx(oe,{variant:"ghost",tooltip:n("workflows.builder.addToForm"),"aria-label":n("workflows.builder.addToForm"),icon:r.jsx(Gt,{}),pointerEvents:"auto",size:"xs",onClick:s})});HU.displayName="InputFieldAddToFormRoot";const WU=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M();return r.jsxs(Fn,{isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(Un,{children:r.jsx(oe,{variant:"ghost",tooltip:n("nodes.description"),"aria-label":n("nodes.description"),icon:r.jsx(Oae,{}),pointerEvents:"auto",size:"xs"})}),r.jsx(Bn,{p:2,w:256,children:r.jsx(UU,{nodeId:e,fieldName:t})})]})});WU.displayName="InputFieldDescriptionPopover";const UU=u.memo(({nodeId:e,fieldName:t})=>{const n=z(),{t:s}=M(),i=r_(e,t),o=u.useCallback(a=>{n($M({nodeId:e,fieldName:t,val:a.target.value}))},[n,t,e]);return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:s("nodes.description")}),r.jsx(Qn,{className:`${Ue} ${ki} ${ht}`,fontSize:"sm",value:i??"",onChange:o,p:2,resize:"none",rows:5})]})});UU.displayName="Content";const qU={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},KU={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineStart:"-0.5rem"},$_=u.memo(({nodeId:e,fieldName:t})=>{const n=Ni(e,t),s=zv(n.type),i=u.useMemo(()=>Bv(n.type),[n.type]),o=u.useMemo(()=>BP(n.type),[n.type]);return Gv()?r.jsx(YU,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):r.jsx(ZU,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});$_.displayName="InputFieldHandle";const ZU=u.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>r.jsx(De,{label:t,placement:"start",openDelay:Qu,children:r.jsx(ja,{type:"target",id:e.name,position:ka.Left,style:KU,children:r.jsx(Se,{sx:qU,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})}));ZU.displayName="IdleHandle";const YU=u.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:a}=M(),l=Vv(e,t,"target"),c=$v(e,t,"target"),d=u.useMemo(()=>c!==null?a(c):s,[s,a,c]);return r.jsx(De,{label:d,placement:"start",openDelay:Qu,children:r.jsx(ja,{type:"target",id:n.name,position:ka.Left,style:KU,children:r.jsx(Se,{sx:qU,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});YU.displayName="ConnectionInProgressHandle";const X3e=(e,t)=>{const n=z(),s=Ni(e,t),i=u.useMemo(()=>pe(lt,l=>{var h;const c=l.nodes.find(f=>f.id===e);if(!Jr(c))return;const d=(h=c.data.inputs[t])==null?void 0:h.value;return!bl(d,s.default)}),[t,s.default,e]),o=I(i),a=u.useCallback(()=>{n(QS({nodeId:e,fieldName:t,value:s.default}))},[n,t,s.default,e]);return{defaultValue:s.default,isValueChanged:o,resetToDefaultValue:a}},XU=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),{isValueChanged:s,resetToDefaultValue:i}=X3e(e,t);return r.jsx(oe,{variant:"ghost",tooltip:n("nodes.resetToDefaultValue"),"aria-label":n("nodes.resetToDefaultValue"),icon:r.jsx(Di,{}),pointerEvents:"auto",size:"xs",onClick:i,isDisabled:!s})});XU.displayName="InputFieldResetToDefaultValueIconButton";const QU=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=M(),s=s_(e,t),i=Ni(e,t),o=zv(i.type),a=u.useMemo(()=>s.label&&i.title?`${s.label} (${i.title})`:s.label&&!i.title?s.label:i.title,[s,i]);return r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:a}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsxs(q,{children:[n("parameters.type"),": ",o]}),r.jsxs(q,{children:[n("common.input"),": ",ru(i.input)]})]})});QU.displayName="InputFieldTooltipContent";const Q3e=(e,t)=>{const n=js(e);return u.useMemo(()=>{const i=n.inputs[t];return Ge(i,`Template for input field ${t} not found.`),i.title},[t,n.inputs])},J3e={p:0,fontWeight:"semibold",textAlign:"left",color:"base.300",_hover:{fontWeight:"semibold !important"},'&[data-is-invalid="true"]':{color:"error.300"},'&[data-is-disabled="true"]':{opacity:.5}},V_=u.memo(e=>{const{nodeId:t,fieldName:n,isInvalid:s,isDragging:i}=e,o=u.useRef(null),a=o_(t,n),l=Q3e(t,n),{t:c}=M(),d=F_(t,n),h=Vv(t,n,"target"),f=Gv(),p=$v(t,n,"target"),g=z(),m=u.useMemo(()=>l||c("nodes.unknownField"),[l,c]),y=u.useCallback(x=>{g(VM({nodeId:t,fieldName:n,label:x}))},[g,t,n]),b=oa({value:a||m,defaultValue:m,onChange:y,inputRef:o}),C=u.useMemo(()=>f&&p!==null&&!h||d,[f,p,h,d]),v=u.useCallback(x=>{x.stopPropagation(),b.startEditing()},[b]);return b.isEditing?r.jsx(jt,{ref:o,variant:"outline",...b.inputProps,_focusVisible:{borderRadius:"base",h:"unset",px:2}}):r.jsx(De,{label:r.jsx(QU,{nodeId:t,fieldName:n}),openDelay:Qu,placement:"top",isDisabled:i,children:r.jsx(q,{className:ic,sx:J3e,noOfLines:1,"data-is-invalid":s,"data-is-disabled":C,onDoubleClick:v,children:b.value})})});V_.displayName="InputFieldTitle";const Hv=u.memo(({nodeId:e,fieldName:t})=>{const n=Ni(e,t),s=bg(e,t),i=F_(e,t);return n.input==="connection"||i?r.jsx(JU,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n}):r.jsx(eq,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n})});Hv.displayName="InputFieldEditModeNodes";const JU=u.memo(({nodeId:e,fieldName:t,isInvalid:n})=>r.jsxs(_v,{children:[r.jsx(A,{px:2,children:r.jsx(V_,{nodeId:e,fieldName:t,isInvalid:n})}),r.jsx($_,{nodeId:e,fieldName:t})]}));JU.displayName="ConnectedOrConnectionField";const eEe={w:"full",px:2,flexDir:"column",gap:1,'&[data-is-dragging="true"]':{opacity:.3},pointerEvents:"auto",'&[data-is-connected="true"]':{pointerEvents:"none"},"& .direct-field-action-buttons":{display:"none"},_hover:{"& .direct-field-action-buttons":{display:"inline-flex"}}},eq=u.memo(({nodeId:e,fieldName:t,isInvalid:n,isConnected:s,fieldTemplate:i})=>{const o=u.useRef(null),a=u.useRef(null),l=ASe({nodeId:e,fieldName:t},i,o,a);return r.jsxs(_v,{children:[r.jsxs(A,{ref:o,sx:eEe,"data-is-connected":s,"data-is-dragging":l,children:[r.jsxs(A,{gap:1,children:[r.jsx(A,{className:Ue,ref:a,children:r.jsx(V_,{nodeId:e,fieldName:t,isInvalid:n,isDragging:l})}),r.jsx(rt,{}),r.jsxs(A,{className:"direct-field-action-buttons",children:[r.jsx(WU,{nodeId:e,fieldName:t}),r.jsx(XU,{nodeId:e,fieldName:t}),r.jsx(HU,{nodeId:e,fieldName:t})]})]}),r.jsx(Iv,{nodeId:e,fieldName:t})]}),i.input!=="direct"&&r.jsx($_,{nodeId:e,fieldName:t})]})});eq.displayName="DirectField";const tEe=e=>{const t=u.useMemo(()=>pe(lt,s=>{var i;return((i=Mp(s,e))==null?void 0:i.isIntermediate)??!1}),[e]);return I(t)},nEe=({nodeId:e})=>{const{t}=M(),n=z(),s=B_(e),i=tEe(e),o=u.useCallback(a=>{n(Ase({nodeId:e,isIntermediate:!a.target.checked}))},[n,e]);return s?r.jsxs(Z,{className:ki,children:[r.jsxs(te,{m:0,children:[t("nodes.saveToGallery")," "]}),r.jsx(kn,{onChange:o,isChecked:!i})]}):null},sEe=u.memo(nEe),rEe=e=>{const t=u.useMemo(()=>pe(lt,s=>{var i;return((i=Mp(s,e))==null?void 0:i.useCache)??!1}),[e]);return I(t)},iEe=({nodeId:e})=>{const t=z(),n=rEe(e),s=u.useCallback(o=>{t(Tse({nodeId:e,useCache:o.target.checked}))},[t,e]),{t:i}=M();return r.jsxs(Z,{className:ic,children:[r.jsx(te,{m:0,children:i("invocationCache.useCache")}),r.jsx(kn,{className:ki,onChange:s,isChecked:n})]})},oEe=u.memo(iEe),r3={w:"unset"},aEe=({nodeId:e})=>{const t=B_(e),n=zU(e),s=en("invocationCache");return r.jsx(A,{className:Fp,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:r.jsxs(fs,{formControlProps:r3,formLabelProps:r3,children:[n&&s&&r.jsx(oEe,{nodeId:e}),n&&t&&r.jsx(sEe,{nodeId:e})]})})},lEe=u.memo(aEe),cEe={transitionProperty:"transform",transitionDuration:"normal",transform:"rotate(180deg)",'&[data-is-open="true"]':{transform:"rotate(0deg)"}},uEe=({nodeId:e,isOpen:t})=>{const n=z(),s=dw(),i=u.useCallback(()=>{n(Ese({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return r.jsx(oe,{className:`${Ue} ${ic}`,onClick:i,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:r.jsx(dt,{as:DL,sx:cEe,"data-is-open":t})})},G_=u.memo(uEe),dEe=e=>u.useMemo(()=>{switch(e){case"Group 1":return"invokeGreen.300";case"Group 2":return"invokeBlue.300";case"Group 3":return"invokePurple.200";case"Group 4":return"invokeRed.300";case"Group 5":return"invokeYellow.300";default:return}},[e]),hEe=e=>{const t=u.useMemo(()=>pe(lt,s=>{var o;const i=Mse(s,e);if(Jr(i)&&q3(i))return(o=i.data.inputs.batch_group_id)==null?void 0:o.value}),[e]);return I(t)},fEe=({nodeId:e,title:t})=>{const n=z(),s=Gk(e),i=hEe(e),o=dEe(i),a=GV(e),{t:l}=M(),c=u.useRef(null),d=u.useCallback(p=>{n(IM({nodeId:e,label:p}))},[n,e]),h=oa({value:s||t||a||l("nodes.problemSettingTitle"),defaultValue:t||a||l("nodes.problemSettingTitle"),onChange:d,inputRef:c}),f=u.useMemo(()=>i?i==="None"?`${h.value} (${l("nodes.noBatchGroup")})`:`${h.value} (${i})`:h.value,[i,h.value,l]);return r.jsxs(A,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[!h.isEditing&&r.jsx(q,{className:ic,fontWeight:"semibold",color:o,onDoubleClick:h.startEditing,children:f}),h.isEditing&&r.jsx(jt,{ref:c,...h.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},tq=u.memo(fEe),pEe=e=>{const t=js(e);return u.useMemo(()=>t.classification,[t])},gEe=({nodeId:e})=>{const t=pEe(e);return!t||t==="stable"?null:r.jsx(De,{label:r.jsx(nq,{classification:t}),placement:"top",shouldWrapChildren:!0,children:r.jsx(yEe,{classification:t})})},mEe=u.memo(gEe),nq=u.memo(({classification:e})=>{const{t}=M();return e==="beta"?t("nodes.betaDesc"):e==="prototype"?t("nodes.prototypeDesc"):e==="internal"?t("nodes.internalDesc"):e==="special"?t("nodes.specialDesc"):null});nq.displayName="ClassificationTooltipContent";const yEe=({classification:e})=>e==="beta"?r.jsx(dt,{as:VL,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?r.jsx(dt,{as:Ew,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?r.jsx(dt,{as:RL,display:"block",boxSize:4,color:"invokePurple.300"}):e==="special"?r.jsx(dt,{as:Ly,display:"block",boxSize:4,color:"invokeGreen.300"}):null,vEe=e=>{const t=ce(Tn),n=u.useMemo(()=>pe(lt,i=>fL(e,t,i).length>0),[e,t]);return I(n)},i3={visibility:"hidden"},o3={borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:"var(--invoke-colors-base-600)",zIndex:-1},bEe=({nodeId:e})=>{const t=js(e);return t?r.jsxs(r.Fragment,{children:[r.jsx(ja,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:ka.Left,style:o3}),_i(t.inputs,n=>r.jsx(ja,{type:"target",id:n.name,isConnectable:!1,position:ka.Left,style:i3},`${e}-${n.name}-collapsed-input-handle`)),r.jsx(ja,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:ka.Right,style:o3}),_i(t.outputs,n=>r.jsx(ja,{type:"source",id:n.name,isConnectable:!1,position:ka.Right,style:i3},`${e}-${n.name}-collapsed-output-handle`))]}):null},xEe=u.memo(bEe),sq=u.memo(({nodeId:e})=>{const t=VV(e);return r.jsx(De,{label:r.jsx(rq,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:r.jsx(dt,{as:td,display:"block",boxSize:4,w:8,color:t?"error.400":"base.400"})})});sq.displayName="InvocationNodeInfoIcon";const rq=u.memo(({nodeId:e})=>{const t=BV(e),n=Gk(e),s=Vk(e),i=js(e),{t:o}=M(),a=u.useMemo(()=>n?`${n} (${i.title})`:i.title,[n,i.title]);return r.jsxs(A,{flexDir:"column",children:[r.jsx(q,{as:"span",fontWeight:"semibold",children:a}),r.jsxs(q,{opacity:.7,children:[o("nodes.nodePack"),": ",i.nodePack]}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsx(CEe,{nodeVersion:s,templateVersion:i.version}),t&&r.jsx(q,{children:t})]})});rq.displayName="TooltipContent";const CEe=({nodeVersion:e,templateVersion:t})=>{const{t:n}=M();return B4(e,t,"<")?r.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateNode"),")"]}):B4(e,t,">")?r.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateApp"),")"]}):r.jsxs(q,{as:"span",children:[n("nodes.version")," ",e]})},zx=3,a3={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},SEe=({nodeId:e})=>{const t=ZS(e);return t?r.jsx(De,{label:r.jsx(iq,{nodeExecutionState:t}),placement:"top",children:r.jsx(A,{className:Fp,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:r.jsx(oq,{nodeExecutionState:t})})}):null},wEe=u.memo(SEe),iq=u.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:i}=M();return t===Xs.enum.PENDING?r.jsx(q,{children:i("queue.pending")}):t===Xs.enum.IN_PROGRESS?s?r.jsxs(A,{pos:"relative",pt:1.5,pb:.5,children:[r.jsx(dn,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&r.jsxs(is,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?r.jsxs(q,{children:[i("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):r.jsx(q,{children:i("nodes.executionStateInProgress")}):t===Xs.enum.COMPLETED?r.jsx(q,{children:i("nodes.executionStateCompleted")}):t===Xs.enum.FAILED?r.jsx(q,{children:i("nodes.executionStateError")}):null});iq.displayName="TooltipLabel";const oq=u.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===Xs.enum.PENDING?r.jsx(dt,{as:Dw,boxSize:zx,color:"base.300"}):n===Xs.enum.IN_PROGRESS?t===null?r.jsx($4,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:a3}):r.jsx($4,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:a3}):n===Xs.enum.COMPLETED?r.jsx(dt,{as:Bp,boxSize:zx,color:"ok.300"}):n===Xs.enum.FAILED?r.jsx(dt,{as:zp,boxSize:zx,color:"error.300"}):null});oq.displayName="StatusIcon";const jEe={borderTopRadius:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",color:"base.200",borderBottomRadius:"base",'&[data-is-open="true"]':{borderBottomRadius:0},'&[data-is-invalid="true"]':{color:"error.300"}},kEe=({nodeId:e,isOpen:t})=>{const n=vEe(e);return r.jsxs(A,{layerStyle:"nodeHeader",sx:jEe,"data-is-open":t,"data-is-invalid":n,children:[r.jsx(G_,{nodeId:e,isOpen:t}),r.jsx(mEe,{nodeId:e}),r.jsx(tq,{nodeId:e}),r.jsxs(A,{alignItems:"center",children:[r.jsx(wEe,{nodeId:e}),r.jsx(sq,{nodeId:e})]}),!t&&r.jsx(xEe,{nodeId:e})]})},_Ee=u.memo(kEe),IEe={flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:"base",'&[data-with-footer="true"]':{borderBottomRadius:0},'&[data-with-footer="false"]':{pb:4}},AEe=({nodeId:e,isOpen:t})=>{const n=Z3e(e);return r.jsxs(r.Fragment,{children:[r.jsx(_Ee,{nodeId:e,isOpen:t}),t&&r.jsxs(r.Fragment,{children:[r.jsx(A,{layerStyle:"nodeBody",sx:IEe,"data-with-footer":n,children:r.jsxs(A,{flexDir:"column",px:2,w:"full",h:"full",children:[r.jsxs(Xr,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[r.jsx(aq,{nodeId:e}),r.jsx(uq,{nodeId:e})]}),r.jsx(lq,{nodeId:e}),r.jsx(cq,{nodeId:e})]})}),n&&r.jsx(lEe,{nodeId:e})]})]})},TEe=u.memo(AEe),aq=u.memo(({nodeId:e})=>{const t=U3e(e);return r.jsx(r.Fragment,{children:t.map((n,s)=>r.jsx(Dt,{gridColumnStart:1,gridRowStart:s+1,children:r.jsx(Du,{nodeId:e,fieldName:n,children:r.jsx(Hv,{nodeId:e,fieldName:n})})},`${e}.${n}.input-field`))})});aq.displayName="ConnectionFields";const lq=u.memo(({nodeId:e})=>{const t=W3e(e);return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(Du,{nodeId:e,fieldName:n,children:r.jsx(Hv,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});lq.displayName="AnyOrDirectFields";const cq=u.memo(({nodeId:e})=>{const t=H3e(e);return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(Du,{nodeId:e,fieldName:n,children:r.jsx(Hv,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});cq.displayName="MissingFields";const uq=u.memo(({nodeId:e})=>{const t=K3e(e);return r.jsx(r.Fragment,{children:t.map((n,s)=>r.jsx(Dt,{gridColumnStart:2,gridRowStart:s+1,children:r.jsx(DU,{nodeId:e,fieldName:n,children:r.jsx(GU,{nodeId:e,fieldName:n})})},`${e}.${n}.output-field`))})});uq.displayName="OutputFields";const EEe=e=>{const t=u.useMemo(()=>pe(lt,s=>{var i;return((i=Mp(s,e))==null?void 0:i.nodePack)??null}),[e]);return I(t)},MEe=({nodeId:e,isOpen:t,label:n,type:s})=>{const{t:i}=M(),o=EEe(e);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{className:Fp,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",children:[r.jsx(G_,{nodeId:e,isOpen:t}),r.jsx(q,{w:"full",textAlign:"center",pe:8,color:"error.300",children:n?`${n} (${s})`:s})]}),t&&r.jsx(A,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:r.jsxs(A,{gap:2,flexDir:"column",children:[r.jsxs(q,{as:"span",children:[i("nodes.unknownNodeType"),":"," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:s})]}),o&&r.jsxs(q,{as:"span",children:[i("nodes.nodePack"),":"," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:o})]})]})})]})},PEe=u.memo(MEe),LEe=e=>{const{data:t,selected:n}=e,{id:s,type:i,isOpen:o,label:a}=t,l=ce(Tn),c=u.useMemo(()=>!!l[i],[l,i]),d=u.useMemo(()=>pe(xy,f=>!!f.find(p=>p.id===s)),[s]);return I(d)?c?r.jsx(V1,{nodeId:s,selected:n,children:r.jsx(TEe,{nodeId:s,isOpen:o})}):r.jsx(V1,{nodeId:s,selected:n,children:r.jsx(PEe,{nodeId:s,isOpen:o,label:a,type:i})}):null},DEe=u.memo(LEe),REe=e=>{const{id:t,data:n,selected:s}=e,{notes:i,isOpen:o}=n,a=z(),l=u.useCallback(h=>{a(Pse({nodeId:t,value:h.target.value}))},[a,t]),c=u.useMemo(()=>pe(xy,h=>!!h.find(f=>f.id===t)),[t]);return I(c)?r.jsxs(V1,{nodeId:t,selected:s,children:[r.jsxs(A,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:o?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[r.jsx(G_,{nodeId:t,isOpen:o}),r.jsx(tq,{nodeId:t,title:"Notes"}),r.jsx(Se,{minW:8})]}),o&&r.jsx(r.Fragment,{children:r.jsx(A,{layerStyle:"nodeBody",className:ki,cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:r.jsx(A,{className:ki,w:"full",h:"full",flexDir:"column",children:r.jsx(Qn,{className:Ue,value:i,onChange:l,rows:8,resize:"none",fontSize:"sm"})})})})]}):null},OEe=u.memo(REe),NEe={collapsed:b3e,default:k3e},FEe={invocation:DEe,current_image:M3e,notes:OEe},BEe={hideAttribution:!0},$Ee=[25,25],VEe=e=>e.cancelConnection,dq=u.memo(()=>{const e=z(),t=I(xy),n=I(Lse),s=ce(V4),i=ce(G4),o=I(Dse),a=I(Rse),l=I(AP),c=I(TP),{onConnectStart:d,onConnect:h,onConnectEnd:f}=s3e(),p=u.useRef(null),g=r3e(),m=Ose(VEe),y=dw(),b=Wu(),C=Os("workflows");ta("workflows",p),lke(),Nse();const[v]=HS("radii",["base"]),x=u.useMemo(()=>({borderRadius:v}),[v]),S=u.useCallback(se=>{e(rf(se));const ne=sf.get();ne&&i&&(G4.set(!1),ne.fitView())},[e,i]),w=u.useCallback(se=>{se.length>0&&e(Ki(se))},[e]),j=u.useCallback((se,ne)=>{V4.set(ne)},[]),{onCloseGlobal:P}=bp(),T=u.useCallback(()=>{P()},[P]),L=u.useCallback(se=>{sf.set(se),se.fitView()},[]),E=u.useCallback(se=>{var ne,H;(ne=p.current)!=null&&ne.getBoundingClientRect()&&uw.set(((H=sf.get())==null?void 0:H.screenToFlowPosition({x:se.clientX,y:se.clientY}))??null)},[]),O=u.useCallback((se,ne,H)=>{Tl.set(ne),Wh.set(!1),eb.set(se)},[]),F=u.useCallback((se,ne)=>{Wh.set(!0);const H=$1(ne);e(Ki([{type:"remove",id:se.id},{type:"add",item:H}])),y([se.source,se.target,H.source,H.target])},[e,y]),_=u.useCallback((se,ne,H)=>{const V=Wh.get(),Y=eb.get()??{clientX:0,clientY:0},W=!("touches"in se)&&Math.hypot(se.clientX-Y.clientX,se.clientY-Y.clientY)>5;!V&&W&&e(Ki([{type:"remove",id:ne.id}])),Tl.set(null),Wh.set(!1),mr.set(null),eb.set(null)},[e]),{copySelection:R,pasteSelection:D,pasteSelectionWithEdges:$}=c3e();Le({id:"copySelection",category:"workflows",callback:R,options:{preventDefault:!0},dependencies:[R]});const G=u.useCallback(()=>{const{nodes:se,edges:ne}=lt(b.getState()),H=[],V=[];se.forEach(({id:Y,selected:W})=>{W||H.push({type:"select",id:Y,selected:!0})}),ne.forEach(({id:Y,selected:W})=>{W||V.push({type:"select",id:Y,selected:!0})}),H.length>0&&e(rf(H)),V.length>0&&e(Ki(V))},[e,b]);Le({id:"selectAll",category:"workflows",callback:G,options:{enabled:C,preventDefault:!0},dependencies:[G,C]}),Le({id:"pasteSelection",category:"workflows",callback:D,options:{preventDefault:!0},dependencies:[D]}),Le({id:"pasteSelectionWithEdges",category:"workflows",callback:$,options:{preventDefault:!0},dependencies:[$]}),Le({id:"undo",category:"workflows",callback:()=>{e(Fse())},options:{enabled:o,preventDefault:!0},dependencies:[o]}),Le({id:"redo",category:"workflows",callback:()=>{e(Bse())},options:{enabled:a,preventDefault:!0},dependencies:[a]});const ee=u.useCallback(()=>{Tl.get()||(mr.set(null),ou.set(!1),m())},[m]);Ii("esc",ee);const Q=u.useCallback(()=>{const{nodes:se,edges:ne}=lt(b.getState()),H=[],V=[];se.filter(Y=>Y.selected).forEach(({id:Y})=>{H.push({type:"remove",id:Y})}),ne.filter(Y=>Y.selected).forEach(({id:Y})=>{V.push({type:"remove",id:Y})}),H.length>0&&e(rf(H)),V.length>0&&e(Ki(V))},[e,b]);return Le({id:"deleteSelection",category:"workflows",callback:Q,options:{preventDefault:!0,enabled:C},dependencies:[Q,C]}),r.jsx($se,{id:"workflow-editor",ref:p,defaultViewport:s,nodeTypes:FEe,edgeTypes:NEe,nodes:t,edges:n,onInit:L,onMouseMove:E,onNodesChange:S,onEdgesChange:w,onReconnect:F,onReconnectStart:O,onReconnectEnd:_,onConnectStart:d,onConnect:h,onConnectEnd:f,onMoveEnd:j,connectionLineComponent:h3e,isValidConnection:g,minZoom:.1,snapToGrid:l,snapGrid:$Ee,connectionRadius:30,proOptions:BEe,style:x,onPaneClick:T,deleteKeyCode:null,selectionMode:c,elevateEdgesOnSelect:!0,nodeDragThreshold:1,noDragClassName:Ue,noWheelClassName:ht,noPanClassName:ki,children:r.jsx(Vse,{})})});dq.displayName="Flow";const GEe=()=>{const e=z(),t=I(FP),{t:n}=M(),s=u.useCallback(i=>{e(Gse(i))},[e]);return r.jsx(A,{alignItems:"center",children:r.jsx(Ze,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},zEe=u.memo(GEe),HEe=()=>{const{t:e}=M(),{zoomIn:t,zoomOut:n,fitView:s}=zse(),i=z(),o=I(VP),a=u.useCallback(()=>{t({duration:300})},[t]),l=u.useCallback(()=>{n({duration:300})},[n]),c=u.useCallback(()=>{s({duration:300})},[s]),d=u.useCallback(()=>{i(Hse(!o))},[o,i]);return r.jsxs(Cs,{orientation:"vertical",children:[r.jsx(oe,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:a,icon:r.jsx(UL,{})}),r.jsx(oe,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:l,icon:r.jsx(WL,{})}),r.jsx(oe,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:c,icon:r.jsx(Vp,{})}),r.jsx(oe,{tooltip:e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:o,onClick:d,icon:r.jsx(Rae,{})})]})},WEe=u.memo(HEe),UEe=()=>r.jsxs(A,{gap:2,position:"absolute",bottom:2,insetInlineStart:2,children:[r.jsx(WEe,{}),r.jsx(zEe,{})]}),qEe=u.memo(UEe),KEe=Qo(Wse),ZEe={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},YEe=()=>{const e=I(VP);return r.jsx(A,{gap:2,position:"absolute",bottom:2,insetInlineEnd:2,children:e&&r.jsx(KEe,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:ZEe,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},XEe=u.memo(YEe),QEe=()=>{const{data:e,isLoading:t}=fy(),{t:n}=M(),s=u.useRef(null);return ta("workflows",s),r.jsxs(A,{tabIndex:-1,ref:s,layerStyle:"first",position:"relative",width:"full",height:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:[e&&r.jsxs(r.Fragment,{children:[r.jsx(dq,{}),r.jsx(IU,{}),r.jsx(e3e,{}),r.jsx(qEe,{}),r.jsx(XEe,{}),r.jsx(n3e,{}),r.jsx(zke,{})]}),r.jsx(U8e,{}),t&&r.jsx(Ot,{label:n("nodes.loadingNodes"),icon:Ey})]})},JEe=u.memo(QEe),hq=u.memo(()=>I(bo)==="edit"?r.jsx(Use,{children:r.jsx(JEe,{})}):r.jsx(yv,{}));hq.displayName="WorkflowsMainPanel";const fq="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",eMe=()=>{const{data:e}=Cy(),t=u.useRef(null),n=ce(qse),s=u.useMemo(()=>e?r.jsxs(q,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return n||r.jsx(De,{placement:"right",label:s,p:1,px:2,gutter:16,children:r.jsx(dn,{ref:t,src:fq,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},tMe=u.memo(eMe),nMe="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",sMe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=ir(),{t:i}=M(),o=na(),{depsArray:a,depsObject:l}=Kse(void 0,{selectFromResult:({data:h})=>({depsObject:h,depsArray:h?_i(h,(f,p)=>({name:p,version:f})):[]})}),{data:c}=Cy(),d=u.useCallback(()=>{o.writeText(JSON.stringify(l,null,2))},[o,l]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(ni,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{maxH:"80vh",h:"34rem",children:[r.jsx(Mr,{children:i("accessibility.about")}),r.jsx(yo,{}),r.jsx(sr,{display:"flex",flexDir:"column",gap:4,children:r.jsxs(Xr,{templateColumns:"repeat(2, 1fr)",h:"full",children:[r.jsx(Dt,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:r.jsxs($n,{children:[r.jsxs(A,{position:"sticky",top:"0",backgroundColor:"base.750",p:1,alignItems:"center",children:[r.jsx(Rt,{size:"md",children:i("common.localSystem")}),r.jsx(rt,{}),r.jsx(De,{label:i("common.copy"),children:r.jsx(oe,{onClick:d,isDisabled:!l,"aria-label":i("common.copy"),icon:r.jsx(an,{}),variant:"ghost"})})]}),a.map(({name:h,version:f},p)=>r.jsxs(Xr,{py:"2",px:"1",w:"full",templateColumns:"repeat(2, 1fr)",children:[r.jsx(q,{children:h}),r.jsx(q,{children:f||i("common.notInstalled")})]},p))]})}),r.jsx(Dt,{children:r.jsxs(A,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[r.jsx(dn,{src:nMe,alt:"invoke-logo",w:"120px"}),c&&r.jsx(q,{children:`v${c==null?void 0:c.version}`}),r.jsxs(Xr,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[r.jsx(Dt,{children:r.jsx(Js,{href:X2,label:i("common.githubLabel")})}),r.jsx(Dt,{children:r.jsx(Js,{href:bj,label:i("common.discordLabel")})})]}),r.jsx(Rt,{fontSize:"large",children:i("common.aboutHeading")}),r.jsx(q,{fontSize:"sm",children:i("common.aboutDesc")}),r.jsx(Js,{href:D6,label:D6})]})})]})}),r.jsx(vo,{})]})]})]})},rMe=u.memo(sMe),iMe=({hotkey:e})=>{const{t}=M(),{id:n,platformKeys:s,title:i,desc:o}=e;return r.jsxs(A,{flexDir:"column",gap:2,px:2,children:[r.jsxs(A,{lineHeight:1,gap:1,alignItems:"center",children:[r.jsx(q,{fontWeight:"semibold",children:i}),r.jsx(rt,{}),s.map((a,l)=>r.jsxs(u.Fragment,{children:[a.map((c,d)=>r.jsxs(u.Fragment,{children:[r.jsx(Hh,{textTransform:"lowercase",children:c}),d!==a.length-1&&r.jsx(q,{as:"span",fontWeight:"semibold",children:"+"})]},`${n}-${c}-${l}-${d}`)),l!==s.length-1&&r.jsx(q,{as:"span",px:2,variant:"subtext",fontWeight:"semibold",children:t("common.or")})]},`${n}-${l}`))]}),r.jsx(q,{variant:"subtext",children:o})]})},oMe=u.memo(iMe),aMe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=ir(),{t:i}=M(),[o,a]=u.useState(""),l=u.useRef(null),c=u.useCallback(()=>a(""),[]),d=u.useCallback(p=>a(p.target.value),[]),h=oL(),f=u.useMemo(()=>{const p=o.trim().toLowerCase(),g=[];return Object.values(h).forEach(m=>{const y={title:m.title,hotkeys:[]};Object.values(m.hotkeys).forEach(b=>{p.length?(b.title.toLowerCase().includes(p)||b.desc.toLowerCase().includes(p)||b.category.toLowerCase().includes(p)||b.platformKeys.some(C=>C.some(v=>v.toLowerCase().includes(p))))&&y.hotkeys.push(b):y.hotkeys.push(b)}),y.hotkeys.length&&g.push(y)}),g},[h,o]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(ni,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,initialFocusRef:l,children:[r.jsx(nr,{}),r.jsxs(si,{maxH:"80vh",h:"80vh",children:[r.jsx(Mr,{children:i("hotkeys.hotkeys")}),r.jsx(yo,{}),r.jsxs(sr,{display:"flex",flexDir:"column",gap:4,children:[r.jsxs(Jo,{children:[r.jsx(jt,{ref:l,placeholder:i("hotkeys.searchHotkeys"),value:o,onChange:d}),o.length&&r.jsx(lo,{h:"full",pe:2,children:r.jsx(oe,{onClick:c,size:"sm",variant:"ghost","aria-label":i("hotkeys.clearSearch"),boxSize:4,icon:r.jsx(Nt,{})})})]}),r.jsx($n,{children:r.jsxs(A,{flexDir:"column",gap:4,children:[f.map(p=>r.jsx(Wi,{title:p.title,children:p.hotkeys.map((g,m)=>r.jsxs(u.Fragment,{children:[r.jsx(oMe,{hotkey:g}),m<p.hotkeys.length-1&&r.jsx(Pt,{})]},g.id))},p.title)),!f.length&&r.jsx(Ot,{label:i("hotkeys.noHotkeysFound"),icon:null})]})})]}),r.jsx(vo,{})]})]})]})},lMe=u.memo(aMe);function cMe(e){return ue({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function uMe(e){return ue({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const pq=u.memo(()=>{const{t:e}=M(),t=VS(),n=I(R3),s=u.useCallback(i=>{t(Zse(i.target.checked))},[t]);return r.jsxs(Z,{children:[r.jsx(te,{children:e("system.enableLogging")}),r.jsx(at,{isChecked:n,onChange:s})]})});pq.displayName="SettingsDeveloperLogIsEnabled";const gq=u.memo(()=>{const{t:e}=M(),t=z(),n=I(L3),s=u.useMemo(()=>Yse.options.map(a=>({label:e(`system.logLevel.${a}`),value:a})),[e]),i=u.useMemo(()=>s.find(a=>a.value===n),[n,s]),o=u.useCallback(a=>{Xse(a==null?void 0:a.value)&&t(Qse(a.value))},[t]);return r.jsxs(Z,{children:[r.jsx(te,{children:e("system.logLevel.logLevel")}),r.jsx(Fe,{value:i,options:s,onChange:o,isSearchable:!1})]})});gq.displayName="SettingsDeveloperLogLevel";const mq=u.memo(()=>{const{t:e}=M(),t=I(D3),n=u.useMemo(()=>die(Jse.options,t),[t]);return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:e("system.logNamespaces.logNamespaces")}),r.jsx(A,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>r.jsx(l3,{namespace:s,isEnabled:!0},`enabled-${s}`))}),r.jsx(A,{gap:2,flexWrap:"wrap",children:n.map(s=>r.jsx(l3,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});mq.displayName="SettingsDeveloperLogNamespaces";const l3=({namespace:e,isEnabled:t})=>{const{t:n}=M(),s=VS(),i=u.useCallback(()=>{s(ere(e))},[s,e]);return r.jsxs(US,{h:"min-content",borderRadius:"base",onClick:i,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&r.jsx(qS,{})]})},dMe=e=>{const{t}=M(),{data:n,refetch:s}=tre(void 0,{refetchOnMountOrArgChange:!0,skip:!e}),[i,{isLoading:o}]=nre(),{data:a}=ti(),l=u.useMemo(()=>!!(a&&(a.queue.in_progress>0||a.queue.pending>0)),[a]),c=u.useCallback(()=>{l||i().unwrap().then(d=>{ve({id:"INTERMEDIATES_CLEARED",title:t("settings.intermediatesCleared",{count:d}),status:"info"})}).catch(()=>{ve({id:"INTERMEDIATES_CLEAR_FAILED",title:t("settings.intermediatesClearedFailed"),status:"error"})})},[t,i,l]);return{intermediatesCount:n,clearIntermediates:c,isLoading:o,hasPendingItems:l,refetchIntermediatesCount:s}},hMe=$e.enum(["ar","az","de","en","es","fi","fr","he","hu","it","ja","ko","nl","pl","pt","pt_BR","ru","sv","tr","ua","vi","zh_CN","zh_Hant"]),fMe=e=>hMe.safeParse(e).success,pMe={ar:"",az:"Azrbaycan dili",de:"Deutsch",en:"English",es:"Espaol",fi:"Suomi",fr:"Franais",he:"",hu:"Magyar Nyelv",it:"Italiano",ja:"",ko:"",nl:"Nederlands",pl:"Polski",pt:"Portugus",pt_BR:"Portugus do Brasil",ru:"",sv:"Svenska",tr:"Trke",ua:"",vi:"Ting Vit",zh_CN:"",zh_Hant:""},c3=_i(pMe,(e,t)=>({label:e,value:t})),yq=u.memo(()=>{const{t:e}=M(),t=z(),n=I(Z7),s=en("localization"),i=u.useMemo(()=>c3.find(a=>a.value===n),[n]),o=u.useCallback(a=>{fMe(a==null?void 0:a.value)&&t(sre(a.value))},[t]);return r.jsxs(Z,{isDisabled:!s,children:[r.jsx(te,{children:e("common.languagePickerLabel")}),r.jsx(Fe,{value:i,options:c3,onChange:o})]})});yq.displayName="SettingsLanguageSelect";const gMe={shouldShowDeveloperSettings:!0,shouldShowResetWebUiText:!0,shouldShowClearIntermediates:!0,shouldShowLocalizationToggle:!0,shouldShowInvocationProgressDetailSetting:!0},[mMe]=Ql(!1),yMe=({config:e=gMe,children:t})=>{const n=z(),{t:s}=M(),{isNSFWCheckerAvailable:i,isWatermarkerAvailable:o}=pP(void 0,{selectFromResult:({data:Q})=>({isNSFWCheckerAvailable:(Q==null?void 0:Q.nsfw_methods.includes("nsfw_checker"))??!1,isWatermarkerAvailable:(Q==null?void 0:Q.watermarking_methods.includes("invisible_watermark"))??!1})}),{clearIntermediates:a,hasPendingItems:l,intermediatesCount:c,isLoading:d,refetchIntermediatesCount:h}=dMe(!!(e!=null&&e.shouldShowClearIntermediates)),f=mMe(),p=G7(),g=I(rre),m=I(ire),y=I(pw),b=I(ore),C=I(are),v=I(lre),x=I(cre),S=I(ty),w=I(mp),j=I(dM),P=u.useCallback(()=>{n(jS())},[n]),T=uL();u.useEffect(()=>{f.isTrue&&(e!=null&&e.shouldShowClearIntermediates)&&h()},[e==null?void 0:e.shouldShowClearIntermediates,h,f.isTrue]);const L=u.useCallback(()=>{T(),f.setFalse(),p.setTrue()},[T,f,p]),E=u.useCallback(Q=>{n(iE(Q.target.checked))},[n]),O=u.useCallback(Q=>{n(ure(Q.target.checked))},[n]),F=u.useCallback(Q=>{n(dre(Q.target.checked))},[n]),_=u.useCallback(Q=>{n(mM(Q.target.checked))},[n]),R=u.useCallback(Q=>{n(hre(Q.target.checked))},[n]),D=u.useCallback(Q=>{n(uE(Q.target.checked))},[n]),$=u.useCallback(Q=>{n(fre(Q.target.checked))},[n]),G=u.useCallback(Q=>{n(pre(Q.target.checked))},[n]),ee=u.useCallback(Q=>{n(gre(Q.target.checked))},[n]);return r.jsxs(r.Fragment,{children:[u.cloneElement(t,{onClick:f.setTrue}),r.jsxs(ni,{isOpen:f.isTrue,onClose:f.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(nr,{}),r.jsxs(si,{maxH:"80vh",h:"68rem",children:[r.jsx(Mr,{bg:"none",children:s("common.settingsLabel")}),r.jsx(yo,{}),r.jsx(sr,{display:"flex",flexDir:"column",gap:4,children:r.jsx($n,{children:r.jsx(A,{flexDir:"column",gap:4,children:r.jsxs(fs,{formLabelProps:{flexGrow:1},children:[r.jsxs(Wi,{title:s("settings.general"),children:[r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.confirmOnDelete")}),r.jsx(at,{isChecked:m,onChange:E})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.confirmOnNewSession")}),r.jsx(at,{isChecked:w,onChange:P})]})]}),r.jsxs(Wi,{title:s("settings.generation"),children:[r.jsxs(Z,{isDisabled:!i,children:[r.jsx(te,{children:s("settings.enableNSFWChecker")}),r.jsx(at,{isChecked:C,onChange:O})]}),r.jsxs(Z,{isDisabled:!o,children:[r.jsx(te,{children:s("settings.enableInvisibleWatermark")}),r.jsx(at,{isChecked:v,onChange:F})]})]}),r.jsxs(Wi,{title:s("settings.ui"),children:[r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.showProgressInViewer")}),r.jsx(at,{isChecked:y,onChange:_})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.antialiasProgressImages")}),r.jsx(at,{isChecked:b,onChange:R})]}),!!(e!=null&&e.shouldShowInvocationProgressDetailSetting)&&r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.showDetailedInvocationProgress")}),r.jsx(at,{isChecked:j,onChange:ee})]}),r.jsxs(Z,{children:[r.jsx(Ve,{feature:"noiseUseCPU",inPortal:!1,children:r.jsx(te,{children:s("parameters.useCpuNoise")})}),r.jsx(at,{isChecked:g,onChange:G})]}),!!(e!=null&&e.shouldShowLocalizationToggle)&&r.jsx(yq,{}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.enableInformationalPopovers")}),r.jsx(at,{isChecked:x,onChange:D})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.enableModelDescriptions")}),r.jsx(at,{isChecked:S,onChange:$})]})]}),!!(e!=null&&e.shouldShowDeveloperSettings)&&r.jsxs(Wi,{title:s("settings.developer"),children:[r.jsx(pq,{}),r.jsx(gq,{}),r.jsx(mq,{})]}),!!(e!=null&&e.shouldShowClearIntermediates)&&r.jsxs(Wi,{title:s("settings.clearIntermediates"),children:[r.jsx(ye,{tooltip:l?s("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:a,isLoading:d,isDisabled:!c||l,children:s("settings.clearIntermediatesWithCount",{count:c??0})}),r.jsx(q,{fontWeight:"bold",children:s("settings.clearIntermediatesDesc1")}),r.jsx(q,{variant:"subtext",children:s("settings.clearIntermediatesDesc2")}),r.jsx(q,{variant:"subtext",children:s("settings.clearIntermediatesDesc3")})]}),r.jsxs(Wi,{title:s("settings.resetWebUI"),children:[r.jsx(ye,{colorScheme:"error",onClick:L,children:s("settings.resetWebUI")}),!!(e!=null&&e.shouldShowResetWebUiText)&&r.jsxs(r.Fragment,{children:[r.jsx(q,{variant:"subtext",children:s("settings.resetWebUIDesc1")}),r.jsx(q,{variant:"subtext",children:s("settings.resetWebUIDesc2")})]})]})]})})})}),r.jsx(vo,{})]})]})]})},vMe=u.memo(yMe),u3=({menuText:e,menuIcon:t})=>{const{t:n}=M();return r.jsx(De,{label:n("upsell.professionalUpsell"),placement:"right",gutter:16,children:r.jsx(he,{as:"a",href:"http://invoke.com/pricing",target:"_blank",icon:t({}),children:r.jsxs(A,{gap:"1",alignItems:"center",justifyContent:"space-between",children:[r.jsx(q,{children:e}),r.jsx(dt,{as:PL,color:"invokeYellow.500"})]})})})},bMe=()=>{const{t:e}=M(),{isOpen:t,onOpen:n,onClose:s}=ir();bp(s);const i=en("bugLink"),o=en("discordLink"),a=en("githubLink");return r.jsxs(Yt,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[r.jsx(Xt,{as:oe,variant:"link","aria-label":e("accessibility.menu"),icon:r.jsx(nd,{fontSize:20}),boxSize:8}),r.jsx(za,{children:r.jsxs(It,{children:[r.jsxs(xr,{title:e("upsell.professional"),children:[r.jsx(u3,{menuText:e("upsell.inviteTeammates"),menuIcon:Uae}),r.jsx(u3,{menuText:e("upsell.shareAccess"),menuIcon:tle})]}),r.jsxs(xr,{title:e("common.communityLabel"),children:[a&&r.jsx(he,{as:"a",href:X2,target:"_blank",icon:r.jsx(uMe,{}),children:e("common.githubLabel")}),i&&r.jsx(he,{as:"a",href:`${X2}/issues`,target:"_blank",icon:r.jsx(pae,{}),children:e("common.reportBugLabel")}),o&&r.jsx(he,{as:"a",href:bj,target:"_blank",icon:r.jsx(cMe,{}),children:e("common.discordLabel")})]}),r.jsxs(xr,{title:e("common.settingsLabel"),children:[r.jsx(lMe,{children:r.jsx(he,{as:"button",icon:r.jsx(Eae,{}),children:e("common.hotkeysLabel")})}),r.jsx(vMe,{children:r.jsx(he,{as:"button",icon:r.jsx(nle,{}),children:e("common.settingsLabel")})})]}),r.jsx(xr,{title:e("accessibility.about"),children:r.jsx(rMe,{children:r.jsx(he,{as:"button",icon:r.jsx(td,{}),children:e("accessibility.about")})})})]})})]})},xMe=u.memo(bMe),CMe=()=>{const e=ce(Wn),{t}=M();return e?null:r.jsx(De,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:r.jsx(dt,{as:zp,color:"error.300"})})},SMe=u.memo(CMe),vq=u.memo(()=>{const{t:e}=M(),t=z(),n=q7(),s=u.useCallback(()=>{t(mfe()),n.open()},[n,t]);return r.jsx(oe,{"aria-label":e("supportVideos.supportVideos"),variant:"link",icon:r.jsx(rle,{fontSize:20}),boxSize:8,onClick:s})});vq.displayName="VideosModalButton";const Gc=u.memo(({tab:e,children:t})=>{const n=u.useMemo(()=>pe(Ar,i=>!i.disabledTabs.includes(e)),[e]);return I(n)?t:null});Gc.displayName="TabMountGate";const wMe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",jMe=pe(Ar,e=>e.isLocal),kMe={StrongComponent:r.jsx(q,{as:"span",color:"white",fontSize:"sm",fontWeight:"semibold"})},_Me=()=>{const{t:e}=M(),{data:t}=Cy(),n=I(jMe),s=u.useMemo(()=>{var o;return(o=t==null?void 0:t.highlights)!=null&&o.length?t.highlights.map((a,l)=>r.jsx(Vt,{children:a},`${a}-${l}`)):e("whatsNew.items",{returnObjects:!0}).map((a,l)=>r.jsx(Vt,{children:r.jsx(Jt,{i18nKey:a,components:kMe})},`${a}-${l}`))},[t==null?void 0:t.highlights,e]);return r.jsxs(A,{gap:4,flexDir:"column",children:[r.jsx(Pi,{fontSize:"sm",children:s}),r.jsxs(A,{flexDir:"column",gap:1,children:[r.jsx(Js,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.readReleaseNotes"),href:n?`https://github.com/invoke-ai/InvokeAI/releases/tag/v${t==null?void 0:t.version}`:"https://support.invoke.ai/support/solutions/articles/151000178246"}),r.jsx(Js,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.watchRecentReleaseVideos"),href:"https://www.youtube.com/@invokeai/videos"})]})]})},IMe=pe(Ar,e=>e.isLocal),AMe=()=>{const{t:e}=M(),t=ce(GP),n=z(),s=I(l=>l.ui.shouldShowNotificationV2),i=u.useCallback(()=>{n(mre(!1))},[n]),{data:o}=Cy(),a=I(IMe);return!o||!t?null:r.jsxs(Fn,{onClose:i,placement:"top-start",autoFocus:!1,defaultIsOpen:s,children:[r.jsx(Un,{children:r.jsx(A,{pos:"relative",children:r.jsx(oe,{"aria-label":"Notifications",variant:"link",icon:r.jsx(Mae,{fontSize:20}),boxSize:8})})}),r.jsxs(Bn,{p:2,children:[r.jsx(Li,{}),r.jsx(dE,{}),r.jsx(yre,{fontSize:"md",fontWeight:"semibold",pt:5,children:r.jsxs(A,{alignItems:"center",gap:3,children:[r.jsx(dn,{src:wMe,boxSize:6}),e("whatsNew.whatsNewInInvoke"),!!o.version.length&&(a?r.jsx(q,{variant:"subtext",children:`v${o.version}`}):r.jsx(q,{variant:"subtext",children:o.version}))]})}),r.jsx(qn,{p:2,maxW:300,children:r.jsx(_Me,{})})]})]})},zc=u.memo(u.forwardRef(({tab:e,icon:t,label:n},s)=>{const i=z(),o=I(En),a=u.useCallback(()=>{i(Kt(e))},[i,e]);return r.jsx(De,{label:n,placement:"end",children:r.jsx(oe,{ref:s,p:0,onClick:a,icon:t,size:"md",fontSize:"24px",variant:"appTab","data-selected":o===e,"aria-label":n,"data-testid":n})})}));zc.displayName="TabButton";const bq=u.memo(()=>{const{t:e}=M(),t=ce(vre);return r.jsxs(A,{flexDir:"column",alignItems:"center",py:2,gap:4,minW:0,children:[r.jsx(tMe,{}),r.jsxs(A,{gap:4,pt:6,h:"full",flexDir:"column",children:[r.jsx(Gc,{tab:"canvas",children:r.jsx(zc,{tab:"canvas",icon:r.jsx(qa,{}),label:e("ui.tabs.canvas")})}),r.jsx(Gc,{tab:"upscaling",children:r.jsx(zc,{tab:"upscaling",icon:r.jsx(Vp,{}),label:e("ui.tabs.upscaling")})}),r.jsx(Gc,{tab:"workflows",children:r.jsx(zc,{tab:"workflows",icon:r.jsx(Ey,{}),label:e("ui.tabs.workflows")})}),r.jsx(Gc,{tab:"models",children:r.jsx(zc,{tab:"models",icon:r.jsx(vae,{}),label:e("ui.tabs.models")})}),r.jsx(Gc,{tab:"queue",children:r.jsx(zc,{tab:"queue",icon:r.jsx(KL,{}),label:e("ui.tabs.queue")})})]}),r.jsx(rt,{}),r.jsx(SMe,{}),r.jsx(AMe,{}),r.jsx(vq,{}),t||r.jsx(xMe,{})]})});bq.displayName="VerticalNavBar";const d3=0,xq=-10,Cq=10,TMe=-10,EMe=10,h3=1,f3=1,MMe=[xq,0,Cq],PMe=()=>{const e=I(bre),t=z(),{t:n}=M(),s=u.useCallback(i=>{t(xre(i))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"creativity",children:r.jsx(te,{children:n("upscaling.creativity")})}),r.jsx(Ze,{value:e,defaultValue:d3,min:xq,max:Cq,step:h3,fineStep:f3,onChange:s,marks:MMe}),r.jsx(Ae,{value:e,defaultValue:d3,min:TMe,max:EMe,step:h3,fineStep:f3,onChange:s})]})},LMe=u.memo(PMe),DMe=()=>{const{t:e}=M(),[t,{isLoading:n}]=Zp(),s=I(zP),i=z(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(Cre(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Ja({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(Ve,{feature:"upscaleModel",children:r.jsx(te,{children:e("upscaling.upscaleModel")})}),r.jsx(De,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},RMe=u.memo(DMe),p3=0,Sq=-10,wq=10,OMe=-10,NMe=10,g3=1,m3=1,FMe=[Sq,0,wq],BMe=()=>{const e=I(Sre),t=z(),{t:n}=M(),s=u.useCallback(i=>{t(wre(i))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"structure",children:r.jsx(te,{children:n("upscaling.structure")})}),r.jsx(Ze,{value:e,defaultValue:p3,min:Sq,max:wq,step:g3,fineStep:m3,onChange:s,marks:FMe}),r.jsx(Ae,{value:e,defaultValue:p3,min:OMe,max:NMe,step:g3,fineStep:m3,onChange:s})]})},$Me=u.memo(BMe),VMe=[2,4,8],y3=e=>`${e}x`,jq=u.memo(()=>{const e=z(),{t}=M(),n=I(jre),s=u.useCallback(i=>{e(kre(i))},[e]);return r.jsxs(Z,{orientation:"vertical",gap:0,children:[r.jsx(Ve,{feature:"scale",children:r.jsx(te,{m:0,children:t("upscaling.scale")})}),r.jsxs(A,{w:"full",gap:4,children:[r.jsx(Ze,{min:2,max:8,value:n,onChange:s,marks:VMe,formatValue:y3,defaultValue:4}),r.jsx(Ae,{maxW:20,value:n,onChange:s,defaultValue:4,min:2,max:16,format:y3})]})]})});jq.displayName="UpscaleScaleSlider";const GMe=()=>{const e=z(),t=I(HP),n=u.useMemo(()=>pC.getData(),[]),s=u.useCallback(()=>{e(u0(null))},[e]),i=u.useCallback(o=>{e(u0(o))},[e]);return r.jsx(A,{justifyContent:"flex-start",children:r.jsxs(A,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[!t&&r.jsx(Lk,{w:"full",h:"full",isError:!t,onUpload:i,fontSize:36}),t&&r.jsxs(r.Fragment,{children:[r.jsx(tl,{imageDTO:t}),r.jsx(A,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:r.jsx(Xo,{onClick:s,icon:r.jsx(Di,{size:16}),tooltip:Te("common.reset")})}),r.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${t.width}x${t.height}`})]}),r.jsx(gs,{dndTarget:pC,dndTargetData:n,label:Te("gallery.drop")})]})})},zMe=e=>tn(hp,Ar,(t,n)=>{const{upscaleModel:s,scale:i}=t,{maxUpscaleDimension:o}=n;if(!o||!s||!e)return!1;const{width:a,height:l}=e,c=o**2;return a*i*l*i>c}),HMe=e=>{const t=u.useMemo(()=>zMe(e),[e]);return I(t)},WMe=()=>{const{t:e}=M(),t=I(Ap),n=I(zP),s=I(_re),i=I(HP),o=z(),[a,{isLoading:l}]=fj(),c=I(XS),d=I(Ire),h=HMe(i);u.useEffect(()=>{const b=a.find(C=>C.base===(t==null?void 0:t.base)&&C.name.toLowerCase().includes("tile"));o(Are(b||null))},[t==null?void 0:t.base,a,o]);const f=u.useMemo(()=>t&&["sd-1","sdxl"].includes(t.base),[t]),p=u.useMemo(()=>{const b=[];return f&&(t||b.push(e("upscaling.mainModelDesc")),s||b.push(e("upscaling.tileControlNetModelDesc")),n||b.push(e("upscaling.upscaleModelDesc"))),b},[f,t,s,n,e]),g=u.useMemo(()=>{const b=[];return h&&d&&b.push(e("upscaling.exceedsMaxSizeDetails",{maxUpscaleDimension:d.toLocaleString()})),b},[h,e,d]),m=u.useMemo(()=>[...p,...g],[p,g]),y=u.useCallback(()=>{o(Kt("models")),$l.set(3)},[o]);return f&&p.length>0&&c||f&&m.length===0||l?null:r.jsxs(A,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!f&&r.jsx(q,{children:e("upscaling.incompatibleBaseModelDesc")}),p.length>0&&r.jsx(q,{children:r.jsx(Jt,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:r.jsx(ye,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:y})}})}),m.length>0&&r.jsx(Pi,{children:m.map(b=>r.jsx(Vt,{children:b},b))})]})},UMe=tn([hp],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,i=[];if(t&&i.push(t.name),n){const o=t?z4(t.base):z4(null),a=H4(n.width*s,o),l=H4(n.height*s,o);i.push(`${a}${l}`)}return{badges:i}}),kq=u.memo(()=>{const{t:e}=M(),{badges:t}=I(UMe),{isOpen:n,onToggle:s}=Ad({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:i,onToggle:o}=y_({id:"upscale-settings-advanced",defaultIsOpen:!1});return r.jsx(Xu,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:r.jsxs(A,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[r.jsxs(A,{flexDir:"column",gap:4,children:[r.jsxs(A,{gap:4,children:[r.jsx(GMe,{}),r.jsxs(A,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx(RMe,{}),r.jsx(jq,{})]})]}),r.jsx(WMe,{})]}),r.jsx(lw,{label:e("accordions.advanced.options"),isOpen:i,onToggle:o,children:r.jsxs(A,{gap:4,pb:4,flexDir:"column",children:[r.jsx(LMe,{}),r.jsx($Me,{})]})})]})})});kq.displayName="UpscaleSettingsAccordion";const v3={height:"100%",width:"100%"},qMe=()=>{const e=ce(Mf);return r.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(GH,{}),r.jsx(A,{w:"full",h:"full",position:"relative",children:r.jsxs(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&r.jsx(Ns,{defer:!0,style:v3,options:Bl.options,children:r.jsx(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(VH,{})})}),r.jsx(Ns,{defer:!0,style:v3,options:Bl.options,children:r.jsxs(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(h_,{}),r.jsx(kq,{}),r.jsx(v_,{}),r.jsx(m_,{})]})})]})})]})},KMe=u.memo(qMe),Pm={position:"relative",height:"100%",width:"100%",minWidth:0},ZMe=e=>d2.set(!e),YMe=e=>Mre.set(!e),_q=u.memo(()=>{const e=u.useRef(null);sSe();const t=I(Tre),n=u.useMemo(()=>({id:"left-panel",minSizePx:W4,defaultSizePx:W4,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:ZMe}),[]),s=DC(n);Le({id:"toggleLeftPanel",category:"app",callback:s.toggle,options:{enabled:t},dependencies:[s.toggle,t]});const i=I(Ere),o=u.useMemo(()=>({id:"right-panel",minSizePx:U4,defaultSizePx:U4,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:YMe}),[]),a=DC(o);return Le({id:"toggleRightPanel",category:"app",callback:a.toggle,options:{enabled:i},dependencies:[a.toggle,i]}),Le({id:"resetPanelLayout",category:"app",callback:()=>{s.reset(),a.reset()},dependencies:[s.reset,a.reset]}),Le({id:"togglePanels",category:"app",callback:()=>{s.isCollapsed||a.isCollapsed?(s.expand(),a.expand()):(s.collapse(),a.collapse())},dependencies:[s.isCollapsed,a.isCollapsed,s.expand,a.expand,s.collapse,a.collapse]}),r.jsxs(A,{id:"invoke-app-tabs",w:"full",h:"full",gap:4,p:4,overflow:"hidden",children:[r.jsx(bq,{}),r.jsxs(ug,{ref:e,id:"app-panel-group",autoSaveId:"app-panel-group",direction:"horizontal",style:Pm,children:[t&&r.jsxs(r.Fragment,{children:[r.jsx(io,{order:0,collapsible:!0,style:Pm,...s.panelProps,children:r.jsxs(A,{flexDir:"column",w:"full",h:"full",gap:2,children:[r.jsx(u_e,{}),r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(Aq,{})})]})}),r.jsx(a1,{id:"left-main-handle",...s.resizeHandleProps})]}),r.jsxs(io,{id:"main-panel",order:1,minSize:20,style:Pm,children:[r.jsx(Tq,{}),t&&r.jsx(g_e,{panelApi:s}),i&&r.jsx(h_e,{panelApi:a})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx(a1,{id:"main-right-handle",...a.resizeHandleProps}),r.jsx(io,{order:2,style:Pm,collapsible:!0,...a.panelProps,children:r.jsx(Iq,{})})]})]})]})});_q.displayName="AppContent";const Iq=u.memo(()=>{const e=I(En);return e==="canvas"?r.jsx(NV,{}):e==="upscaling"||e==="workflows"?r.jsx(OV,{}):null});Iq.displayName="RightPanelContent";const Aq=u.memo(()=>{const e=I(En);return e==="canvas"?r.jsx(E5e,{}):e==="upscaling"?r.jsx(KMe,{}):e==="workflows"?r.jsx(i_e,{}):null});Aq.displayName="LeftPanelContent";const Tq=u.memo(()=>{const e=I(En);return e==="canvas"?r.jsx(y$,{}):e==="upscaling"?r.jsx(yv,{}):e==="workflows"?r.jsx(hq,{}):e==="models"?r.jsx(nIe,{}):e==="queue"?r.jsx(xAe,{}):null});Tq.displayName="MainPanelContent";const XMe=u.createContext(null),Hx={didCatch:!1,error:null};class QMe extends u.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Hx}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:o,reason:"imperative-api"}),this.setState(Hx)}}componentDidCatch(t,n){var s,i;(s=(i=this.props).onError)===null||s===void 0||s.call(i,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:i}=this.props;if(s&&n.error!==null&&JMe(t.resetKeys,i)){var o,a;(o=(a=this.props).onReset)===null||o===void 0||o.call(a,{next:i,prev:t.resetKeys,reason:"keys"}),this.setState(Hx)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:i}=this.props,{didCatch:o,error:a}=this.state;let l=t;if(o){const c={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")l=n(c);else if(s)l=u.createElement(s,c);else if(i===null||u.isValidElement(i))l=i;else throw a}return u.createElement(XMe.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}function JMe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}const ePe="default",tPe=Oe(ePe),nPe=e=>e==="OutOfMemoryError"?Te("toast.outOfMemoryError"):Te("toast.serverError");function sPe({errorType:e,isLocal:t,sessionId:n,errorMessage:s}){const{t:i}=M(),o=na(),a=u.useMemo(()=>{if(e==="OutOfMemoryError")return t?r.jsx(Jt,{i18nKey:"toast.outOfMemoryErrorDescLocal",components:{LinkComponent:r.jsx(kk,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}}):i("toast.outOfMemoryErrorDesc");if(s)return`${e}: ${s}`},[s,e,t,i]),l=u.useCallback(()=>o.writeText(n),[n,o]);return r.jsxs(A,{flexDir:"column",children:[a&&r.jsx(q,{noOfLines:4,fontSize:"md",children:a}),!t&&r.jsxs(A,{gap:"2",alignItems:"center",children:[r.jsx(q,{fontSize:"sm",fontStyle:"italic",children:i("toast.sessionRef",{sessionId:n})}),r.jsx(oe,{size:"sm","aria-label":"Copy",icon:r.jsx(an,{}),onClick:l,variant:"ghost",sx:{svg:{fill:"base.50"}}})]})]})}const b3=Fs("events"),rPe=e=>e.invocation_source_id.split(":")[0]===Ore,iPe=["load_image","image"],oPe=(e,t)=>{const n=(l,c)=>{if(iPe.includes(l.invocation.type)){b3.trace("Skipping node type denylisted");return}if(c.is_intermediate)return;t(Lre.util.updateQueryData("getBoardImagesTotal",c.board_id??"none",g=>{g.total+=1})),t(wS.util.invalidateTags([{type:"Board",id:c.board_id??"none"},{type:"ImageList",id:Dre({board_id:c.board_id??"none",categories:Rre(c)})}]));const{shouldAutoSwitch:d,selectedBoardId:h,galleryView:f,offset:p}=e().gallery;d&&(c.board_id&&c.board_id!==h?t(Ef({boardId:c.board_id,selectedImageName:c.image_name})):!c.board_id&&h!=="none"?t(Ef({boardId:"none",selectedImageName:c.image_name})):(t(fM(c)),f!=="images"?t(l2("images")):p>0&&t(pM({offset:0}))))},s=l=>{const{result:c}=l;return c.type==="image_output"?ny(c.image.image_name):null},i=async l=>{const{result:c,invocation_source_id:d}=l,h=bt(Dc.get()[d]);h&&(h.status=Xs.enum.COMPLETED,h.progress!==null&&(h.progress=1),h.outputs.push(c),Nm(h.nodeId,h));const f=await s(l);f&&!f.is_intermediate&&n(l,f)},o=async l=>{const c=await s(l);c&&(l.destination==="canvas"?rPe(l)&&(l.result.type==="image_output"&&t(Pre({stagingAreaImage:{imageDTO:c,offsetX:0,offsetY:0}})),n(l,c)):c.is_intermediate||n(l,c))},a=async l=>{const c=await s(l);c&&!c.is_intermediate&&n(l,c)};return async l=>{b3.debug({data:l},`Invocation complete (${l.invocation.type}, ${l.invocation_source_id})`),l.origin==="workflows"?await i(l):l.origin==="canvas"?await o(l):await a(l),Fo.set(null)}},Qt=Fs("events"),Mc=Hi.endpoints.listModelInstalls.select(),aPe=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:i}=t;e.on("connect",()=>{Qt.debug("Connected"),n(!0),s(Nre());const l=Fre.get();if(e.emit("subscribe_queue",{queue_id:l}),!WP.get()){const c=tPe.get();e.emit("subscribe_bulk_download",{bulk_download_id:c})}Fo.set(null)}),e.on("connect_error",l=>{Qt.debug("Connect error"),n(!1),Fo.set(null),l&&l.message&&l.data==="ERR_UNAUTHENTICATED"&&ve({id:`connect-error-${l.message}`,title:l.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{Qt.debug("Disconnected"),Fo.set(null),n(!1)}),e.on("invocation_started",l=>{const{invocation_source_id:c,invocation:d}=l;Qt.debug({data:l},`Invocation started (${d.type}, ${c})`);const h=bt(Dc.get()[c]);h&&(h.status=Xs.enum.IN_PROGRESS,Nm(h.nodeId,h))}),e.on("invocation_progress",l=>{const{invocation_source_id:c,invocation:d,image:h,origin:f,percentage:p,message:g}=l;let m="Invocation progress";if(g&&(m+=`: ${g}`),qe(p)||(m+=` ${_p(p*100,2)}%`),m+=` (${d.type}, ${c})`,Qt.trace({data:l},m),Fo.set(l),f==="workflows"){const y=bt(Dc.get()[c]);y&&(y.status=Xs.enum.IN_PROGRESS,y.progress=p,y.progressImage=h??null,Nm(y.nodeId,y))}}),e.on("invocation_error",l=>{const{invocation_source_id:c,invocation:d,error_type:h,error_message:f,error_traceback:p}=l;Qt.error({data:l},`Invocation error (${d.type}, ${c})`);const g=bt(Dc.get()[c]);g&&(g.status=Xs.enum.FAILED,g.progress=null,g.progressImage=null,g.error={error_type:h,error_message:f,error_traceback:p},Nm(g.nodeId,g))});const o=oPe(i,s);e.on("invocation_complete",o),e.on("model_load_started",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load started: ${h} (${g.join(", ")})`;Qt.debug({data:l},m)}),e.on("model_load_complete",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load complete: ${h} (${g.join(", ")})`;Qt.debug({data:l},m)}),e.on("download_started",l=>{Qt.debug({data:l},"Download started")}),e.on("download_progress",l=>{Qt.trace({data:l},"Download progress")}),e.on("download_complete",l=>{Qt.debug({data:l},"Download complete")}),e.on("download_cancelled",l=>{Qt.warn({data:l},"Download cancelled")}),e.on("download_error",l=>{Qt.error({data:l},"Download error")}),e.on("model_install_started",l=>{Qt.debug({data:l},"Model install started");const{id:c}=l,d=Mc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="running"),h})):s(To.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",l=>{Qt.debug({data:l},"Model install download started");const{id:c}=l,d=Mc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloading"),h})):s(To.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",l=>{Qt.trace({data:l},"Model install download progress");const{bytes:c,total_bytes:d,id:h}=l,f=Mc(i()).data;f!=null&&f.find(p=>p.id===h)?s(Hi.util.updateQueryData("listModelInstalls",void 0,p=>{const g=p.find(m=>m.id===h);return g&&(g.bytes=c,g.total_bytes=d,g.status="downloading"),p})):s(To.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",l=>{Qt.debug({data:l},"Model install downloads complete");const{id:c}=l,d=Mc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloads_done"),h})):s(To.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",l=>{Qt.debug({data:l},"Model install complete");const{id:c}=l,d=Mc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="completed"),h})):s(To.util.invalidateTags([{type:"ModelInstalls"}])),s(To.util.invalidateTags([{type:"ModelConfig",id:q4}])),s(To.util.invalidateTags([{type:"ModelScanFolderResults",id:q4}]))});const a=wde(i,s);e.on("model_install_error",a),e.on("model_install_cancelled",l=>{Qt.warn({data:l},"Model install cancelled");const{id:c}=l,d=Mc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="cancelled"),h})):s(To.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",l=>{const{item_id:c,session_id:d,status:h,started_at:f,updated_at:p,completed_at:g,batch_status:m,queue_status:y,error_type:b,error_message:C,error_traceback:v,destination:x}=l;Qt.debug({data:l},`Queue item ${c} status updated: ${h}`),s(Wc.util.updateQueryData("listQueueItems",void 0,w=>{Bre.updateOne(w,{id:String(c),changes:{status:h,started_at:f,updated_at:p??void 0,completed_at:g??void 0,error_type:b,error_message:C,error_traceback:v}})})),s(Wc.util.updateQueryData("getQueueStatus",void 0,w=>{w&&Object.assign(w.queue,y)})),s(Wc.util.updateQueryData("getBatchStatus",{batch_id:m.batch_id},()=>m));const S=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:c}];if(x&&S.push({type:"QueueCountsByDestination",id:x}),s(Wc.util.invalidateTags(S)),h==="in_progress")$re(Dc.get(),w=>{if(!w)return;const j=bt(w);j.status=Xs.enum.PENDING,j.error=null,j.progress=null,j.progressImage=null,j.outputs=[],Dc.setKey(j.nodeId,j)});else if(h==="failed"&&b){const w=i().config.isLocal??!0,j=d;ve({id:`INVOCATION_ERROR_${b}`,title:nPe(b),status:"error",duration:null,updateDescription:w,description:r.jsx(sPe,{errorType:b,errorMessage:C,sessionId:j,isLocal:w})})}else(h==="completed"||h==="failed"||h==="canceled")&&Fo.set(null)}),e.on("queue_cleared",l=>{Qt.debug({data:l},"Queue cleared")}),e.on("batch_enqueued",l=>{Qt.debug({data:l},"Batch enqueued")}),e.on("queue_items_retried",l=>{Qt.debug({data:l},"Queue items retried")}),e.on("bulk_download_started",l=>{Qt.debug({data:l},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",l=>{Qt.debug({data:l},"Bulk gallery download ready");const{bulk_download_item_name:c}=l,d=`/api/v1/images/download/${c}`;ve({id:c,title:Te("gallery.bulkDownloadReady","Download ready"),status:"success",description:r.jsx(Js,{label:Te("gallery.clickToDownload","Click here to download"),href:d,download:c}),duration:null})}),e.on("bulk_download_error",l=>{Qt.error({data:l},"Bulk gallery download error");const{bulk_download_item_name:c,error:d}=l;ve({id:c,title:Te("gallery.bulkDownloadFailed"),status:"error",description:d,duration:null})})},mo=Object.create(null);mo.open="0";mo.close="1";mo.ping="2";mo.pong="3";mo.message="4";mo.upgrade="5";mo.noop="6";const r0=Object.create(null);Object.keys(mo).forEach(e=>{r0[mo[e]]=e});const iS={type:"error",data:"parser error"},Eq=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Mq=typeof ArrayBuffer=="function",Pq=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,z_=({type:e,data:t},n,s)=>Eq&&t instanceof Blob?n?s(t):x3(t,s):Mq&&(t instanceof ArrayBuffer||Pq(t))?n?s(t):x3(new Blob([t]),s):s(mo[e]+(t||"")),x3=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function C3(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Wx;function lPe(e,t){if(Eq&&e.data instanceof Blob)return e.data.arrayBuffer().then(C3).then(t);if(Mq&&(e.data instanceof ArrayBuffer||Pq(e.data)))return t(C3(e.data));z_(e,!1,n=>{Wx||(Wx=new TextEncoder),t(Wx.encode(n))})}const S3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<S3.length;e++)nf[S3.charCodeAt(e)]=e;const cPe=e=>{let t=e.length*.75,n=e.length,s,i=0,o,a,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),h=new Uint8Array(d);for(s=0;s<n;s+=4)o=nf[e.charCodeAt(s)],a=nf[e.charCodeAt(s+1)],l=nf[e.charCodeAt(s+2)],c=nf[e.charCodeAt(s+3)],h[i++]=o<<2|a>>4,h[i++]=(a&15)<<4|l>>2,h[i++]=(l&3)<<6|c&63;return d},uPe=typeof ArrayBuffer=="function",H_=(e,t)=>{if(typeof e!="string")return{type:"message",data:Lq(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:dPe(e.substring(1),t)}:r0[n]?e.length>1?{type:r0[n],data:e.substring(1)}:{type:r0[n]}:iS},dPe=(e,t)=>{if(uPe){const n=cPe(e);return Lq(n,t)}else return{base64:!0,data:e}},Lq=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Dq="",hPe=(e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach((o,a)=>{z_(o,!1,l=>{s[a]=l,++i===n&&t(s.join(Dq))})})},fPe=(e,t)=>{const n=e.split(Dq),s=[];for(let i=0;i<n.length;i++){const o=H_(n[i],t);if(s.push(o),o.type==="error")break}return s};function pPe(){return new TransformStream({transform(e,t){lPe(e,n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let Ux;function Lm(e){return e.reduce((t,n)=>t+n.length,0)}function Dm(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)n[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function gPe(e,t){Ux||(Ux=new TextDecoder);const n=[];let s=0,i=-1,o=!1;return new TransformStream({transform(a,l){for(n.push(a);;){if(s===0){if(Lm(n)<1)break;const c=Dm(n,1);o=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(Lm(n)<2)break;const c=Dm(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(Lm(n)<8)break;const c=Dm(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),h=d.getUint32(0);if(h>Math.pow(2,21)-1){l.enqueue(iS);break}i=h*Math.pow(2,32)+d.getUint32(4),s=3}else{if(Lm(n)<i)break;const c=Dm(n,i);l.enqueue(H_(o?c:Ux.decode(c),t)),s=0}if(i===0||i>e){l.enqueue(iS);break}}}})}const Rq=4;function Rn(e){if(e)return mPe(e)}function mPe(e){for(var t in Rn.prototype)e[t]=Rn.prototype[t];return e}Rn.prototype.on=Rn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Rn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Rn.prototype.off=Rn.prototype.removeListener=Rn.prototype.removeAllListeners=Rn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,i=0;i<n.length;i++)if(s=n[i],s===t||s.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Rn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,i=n.length;s<i;++s)n[s].apply(this,t)}return this};Rn.prototype.emitReserved=Rn.prototype.emit;Rn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Rn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Wv=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Wr=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),yPe="arraybuffer";function Oq(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const vPe=Wr.setTimeout,bPe=Wr.clearTimeout;function Uv(e,t){t.useNativeTimers?(e.setTimeoutFn=vPe.bind(Wr),e.clearTimeoutFn=bPe.bind(Wr)):(e.setTimeoutFn=Wr.setTimeout.bind(Wr),e.clearTimeoutFn=Wr.clearTimeout.bind(Wr))}const xPe=1.33;function CPe(e){return typeof e=="string"?SPe(e):Math.ceil((e.byteLength||e.size)*xPe)}function SPe(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function Nq(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function wPe(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function jPe(e){let t={},n=e.split("&");for(let s=0,i=n.length;s<i;s++){let o=n[s].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}class kPe extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class W_ extends Rn{constructor(t){super(),this.writable=!1,Uv(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new kPe(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=H_(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=wPe(t);return n.length?"?"+n:""}}class _Pe extends W_{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};fPe(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,hPe(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Nq()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let Fq=!1;try{Fq=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const IPe=Fq;function APe(){}class TPe extends _Pe{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class ao extends Rn{constructor(t,n,s){super(),this.createRequest=t,Uv(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=Oq(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ao.requestsCount++,ao.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=APe,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ao.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ao.requestsCount=0;ao.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",w3);else if(typeof addEventListener=="function"){const e="onpagehide"in Wr?"pagehide":"unload";addEventListener(e,w3,!1)}}function w3(){for(let e in ao.requests)ao.requests.hasOwnProperty(e)&&ao.requests[e].abort()}const EPe=function(){const e=Bq({xdomain:!1});return e&&e.responseType!==null}();class MPe extends TPe{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=EPe&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new ao(Bq,this.uri(),t)}}function Bq(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||IPe))return new XMLHttpRequest}catch{}if(!t)try{return new Wr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const $q=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class PPe extends W_{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=$q?{}:Oq(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;z_(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch{}i&&Wv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Nq()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const qx=Wr.WebSocket||Wr.MozWebSocket;class LPe extends PPe{createSocket(t,n,s){return $q?new qx(t,n,s):n?new qx(t,n):new qx(t)}doWrite(t,n){this.ws.send(n)}}class DPe extends W_{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=gPe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),i=pPe();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const o=()=>{s.read().then(({done:l,value:c})=>{l||(this.onPacket(c),o())}).catch(l=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;this._writer.write(s).then(()=>{i&&Wv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const RPe={websocket:LPe,webtransport:DPe,polling:MPe},OPe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,NPe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function oS(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=OPe.exec(e||""),o={},a=14;for(;a--;)o[NPe[a]]=i[a]||"";return n!=-1&&s!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=FPe(o,o.path),o.queryKey=BPe(o,o.query),o}function FPe(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function BPe(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,o){i&&(n[i]=o)}),n}const aS=typeof addEventListener=="function"&&typeof removeEventListener=="function",i0=[];aS&&addEventListener("offline",()=>{i0.forEach(e=>e())},!1);class Da extends Rn{constructor(t,n){if(super(),this.binaryType=yPe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=oS(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=oS(n.host).host);Uv(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=jPe(this.opts.query)),aS&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},i0.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=Rq,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Da.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Da.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(n+=CPe(i)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Wv(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,i){if(typeof n=="function"&&(i=n,n=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:t,data:n,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Da.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),aS&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=i0.indexOf(this._offlineEventListener);s!==-1&&i0.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Da.protocol=Rq;class $Pe extends Da{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;Da.priorWebsocketSuccess=!1;const i=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Da.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=n.name,this.emitReserved("upgradeError",p)}}))};function o(){s||(s=!0,h(),n.close(),n=null)}const a=f=>{const p=new Error("probe error: "+f);p.transport=n.name,o(),this.emitReserved("upgradeError",p)};function l(){a("transport closed")}function c(){a("socket closed")}function d(f){n&&f.name!==n.name&&o()}const h=()=>{n.removeListener("open",i),n.removeListener("error",a),n.removeListener("close",l),this.off("close",c),this.off("upgrading",d)};n.once("open",i),n.once("error",a),n.once("close",l),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let VPe=class extends $Pe{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>RPe[i]).filter(i=>!!i)),super(t,s)}};function GPe(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=oS(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+t,s.href=s.protocol+"://"+o+(n&&n.port===s.port?"":":"+s.port),s}const zPe=typeof ArrayBuffer=="function",HPe=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Vq=Object.prototype.toString,WPe=typeof Blob=="function"||typeof Blob<"u"&&Vq.call(Blob)==="[object BlobConstructor]",UPe=typeof File=="function"||typeof File<"u"&&Vq.call(File)==="[object FileConstructor]";function U_(e){return zPe&&(e instanceof ArrayBuffer||HPe(e))||WPe&&e instanceof Blob||UPe&&e instanceof File}function o0(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(o0(e[n]))return!0;return!1}if(U_(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return o0(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&o0(e[n]))return!0;return!1}function qPe(e){const t=[],n=e.data,s=e;return s.data=lS(n,t),s.attachments=t.length,{packet:s,buffers:t}}function lS(e,t){if(!e)return e;if(U_(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=lS(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=lS(e[s],t));return n}return e}function KPe(e,t){return e.data=cS(e.data,t),delete e.attachments,e}function cS(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=cS(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=cS(e[n],t));return e}const ZPe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],YPe=5;var _t;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(_t||(_t={}));class XPe{constructor(t){this.replacer=t}encode(t){return(t.type===_t.EVENT||t.type===_t.ACK)&&o0(t)?this.encodeAsBinary({type:t.type===_t.EVENT?_t.BINARY_EVENT:_t.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===_t.BINARY_EVENT||t.type===_t.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=qPe(t),s=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(s),i}}function j3(e){return Object.prototype.toString.call(e)==="[object Object]"}class q_ extends Rn{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===_t.BINARY_EVENT;s||n.type===_t.BINARY_ACK?(n.type=s?_t.EVENT:_t.ACK,this.reconstructor=new QPe(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(U_(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(_t[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===_t.BINARY_EVENT||s.type===_t.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(o,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(o,n)}else s.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}s.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(q_.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case _t.CONNECT:return j3(n);case _t.DISCONNECT:return n===void 0;case _t.CONNECT_ERROR:return typeof n=="string"||j3(n);case _t.EVENT:case _t.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&ZPe.indexOf(n[0])===-1);case _t.ACK:case _t.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class QPe{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=KPe(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const JPe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:q_,Encoder:XPe,get PacketType(){return _t},protocol:YPe},Symbol.toStringTag,{value:"Module"}));function vi(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const eLe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gq extends Rn{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[vi(t,"open",this.onopen.bind(this)),vi(t,"packet",this.onpacket.bind(this)),vi(t,"error",this.onerror.bind(this)),vi(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,i,o;if(eLe.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:_t.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,f=n.pop();this._registerAckCallback(h,f),a.id=h}const l=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);n.call(this,new Error("operation has timed out"))},i),a=(...l)=>{this.io.clearTimeoutFn(o),n.apply(this,l)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((s,i)=>{const o=(a,l)=>a?i(a):s(l);o.withError=!0,n.push(o),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...o)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:_t.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case _t.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _t.EVENT:case _t.BINARY_EVENT:this.onevent(t);break;case _t.ACK:case _t.BINARY_ACK:this.onack(t);break;case _t.DISCONNECT:this.ondisconnect();break;case _t.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...i){s||(s=!0,n.packet({type:_t.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_t.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function Md(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Md.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};Md.prototype.reset=function(){this.attempts=0};Md.prototype.setMin=function(e){this.ms=e};Md.prototype.setMax=function(e){this.max=e};Md.prototype.setJitter=function(e){this.jitter=e};class uS extends Rn{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Uv(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Md({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||JPe;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new VPe(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=vi(n,"open",function(){s.onopen(),t&&t()}),o=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},a=vi(n,"error",o);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(vi(t,"ping",this.onping.bind(this)),vi(t,"data",this.ondata.bind(this)),vi(t,"error",this.onerror.bind(this)),vi(t,"close",this.onclose.bind(this)),vi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Wv(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new Gq(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const $h={};function a0(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=GPe(e,t.path||"/socket.io"),s=n.source,i=n.id,o=n.path,a=$h[i]&&o in $h[i].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let c;return l?c=new uS(s,t):($h[i]||($h[i]=new uS(s,t)),c=$h[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(a0,{Manager:uS,Socket:Gq,io:a0,connect:a0});const tLe=()=>{kt("useSocketIO");const e=jn(),t=ce(WP),n=ce(vp),s=ce(K4),i=u.useMemo(()=>{const a=window.location.protocol==="https:"?"wss":"ws";return t?t.replace(/^https?:\/\//i,""):`${a}://${window.location.host}`},[t]),o=u.useMemo(()=>{const a={timeout:6e4,path:t?"/ws/socket.io":`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0};return n&&(a.auth={token:n},a.transports=["websocket","polling"]),{...a,...s}},[n,s,t]);u.useEffect(()=>{const a=a0(i,o);tM.set(a),aPe({socket:a,store:e,setIsConnected:Wn.set}),a.connect(),Z4.get()&&(window.$socketOptions=K4,console.log("Socket initialized",a));const l=e.subscribe(()=>{const c=Vre(e.getState()).data;(!c||c.queue.in_progress===0)&&Fo.set(null)});return()=>{Z4.get()&&(window.$socketOptions=void 0,console.log("Socket teardown",a)),l(),a.disconnect()}},[o,i,e])};function nLe(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects"];for(const i of s){let o=e[i];if(o!==void 0){if(i==="labels"||i==="projects"){if(!Array.isArray(o))throw new TypeError(`The \`${i}\` option should be an array`);o=o.join(",")}n.searchParams.set(i,o)}}return n.toString()}const sLe=pe(Ar,e=>e.isLocal),rLe=({error:e,resetErrorBoundary:t})=>{const{t:n}=M(),s=I(sLe),i=na(),o=u.useCallback(()=>{const l=JSON.stringify(Ds(e),null,2);i.writeText(`\`\`\`
${l}
\`\`\``,()=>{ve({id:"ERROR_COPIED",title:n("toast.errorCopied")})})},[i,e,n]),a=u.useMemo(()=>s?nLe({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}):"https://support.invoke.ai/support/tickets/new",[e.message,e.name,s]);return r.jsx(A,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:r.jsxs(A,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[r.jsxs(A,{alignItems:"center",gap:"2",children:[r.jsx(dn,{src:fq,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),r.jsx(Rt,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),r.jsx(A,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:r.jsxs(q,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),r.jsxs(A,{gap:4,children:[r.jsx(ye,{leftIcon:r.jsx(Di,{}),onClick:t,children:n("accessibility.resetUI")}),r.jsx(ye,{leftIcon:r.jsx(an,{}),onClick:o,children:n("common.copyError")}),r.jsx(oy,{href:a,isExternal:!0,children:r.jsx(ye,{leftIcon:r.jsx(Iy,{}),children:n(s?"accessibility.createIssue":"accessibility.submitSupportTicket")})})]})]})})},iLe=u.memo(rLe),oLe={},aLe=({config:e=oLe,studioInitAction:t})=>{const n=ce(GP),s=uL(),i=u.useCallback(()=>(s(),location.reload(),!1),[s]);return r.jsxs(QMe,{onReset:i,FallbackComponent:iLe,children:[r.jsxs(Se,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",children:[r.jsx(_q,{}),!n&&r.jsx(Gre,{})]}),r.jsx(zq,{config:e,studioInitAction:t}),r.jsx(ple,{}),r.jsx(toe,{}),r.jsx(_R,{}),r.jsx(dfe,{}),r.jsx(A7,{}),r.jsx(T7,{}),r.jsx(Tz,{}),r.jsx(Dz,{}),r.jsx(E7,{}),r.jsx(Mke,{}),r.jsx(nhe,{}),r.jsx(ffe,{}),r.jsx(nde,{}),r.jsx(aL,{}),r.jsx(hD,{}),r.jsx(fD,{}),r.jsx(HR,{}),r.jsx(_D,{}),r.jsx(K7,{}),r.jsx(bi,{children:r.jsx(aD,{})})]})},VLe=u.memo(aLe),zq=u.memo(({config:e,studioInitAction:t})=>{const n=I(Z7),s=cL("system"),i=z();return Uie(),tLe(),zre(),Xie(),fy(),Vie(),u.useEffect(()=>{ut.changeLanguage(n)},[n]),u.useEffect(()=>{LS(e)&&(s.info({config:e},"Received config"),i(Hre(e)))},[i,e,s]),u.useEffect(()=>{i(Wre())},[i]),Ure(t),Jde(),$ie(),bie(),null});zq.displayName="HookIsolator";export{VLe as default};
